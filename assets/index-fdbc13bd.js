var Wr=Object.defineProperty;var qr=(q,_,M)=>_ in q?Wr(q,_,{enumerable:!0,configurable:!0,writable:!0,value:M}):q[_]=M;var Ht=(q,_,M)=>(qr(q,typeof _!="symbol"?_+"":_,M),M),Cn=(q,_,M)=>{if(!_.has(q))throw TypeError("Cannot "+M)};var ye=(q,_,M)=>(Cn(q,_,"read from private field"),M?M.call(q):_.get(q)),Ge=(q,_,M)=>{if(_.has(q))throw TypeError("Cannot add the same private member more than once");_ instanceof WeakSet?_.add(q):_.set(q,M)},ut=(q,_,M,$)=>(Cn(q,_,"write to private field"),$?$.call(q,M):_.set(q,M),M);var rn=(q,_,M,$)=>({set _(j){ut(q,_,j,M)},get _(){return ye(q,_,$)}}),it=(q,_,M)=>(Cn(q,_,"access private method"),M);import{c as commonjsGlobal,r as require$$5,g as getDefaultExportFromCjs,n as nodeCrypto,s as split_css_unit,a as noop,b as subscribe,d as run_all,e as safe_not_equal,i as is_function,S as SvelteComponent,f as init,h as element,j as space,k as set_style,l as attr,m as insert,o as append,p as listen,q as detach,t as createEventDispatcher,u as binding_callbacks,v as create_component,w as text,x as mount_component,y as transition_in,z as group_outros,A as transition_out,B as check_outros,C as set_data,D as destroy_component,E as component_subscribe,F as onMount,G as add_render_callback,H as create_in_transition,I as create_bidirectional_transition,J as set_input_value,K as bubble,L as select_option,M as update_keyed_each,N as destroy_block,O as destroy_each,P as empty,Q as select_value,R as toggle_class,T as compute_rest_props,U as assign,V as exclude_internal_props,W as get_spread_update,X as get_spread_object,Y as construct_svelte_component,Z as getContext,_ as create_slot,$ as update_slot_base,a0 as get_all_dirty_from_scope,a1 as get_slot_changes,a2 as src_url_equal,a3 as HtmlTag,a4 as setContext,a5 as null_to_empty,a6 as create_out_transition,a7 as onDestroy,a8 as globals,a9 as tick,aa as svg_element,ab as handle_promise,ac as update_await_block_branch,ad as outro_and_destroy_block,ae as get_store_value,af as bind,ag as add_flush_callback,ah as afterUpdate,ai as set_store_value}from"./svelte-343d99a2.js";function _mergeNamespaces(q,_){for(var M=0;M<_.length;M++){const $=_[M];if(typeof $!="string"&&!Array.isArray($)){for(const j in $)if(j!=="default"&&!(j in q)){const z=Object.getOwnPropertyDescriptor($,j);z&&Object.defineProperty(q,j,z.get?z:{enumerable:!0,get:()=>$[j]})}}}return Object.freeze(Object.defineProperty(q,Symbol.toStringTag,{value:"Module"}))}(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const j of document.querySelectorAll('link[rel="modulepreload"]'))$(j);new MutationObserver(j=>{for(const z of j)if(z.type==="childList")for(const V of z.addedNodes)V.tagName==="LINK"&&V.rel==="modulepreload"&&$(V)}).observe(document,{childList:!0,subtree:!0});function M(j){const z={};return j.integrity&&(z.integrity=j.integrity),j.referrerPolicy&&(z.referrerPolicy=j.referrerPolicy),j.crossOrigin==="use-credentials"?z.credentials="include":j.crossOrigin==="anonymous"?z.credentials="omit":z.credentials="same-origin",z}function $(j){if(j.ep)return;j.ep=!0;const z=M(j);fetch(j.href,z)}})();const app="";class EarthstarError extends Error{constructor(_){super(_||""),this.name="EarthstarError"}}class ValidationError extends EarthstarError{constructor(_){super(_||"Validation error"),this.name="ValidationError"}}class ReplicaIsClosedError extends EarthstarError{constructor(_){super(_||"a Replica or ReplicaDriver was used after being closed"),this.name="ReplicaIsClosedError"}}class ReplicaCacheIsClosedError extends EarthstarError{constructor(_){super(_||"a ReplicaCache was used after being closed"),this.name="ReplicaCacheIsClosedError"}}class NotSupportedError extends EarthstarError{constructor(_){super(_||"Not supported"),this.name="NotSupportedError"}}function isErr(q){return q instanceof EarthstarError}function notErr(q){return!(q instanceof EarthstarError)}var dist$2={},crypto_types_gen={};Object.defineProperty(crypto_types_gen,"__esModule",{value:!0});(function(q){var _=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(z,V,G,X){X===void 0&&(X=G);var Y=Object.getOwnPropertyDescriptor(V,G);(!Y||("get"in Y?!V.__esModule:Y.writable||Y.configurable))&&(Y={enumerable:!0,get:function(){return V[G]}}),Object.defineProperty(z,X,Y)}:function(z,V,G,X){X===void 0&&(X=G),z[X]=V[G]}),M=commonjsGlobal&&commonjsGlobal.__exportStar||function(z,V){for(var G in z)G!=="default"&&!Object.prototype.hasOwnProperty.call(V,G)&&_(V,z,G)};Object.defineProperty(q,"__esModule",{value:!0}),q.crypto=void 0;const j=require$$5.webcrypto;q.crypto=j,M(crypto_types_gen,q)})(dist$2);var dist$1={};Object.defineProperty(dist$1,"__esModule",{value:!0});var setInterval_1=dist$1.setInterval=setTimeout_1=dist$1.setTimeout=void 0;const originalSetTimeout=globalThis.setTimeout;function setTimeout$1(q,_,...M){const $=originalSetTimeout(q,_,...M);return typeof $=="number"?$:$[Symbol.toPrimitive]()}var setTimeout_1=dist$1.setTimeout=setTimeout$1;const originalSetInterval=globalThis.setInterval;function setInterval$1(q,_,...M){const $=originalSetInterval(q,_,...M);return typeof $=="number"?$:$[Symbol.toPrimitive]()}setInterval_1=dist$1.setInterval=setInterval$1;var dist={},_a$2,_b;Object.defineProperty(dist,"__esModule",{value:!0});var WeakRef_1=dist.WeakRef=void 0;WeakRef_1=dist.WeakRef=(_a$2=globalThis.WeakRef)!==null&&_a$2!==void 0?_a$2:(_b=class{constructor(_){}deref(){throw new Error("WeakRef is not supported in Node 14 and below.")}},_b);const{Blob:Blob$1}=window,{Request,Response,Headers:Headers$1,fetch:fetch$1}=window,{ReadableStream:ReadableStream$1,ReadableStreamDefaultReader,ReadableStreamBYOBReader,ReadableStreamBYOBRequest,ReadableByteStreamController,ReadableStreamDefaultController,TransformStream,TransformStreamDefaultController,WritableStream,WritableStreamDefaultWriter,WritableStreamDefaultController,ByteLengthQueuingStrategy,CountQueuingStrategy,TextEncoderStream,TextDecoderStream}=window;if(!ReadableStream$1.prototype[Symbol.asyncIterator]){async function*q(){const _=this.getReader();try{for(;;){const{done:M,value:$}=await _.read();if(M)return;yield $}}finally{_.releaseLock()}}ReadableStream$1.prototype[Symbol.asyncIterator]=q}var ws=null;typeof WebSocket<"u"?ws=WebSocket:typeof MozWebSocket<"u"?ws=MozWebSocket:typeof global<"u"?ws=global.WebSocket||global.MozWebSocket:typeof window<"u"?ws=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(ws=self.WebSocket||self.MozWebSocket);const WebSocket$1=ws,{TextDecoder:TextDecoder$1,TextEncoder}=window;function u(q,_){for(var M=0;M<_.length;M++){var $=_[M];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(q,$.key,$)}}function D(q,_,M){return _&&u(q.prototype,_),M&&u(q,M),q}function t(q,_){(_==null||_>q.length)&&(_=q.length);for(var M=0,$=new Array(_);M<_;M++)$[M]=q[M];return $}function F(q,_){var M=typeof Symbol<"u"&&q[Symbol.iterator]||q["@@iterator"];if(M)return(M=M.call(q)).next.bind(M);if(Array.isArray(q)||(M=function(j,z){if(j){if(typeof j=="string")return t(j,z);var V=Object.prototype.toString.call(j).slice(8,-1);return V==="Object"&&j.constructor&&(V=j.constructor.name),V==="Map"||V==="Set"?Array.from(j):V==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(V)?t(j,z):void 0}}(q))||_&&q&&typeof q.length=="number"){M&&(q=M);var $=0;return function(){return $>=q.length?{done:!0}:{done:!1,value:q[$++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var e=/(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,C=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/;function A(q,_){return(_?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(q)}function E(q,_){_===void 0&&(_=!1);for(var M=[],$=0;$<q.length;){var j=q[$],z=function(te){if(!_)throw new TypeError(te);M.push({type:"INVALID_CHAR",index:$,value:q[$++]})};if(j!=="*")if(j!=="+"&&j!=="?")if(j!=="\\")if(j!=="{")if(j!=="}")if(j!==":")if(j!=="(")M.push({type:"CHAR",index:$,value:q[$++]});else{var V=1,G="",X=$+1,Y=!1;if(q[X]==="?"){z('Pattern cannot start with "?" at '+X);continue}for(;X<q.length;){if(!A(q[X],!1)){z("Invalid character '"+q[X]+"' at "+X+"."),Y=!0;break}if(q[X]!=="\\"){if(q[X]===")"){if(--V==0){X++;break}}else if(q[X]==="("&&(V++,q[X+1]!=="?")){z("Capturing groups are not allowed at "+X),Y=!0;break}G+=q[X++]}else G+=q[X++]+q[X++]}if(Y)continue;if(V){z("Unbalanced pattern at "+$);continue}if(!G){z("Missing pattern at "+$);continue}M.push({type:"PATTERN",index:$,value:G}),$=X}else{for(var Q="",Z=$+1;Z<q.length;){var ee=q.substr(Z,1);if(!(Z===$+1&&e.test(ee)||Z!==$+1&&C.test(ee)))break;Q+=q[Z++]}if(!Q){z("Missing parameter name at "+$);continue}M.push({type:"NAME",index:$,value:Q}),$=Z}else M.push({type:"CLOSE",index:$,value:q[$++]});else M.push({type:"OPEN",index:$,value:q[$++]});else M.push({type:"ESCAPED_CHAR",index:$++,value:q[$++]});else M.push({type:"MODIFIER",index:$,value:q[$++]});else M.push({type:"ASTERISK",index:$,value:q[$++]})}return M.push({type:"END",index:$,value:""}),M}function n(q,_){_===void 0&&(_={});for(var M=E(q),$=_.prefixes,j=$===void 0?"./":$,z="[^"+r(_.delimiter||"/#?")+"]+?",V=[],G=0,X=0,Y="",Q=new Set,Z=function(De){if(X<M.length&&M[X].type===De)return M[X++].value},ee=function(){return Z("MODIFIER")||Z("ASTERISK")},te=function(De){var ve=Z(De);if(ve!==void 0)return ve;var Ce=M[X];throw new TypeError("Unexpected "+Ce.type+" at "+Ce.index+", expected "+De)},ne=function(){for(var De,ve="";De=Z("CHAR")||Z("ESCAPED_CHAR");)ve+=De;return ve},re=_.encodePart||function(De){return De};X<M.length;){var ie=Z("CHAR"),se=Z("NAME"),le=Z("PATTERN");if(se||le||!Z("ASTERISK")||(le=".*"),se||le){var he=ie||"";j.indexOf(he)===-1&&(Y+=he,he=""),Y&&(V.push(re(Y)),Y="");var ce=se||G++;if(Q.has(ce))throw new TypeError("Duplicate name '"+ce+"'.");Q.add(ce),V.push({name:ce,prefix:re(he),suffix:"",pattern:le||z,modifier:ee()||""})}else{var ae=ie||Z("ESCAPED_CHAR");if(ae)Y+=ae;else if(Z("OPEN")){var de=ne(),ge=Z("NAME")||"",fe=Z("PATTERN")||"";ge||fe||!Z("ASTERISK")||(fe=".*");var oe=ne();te("CLOSE");var we=ee()||"";if(!ge&&!fe&&!we){Y+=de;continue}if(!ge&&!fe&&!de)continue;Y&&(V.push(re(Y)),Y=""),V.push({name:ge||(fe?G++:""),pattern:ge&&!fe?z:fe,prefix:re(de),suffix:re(oe),modifier:we})}else Y&&(V.push(re(Y)),Y=""),te("END")}}return V}function r(q){return q.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function i(q){return q&&q.sensitive?"u":"ui"}function s(q,_,M){M===void 0&&(M={});for(var $,j=M.strict,z=j!==void 0&&j,V=M.start,G=V===void 0||V,X=M.end,Y=X===void 0||X,Q=M.encode,Z=Q===void 0?function(ae){return ae}:Q,ee="["+r(M.endsWith||"")+"]|$",te="["+r(M.delimiter||"/#?")+"]",ne=G?"^":"",re=F(q);!($=re()).done;){var ie=$.value;if(typeof ie=="string")ne+=r(Z(ie));else{var se=r(Z(ie.prefix)),le=r(Z(ie.suffix));ie.pattern?(_&&_.push(ie),ne+=se||le?ie.modifier==="+"||ie.modifier==="*"?"(?:"+se+"((?:"+ie.pattern+")(?:"+le+se+"(?:"+ie.pattern+"))*)"+le+")"+(ie.modifier==="*"?"?":""):"(?:"+se+"("+ie.pattern+")"+le+")"+ie.modifier:ie.modifier==="+"||ie.modifier==="*"?"((?:"+ie.pattern+")"+ie.modifier+")":"("+ie.pattern+")"+ie.modifier):ne+="(?:"+se+le+")"+ie.modifier}}if(Y)z||(ne+=te+"?"),ne+=M.endsWith?"(?="+ee+")":"$";else{var he=q[q.length-1],ce=typeof he=="string"?te.indexOf(he[he.length-1])>-1:he===void 0;z||(ne+="(?:"+te+"(?="+ee+"))?"),ce||(ne+="(?="+te+"|"+ee+")")}return new RegExp(ne,i(M))}function a(q,_,M){return q instanceof RegExp?function($,j){if(!j)return $;for(var z=/\((?:\?<(.*?)>)?(?!\?)/g,V=0,G=z.exec($.source);G;)j.push({name:G[1]||V++,prefix:"",suffix:"",modifier:"",pattern:""}),G=z.exec($.source);return $}(q,_):Array.isArray(q)?function($,j,z){var V=$.map(function(G){return a(G,j,z).source});return new RegExp("(?:"+V.join("|")+")",i(z))}(q,_,M):function($,j,z){return s(n($,z),j,z)}(q,_,M)}var B={delimiter:"",prefixes:"",sensitive:!0,strict:!0},o={delimiter:".",prefixes:"",sensitive:!0,strict:!0},h={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function p(q,_){return q.startsWith(_)?q.substring(_.length,q.length):q}function c(q){return!(!q||q.length<2||q[0]!=="["&&(q[0]!=="\\"&&q[0]!=="{"||q[1]!=="["))}var f,l=["ftp","file","http","https","ws","wss"];function m(q){if(!q)return!0;for(var _,M=F(l);!(_=M()).done;)if(q.test(_.value))return!0;return!1}function d(q){switch(q){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function g(q){if(q==="")return q;if(/^[-+.A-Za-z0-9]*$/.test(q))return q.toLowerCase();throw new TypeError("Invalid protocol '"+q+"'.")}function x(q){if(q==="")return q;var _=new URL("https://example.com");return _.username=q,_.username}function S(q){if(q==="")return q;var _=new URL("https://example.com");return _.password=q,_.password}function v(q){if(q==="")return q;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(q))throw new TypeError("Invalid hostname '"+q+"'");var _=new URL("https://example.com");return _.hostname=q,_.hostname}function y(q){if(q==="")return q;if(/[^0-9a-fA-F[\]:]/g.test(q))throw new TypeError("Invalid IPv6 hostname '"+q+"'");return q.toLowerCase()}function R(q){if(q===""||/^[0-9]*$/.test(q)&&parseInt(q)<=65535)return q;throw new TypeError("Invalid port '"+q+"'.")}function k(q){if(q==="")return q;var _=new URL("https://example.com");return _.pathname=q[0]!=="/"?"/-"+q:q,q[0]!=="/"?_.pathname.substring(2,_.pathname.length):_.pathname}function w(q){return q===""?q:new URL("data:"+q).pathname}function P(q){if(q==="")return q;var _=new URL("https://example.com");return _.search=q,_.search.substring(1,_.search.length)}function T(q){if(q==="")return q;var _=new URL("https://example.com");return _.hash=q,_.hash.substring(1,_.hash.length)}(function(q){q[q.INIT=0]="INIT",q[q.PROTOCOL=1]="PROTOCOL",q[q.AUTHORITY=2]="AUTHORITY",q[q.USERNAME=3]="USERNAME",q[q.PASSWORD=4]="PASSWORD",q[q.HOSTNAME=5]="HOSTNAME",q[q.PORT=6]="PORT",q[q.PATHNAME=7]="PATHNAME",q[q.SEARCH=8]="SEARCH",q[q.HASH=9]="HASH",q[q.DONE=10]="DONE"})(f||(f={}));var b=function(){function q(M){this.input=void 0,this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=f.INIT,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=M}var _=q.prototype;return _.parse=function(){for(this.tokenList=E(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===f.INIT){this.rewind(),this.isHashPrefix()?this.changeState(f.HASH,1):this.isSearchPrefix()?(this.changeState(f.SEARCH,1),this.internalResult.hash=""):(this.changeState(f.PATHNAME,0),this.internalResult.search="",this.internalResult.hash="");continue}if(this.state===f.AUTHORITY){this.rewindAndSetState(f.HOSTNAME);continue}this.changeState(f.DONE,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case f.INIT:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(f.PROTOCOL));break;case f.PROTOCOL:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();var M=f.PATHNAME,$=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(M=f.AUTHORITY,$=3):this.shouldTreatAsStandardURL&&(M=f.AUTHORITY),this.changeState(M,$)}break;case f.AUTHORITY:this.isIdentityTerminator()?this.rewindAndSetState(f.USERNAME):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(f.HOSTNAME);break;case f.USERNAME:this.isPasswordPrefix()?this.changeState(f.PASSWORD,1):this.isIdentityTerminator()&&this.changeState(f.HOSTNAME,1);break;case f.PASSWORD:this.isIdentityTerminator()&&this.changeState(f.HOSTNAME,1);break;case f.HOSTNAME:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(f.PORT,1):this.isPathnameStart()?this.changeState(f.PATHNAME,0):this.isSearchPrefix()?this.changeState(f.SEARCH,1):this.isHashPrefix()&&this.changeState(f.HASH,1);break;case f.PORT:this.isPathnameStart()?this.changeState(f.PATHNAME,0):this.isSearchPrefix()?this.changeState(f.SEARCH,1):this.isHashPrefix()&&this.changeState(f.HASH,1);break;case f.PATHNAME:this.isSearchPrefix()?this.changeState(f.SEARCH,1):this.isHashPrefix()&&this.changeState(f.HASH,1);break;case f.SEARCH:this.isHashPrefix()&&this.changeState(f.HASH,1)}}},_.changeState=function(M,$){switch(this.state){case f.INIT:break;case f.PROTOCOL:this.internalResult.protocol=this.makeComponentString();break;case f.AUTHORITY:break;case f.USERNAME:this.internalResult.username=this.makeComponentString();break;case f.PASSWORD:this.internalResult.password=this.makeComponentString();break;case f.HOSTNAME:this.internalResult.hostname=this.makeComponentString();break;case f.PORT:this.internalResult.port=this.makeComponentString();break;case f.PATHNAME:this.internalResult.pathname=this.makeComponentString();break;case f.SEARCH:this.internalResult.search=this.makeComponentString();break;case f.HASH:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(M,$)},_.changeStateWithoutSettingComponent=function(M,$){this.state=M,this.componentStart=this.tokenIndex+$,this.tokenIndex+=$,this.tokenIncrement=0},_.rewind=function(){this.tokenIndex=this.componentStart,this.tokenIncrement=0},_.rewindAndSetState=function(M){this.rewind(),this.state=M},_.safeToken=function(M){return M<0&&(M=this.tokenList.length-M),M<this.tokenList.length?this.tokenList[M]:this.tokenList[this.tokenList.length-1]},_.isNonSpecialPatternChar=function(M,$){var j=this.safeToken(M);return j.value===$&&(j.type==="CHAR"||j.type==="ESCAPED_CHAR"||j.type==="INVALID_CHAR")},_.isProtocolSuffix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},_.nextIsAuthoritySlashes=function(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")},_.isIdentityTerminator=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")},_.isPasswordPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},_.isPortPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},_.isPathnameStart=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")},_.isSearchPrefix=function(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;var M=this.safeToken(this.tokenIndex-1);return M.type!=="NAME"&&M.type!=="PATTERN"&&M.type!=="CLOSE"&&M.type!=="ASTERISK"},_.isHashPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")},_.isGroupOpen=function(){return this.tokenList[this.tokenIndex].type=="OPEN"},_.isGroupClose=function(){return this.tokenList[this.tokenIndex].type=="CLOSE"},_.isIPv6Open=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")},_.isIPv6Close=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")},_.makeComponentString=function(){var M=this.tokenList[this.tokenIndex],$=this.safeToken(this.componentStart).index;return this.input.substring($,M.index)},_.computeShouldTreatAsStandardURL=function(){var M={};Object.assign(M,B),M.encodePart=g;var $=a(this.makeComponentString(),void 0,M);this.shouldTreatAsStandardURL=m($)},D(q,[{key:"result",get:function(){return this.internalResult}}]),q}(),I=["protocol","username","password","hostname","port","pathname","search","hash"];function O(q,_){if(typeof q!="string")throw new TypeError("parameter 1 is not of type 'string'.");var M=new URL(q,_);return{protocol:M.protocol.substring(0,M.protocol.length-1),username:M.username,password:M.password,hostname:M.hostname,port:M.port,pathname:M.pathname,search:M.search!=""?M.search.substring(1,M.search.length):void 0,hash:M.hash!=""?M.hash.substring(1,M.hash.length):void 0}}function H(q,_,M){var $;if(typeof _.baseURL=="string")try{$=new URL(_.baseURL),q.protocol=$.protocol?$.protocol.substring(0,$.protocol.length-1):"",q.username=$.username,q.password=$.password,q.hostname=$.hostname,q.port=$.port,q.pathname=$.pathname,q.search=$.search?$.search.substring(1,$.search.length):"",q.hash=$.hash?$.hash.substring(1,$.hash.length):""}catch{throw new TypeError("invalid baseURL '"+_.baseURL+"'.")}if(typeof _.protocol=="string"&&(q.protocol=function(z,V){var G;return z=(G=z).endsWith(":")?G.substr(0,G.length-1):G,V||z===""?z:g(z)}(_.protocol,M)),typeof _.username=="string"&&(q.username=function(z,V){if(V||z==="")return z;var G=new URL("https://example.com");return G.username=z,G.username}(_.username,M)),typeof _.password=="string"&&(q.password=function(z,V){if(V||z==="")return z;var G=new URL("https://example.com");return G.password=z,G.password}(_.password,M)),typeof _.hostname=="string"&&(q.hostname=function(z,V){return V||z===""?z:c(z)?y(z):v(z)}(_.hostname,M)),typeof _.port=="string"&&(q.port=function(z,V,G){return d(V)===z&&(z=""),G||z===""?z:R(z)}(_.port,q.protocol,M)),typeof _.pathname=="string"){if(q.pathname=_.pathname,$&&!function(z,V){return!(!z.length||z[0]!=="/"&&(!V||z.length<2||z[0]!="\\"&&z[0]!="{"||z[1]!="/"))}(q.pathname,M)){var j=$.pathname.lastIndexOf("/");j>=0&&(q.pathname=$.pathname.substring(0,j+1)+q.pathname)}q.pathname=function(z,V,G){if(G||z==="")return z;if(V&&!l.includes(V))return new URL(V+":"+z).pathname;var X=z[0]=="/";return z=new URL(X?z:"/-"+z,"https://example.com").pathname,X||(z=z.substring(2,z.length)),z}(q.pathname,q.protocol,M)}return typeof _.search=="string"&&(q.search=function(z,V){if(z=p(z,"?"),V||z==="")return z;var G=new URL("https://example.com");return G.search=z,G.search?G.search.substring(1,G.search.length):""}(_.search,M)),typeof _.hash=="string"&&(q.hash=function(z,V){if(z=p(z,"#"),V||z==="")return z;var G=new URL("https://example.com");return G.hash=z,G.hash?G.hash.substring(1,G.hash.length):""}(_.hash,M)),q}function N(q){return q.replace(/([+*?:{}()\\])/g,"\\$1")}function L(q,_){for(var M="[^"+(_.delimiter||"/#?").replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")+"]+?",$=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/,j="",z=0;z<q.length;++z){var V=q[z],G=z>0?q[z-1]:null,X=z<q.length-1?q[z+1]:null;if(typeof V!="string")if(V.pattern!==""){var Y=typeof V.name!="number",Q=_.prefixes!==void 0?_.prefixes:"./",Z=V.suffix!==""||V.prefix!==""&&(V.prefix.length!==1||!Q.includes(V.prefix));Z||!Y||V.pattern!==M||V.modifier!==""||!X||X.prefix||X.suffix||(Z=typeof X=="string"?$.test(X.length>0?X[0]:""):typeof X.name=="number"),!Z&&V.prefix===""&&G&&typeof G=="string"&&G.length>0&&(Z=Q.includes(G[G.length-1])),Z&&(j+="{"),j+=N(V.prefix),Y&&(j+=":"+V.name),V.pattern===".*"?j+=Y||G&&typeof G!="string"&&!G.modifier&&!Z&&V.prefix===""?"(.*)":"*":V.pattern===M?Y||(j+="("+M+")"):j+="("+V.pattern+")",V.pattern===M&&Y&&V.suffix!==""&&$.test(V.suffix[0])&&(j+="\\"),j+=N(V.suffix),Z&&(j+="}"),j+=V.modifier}else{if(V.modifier===""){j+=N(V.prefix);continue}j+="{"+N(V.prefix)+"}"+V.modifier}else j+=N(V)}return j}var U=function(){function q(M,$){M===void 0&&(M={}),this.pattern=void 0,this.regexp={},this.keys={},this.component_pattern={};try{if(typeof M=="string"){var j=new b(M);if(j.parse(),M=j.result,$){if(typeof $!="string")throw new TypeError("'baseURL' parameter is not of type 'string'.");M.baseURL=$}else if(typeof M.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if($)throw new TypeError("parameter 1 is not of type 'string'.");if(!M||typeof M!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");var z;this.pattern=H({pathname:"*",protocol:"*",username:"*",password:"*",hostname:"*",port:"*",search:"*",hash:"*"},M,!0),d(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");for(var V,G=F(I);!(V=G()).done;)if((z=V.value)in this.pattern){var X={},Y=this.pattern[z];switch(this.keys[z]=[],z){case"protocol":Object.assign(X,B),X.encodePart=g;break;case"username":Object.assign(X,B),X.encodePart=x;break;case"password":Object.assign(X,B),X.encodePart=S;break;case"hostname":Object.assign(X,o),X.encodePart=c(Y)?y:v;break;case"port":Object.assign(X,B),X.encodePart=R;break;case"pathname":m(this.regexp.protocol)?(Object.assign(X,h),X.encodePart=k):(Object.assign(X,B),X.encodePart=w);break;case"search":Object.assign(X,B),X.encodePart=P;break;case"hash":Object.assign(X,B),X.encodePart=T}try{var Q=n(Y,X);this.regexp[z]=s(Q,this.keys[z],X),this.component_pattern[z]=L(Q,X)}catch{throw new TypeError("invalid "+z+" pattern '"+this.pattern[z]+"'.")}}}catch(Z){throw new TypeError("Failed to construct 'URLPattern': "+Z.message)}}var _=q.prototype;return _.test=function(M,$){M===void 0&&(M={});var j,z={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof M!="string"&&$)throw new TypeError("parameter 1 is not of type 'string'.");if(M===void 0)return!1;try{z=H(z,typeof M=="object"?M:O(M,$),!1)}catch{return!1}for(j in this.pattern)if(!this.regexp[j].exec(z[j]))return!1;return!0},_.exec=function(M,$){M===void 0&&(M={});var j={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof M!="string"&&$)throw new TypeError("parameter 1 is not of type 'string'.");if(M!==void 0){try{j=H(j,typeof M=="object"?M:O(M,$),!1)}catch{return null}var z,V={};for(z in V.inputs=$?[M,$]:[M],this.pattern){var G=this.regexp[z].exec(j[z]);if(!G)return null;for(var X,Y={},Q=F(this.keys[z].entries());!(X=Q()).done;){var Z=X.value,ee=Z[1];typeof ee.name!="string"&&typeof ee.name!="number"||(Y[ee.name]=G[Z[0]+1]||"")}V[z]={input:j[z]||"",groups:Y}}return V}},D(q,[{key:"protocol",get:function(){return this.component_pattern.protocol}},{key:"username",get:function(){return this.component_pattern.username}},{key:"password",get:function(){return this.component_pattern.password}},{key:"hostname",get:function(){return this.component_pattern.hostname}},{key:"port",get:function(){return this.component_pattern.port}},{key:"pathname",get:function(){return this.component_pattern.pathname}},{key:"search",get:function(){return this.component_pattern.search}},{key:"hash",get:function(){return this.component_pattern.hash}}]),q}();const dntGlobals={crypto:dist$2.crypto,setInterval:setInterval_1,setTimeout:setTimeout_1,WeakRef:WeakRef_1,Blob:Blob$1,Request,Response,Headers:Headers$1,WritableStream,TransformStream,ReadableStream:ReadableStream$1,TransformStreamDefaultController,WritableStreamDefaultWriter,WebSocket:WebSocket$1,TextEncoder,TextDecoder:TextDecoder$1,URLPattern:U},dntGlobalThis=createMergeProxy(globalThis,dntGlobals);function createMergeProxy(q,_){return new Proxy(q,{get(M,$,j){return $ in _?_[$]:q[$]},set(M,$,j){return $ in _&&delete _[$],q[$]=j,!0},deleteProperty(M,$){let j=!1;return $ in _&&(delete _[$],j=!0),$ in q&&(delete q[$],j=!0),j},ownKeys(M){const $=Reflect.ownKeys(q),j=Reflect.ownKeys(_),z=new Set(j);return[...$.filter(V=>!z.has(V)),...j]},defineProperty(M,$,j){return $ in _&&delete _[$],Reflect.defineProperty(q,$,j),!0},getOwnPropertyDescriptor(M,$){return $ in _?Reflect.getOwnPropertyDescriptor(_,$):Reflect.getOwnPropertyDescriptor(q,$)},has(M,$){return $ in _||$ in q}})}function shallowEqualArrays(q,_){if(q===_)return!0;if(!q||!_)return!1;var M=q.length;if(_.length!==M)return!1;for(var $=0;$<M;$++)if(q[$]!==_[$])return!1;return!0}function shallowEqualObjects(q,_){if(q===_)return!0;if(!q||!_)return!1;var M=Object.keys(q),$=Object.keys(_),j=M.length;if($.length!==j)return!1;for(var z=0;z<j;z++){var V=M[z];if(q[V]!==_[V]||!Object.prototype.hasOwnProperty.call(_,V))return!1}return!0}var fastJsonStableStringify=function(q,_){_||(_={}),typeof _=="function"&&(_={cmp:_});var M=typeof _.cycles=="boolean"?_.cycles:!1,$=_.cmp&&function(z){return function(V){return function(G,X){var Y={key:G,value:V[G]},Q={key:X,value:V[X]};return z(Y,Q)}}}(_.cmp),j=[];return function z(V){if(V&&V.toJSON&&typeof V.toJSON=="function"&&(V=V.toJSON()),V!==void 0){if(typeof V=="number")return isFinite(V)?""+V:"null";if(typeof V!="object")return JSON.stringify(V);var G,X;if(Array.isArray(V)){for(X="[",G=0;G<V.length;G++)G&&(X+=","),X+=z(V[G])||"null";return X+"]"}if(V===null)return"null";if(j.indexOf(V)!==-1){if(M)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var Y=j.push(V)-1,Q=Object.keys(V).sort($&&$(V));for(X="",G=0;G<Q.length;G++){var Z=Q[G],ee=z(V[Z]);ee&&(X&&(X+=","),X+=JSON.stringify(Z)+":"+ee)}return j.splice(Y,1),"{"+X+"}"}}(q)};const stringify$1=getDefaultExportFromCjs(fastJsonStableStringify);var lib={};Object.defineProperty(lib,"__esModule",{value:!0});function parse(q,_,M){var $;if(M===void 0&&(M={}),!_.codes){_.codes={};for(var j=0;j<_.chars.length;++j)_.codes[_.chars[j]]=j}if(!M.loose&&q.length*_.bits&7)throw new SyntaxError("Invalid padding");for(var z=q.length;q[z-1]==="=";)if(--z,!M.loose&&!((q.length-z)*_.bits&7))throw new SyntaxError("Invalid padding");for(var V=new(($=M.out)!=null?$:Uint8Array)(z*_.bits/8|0),G=0,X=0,Y=0,Q=0;Q<z;++Q){var Z=_.codes[q[Q]];if(Z===void 0)throw new SyntaxError("Invalid character "+q[Q]);X=X<<_.bits|Z,G+=_.bits,G>=8&&(G-=8,V[Y++]=255&X>>G)}if(G>=_.bits||255&X<<8-G)throw new SyntaxError("Unexpected end of data");return V}function stringify(q,_,M){M===void 0&&(M={});for(var $=M,j=$.pad,z=j===void 0?!0:j,V=(1<<_.bits)-1,G="",X=0,Y=0,Q=0;Q<q.length;++Q)for(Y=Y<<8|255&q[Q],X+=8;X>_.bits;)X-=_.bits,G+=_.chars[V&Y>>X];if(X&&(G+=_.chars[V&Y<<_.bits-X]),z)for(;G.length*_.bits&7;)G+="=";return G}var base16Encoding={chars:"0123456789ABCDEF",bits:4},base32Encoding={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},base32HexEncoding={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},base64Encoding={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},base64UrlEncoding={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},base16$1={parse:function(_,M){return parse(_.toUpperCase(),base16Encoding,M)},stringify:function(_,M){return stringify(_,base16Encoding,M)}},base32$1={parse:function(_,M){return M===void 0&&(M={}),parse(M.loose?_.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):_,base32Encoding,M)},stringify:function(_,M){return stringify(_,base32Encoding,M)}},base32hex$1={parse:function(_,M){return parse(_,base32HexEncoding,M)},stringify:function(_,M){return stringify(_,base32HexEncoding,M)}},base64$1={parse:function(_,M){return parse(_,base64Encoding,M)},stringify:function(_,M){return stringify(_,base64Encoding,M)}},base64url$1={parse:function(_,M){return parse(_,base64UrlEncoding,M)},stringify:function(_,M){return stringify(_,base64UrlEncoding,M)}},codec$2={parse,stringify};lib.base16=base16$1;lib.base32=base32$1;lib.base32hex=base32hex$1;lib.base64=base64$1;lib.base64url=base64url$1;lib.codec=codec$2;const base16=lib.base16,base32=lib.base32,base32hex=lib.base32hex,base64=lib.base64,base64url=lib.base64url,codec$1=lib.codec,rfc4648=Object.freeze(Object.defineProperty({__proto__:null,base16,base32,base32hex,base64,base64url,codec:codec$1,default:lib},Symbol.toStringTag,{value:"Module"}));var sha256Uint8array={};Object.defineProperty(sha256Uint8array,"__esModule",{value:!0});var Hash_1=sha256Uint8array.Hash=createHash_1=sha256Uint8array.createHash=void 0;const K=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],algorithms={sha256:1};function createHash$1(q){if(q&&!algorithms[q]&&!algorithms[q.toLowerCase()])throw new Error("Digest method not supported");return new Hash}var createHash_1=sha256Uint8array.createHash=createHash$1;class Hash{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!sharedBuffer||sharedOffset>=8e3)&&(sharedBuffer=new ArrayBuffer(8e3),sharedOffset=0),this._byte=new Uint8Array(sharedBuffer,sharedOffset,80),this._word=new Int32Array(sharedBuffer,sharedOffset,20),sharedOffset+=80}update(_){if(typeof _=="string")return this._utf8(_);if(_==null)throw new TypeError("Invalid type: "+typeof _);const M=_.byteOffset,$=_.byteLength;let j=$/64|0,z=0;if(j&&!(M&3)&&!(this._size%64)){const G=new Int32Array(_.buffer,M,j*16);for(;j--;)this._int32(G,z>>2),z+=64;this._size+=z}if(_.BYTES_PER_ELEMENT!==1&&_.buffer){const G=new Uint8Array(_.buffer,M+z,$-z);return this._uint8(G)}return z===$?this:this._uint8(_,z)}_uint8(_,M){const{_byte:$,_word:j}=this,z=_.length;for(M=M|0;M<z;){const V=this._size%64;let G=V;for(;M<z&&G<64;)$[G++]=_[M++];G>=64&&this._int32(j),this._size+=G-V}return this}_utf8(_){const{_byte:M,_word:$}=this,j=_.length;let z=this._sp;for(let V=0;V<j;){const G=this._size%64;let X=G;for(;V<j&&X<64;){let Y=_.charCodeAt(V++)|0;Y<128?M[X++]=Y:Y<2048?(M[X++]=192|Y>>>6,M[X++]=128|Y&63):Y<55296||Y>57343?(M[X++]=224|Y>>>12,M[X++]=128|Y>>>6&63,M[X++]=128|Y&63):z?(Y=((z&1023)<<10)+(Y&1023)+65536,M[X++]=240|Y>>>18,M[X++]=128|Y>>>12&63,M[X++]=128|Y>>>6&63,M[X++]=128|Y&63,z=0):z=Y}X>=64&&(this._int32($),$[0]=$[16]),this._size+=X-G}return this._sp=z,this}_int32(_,M){let{A:$,B:j,C:z,D:V,E:G,F:X,G:Y,H:Q}=this,Z=0;for(M=M|0;Z<16;)W[Z++]=swap32(_[M++]);for(Z=16;Z<64;Z++)W[Z]=gamma1(W[Z-2])+W[Z-7]+gamma0(W[Z-15])+W[Z-16]|0;for(Z=0;Z<64;Z++){const ee=Q+sigma1(G)+ch(G,X,Y)+K[Z]+W[Z]|0,te=sigma0($)+maj($,j,z)|0;Q=Y,Y=X,X=G,G=V+ee|0,V=z,z=j,j=$,$=ee+te|0}this.A=$+this.A|0,this.B=j+this.B|0,this.C=z+this.C|0,this.D=V+this.D|0,this.E=G+this.E|0,this.F=X+this.F|0,this.G=Y+this.G|0,this.H=Q+this.H|0}digest(_){const{_byte:M,_word:$}=this;let j=this._size%64|0;for(M[j++]=128;j&3;)M[j++]=0;if(j>>=2,j>14){for(;j<16;)$[j++]=0;j=0,this._int32($)}for(;j<16;)$[j++]=0;const z=this._size*8,V=(z&4294967295)>>>0,G=(z-V)/4294967296;return G&&($[14]=swap32(G)),V&&($[15]=swap32(V)),this._int32($),_==="hex"?this._hex():this._bin()}_hex(){const{A:_,B:M,C:$,D:j,E:z,F:V,G,H:X}=this;return hex32(_)+hex32(M)+hex32($)+hex32(j)+hex32(z)+hex32(V)+hex32(G)+hex32(X)}_bin(){const{A:_,B:M,C:$,D:j,E:z,F:V,G,H:X,_byte:Y,_word:Q}=this;return Q[0]=swap32(_),Q[1]=swap32(M),Q[2]=swap32($),Q[3]=swap32(j),Q[4]=swap32(z),Q[5]=swap32(V),Q[6]=swap32(G),Q[7]=swap32(X),Y.slice(0,32)}}Hash_1=sha256Uint8array.Hash=Hash;const W=new Int32Array(64);let sharedBuffer,sharedOffset=0;const hex32=q=>(q+4294967296).toString(16).substr(-8),swapLE=q=>q<<24&4278190080|q<<8&16711680|q>>8&65280|q>>24&255,swapBE=q=>q,swap32=isBE()?swapBE:swapLE,ch=(q,_,M)=>M^q&(_^M),maj=(q,_,M)=>q&_|M&(q|_),sigma0=q=>(q>>>2|q<<30)^(q>>>13|q<<19)^(q>>>22|q<<10),sigma1=q=>(q>>>6|q<<26)^(q>>>11|q<<21)^(q>>>25|q<<7),gamma0=q=>(q>>>7|q<<25)^(q>>>18|q<<14)^q>>>3,gamma1=q=>(q>>>17|q<<15)^(q>>>19|q<<13)^q>>>10;function isBE(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}const sha256_uint8array=_mergeNamespaces({__proto__:null,get Hash(){return Hash_1},get createHash(){return createHash_1},default:sha256Uint8array},[sha256Uint8array]);/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const _0n=BigInt(0),_1n=BigInt(1),_2n=BigInt(2),_255n=BigInt(255),CURVE_ORDER=_2n**BigInt(252)+BigInt("27742317777372353535851937790883648493"),CURVE={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:_2n**_255n-BigInt(19),l:CURVE_ORDER,n:CURVE_ORDER,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},MAX_256B=_2n**BigInt(256),SQRT_M1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const SQRT_AD_MINUS_ONE=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),INVSQRT_A_MINUS_D=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),ONE_MINUS_D_SQ=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),D_MINUS_ONE_SQ=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class ExtendedPoint{constructor(_,M,$,j){this.x=_,this.y=M,this.z=$,this.t=j}static fromAffine(_){if(!(_ instanceof Point))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return _.equals(Point.ZERO)?ExtendedPoint.ZERO:new ExtendedPoint(_.x,_.y,_1n,mod(_.x*_.y))}static toAffineBatch(_){const M=invertBatch(_.map($=>$.z));return _.map(($,j)=>$.toAffine(M[j]))}static normalizeZ(_){return this.toAffineBatch(_).map(this.fromAffine)}equals(_){assertExtPoint(_);const{x:M,y:$,z:j}=this,{x:z,y:V,z:G}=_,X=mod(M*G),Y=mod(z*j),Q=mod($*G),Z=mod(V*j);return X===Y&&Q===Z}negate(){return new ExtendedPoint(mod(-this.x),this.y,this.z,mod(-this.t))}double(){const{x:_,y:M,z:$}=this,{a:j}=CURVE,z=mod(_**_2n),V=mod(M**_2n),G=mod(_2n*mod($**_2n)),X=mod(j*z),Y=mod(mod((_+M)**_2n)-z-V),Q=X+V,Z=Q-G,ee=X-V,te=mod(Y*Z),ne=mod(Q*ee),re=mod(Y*ee),ie=mod(Z*Q);return new ExtendedPoint(te,ne,ie,re)}add(_){assertExtPoint(_);const{x:M,y:$,z:j,t:z}=this,{x:V,y:G,z:X,t:Y}=_,Q=mod(($-M)*(G+V)),Z=mod(($+M)*(G-V)),ee=mod(Z-Q);if(ee===_0n)return this.double();const te=mod(j*_2n*Y),ne=mod(z*_2n*X),re=ne+te,ie=Z+Q,se=ne-te,le=mod(re*ee),he=mod(ie*se),ce=mod(re*se),ae=mod(ee*ie);return new ExtendedPoint(le,he,ae,ce)}subtract(_){return this.add(_.negate())}precomputeWindow(_){const M=1+256/_,$=[];let j=this,z=j;for(let V=0;V<M;V++){z=j,$.push(z);for(let G=1;G<2**(_-1);G++)z=z.add(j),$.push(z);j=z.double()}return $}wNAF(_,M){!M&&this.equals(ExtendedPoint.BASE)&&(M=Point.BASE);const $=M&&M._WINDOW_SIZE||1;if(256%$)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let j=M&&pointPrecomputes.get(M);j||(j=this.precomputeWindow($),M&&$!==1&&(j=ExtendedPoint.normalizeZ(j),pointPrecomputes.set(M,j)));let z=ExtendedPoint.ZERO,V=ExtendedPoint.ZERO;const G=1+256/$,X=2**($-1),Y=BigInt(2**$-1),Q=2**$,Z=BigInt($);for(let ee=0;ee<G;ee++){const te=ee*X;let ne=Number(_&Y);if(_>>=Z,ne>X&&(ne-=Q,_+=_1n),ne===0){let re=j[te];ee%2&&(re=re.negate()),V=V.add(re)}else{let re=j[te+Math.abs(ne)-1];ne<0&&(re=re.negate()),z=z.add(re)}}return ExtendedPoint.normalizeZ([z,V])[0]}multiply(_,M){return this.wNAF(normalizeScalar(_,CURVE.l),M)}multiplyUnsafe(_){let M=normalizeScalar(_,CURVE.l,!1);const $=ExtendedPoint.BASE,j=ExtendedPoint.ZERO;if(M===_0n)return j;if(this.equals(j)||M===_1n)return this;if(this.equals($))return this.wNAF(M);let z=j,V=this;for(;M>_0n;)M&_1n&&(z=z.add(V)),V=V.double(),M>>=_1n;return z}isSmallOrder(){return this.multiplyUnsafe(CURVE.h).equals(ExtendedPoint.ZERO)}isTorsionFree(){return this.multiplyUnsafe(CURVE.l).equals(ExtendedPoint.ZERO)}toAffine(_=invert(this.z)){const{x:M,y:$,z:j}=this,z=mod(M*_),V=mod($*_);if(mod(j*_)!==_1n)throw new Error("invZ was invalid");return new Point(z,V)}fromRistrettoBytes(){legacyRist()}toRistrettoBytes(){legacyRist()}fromRistrettoHash(){legacyRist()}}ExtendedPoint.BASE=new ExtendedPoint(CURVE.Gx,CURVE.Gy,_1n,mod(CURVE.Gx*CURVE.Gy));ExtendedPoint.ZERO=new ExtendedPoint(_0n,_1n,_1n,_0n);function assertExtPoint(q){if(!(q instanceof ExtendedPoint))throw new TypeError("ExtendedPoint expected")}function assertRstPoint(q){if(!(q instanceof RistrettoPoint))throw new TypeError("RistrettoPoint expected")}function legacyRist(){throw new Error("Legacy method: switch to RistrettoPoint")}class RistrettoPoint{constructor(_){this.ep=_}static calcElligatorRistrettoMap(_){const{d:M}=CURVE,$=mod(SQRT_M1*_*_),j=mod(($+_1n)*ONE_MINUS_D_SQ);let z=BigInt(-1);const V=mod((z-M*$)*mod($+M));let{isValid:G,value:X}=uvRatio(j,V),Y=mod(X*_);edIsNegative(Y)||(Y=mod(-Y)),G||(X=Y),G||(z=$);const Q=mod(z*($-_1n)*D_MINUS_ONE_SQ-V),Z=X*X,ee=mod((X+X)*V),te=mod(Q*SQRT_AD_MINUS_ONE),ne=mod(_1n-Z),re=mod(_1n+Z);return new ExtendedPoint(mod(ee*re),mod(ne*te),mod(te*re),mod(ee*ne))}static hashToCurve(_){_=ensureBytes(_,64);const M=bytes255ToNumberLE(_.slice(0,32)),$=this.calcElligatorRistrettoMap(M),j=bytes255ToNumberLE(_.slice(32,64)),z=this.calcElligatorRistrettoMap(j);return new RistrettoPoint($.add(z))}static fromHex(_){_=ensureBytes(_,32);const{a:M,d:$}=CURVE,j="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",z=bytes255ToNumberLE(_);if(!equalBytes(numberTo32BytesLE(z),_)||edIsNegative(z))throw new Error(j);const V=mod(z*z),G=mod(_1n+M*V),X=mod(_1n-M*V),Y=mod(G*G),Q=mod(X*X),Z=mod(M*$*Y-Q),{isValid:ee,value:te}=invertSqrt(mod(Z*Q)),ne=mod(te*X),re=mod(te*ne*Z);let ie=mod((z+z)*ne);edIsNegative(ie)&&(ie=mod(-ie));const se=mod(G*re),le=mod(ie*se);if(!ee||edIsNegative(le)||se===_0n)throw new Error(j);return new RistrettoPoint(new ExtendedPoint(ie,se,_1n,le))}toRawBytes(){let{x:_,y:M,z:$,t:j}=this.ep;const z=mod(mod($+M)*mod($-M)),V=mod(_*M),{value:G}=invertSqrt(mod(z*V**_2n)),X=mod(G*z),Y=mod(G*V),Q=mod(X*Y*j);let Z;if(edIsNegative(j*Q)){let te=mod(M*SQRT_M1),ne=mod(_*SQRT_M1);_=te,M=ne,Z=mod(X*INVSQRT_A_MINUS_D)}else Z=Y;edIsNegative(_*Q)&&(M=mod(-M));let ee=mod(($-M)*Z);return edIsNegative(ee)&&(ee=mod(-ee)),numberTo32BytesLE(ee)}toHex(){return bytesToHex(this.toRawBytes())}toString(){return this.toHex()}equals(_){assertRstPoint(_);const M=this.ep,$=_.ep,j=mod(M.x*$.y)===mod(M.y*$.x),z=mod(M.y*$.y)===mod(M.x*$.x);return j||z}add(_){return assertRstPoint(_),new RistrettoPoint(this.ep.add(_.ep))}subtract(_){return assertRstPoint(_),new RistrettoPoint(this.ep.subtract(_.ep))}multiply(_){return new RistrettoPoint(this.ep.multiply(_))}multiplyUnsafe(_){return new RistrettoPoint(this.ep.multiplyUnsafe(_))}}RistrettoPoint.BASE=new RistrettoPoint(ExtendedPoint.BASE);RistrettoPoint.ZERO=new RistrettoPoint(ExtendedPoint.ZERO);const pointPrecomputes=new WeakMap;class Point{constructor(_,M){this.x=_,this.y=M}_setWindowSize(_){this._WINDOW_SIZE=_,pointPrecomputes.delete(this)}static fromHex(_,M=!0){const{d:$,P:j}=CURVE;_=ensureBytes(_,32);const z=_.slice();z[31]=_[31]&-129;const V=bytesToNumberLE(z);if(M&&V>=j)throw new Error("Expected 0 < hex < P");if(!M&&V>=MAX_256B)throw new Error("Expected 0 < hex < 2**256");const G=mod(V*V),X=mod(G-_1n),Y=mod($*G+_1n);let{isValid:Q,value:Z}=uvRatio(X,Y);if(!Q)throw new Error("Point.fromHex: invalid y coordinate");const ee=(Z&_1n)===_1n;return(_[31]&128)!==0!==ee&&(Z=mod(-Z)),new Point(Z,V)}static async fromPrivateKey(_){return(await getExtendedPublicKey(_)).point}toRawBytes(){const _=numberTo32BytesLE(this.y);return _[31]|=this.x&_1n?128:0,_}toHex(){return bytesToHex(this.toRawBytes())}toX25519(){const{y:_}=this,M=mod((_1n+_)*invert(_1n-_));return numberTo32BytesLE(M)}isTorsionFree(){return ExtendedPoint.fromAffine(this).isTorsionFree()}equals(_){return this.x===_.x&&this.y===_.y}negate(){return new Point(mod(-this.x),this.y)}add(_){return ExtendedPoint.fromAffine(this).add(ExtendedPoint.fromAffine(_)).toAffine()}subtract(_){return this.add(_.negate())}multiply(_){return ExtendedPoint.fromAffine(this).multiply(_,this).toAffine()}}Point.BASE=new Point(CURVE.Gx,CURVE.Gy);Point.ZERO=new Point(_0n,_1n);class Signature{constructor(_,M){this.r=_,this.s=M,this.assertValidity()}static fromHex(_){const M=ensureBytes(_,64),$=Point.fromHex(M.slice(0,32),!1),j=bytesToNumberLE(M.slice(32,64));return new Signature($,j)}assertValidity(){const{r:_,s:M}=this;if(!(_ instanceof Point))throw new Error("Expected Point instance");return normalizeScalar(M,CURVE.l,!1),this}toRawBytes(){const _=new Uint8Array(64);return _.set(this.r.toRawBytes()),_.set(numberTo32BytesLE(this.s),32),_}toHex(){return bytesToHex(this.toRawBytes())}}function concatBytes(...q){if(!q.every($=>$ instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(q.length===1)return q[0];const _=q.reduce(($,j)=>$+j.length,0),M=new Uint8Array(_);for(let $=0,j=0;$<q.length;$++){const z=q[$];M.set(z,j),j+=z.length}return M}const hexes=Array.from({length:256},(q,_)=>_.toString(16).padStart(2,"0"));function bytesToHex(q){if(!(q instanceof Uint8Array))throw new Error("Uint8Array expected");let _="";for(let M=0;M<q.length;M++)_+=hexes[q[M]];return _}function hexToBytes(q){if(typeof q!="string")throw new TypeError("hexToBytes: expected string, got "+typeof q);if(q.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const _=new Uint8Array(q.length/2);for(let M=0;M<_.length;M++){const $=M*2,j=q.slice($,$+2),z=Number.parseInt(j,16);if(Number.isNaN(z)||z<0)throw new Error("Invalid byte sequence");_[M]=z}return _}function numberTo32BytesBE(q){const M=q.toString(16).padStart(64,"0");return hexToBytes(M)}function numberTo32BytesLE(q){return numberTo32BytesBE(q).reverse()}function edIsNegative(q){return(mod(q)&_1n)===_1n}function bytesToNumberLE(q){if(!(q instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+bytesToHex(Uint8Array.from(q).reverse()))}function bytes255ToNumberLE(q){return mod(bytesToNumberLE(q)&_2n**_255n-_1n)}function mod(q,_=CURVE.P){const M=q%_;return M>=_0n?M:_+M}function invert(q,_=CURVE.P){if(q===_0n||_<=_0n)throw new Error(`invert: expected positive integers, got n=${q} mod=${_}`);let M=mod(q,_),$=_,j=_0n,z=_1n;for(;M!==_0n;){const G=$/M,X=$%M,Y=j-z*G;$=M,M=X,j=z,z=Y}if($!==_1n)throw new Error("invert: does not exist");return mod(j,_)}function invertBatch(q,_=CURVE.P){const M=new Array(q.length),$=q.reduce((z,V,G)=>V===_0n?z:(M[G]=z,mod(z*V,_)),_1n),j=invert($,_);return q.reduceRight((z,V,G)=>V===_0n?z:(M[G]=mod(z*M[G],_),mod(z*V,_)),j),M}function pow2(q,_){const{P:M}=CURVE;let $=q;for(;_-- >_0n;)$*=$,$%=M;return $}function pow_2_252_3(q){const{P:_}=CURVE,M=BigInt(5),$=BigInt(10),j=BigInt(20),z=BigInt(40),V=BigInt(80),X=q*q%_*q%_,Y=pow2(X,_2n)*X%_,Q=pow2(Y,_1n)*q%_,Z=pow2(Q,M)*Q%_,ee=pow2(Z,$)*Z%_,te=pow2(ee,j)*ee%_,ne=pow2(te,z)*te%_,re=pow2(ne,V)*ne%_,ie=pow2(re,V)*ne%_,se=pow2(ie,$)*Z%_;return{pow_p_5_8:pow2(se,_2n)*q%_,b2:X}}function uvRatio(q,_){const M=mod(_*_*_),$=mod(M*M*_),j=pow_2_252_3(q*$).pow_p_5_8;let z=mod(q*M*j);const V=mod(_*z*z),G=z,X=mod(z*SQRT_M1),Y=V===q,Q=V===mod(-q),Z=V===mod(-q*SQRT_M1);return Y&&(z=G),(Q||Z)&&(z=X),edIsNegative(z)&&(z=mod(-z)),{isValid:Y||Q,value:z}}function invertSqrt(q){return uvRatio(_1n,q)}async function sha512ModqLE(...q){const _=await utils$2.sha512(concatBytes(...q)),M=bytesToNumberLE(_);return mod(M,CURVE.l)}function equalBytes(q,_){if(q.length!==_.length)return!1;for(let M=0;M<q.length;M++)if(q[M]!==_[M])return!1;return!0}function ensureBytes(q,_){const M=q instanceof Uint8Array?Uint8Array.from(q):hexToBytes(q);if(typeof _=="number"&&M.length!==_)throw new Error(`Expected ${_} bytes`);return M}function normalizeScalar(q,_,M=!0){if(!_)throw new TypeError("Specify max value");if(typeof q=="number"&&Number.isSafeInteger(q)&&(q=BigInt(q)),typeof q=="bigint"&&q<_){if(M){if(_0n<q)return q}else if(_0n<=q)return q}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function adjustBytes25519(q){return q[0]&=248,q[31]&=127,q[31]|=64,q}async function getExtendedPublicKey(q){if(q=typeof q=="bigint"||typeof q=="number"?numberTo32BytesBE(normalizeScalar(q,MAX_256B)):ensureBytes(q),q.length!==32)throw new Error("Expected 32 bytes");const _=await utils$2.sha512(q),M=adjustBytes25519(_.slice(0,32)),$=_.slice(32,64),j=mod(bytesToNumberLE(M),CURVE.l),z=Point.BASE.multiply(j),V=z.toRawBytes();return{head:M,prefix:$,scalar:j,point:z,pointBytes:V}}async function getPublicKey(q){return(await getExtendedPublicKey(q)).pointBytes}async function sign(q,_){q=ensureBytes(q);const{prefix:M,scalar:$,pointBytes:j}=await getExtendedPublicKey(_),z=await sha512ModqLE(M,q),V=Point.BASE.multiply(z),G=await sha512ModqLE(V.toRawBytes(),j,q),X=mod(z+G*$,CURVE.l);return new Signature(V,X).toRawBytes()}async function verify(q,_,M){_=ensureBytes(_),M instanceof Point||(M=Point.fromHex(M,!1));const{r:$,s:j}=q instanceof Signature?q.assertValidity():Signature.fromHex(q),z=ExtendedPoint.BASE.multiplyUnsafe(j),V=await sha512ModqLE($.toRawBytes(),M.toRawBytes(),_),G=ExtendedPoint.fromAffine(M).multiplyUnsafe(V);return ExtendedPoint.fromAffine($).add(G).subtract(z).multiplyUnsafe(CURVE.h).equals(ExtendedPoint.ZERO)}Point.BASE._setWindowSize(8);const crypto$1={node:nodeCrypto,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},utils$2={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex,getExtendedPublicKey,mod,invert,hashToPrivateScalar:q=>{if(q=ensureBytes(q),q.length<40||q.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const _=mod(bytesToNumberLE(q),CURVE.l);if(_===_0n||_===_1n)throw new Error("Invalid private key");return _},randomBytes:(q=32)=>{if(crypto$1.web)return crypto$1.web.getRandomValues(new Uint8Array(q));if(crypto$1.node){const{randomBytes:_}=crypto$1.node;return new Uint8Array(_(q).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>utils$2.randomBytes(32),sha512:async q=>{if(crypto$1.web){const _=await crypto$1.web.subtle.digest("SHA-512",q.buffer);return new Uint8Array(_)}else{if(crypto$1.node)return Uint8Array.from(crypto$1.node.createHash("sha512").update(q).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(q=8,_=Point.BASE){const M=_.equals(Point.BASE)?_:new Point(_.x,_.y);return M._setWindowSize(q),M.multiply(_2n),M}};var __classPrivateFieldGet$1=globalThis&&globalThis.__classPrivateFieldGet||function(q,_,M,$){if(M==="a"&&!$)throw new TypeError("Private accessor was defined without a getter");if(typeof _=="function"?q!==_||!$:!_.has(q))throw new TypeError("Cannot read private member from an object whose class did not declare it");return M==="m"?$:M==="a"?$.call(q):$?$.value:_.get(q)},__classPrivateFieldSet$1=globalThis&&globalThis.__classPrivateFieldSet||function(q,_,M,$,j){if($==="m")throw new TypeError("Private method is not writable");if($==="a"&&!j)throw new TypeError("Private accessor was defined without a setter");if(typeof _=="function"?q!==_||!j:!_.has(q))throw new TypeError("Cannot write private member to an object whose class did not declare it");return $==="a"?j.call(q,M):j?j.value=M:_.set(q,M),M},_XXH64_seed,_XXH64_v1,_XXH64_v2,_XXH64_v3,_XXH64_v4,_XXH64_memory,_XXH64_len,_XXH64_memsize;const PRIME64_1=11400714785074694791n,PRIME64_2=14029467366897019727n,PRIME64_3=1609587929392839161n,PRIME64_4=9650029242287828579n,PRIME64_5=2870177450012600261n,BITS=64n,BITMASK=2n**BITS-1n,encoder$1=new TextEncoder;function bitsToBigInt(q,_,M,$){return BigInt(q)|BigInt(_)<<16n|BigInt(M)<<32n|BigInt($)<<48n}function memoryToBigInt(q,_){return BigInt(q[_])|BigInt(q[_+1])<<8n|BigInt(q[_+2])<<16n|BigInt(q[_+3])<<24n|BigInt(q[_+4])<<32n|BigInt(q[_+5])<<40n|BigInt(q[_+6])<<48n|BigInt(q[_+7])<<56n}function rotl(q,_){return q<<_&BITMASK|q>>BITS-_}function trunc(q){return BigInt.asUintN(64,q)}class XXH64{constructor(_=0){_XXH64_seed.set(this,void 0),_XXH64_v1.set(this,void 0),_XXH64_v2.set(this,void 0),_XXH64_v3.set(this,void 0),_XXH64_v4.set(this,void 0),_XXH64_memory.set(this,void 0),_XXH64_len.set(this,void 0),_XXH64_memsize.set(this,void 0),this.reset(_)}reset(_=__classPrivateFieldGet$1(this,_XXH64_seed,"f")){return __classPrivateFieldSet$1(this,_XXH64_seed,BigInt.asUintN(32,BigInt(_)),"f"),__classPrivateFieldSet$1(this,_XXH64_v1,trunc(__classPrivateFieldGet$1(this,_XXH64_seed,"f")+PRIME64_1+PRIME64_2),"f"),__classPrivateFieldSet$1(this,_XXH64_v2,trunc(__classPrivateFieldGet$1(this,_XXH64_seed,"f")+PRIME64_2),"f"),__classPrivateFieldSet$1(this,_XXH64_v3,__classPrivateFieldGet$1(this,_XXH64_seed,"f"),"f"),__classPrivateFieldSet$1(this,_XXH64_v4,trunc(__classPrivateFieldGet$1(this,_XXH64_seed,"f")-PRIME64_1),"f"),__classPrivateFieldSet$1(this,_XXH64_memory,null,"f"),__classPrivateFieldSet$1(this,_XXH64_len,0,"f"),__classPrivateFieldSet$1(this,_XXH64_memsize,0,"f"),this}update(_){typeof _=="string"&&(_=encoder$1.encode(_));let M=0,$=_.length,j=M+$;if($===0)return this;if(__classPrivateFieldSet$1(this,_XXH64_len,__classPrivateFieldGet$1(this,_XXH64_len,"f")+$,"f"),__classPrivateFieldGet$1(this,_XXH64_memsize,"f")===0&&__classPrivateFieldSet$1(this,_XXH64_memory,new Uint8Array(32),"f"),__classPrivateFieldGet$1(this,_XXH64_memsize,"f")+$<32)return __classPrivateFieldGet$1(this,_XXH64_memory,"f").set(_.subarray(0,$),__classPrivateFieldGet$1(this,_XXH64_memsize,"f")),__classPrivateFieldSet$1(this,_XXH64_memsize,__classPrivateFieldGet$1(this,_XXH64_memsize,"f")+$,"f"),this;if(__classPrivateFieldGet$1(this,_XXH64_memsize,"f")>0){__classPrivateFieldGet$1(this,_XXH64_memory,"f").set(_.subarray(0,32-__classPrivateFieldGet$1(this,_XXH64_memsize,"f")),__classPrivateFieldGet$1(this,_XXH64_memsize,"f"));let z=0,V;V=memoryToBigInt(__classPrivateFieldGet$1(this,_XXH64_memory,"f"),z),__classPrivateFieldSet$1(this,_XXH64_v1,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v1,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),z+=8,V=memoryToBigInt(this.memory,z),__classPrivateFieldSet$1(this,_XXH64_v2,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v2,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),z+=8,V=memoryToBigInt(this.memory,z),__classPrivateFieldSet$1(this,_XXH64_v3,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v3,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),z+=8,V=memoryToBigInt(this.memory,z),__classPrivateFieldSet$1(this,_XXH64_v4,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v4,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=32-__classPrivateFieldGet$1(this,_XXH64_memsize,"f"),__classPrivateFieldSet$1(this,_XXH64_memsize,0,"f")}if(M<=j-32){const z=j-32;do{let V;V=memoryToBigInt(_,M),__classPrivateFieldSet$1(this,_XXH64_v1,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v1,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=8,V=memoryToBigInt(_,M),__classPrivateFieldSet$1(this,_XXH64_v2,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v2,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=8,V=memoryToBigInt(_,M),__classPrivateFieldSet$1(this,_XXH64_v3,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v3,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=8,V=memoryToBigInt(_,M),__classPrivateFieldSet$1(this,_XXH64_v4,trunc(rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v4,"f")+V*PRIME64_2),31n)*PRIME64_1),"f"),M+=8}while(M<=z)}return M<j&&(__classPrivateFieldGet$1(this,_XXH64_memory,"f").set(_.subarray(M,j),__classPrivateFieldGet$1(this,_XXH64_memsize,"f")),__classPrivateFieldSet$1(this,_XXH64_memsize,j-M,"f")),this}digest(){let _=__classPrivateFieldGet$1(this,_XXH64_memory,"f"),M=__classPrivateFieldGet$1(this,_XXH64_memsize,"f"),$=0,j=0n,z=0n,V=0n;for(__classPrivateFieldGet$1(this,_XXH64_len,"f")>=32?(j=rotl(__classPrivateFieldGet$1(this,_XXH64_v1,"f"),1n)+rotl(__classPrivateFieldGet$1(this,_XXH64_v2,"f"),7n)+rotl(__classPrivateFieldGet$1(this,_XXH64_v3,"f"),12n)+rotl(__classPrivateFieldGet$1(this,_XXH64_v4,"f"),18n),j=trunc(j^rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v1,"f")*PRIME64_2),31n)*PRIME64_1),j=trunc(j*PRIME64_1+PRIME64_4),j=trunc(j^rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v2,"f")*PRIME64_2),31n)*PRIME64_1),j=trunc(j*PRIME64_1+PRIME64_4),j=trunc(j^rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v3,"f")*PRIME64_2),31n)*PRIME64_1),j=trunc(j*PRIME64_1+PRIME64_4),j=trunc(j^rotl(trunc(__classPrivateFieldGet$1(this,_XXH64_v4,"f")*PRIME64_2),31n)*PRIME64_1),j=trunc(j*PRIME64_1+PRIME64_4)):j=trunc(__classPrivateFieldGet$1(this,_XXH64_seed,"f")+PRIME64_5),j+=BigInt(__classPrivateFieldGet$1(this,_XXH64_len,"f"));$<=M-8;)V=memoryToBigInt(_,$),V=trunc(rotl(trunc(V*PRIME64_2),31n)*PRIME64_1),j=trunc(rotl(j^V,27n)*PRIME64_1+PRIME64_4),$+=8;for($+4<=M&&(V=bitsToBigInt(_[$+1]<<8|_[$],_[$+3]<<8|_[$+2],0,0),j=trunc(rotl(j^trunc(V*PRIME64_1),23n)*PRIME64_2+PRIME64_3),$+=4);$<M;)V=bitsToBigInt(_[$++],0,0,0),j=trunc(rotl(j^trunc(V*PRIME64_5),11n)*PRIME64_1);return z=trunc(j>>33n),j=trunc((j^z)*PRIME64_2),z=trunc(j>>29n),j=trunc((j^z)*PRIME64_3),z=trunc(j>>32n),j=trunc(j^z),j}}_XXH64_seed=new WeakMap,_XXH64_v1=new WeakMap,_XXH64_v2=new WeakMap,_XXH64_v3=new WeakMap,_XXH64_v4=new WeakMap,_XXH64_memory=new WeakMap,_XXH64_len=new WeakMap,_XXH64_memsize=new WeakMap;function hash(q,_=0){return new XXH64(_).update(q).digest()}function ascend(q,_){return q<_?-1:q>_?1:0}class BinarySearchNode{constructor(_,M){Object.defineProperty(this,"parent",{enumerable:!0,configurable:!0,writable:!0,value:_}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:M}),Object.defineProperty(this,"left",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"right",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.left=null,this.right=null}static from(_){const M=new BinarySearchNode(_.parent,_.value);return M.left=_.left,M.right=_.right,M}directionFromParent(){return this.parent===null?null:this===this.parent.left?"left":this===this.parent.right?"right":null}findMinNode(){let _=this.left;for(;_!=null&&_.left;)_=_.left;return _??this}findMaxNode(){let _=this.right;for(;_!=null&&_.right;)_=_.right;return _??this}findSuccessorNode(){if(this.right!==null)return this.right.findMinNode();let _=this.parent,M=this.directionFromParent();for(;_&&M==="right";)M=_.directionFromParent(),_=_.parent;return _}}class BinarySearchTree{constructor(_=ascend){Object.defineProperty(this,"compare",{enumerable:!0,configurable:!0,writable:!0,value:_}),Object.defineProperty(this,"root",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_size",{enumerable:!0,configurable:!0,writable:!0,value:0})}static from(_,M){let $,j=[];if(_ instanceof BinarySearchTree)if($=new BinarySearchTree((M==null?void 0:M.compare)??_.compare),M!=null&&M.compare||M!=null&&M.map)j=_;else{const V=[];for(_.root&&($.root=BinarySearchNode.from(_.root),V.push($.root));V.length;){const G=V.pop(),X=G.left?BinarySearchNode.from(G.left):null,Y=G.right?BinarySearchNode.from(G.right):null;X&&(X.parent=G,V.push(X)),Y&&(Y.parent=G,V.push(Y))}}else $=M!=null&&M.compare?new BinarySearchTree(M.compare):new BinarySearchTree,j=_;const z=M!=null&&M.map?Array.from(j,M.map,M.thisArg):j;for(const V of z)$.insert(V);return $}get size(){return this._size}findNode(_){let M=this.root;for(;M;){const $=this.compare(_,M.value);if($===0)break;const j=$<0?"left":"right";M=M[j]}return M}rotateNode(_,M){const $=M==="left"?"right":"left";if(!_[$])throw new TypeError(`cannot rotate ${M} without ${$} child`);const j=_[$];if(_[$]=j[M]??null,j[M]&&(j[M].parent=_),j.parent=_.parent,_.parent){const z=_===_.parent[M]?M:$;_.parent[z]=j}else this.root=j;j[M]=_,_.parent=j}insertNode(_,M){if(this.root){let $=this.root;for(;;){const j=this.compare(M,$.value);if(j===0)break;const z=j<0?"left":"right";if($[z])$=$[z];else return $[z]=new _($,M),this._size++,$[z]}}else return this.root=new _(null,M),this._size++,this.root;return null}removeNode(_){let M=this.findNode(_);if(M){const $=!M.left||!M.right?M:M.findSuccessorNode(),j=$.left??$.right;j&&(j.parent=$.parent),$.parent?$.parent[$.directionFromParent()]=j:this.root=j,$!==M&&(M.value=$.value,M=$),this._size--}return M}insert(_){return!!this.insertNode(BinarySearchNode,_)}remove(_){return!!this.removeNode(_)}find(_){var M;return((M=this.findNode(_))==null?void 0:M.value)??null}min(){return this.root?this.root.findMinNode().value:null}max(){return this.root?this.root.findMaxNode().value:null}clear(){this.root=null,this._size=0}isEmpty(){return this.size===0}*lnrValues(){const _=[];let M=this.root;for(;_.length||M;)M?(_.push(M),M=M.left):(M=_.pop(),yield M.value,M=M.right)}*rnlValues(){const _=[];let M=this.root;for(;_.length||M;)M?(_.push(M),M=M.right):(M=_.pop(),yield M.value,M=M.left)}*nlrValues(){const _=[];for(this.root&&_.push(this.root);_.length;){const M=_.pop();yield M.value,M.right&&_.push(M.right),M.left&&_.push(M.left)}}*lrnValues(){const _=[];let M=this.root,$=null;for(;_.length||M;)if(M)_.push(M),M=M.left;else{const j=_[_.length-1];j.right&&j.right!==$?M=j.right:(yield j.value,$=_.pop())}}*lvlValues(){const _=[];let M=this.root;for(;M;)yield M.value,M.left&&_.push(M.left),M.right&&_.push(M.right),M=_.shift()??null}*[Symbol.iterator](){yield*this.lnrValues()}}class RedBlackNode extends BinarySearchNode{constructor(_,M){super(_,M),Object.defineProperty(this,"red",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.red=!0}static from(_){const M=new RedBlackNode(_.parent,_.value);return M.left=_.left,M.right=_.right,M.red=_.red,M}}class RedBlackTree extends BinarySearchTree{constructor(_=ascend){super(_)}static from(_,M){let $,j=[];if(_ instanceof RedBlackTree)if($=new RedBlackTree((M==null?void 0:M.compare)??_.compare),M!=null&&M.compare||M!=null&&M.map)j=_;else{const V=[];for(_.root&&($.root=RedBlackNode.from(_.root),V.push($.root));V.length;){const G=V.pop(),X=G.left?RedBlackNode.from(G.left):null,Y=G.right?RedBlackNode.from(G.right):null;X&&(X.parent=G,V.push(X)),Y&&(Y.parent=G,V.push(Y))}}else $=M!=null&&M.compare?new RedBlackTree(M.compare):new RedBlackTree,j=_;const z=M!=null&&M.map?Array.from(j,M.map,M.thisArg):j;for(const V of z)$.insert(V);return $}removeFixup(_,M){var $,j,z;for(;_&&!(M!=null&&M.red);){const V=_.left===M?"left":"right",G=V==="right"?"left":"right";let X=_[G];X!=null&&X.red&&(X.red=!1,_.red=!0,this.rotateNode(_,V),X=_[G]),X&&(!(($=X.left)!=null&&$.red)&&!((j=X.right)!=null&&j.red)?(X.red=!0,M=_,_=M.parent):((z=X[G])!=null&&z.red||(X[V].red=!1,X.red=!0,this.rotateNode(X,G),X=_[G]),X.red=_.red,_.red=!1,X[G].red=!1,this.rotateNode(_,V),M=this.root,_=null))}M&&(M.red=!1)}insert(_){var $;let M=this.insertNode(RedBlackNode,_);if(M){for(;($=M.parent)!=null&&$.red;){let j=M.parent;const z=j.directionFromParent(),V=z==="right"?"left":"right",G=j.parent[V]??null;G!=null&&G.red?(j.red=!1,G.red=!1,j.parent.red=!0,M=j.parent):(M===j[V]&&(M=j,this.rotateNode(M,z),j=M.parent),j.red=!1,j.parent.red=!0,this.rotateNode(j.parent,V))}this.root.red=!1}return!!M}remove(_){const M=this.removeNode(_);return M&&!M.red&&this.removeFixup(M.parent,M.left??M.right),!!M}}function combineMonoid(q,_){return{lift:M=>[q.lift(M),_.lift(M)],combine:(M,$)=>{const j=q.combine(M[0],$[0]),z=_.combine(M[1],$[1]);return[j,z]},neutral:[q.neutral,_.neutral]}}const sizeMonoid={lift:q=>1,combine:(q,_)=>q+_,neutral:0};class FingerprintNode extends RedBlackNode{constructor(_,M,$){super(_,M),Object.defineProperty(this,"label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"liftedValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.label=$.neutral,this.liftedValue=$.lift(M),this.monoid=$}updateLabel(_=!0,M){var $;this.left!==null&&this.right===null?this.label=this.monoid.combine(this.left.label,this.liftedValue):this.left===null&&this.right!==null?this.label=this.monoid.combine(this.liftedValue,this.right.label):this.left&&this.right?this.label=this.monoid.combine(this.left.label,this.monoid.combine(this.liftedValue,this.right.label)):this.label=this.liftedValue,_&&(($=this.parent)==null||$.updateLabel(!0,"Updated by child"))}}class FingerprintTree extends RedBlackTree{constructor(_,M){super(M),Object.defineProperty(this,"monoid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedMinNode",{enumerable:!0,configurable:!0,writable:!0,value:null});const z=combineMonoid({lift:V=>[V],combine:(V,G)=>V.concat(G),neutral:[]},{lift:V=>V,combine:(V,G)=>{if(!(V===void 0&&G===void 0))return G===void 0?V:V===void 0?G:M(V,G)>0?V:G},neutral:void 0});this.monoid=combineMonoid(_,combineMonoid(sizeMonoid,z))}getLowestValue(){if(!this.root)throw new Error("Can't get a range from a tree with no items");return this.cachedMinNode?this.cachedMinNode.value:this.root.findMinNode().value}rotateNode(_,M){var z;const $=M==="left"?"right":"left";if(!_[$])throw new TypeError(`cannot rotate ${M} without ${$} child`);const j=_[$];if(_[$]=j[M]??null,j[M]&&(j[M].parent=_),j.parent=_.parent,_.parent){const V=_===_.parent[M]?M:$;_.parent[V]=j}else this.root=j;j[M]=_,_.parent=j,(z=j[M])==null||z.updateLabel(!1,"Node rotated")}removeFixup(_,M){var $,j,z;for(;_&&!(M!=null&&M.red);){const V=_.left===M?"left":"right",G=V==="right"?"left":"right";let X=_[G];X!=null&&X.red&&(X.red=!1,_.red=!0,this.rotateNode(_,V),X=_[G]),X&&(!(($=X.left)!=null&&$.red)&&!((j=X.right)!=null&&j.red)?(X.red=!0,M=_,_=M.parent):((z=X[G])!=null&&z.red||(X[V].red=!1,X.red=!0,this.rotateNode(X,G),X=_[G]),X.red=_.red,_.red=!1,X[G].red=!1,this.rotateNode(_,V),M=this.root,_=null))}M&&(M.red=!1)}insertFingerprintNode(_){if(this.root){let M=this.root,$=!0;for(;;){const j=this.compare(_,M.value);if(j===0){$=!1;break}const z=j<0?"left":"right";if($&&z==="right"&&($=!1),M[z])M=M[z];else return M[z]=new FingerprintNode(M,_,this.monoid),this._size++,$&&(this.cachedMinNode=M[z]),M[z]}}else return this.root=new FingerprintNode(null,_,this.monoid),this._size++,this.cachedMinNode=this.root,this.root;return null}insert(_){var j;const M=this.insertFingerprintNode(_);let $=M;if($){for(;(j=$.parent)!=null&&j.red;){let z=$.parent;const V=z.directionFromParent(),G=V==="right"?"left":"right",X=z.parent[G]??null;X!=null&&X.red?(z.red=!1,X.red=!1,z.parent.red=!0,$=z.parent):($===z[G]&&($=z,this.rotateNode($,V),z=$.parent),z.red=!1,z.parent.red=!0,this.rotateNode(z.parent,G))}this.root.red=!1}return M==null||M.updateLabel(!0,"Node inserted"),!!$}remove(_){var $;const M=this.removeNode(_);return M&&!M.red&&this.removeFixup(M.parent,M.left??M.right),M&&(($=M.parent)==null||$.updateLabel(!0,"Child node removed")),!!M}getFingerprint(_,M,$){if(this.root===null)return{fingerprint:this.monoid.neutral[0],size:0,items:[],nextTree:null};const j=this.compare(_,M);if(j===0)return{fingerprint:this.root.label[0],size:this.root.label[1][0],items:this.root.label[1][1][0],nextTree:this.cachedMinNode};if(j<0){const z=this.compare(_,this.cachedMinNode.value)<=0?this.cachedMinNode:null,V=$||z||this.findGteNode(_),{label:G,nextTree:X}=this.aggregateUntil(V,_,M);return{fingerprint:G[0],size:G[1][0],items:G[1][1][0],nextTree:X}}else{const z=this.cachedMinNode,V=this.root.label[1][1][1],G=this.compare(M,z.value)>0,X=this.compare(_,V)<=0;if(G&&X){const{label:Y,nextTree:Q}=this.aggregateUntil(z,z.value,M),ee=[this.monoid.lift(V)[0],[1,[[V],V]]],te=$||this.findGteNode(_),{label:ne}=this.aggregateUntil(te,_,V),re=this.monoid.combine(ne,ee),ie=this.monoid.combine(Y,re);return{fingerprint:ie[0],size:ie[1][0],items:ie[1][1][0],nextTree:Q}}else if(G){const{label:Y,nextTree:Q}=this.aggregateUntil(z,z.value,M);return{fingerprint:Y[0],size:Y[1][0],items:Y[1][1][0],nextTree:Q}}else{const Y=this.compare(_,this.cachedMinNode.value)<=0?this.cachedMinNode:null,Q=$||Y||this.findGteNode(_),{label:Z}=this.aggregateUntil(Q,_,V),te=[this.monoid.lift(V)[0],[1,[[V],V]]],ne=this.monoid.combine(Z,te);return{fingerprint:ne[0],size:ne[1][0],items:ne[1][1][0],nextTree:Y}}}}findGteNode(_){let M=this.root;for(;M;){const $=this.compare(_,M.value);if($===0)break;const j=$<0?"left":"right";if(M[j])M=M[j];else break}return M}aggregateUntil(_,M,$){const{label:j,nextTree:z}=this.aggregateUp(_,M,$);return z===null||this.compare(z.value,$)>=0?{label:j,nextTree:z}:this.aggregateDown(z.right,$,this.monoid.combine(j,z.liftedValue))}aggregateUp(_,M,$){var V;let j=this.monoid.neutral,z=_;for(;this.compare(z.label[1][1][1],$)<0;){if(this.compare(z.value,M)>=0&&(j=this.monoid.combine(j,this.monoid.combine(z.liftedValue,((V=z.right)==null?void 0:V.label)||this.monoid.neutral))),z.parent===null)return{label:j,nextTree:null};z=z.parent}return{label:j,nextTree:z}}aggregateDown(_,M,$){var V,G;let j=_,z=$;for(;j!==null;)if(this.compare(j.value,M)<0)z=this.monoid.combine(z,this.monoid.combine(((V=j.left)==null?void 0:V.label)||this.monoid.neutral,j.liftedValue)),j=j.right;else{if(j.left===null||this.compare(j.label[1][1][1],M)<0)return{label:this.monoid.combine(z,((G=j.left)==null?void 0:G.label)||this.monoid.neutral),nextTree:j};j=j.left}return{label:z,nextTree:null}}isValueEqual(_,M){return this.compare(_,M)===0}}function deferred$1(){let q,_="pending";const M=new Promise(($,j)=>{q={async resolve(z){await z,_="fulfilled",$(z)},reject(z){_="rejected",j(z)}}});return Object.defineProperty(M,"state",{get:()=>_}),Object.assign(M,q)}class TeeableDeferred{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(_){if(this.state==="pending"){this.state="fulfilled";for(const M of this.deferreds)M.resolve(_)}}reject(_){if(this.state==="pending"){this.state="rejected";for(const M of this.deferreds)M.reject(_)}}tee(){const _=deferred$1();return this.state==="fulfilled"?_.resolve():this.state==="rejected"?_.reject():this.deferreds.add(_),_}}class RangeMessenger{constructor(_){Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDoneTee",{enumerable:!0,configurable:!0,writable:!0,value:new TeeableDeferred}),Object.defineProperty(this,"insertionCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"fingerprintEquals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowerBoundFromPrev",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatedPayload",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"collatePayloads",{enumerable:!0,configurable:!0,writable:!0,value:M=>{switch(M.type){case"payload":{let $=this.collatedPayload;if($===null&&($={type:"payload",lowerBound:M.lowerBound,payload:[],end:{canRespond:!1,upperBound:M.payload}}),$.payload.push(M.payload),this.collatedPayload=$,M.end)return M.end.upperBound?$.end=M.end:$.end={...M.end,upperBound:M.payload},this.collatedPayload=null,$;break}default:return this.collatedPayload&&(this.collatedPayload=null),M}}}),Object.defineProperty(this,"reusableTree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastAdjacentDoneUpperBound",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isDoneSoFar",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.tree=_.tree,this.fingerprintEquals=_.fingerprintEquals,this.encoding=_.encoding,this.payloadThreshold=_.payloadThreshold,this.rangeDivision=_.rangeDivision}decode(_){const M=this.lowerBoundFromPrev;try{switch(this.encoding.decode.getType(_)){case"payload":{const j=this.encoding.decode.payload(_);return j.end&&(this.lowerBoundFromPrev=j.end.upperBound),{type:"payload",lowerBound:M,payload:j.value,...j.end?{end:j.end}:{}}}case"fingerprint":{const j=this.encoding.decode.fingerprint(_);return this.lowerBoundFromPrev=j.upperBound,{type:"fingerprint",lowerBound:M,fingerprint:j.fingerprint,upperBound:j.upperBound}}case"emptyPayload":{const j=this.encoding.decode.emptyPayload(_);return this.lowerBoundFromPrev=j,{lowerBound:M,type:"emptyPayload",upperBound:j}}case"done":{const j=this.encoding.decode.done(_);return this.lowerBoundFromPrev=j,{lowerBound:M,type:"done",upperBound:j}}case"emptySet":return{type:"emptySet",canRespond:this.encoding.decode.emptySet(_)};case"lowerBound":{const j=this.encoding.decode.lowerBound(_);return this.lowerBoundFromPrev=j,{type:"lowerBound",value:j}}case"terminal":return this.encoding.decode.terminal(_),{type:"terminal"}}}catch($){console.group("range-reconcile: Could not decode message"),console.warn(_),console.warn($)}return null}setReusableTree(_){this.reusableTree=_||void 0}process(_){const M=this.reusableTree;switch(_.type){case"lowerBound":case"terminal":case"done":return this.setReusableTree(null),[_];case"emptySet":{if(_.canRespond===!1&&this.isDoneTee.resolve(),this.tree.size===0)return[{type:"emptySet",canRespond:!1}];const $=this.tree.getLowestValue(),j=[{type:"lowerBound",value:$}],{items:z}=this.tree.getFingerprint($,$);for(let V=0;V<z.length;V++){const G=z[V];V===z.length-1?j.push({type:"payload",payload:G,end:{upperBound:$,canRespond:!1}}):j.push({type:"payload",payload:G})}return j.push({type:"terminal"}),j}case"fingerprint":{const{fingerprint:$,size:j,items:z,nextTree:V}=this.tree.getFingerprint(_.lowerBound,_.upperBound,M);if(this.setReusableTree(V),this.fingerprintEquals($,_.fingerprint))return[{type:"done",upperBound:_.upperBound}];if(j<=this.payloadThreshold){if(j===0)return[{type:"emptyPayload",upperBound:_.upperBound}];const G=[];for(let X=0;X<j;X++)G.push({type:"payload",payload:z[X],...X===z.length-1?{end:{upperBound:_.upperBound,canRespond:!0}}:{}});return G}else{const G=Math.ceil(j/this.rangeDivision),X=[];if(G<=this.payloadThreshold){for(let ee=0;ee<z.length;ee++)X.push({type:"payload",payload:z[ee],...ee===z.length-1?{end:{upperBound:_.upperBound,canRespond:!0}}:{}});return X}let Y;const Q=z;let Z=!1;if(_.lowerBound>=_.upperBound){let ee=0;for(let te=0;te<=z.length;te++)if(z[te]>=_.lowerBound){ee=te;break}if(ee>0){const te=Q.splice(0,ee);Q.push(...te),Z=!0}}for(let ee=0;ee<j;ee+=G){const te=Q[ee],ne=Q[ee+G]||_.upperBound,{fingerprint:re,nextTree:ie}=this.tree.getFingerprint(te,ne,Y);Y=Z?void 0:ie||void 0,X.push({type:"fingerprint",fingerprint:re,upperBound:ne})}return X}}case"payload":{for(const $ of _.payload){this.tree.insert($);for(const j of this.insertionCallbacks)j($)}if(_.end.canRespond){const{items:$,size:j,nextTree:z}=this.tree.getFingerprint(_.lowerBound,_.end.upperBound,M);if(this.setReusableTree(z),j===0)return[{type:"emptyPayload",upperBound:_.end.upperBound}];const V=[];for(let X=0;X<j;X++){let Y=!1;for(let Q=0;Q<_.payload.length;Q++)this.tree.isValueEqual($[X],_.payload[Q])&&(Y=!0);Y||V.push({type:"payload",payload:$[X]})}const G=V[V.length-1];return V[V.length-1]={...G,end:{upperBound:_.end.upperBound,canRespond:!1}},V}else return this.setReusableTree(null),[{type:"done",upperBound:_.end.upperBound}]}case"emptyPayload":{this.setReusableTree(null);const{items:$,size:j,nextTree:z}=this.tree.getFingerprint(_.lowerBound,_.upperBound);if(this.setReusableTree(z),j===0)return this.setReusableTree(null),[];const V=[];for(let G=0;G<j;G++)V.push({type:"payload",payload:$[G],...G===$.length-1?{end:{upperBound:_.upperBound,canRespond:!1}}:{}});return V}}}consolidateAdjacentDones(_){switch(_.type){case"done":{this.lastAdjacentDoneUpperBound=_.upperBound;break}default:{const M=this.lastAdjacentDoneUpperBound;return M?(this.lastAdjacentDoneUpperBound=null,[{type:"done",upperBound:M},_]):[_]}}}checkIsDone(_){var M;if(this.isDoneTee.state==="pending")switch(_.type){case"emptySet":{_.canRespond&&(this.isDoneSoFar=!1);break}case"lowerBound":break;case"fingerprint":this.isDoneSoFar=!1;break;case"emptyPayload":this.isDoneSoFar=!1;break;case"payload":((M=_.end)==null?void 0:M.canRespond)===!0&&(this.isDoneSoFar=!1);break;case"terminal":this.isDoneSoFar?this.isDoneTee.resolve():this.isDoneSoFar=!0}}encode(_){let M;switch(_.type){case"emptySet":{M=this.encoding.encode.emptySet(_.canRespond);break}case"lowerBound":{M=this.encoding.encode.lowerBound(_.value);break}case"done":{M=this.encoding.encode.done(_.upperBound);break}case"fingerprint":{M=this.encoding.encode.fingerprint(_.fingerprint,_.upperBound);break}case"payload":{M=this.encoding.encode.payload(_.payload,_.end);break}case"emptyPayload":{M=this.encoding.encode.emptyPayload(_.upperBound);break}case"terminal":{M=this.encoding.encode.terminal();break}}return M}respond(_){if(this.isDone().state==="fulfilled")return[];const M=this.decode(_),$=this.collatePayloads(M);if($===void 0)return[];const j=this.process($),z=[];for(const G of j){const X=this.consolidateAdjacentDones(G);X&&z.push(...X)}for(const G of z)this.checkIsDone(G);const V=[];for(const G of z)V.push(this.encode(G));return V}isDone(){return this.isDoneTee.tee()}initialMessages(_){const{tree:M,encoding:$,payloadThreshold:j,rangeDivision:z}=this;function*V(){if(M.size===0){yield $.encode.emptySet(!0);return}const G=M.getLowestValue();yield $.encode.lowerBound(G);const{items:Y}=M.getFingerprint(G,G),Z=(_||(ne=>{const re=Math.ceil(ne.length/z),ie=[];for(let se=0;se<ne.length;se+=re){const le=ne.slice(se,se+re);ie.push(le)}return ie}))(Y);let ee;for(let ne=0;ne<Z.length;ne++){const re=Z[ne+1]?Z[ne+1][0]:G,ie=Z[ne];if(ie.length<=j)for(let se=0;se<ie.length;se++)yield $.encode.payload(ie[se],se===ie.length-1?{upperBound:re,canRespond:!0}:void 0);else{const se=ie[0],{fingerprint:le,nextTree:he}=M.getFingerprint(se,re,ee);ee=he||void 0,yield $.encode.fingerprint(le,re)}}yield $.encode.terminal()}return V()}onInsertion(_){return this.insertionCallbacks.add(_),()=>{this.insertionCallbacks.delete(_)}}}var __classPrivateFieldGet=globalThis&&globalThis.__classPrivateFieldGet||function(q,_,M,$){if(M==="a"&&!$)throw new TypeError("Private accessor was defined without a getter");if(typeof _=="function"?q!==_||!$:!_.has(q))throw new TypeError("Cannot read private member from an object whose class did not declare it");return M==="m"?$:M==="a"?$.call(q):$?$.value:_.get(q)},__classPrivateFieldSet=globalThis&&globalThis.__classPrivateFieldSet||function(q,_,M,$,j){if($==="m")throw new TypeError("Private method is not writable");if($==="a"&&!j)throw new TypeError("Private accessor was defined without a setter");if(typeof _=="function"?q!==_||!j:!_.has(q))throw new TypeError("Cannot write private member to an object whose class did not declare it");return $==="a"?j.call(q,M):j?j.value=M:_.set(q,M),M},_AsyncQueue_instances,_AsyncQueue_queue,_AsyncQueue_resolve,_AsyncQueue_error,_AsyncQueue_handleError,_AsyncQueue_enqueue;const END=Symbol("Stream ended."),ERROR=Symbol("Stream errored.");class AsyncQueue{constructor(_){var M,$,j;_AsyncQueue_instances.add(this),_AsyncQueue_queue.set(this,[]),_AsyncQueue_resolve.set(this,null),_AsyncQueue_error.set(this,void 0),Object.defineProperty(this,"push",{enumerable:!0,configurable:!0,writable:!0,value:(...z)=>{z.length?__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_enqueue).call(this,!1,z):(__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_enqueue).call(this,!1,[ERROR]),__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_handleError).call(this,new Error("AsyncQueueError: queue.push was called with no arguments")))}}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:({immediately:z=!1,withError:V}={})=>{V&&__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_handleError).call(this,V),__classPrivateFieldGet(this,_AsyncQueue_instances,"m",_AsyncQueue_enqueue).call(this,z,[V?ERROR:END]),this.push=this.close=()=>{}}}),(j=($=(M=_==null?void 0:_.catch)==null?void 0:M.call(_,z=>this.close({withError:z})))==null?void 0:$.finally)==null||j.call($,()=>this.close())}get length(){return __classPrivateFieldGet(this,_AsyncQueue_queue,"f").length}async*[(_AsyncQueue_queue=new WeakMap,_AsyncQueue_resolve=new WeakMap,_AsyncQueue_error=new WeakMap,_AsyncQueue_instances=new WeakSet,_AsyncQueue_handleError=function(M){__classPrivateFieldGet(this,_AsyncQueue_error,"f")instanceof AggregateError?__classPrivateFieldGet(this,_AsyncQueue_error,"f").errors.push(M):__classPrivateFieldGet(this,_AsyncQueue_error,"f")?__classPrivateFieldSet(this,_AsyncQueue_error,new AggregateError([__classPrivateFieldGet(this,_AsyncQueue_error,"f"),M]),"f"):__classPrivateFieldSet(this,_AsyncQueue_error,M,"f")},_AsyncQueue_enqueue=function(M,$){var j;__classPrivateFieldGet(this,_AsyncQueue_queue,"f")[M?"unshift":"push"](...$),(j=__classPrivateFieldGet(this,_AsyncQueue_resolve,"f"))==null||j.call(this,__classPrivateFieldGet(this,_AsyncQueue_queue,"f").shift()),__classPrivateFieldSet(this,_AsyncQueue_resolve,null,"f")},Symbol.asyncIterator)](){for(;;){const _=__classPrivateFieldGet(this,_AsyncQueue_queue,"f").length?__classPrivateFieldGet(this,_AsyncQueue_queue,"f").shift():await new Promise(M=>{__classPrivateFieldSet(this,_AsyncQueue_resolve,M,"f")});if(_===ERROR)throw __classPrivateFieldGet(this,_AsyncQueue_error,"f");if(_===END)break;yield _}}}function deferred(){let q,_="pending";const M=new Promise(($,j)=>{q={async resolve(z){await z,_="fulfilled",$(z)},reject(z){_="rejected",j(z)}}});return Object.defineProperty(M,"state",{get:()=>_}),Object.assign(M,q)}new TextDecoder$1;const encoder=new TextEncoder;function stringToBytes(q){return encoder.encode(q)}function stringLengthInBytes(q){return stringToBytes(q).length}function onlyHasChars(q,_){for(let M of q)if(_.indexOf(M)===-1)return!1;return!0}function isDigit(q){return q===""?!1:digits.indexOf(q)!==-1}const alphaLower="abcdefghijklmnopqrstuvwxyz",alphaUpper=alphaLower.toUpperCase(),digits="0123456789",b32chars=alphaLower+"234567",authorNameChars=alphaLower+digits,authorKeyChars=b32chars,authorAddressChars=authorNameChars+b32chars+"@.",workspaceNameChars=alphaLower+digits,workspaceKeyChars=b32chars,workspaceAddressChars=workspaceNameChars+b32chars+"+.",pathPunctuation="/'()-._~!$&+,:=@%",pathChars=alphaLower+alphaUpper+digits+pathPunctuation;function assembleAuthorAddress(q,_){return`@${q}.${_}`}function assembleShareAddress(q,_){return`+${q}.${_}`}function checkAuthorIsValid(q){const _=parseAuthorAddress(q);return notErr(_)?!0:_}function checkShareIsValid(q){const _=parseShareAddress(q);return notErr(_)?!0:_}function parseAuthorOrShareAddress(q){return q.startsWith("@")?parseAuthorAddress(q):q.startsWith("+")?parseShareAddress(q):new ValidationError("address must start with either @ or +")}function parseAuthorAddress(q){return parseAddress(q,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:authorNameChars,allowedPubkeyCharacters:authorKeyChars,pubkeyMustStartWithB:!0})}function parseShareAddress(q){return parseAddress(q,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:workspaceNameChars,allowedPubkeyCharacters:workspaceKeyChars,pubkeyMustStartWithB:!0})}function parseAddress(q,_){const{sigil:M,separator:$,minNameLength:j,maxNameLength:z,minPubkeyLength:V,maxPubkeyLength:G,allowedNameCharacters:X,allowedPubkeyCharacters:Y,pubkeyMustStartWithB:Q}=_;if(typeof q!="string")return new ValidationError("address must be a string");if(q.length<4)return new ValidationError("address is too short");if(q[0]!==M)return new ValidationError(`address must start with a sigil: "${M}"`);if(q.indexOf($)===-1)return new ValidationError(`address must contain a separator character: "${$}"`);const Z=q.slice(1).split($);if(Z.length!==2)return new ValidationError(`address must have exactly 2 parts separated by a "${$}" separator`);const[ee,te]=Z;return ee.length<j||ee.length>z?new ValidationError(`name must be between ${j} and ${z} characters long, but is ${ee.length}`):te.length<V||te.length>G?new ValidationError(`pubkey must be between ${V} and ${G} characters long, but is ${te.length}`):onlyHasChars(ee,X)?onlyHasChars(te,Y)?isDigit(ee[0])?new ValidationError(`name "${ee}" must not start with a digit`):isDigit(te[0])?new ValidationError(`pubkey "${te}" must not start with a digit`):Q&&te[0]!=="b"?new ValidationError(`pubkey "${te}" must start with 'b'`):{address:q,name:ee,pubkey:te}:new ValidationError(`pubkey "${te}" must only have allowed characters`):new ValidationError(`name "${ee}" must only have allowed characters`)}function isPlainObject(q){return!(Object.prototype.toString.call(q)!=="[object Object]"||(""+q.constructor).startsWith("class"))}function checkLiteral(q){return _=>_!==q?`expected literal value ${JSON.stringify(q)}`:null}function checkString(q={}){return _=>{if(q.optional!==!0&&_===void 0)return"required";if(q.optional===!0&&_===void 0)return null;let M=stringLengthInBytes(_);return typeof _!="string"?"expected a string but got "+JSON.stringify(_):q.minLen!==void 0&&M<q.minLen?`string shorter than min length of ${q.minLen} chars`:q.maxLen!==void 0&&M>q.maxLen?`string shorter than max length of ${q.maxLen} chars`:q.len!==void 0&&M!==q.len?`string does not have required length of ${q.len} chars: ${_}`:q.allowedChars!==void 0&&!onlyHasChars(_,q.allowedChars)?"contains disallowed characters":null}}function checkInt(q={}){return _=>q.optional!==!0&&_===void 0?"required":q.optional===!0&&_===void 0?null:q.nullable!==!0&&_===null?"not nullable":q.nullable===!0&&_===null?null:typeof _!="number"?"expected a number but got "+JSON.stringify(_):isNaN(_)?"is NaN":isFinite(_)?_!==Math.round(_)?"expected an integer":q.min!==void 0&&_<q.min?`integer too small (must be >= ${q.min})`:q.max!==void 0&&_>q.max?`integer too large (must be <= ${q.max})`:null:"is Infinity"}function checkObj(q={}){return q.allowLiteralUndefined=q.allowLiteralUndefined??!1,q.allowExtraKeys=q.allowExtraKeys??!1,_=>{if(!isPlainObject(_))return"expected an object";if(q.allowLiteralUndefined===!1){for(let[M,$]of Object.entries(_))if($===void 0)return`${M} is explicitly set to undefined but should be missing instead`}if(q.objSchema!==void 0){if(q.allowExtraKeys===!1){let M=Object.keys(_),$=Object.keys(q.objSchema),j=M.filter(z=>$.indexOf(z)===-1);if(j.length>0)return`object has extra keys not in the schema: ${j.join(", ")}`}for(let[M,$]of Object.entries(q.objSchema)){let j=$(_[M]);if(j!==null)return`${M}: ${j}`}}return null}}const{codec}=rfc4648,myEncoding={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function base32BytesToString(q){return"b"+codec.stringify(q,myEncoding,{pad:!1})}function base32StringToBytes(q){if(!q.startsWith("b"))throw new ValidationError("can't decode base32 string - it should start with a 'b'. "+q);if(q[q.length-1]==="=")throw new ValidationError("can't decode base32 string - it contains padding characters ('=')");return codec.parse(q.slice(1),myEncoding,{loose:!0})}var LogLevel;(function(q){q[q.None=-1]="None",q[q.Error=0]="Error",q[q.Warn=1]="Warn",q[q.Log=2]="Log",q[q.Info=3]="Info",q[q.Debug=4]="Debug"})(LogLevel||(LogLevel={}));const DEFAULT_LOG_LEVEL=LogLevel.Error;let globalLogLevels={_default:DEFAULT_LOG_LEVEL};function getLogLevel(q){return q in globalLogLevels?globalLogLevels[q]:globalLogLevels._default}class Logger{constructor(_,M){Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.source=_,this.color=M||"aqua"}_print(_,M,$,...j){if(_<=getLogLevel(this.source))if(M){const z=`[${this.source}]`;if(this.color!==void 0){const V=[`%c ${z}`,`color: ${this.color}`];console.log($,...V,...j)}else console.log($,z,...j)}else console.log($,...j)}error(..._){this._print(LogLevel.Error,!0,"!!",..._)}warn(..._){this._print(LogLevel.Warn,!0,"! ",..._)}log(..._){this._print(LogLevel.Log,!0,"  ",..._)}info(..._){this._print(LogLevel.Info,!0,"    ",..._)}debug(..._){this._print(LogLevel.Debug,!0,"      ",..._)}blank(){this._print(LogLevel.Info,!1,"")}}class UpdatableHash{constructor(_){Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalDigest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.hash=_.hash,this.internalUpdate=_.update,this.internalDigest=_.digest}update(_){return this.hash=this.internalUpdate(this.hash,_),this.hash}digest(){return this.internalDigest(this.hash)}}const{createHash}=sha256_uint8array,logger$7=new Logger("crypto-driver-noble","cyan"),CryptoDriverNoble=class{static sha256(q){return typeof q=="string"?Promise.resolve(createHash("sha256").update(q,"utf-8").digest()):Promise.resolve(createHash("sha256").update(q).digest())}static updatableSha256(){return new UpdatableHash({hash:createHash("sha256"),update:(q,_)=>q.update(_),digest:q=>q.digest()})}static async generateKeypairBytes(){logger$7.debug("generateKeypairBytes");const q=utils$2.randomPrivateKey();return{pubkey:await getPublicKey(q),secret:q}}static sign(q,_){return logger$7.debug("sign"),typeof _=="string"&&(_=stringToBytes(_)),sign(_,q.secret)}static async verify(q,_,M){logger$7.debug("verify");try{return typeof M=="string"&&(M=stringToBytes(M)),await verify(_,M,q)}catch{return!1}}};function microsecondNow(){return Date.now()*1e3}function sleep(q){return new Promise(_=>{setTimeout_1(_,q)})}function randomId(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function decodeKeypairToBytes(q){try{const _=isAuthorKeypair(q)?q.address:q.shareAddress,M=parseAuthorOrShareAddress(_);if(isErr(M))return M;const $={pubkey:base32StringToBytes(M.pubkey),secret:base32StringToBytes(q.secret)};return $.pubkey.length!==32?new ValidationError(`pubkey bytes should be 32 bytes long, not ${$.pubkey.length} after base32 decoding.  ${_}`):$.secret.length!==32?new ValidationError(`secret bytes should be 32 bytes long, not ${$.secret.length} after base32 decoding.  ${q.secret}`):$}catch(_){return new ValidationError("crash while decoding author keypair: "+_.message)}}function isAuthorKeypair(q){return"address"in q}new Logger("crypto","cyan");let GlobalCryptoDriver=CryptoDriverNoble,logger$6=new Logger("crypto","cyan");const Crypto=class{static async sha256base32(q){const _=await GlobalCryptoDriver.sha256(q);return base32BytesToString(_)}static updatableSha256(){return GlobalCryptoDriver.updatableSha256()}static async generateAuthorKeypair(q){logger$6.debug(`generateAuthorKeypair("${q}")`);const _=await GlobalCryptoDriver.generateKeypairBytes(),M={address:assembleAuthorAddress(q,base32BytesToString(_.pubkey)),secret:base32BytesToString(_.secret)},$=checkAuthorIsValid(M.address);return isErr($)?$:M}static async generateShareKeypair(q){logger$6.debug(`generateAuthorKeypair("${q}")`);const _=await GlobalCryptoDriver.generateKeypairBytes(),M={shareAddress:assembleShareAddress(q,base32BytesToString(_.pubkey)),secret:base32BytesToString(_.secret)},$=checkShareIsValid(M.shareAddress);return isErr($)?$:M}static async sign(q,_){logger$6.debug("sign");try{const M=decodeKeypairToBytes(q);if(isErr(M))return M;const $=await GlobalCryptoDriver.sign(M,_);return base32BytesToString($)}catch(M){return new ValidationError("unexpected error while signing: "+M.message)}}static verify(q,_,M){logger$6.debug("verify");try{const $=parseAuthorOrShareAddress(q);return isErr($)?Promise.resolve(!1):GlobalCryptoDriver.verify(base32StringToBytes($.pubkey),base32StringToBytes(_),M)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(q){logger$6.debug("checkAuthorKeypairIsValid");const _=isAuthorKeypair(q)?q.address:q.shareAddress;try{if(typeof _!="string"||typeof q.secret!="string")return new ValidationError("address and secret must be strings");const M=parseAuthorOrShareAddress(_);if(isErr(M))return M;const $="a test message to sign. "+randomId(),j=await this.sign(q,$);return isErr(j)?j:await this.verify(_,j,$)===!1?new ValidationError("pubkey does not match secret"):!0}catch(M){return new ValidationError("unexpected error in checkAuthorKeypairIsValid: "+M.message)}}};var __setFunctionName$1=globalThis&&globalThis.__setFunctionName||function(q,_,M){return typeof _=="symbol"&&(_=_.description?"[".concat(_.description,"]"):""),Object.defineProperty(q,"name",{configurable:!0,value:M?"".concat(M," ",_):_})},_a$1;new Logger("validator es.4","red");const FUTURE_CUTOFF_MINUTES$1=10,FUTURE_CUTOFF_MICROSECONDS$1=FUTURE_CUTOFF_MINUTES$1*60*1e3*1e3,MIN_TIMESTAMP$1=1e13,MAX_TIMESTAMP$1=9007199254740990,MAX_CONTENT_LENGTH=4e6,HASH_STR_LEN$1=53,SIG_STR_LEN$1=104,ES4_CORE_SCHEMA={objSchema:{format:checkLiteral("es.4"),author:checkString({allowedChars:authorAddressChars}),content:checkString({maxLen:MAX_CONTENT_LENGTH}),contentHash:checkString({allowedChars:b32chars,len:HASH_STR_LEN$1}),deleteAfter:checkInt({min:MIN_TIMESTAMP$1,max:MAX_TIMESTAMP$1,nullable:!0}),path:checkString({allowedChars:pathChars,minLen:2,maxLen:512}),signature:checkString({allowedChars:b32chars,len:SIG_STR_LEN$1}),timestamp:checkInt({min:MIN_TIMESTAMP$1,max:MAX_TIMESTAMP$1}),workspace:checkString({allowedChars:workspaceAddressChars})},allowLiteralUndefined:!1,allowExtraKeys:!1};_a$1=class{static hashDocument(q){const _={...q,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},M=this._checkBasicDocumentValidity(_);return isErr(M)?Promise.resolve(M):Crypto.sha256base32(`author	${q.author}
contentHash	${q.contentHash}
`+(q.deleteAfter===null?"":`deleteAfter	${q.deleteAfter}
`)+`format	${q.format}
path	${q.path}
timestamp	${q.timestamp}
workspace	${q.workspace}
`)}static async generateDocument({input:q,keypair:_,share:M,timestamp:$}){const j={format:"es.4",author:_.address,content:q.content,contentHash:await Crypto.sha256base32(q.content),deleteAfter:q.deleteAfter??null,path:q.path,timestamp:$,workspace:M,signature:"?"},z=await this.signDocument(_,j);return isErr(z)?z:{doc:z}}static async signDocument(q,_){const M=await this.hashDocument(_);if(isErr(M))return M;const $=await Crypto.sign(q,M);return isErr($)?$:{..._,signature:$}}static async wipeDocument(q,_){if(_.content.length===0)return _;const M=this.removeExtraFields(_);if(isErr(M))return M;const j={...M.doc,content:"",contentHash:await Crypto.sha256base32(""),signature:"?"};return this.signDocument(q,j)}static removeExtraFields(q){if(!isPlainObject(q))return new ValidationError("doc is not a plain javascript object");const _=new Set(Object.keys(ES4_CORE_SCHEMA.objSchema||{})),M={},$={};for(const[j,z]of Object.entries(q))if(_.has(j))M[j]=z;else{if(!j.startsWith("_"))return new ValidationError("extra document fields must have names starting with an underscore");$[j]=z}return{doc:M,extras:$}}static async checkDocumentIsValid(q,_){_===void 0&&(_=Date.now()*1e3);const M=this._checkBasicDocumentValidity(q);if(isErr(M))return M;const $=this._checkTimestampIsOk(q.timestamp,q.deleteAfter,_);if(isErr($))return $;const j=this._checkAuthorCanWriteToPath(q.author,q.path);if(isErr(j))return j;const z=this._checkPathIsValid(q.path,q.deleteAfter);if(isErr(z))return z;const V=checkAuthorIsValid(q.author);if(isErr(V))return V;const G=checkShareIsValid(q.workspace);if(isErr(G))return G;const X=await this._checkAuthorSignatureIsValid(q);if(isErr(X))return X;const Y=await this._checkContentMatchesHash(q.content,q.contentHash);return isErr(Y)?Y:!0}static _checkBasicDocumentValidity(q){const _=checkObj(ES4_CORE_SCHEMA)(q);return _!==null?new ValidationError(_):!0}static _checkAuthorCanWriteToPath(q,_){return _.indexOf("~")===-1||_.indexOf("~"+q)!==-1?!0:new ValidationError(`author ${q} can't write to path ${_}`)}static _checkTimestampIsOk(q,_,M){if(q>M+FUTURE_CUTOFF_MICROSECONDS$1)return new ValidationError("timestamp too far in the future");if(_!==null){if(M>_)return new ValidationError("ephemeral doc has expired");if(_<=q)return new ValidationError("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(q,_){if(!q.startsWith("/"))return new ValidationError("invalid path: must start with /");if(q.endsWith("/"))return new ValidationError("invalid path: must not end with /");if(q.startsWith("/@"))return new ValidationError('invalid path: must not start with "/@"');if(q.indexOf("//")!==-1)return new ValidationError("invalid path: must not contain two consecutive slashes");if(_!==void 0){if(q.indexOf("!")===-1&&_!==null)return new ValidationError("when deleteAfter is set, path must contain '!'");if(q.indexOf("!")!==-1&&_===null)return new ValidationError("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(q){try{const _=await this.hashDocument(q);return isErr(_)?_:await Crypto.verify(q.author,q.signature,_)!==!0?new ValidationError("signature is invalid"):!0}catch{return new ValidationError("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(q,_){return await Crypto.sha256base32(q)!==_?new ValidationError("content does not match contentHash"):!0}static getAttachmentInfo(q){return new ValidationError("es.4 does not support attachments")}static updateAttachmentFields(q,_,M,$){return Promise.resolve(new ValidationError("es.4 does not support attachments"))}static authorFromCredentials(q){return q.address}},__setFunctionName$1(_a$1,"FormatEs4"),Object.defineProperty(_a$1,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.4"});var __setFunctionName=globalThis&&globalThis.__setFunctionName||function(q,_,M){return typeof _=="symbol"&&(_=_.description?"[".concat(_.description,"]"):""),Object.defineProperty(q,"name",{configurable:!0,value:M?"".concat(M," ",_):_})},_a;new Logger("validator es.5","red");const FUTURE_CUTOFF_MINUTES=10,FUTURE_CUTOFF_MICROSECONDS=FUTURE_CUTOFF_MINUTES*60*1e3*1e3,MIN_TIMESTAMP=1e13,MAX_TIMESTAMP=9007199254740990,MAX_TEXT_LENGTH=8e3,HASH_STR_LEN=53,SIG_STR_LEN=104,MIN_BLOB_SIZE=0,MAX_BLOB_SIZE=Number.MAX_SAFE_INTEGER,ES5_CORE_SCHEMA={objSchema:{format:checkLiteral("es.5"),author:checkString({allowedChars:authorAddressChars}),text:checkString({maxLen:MAX_TEXT_LENGTH}),textHash:checkString({allowedChars:b32chars,len:HASH_STR_LEN}),deleteAfter:checkInt({min:MIN_TIMESTAMP,max:MAX_TIMESTAMP,optional:!0}),path:checkString({allowedChars:pathChars,minLen:2,maxLen:512}),signature:checkString({allowedChars:b32chars,len:SIG_STR_LEN}),shareSignature:checkString({allowedChars:b32chars,len:SIG_STR_LEN}),timestamp:checkInt({min:MIN_TIMESTAMP,max:MAX_TIMESTAMP}),share:checkString({allowedChars:workspaceAddressChars}),attachmentSize:checkInt({min:MIN_BLOB_SIZE,max:MAX_BLOB_SIZE,optional:!0}),attachmentHash:checkString({allowedChars:b32chars,len:HASH_STR_LEN,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1},FormatEs5=(_a=class{static hashDocument(q){const _={...q,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},M=this._checkBasicDocumentValidity(_);return isErr(M)?Promise.resolve(M):Crypto.sha256base32((q.attachmentHash===void 0?"":`attachmentHash	${q.attachmentHash}
`)+(q.attachmentSize===void 0?"":`attachmentSize	${q.attachmentSize}
`)+`author	${q.author}
`+(q.deleteAfter===void 0?"":`deleteAfter	${q.deleteAfter}
`)+`format	${q.format}
path	${q.path}
textHash	${q.textHash}
timestamp	${q.timestamp}
share	${q.share}
`)}static async generateDocument({input:q,keypair:_,share:M,timestamp:$,prevLatestDoc:j,config:z}){if(q.text===void 0&&(j==null?void 0:j.text)===void 0)return new ValidationError("Couldn't determine document text from given input or previous version's text.");const V=q.text!==void 0?q.text:j==null?void 0:j.text,G={...j,format:"es.5",author:_.address,text:V,textHash:await Crypto.sha256base32(V),path:q.path,timestamp:$,share:M,signature:"?",shareSignature:"?"};q.deleteAfter&&(G.deleteAfter=q.deleteAfter);const X=await this.signDocument(_,G,z);return isErr(X)?X:q.attachment?{doc:X,attachment:q.attachment}:{doc:X}}static async signDocument(q,_,M){const $=await this.hashDocument(_);if(isErr($))return $;const j=await Crypto.sign(q,$);if(M.shareSecret===void 0)return new EarthstarError(`Tried to write a document to ${_.share} without the secret.`);const z=await Crypto.sign({shareAddress:_.share,secret:M.shareSecret},$);return isErr(j)?j:isErr(z)?z:{..._,signature:j,shareSignature:z}}static async wipeDocument(q,_,M){if(_.text.length===0)return _;const $=this.removeExtraFields(_);if(isErr($))return $;const j=$.doc;if(j.attachmentHash){const V={...j,text:"",textHash:await Crypto.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await Crypto.sha256base32(""),attachmentSize:0};return this.signDocument(q,V,M)}const z={...j,text:"",textHash:await Crypto.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(q,z,M)}static removeExtraFields(q){if(!isPlainObject(q))return new ValidationError("doc is not a plain javascript object");const _=new Set(Object.keys(ES5_CORE_SCHEMA.objSchema||{})),M={},$={};for(const[j,z]of Object.entries(q))if(_.has(j))M[j]=z;else{if(!j.startsWith("_"))return new ValidationError("extra document fields must have names starting with an underscore");$[j]=z}return{doc:M,extras:$}}static async checkDocumentIsValid(q,_){_===void 0&&(_=Date.now()*1e3);const M=this._checkBasicDocumentValidity(q);if(isErr(M))return M;const $=this._checkTimestampIsOk(q.timestamp,q.deleteAfter?q.deleteAfter:null,_);if(isErr($))return $;const j=this._checkAuthorCanWriteToPath(q.author,q.path);if(isErr(j))return j;const z=this._checkAttachmentFieldsConsistent(q);if(isErr(z))return z;const V=this._checkPathIsValid(q.path,!!q.attachmentHash,q.deleteAfter);if(isErr(V))return V;const G=checkAuthorIsValid(q.author);if(isErr(G))return G;const X=checkShareIsValid(q.share);if(isErr(X))return X;const Y=await this._checkAuthorSignatureIsValid(q);if(isErr(Y))return Y;const Q=await this._checkShareSignatureIsValid(q);if(isErr(Q))return Q;const Z=await this._checkContentMatchesHash(q.text,q.textHash);return isErr(Z)?Z:!0}static _checkBasicDocumentValidity(q){const _=checkObj(ES5_CORE_SCHEMA)(q);return _!==null?new ValidationError(_):!0}static _checkAttachmentFieldsConsistent(q){return q.text.length===0&&q.attachmentSize&&q.attachmentSize>0?new ValidationError("Documents with attachments must have text."):(q.text.length>0&&q.attachmentSize&&q.attachmentSize,q.attachmentHash&&q.attachmentSize===void 0?new ValidationError("Attachment size is undefined while attachment hash is defined"):q.attachmentSize&&q.attachmentHash===void 0?new ValidationError("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(q,_){return _.indexOf("~")===-1||_.indexOf("~"+q)!==-1?!0:new ValidationError(`author ${q} can't write to path ${_}`)}static _checkTimestampIsOk(q,_,M){if(q>M+FUTURE_CUTOFF_MICROSECONDS)return new ValidationError("timestamp too far in the future");if(_!==null){if(M>_)return new ValidationError("ephemeral doc has expired");if(_<=q)return new ValidationError("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(q,_,M){if(!q.startsWith("/"))return new ValidationError("invalid path: must start with /");if(q.endsWith("/"))return new ValidationError("invalid path: must not end with /");if(q.startsWith("/@"))return new ValidationError('invalid path: must not start with "/@"');if(q.indexOf("//")!==-1)return new ValidationError("invalid path: must not contain two consecutive slashes");if(M!==void 0){if(q.indexOf("!")===-1&&M!==null)return new ValidationError("when deleteAfter is set, path must contain '!'");if(q.indexOf("!")!==-1&&M===null)return new ValidationError("when deleteAfter is null, path must not contain '!'")}return!pathHasFileExtension(q)&&_?new ValidationError("when a attachment is provided, the path must end with a file extension"):pathHasFileExtension(q)&&_===!1?new ValidationError("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(q){try{const _=await this.hashDocument(q);return isErr(_)?_:await Crypto.verify(q.author,q.signature,_)!==!0?new ValidationError("signature is invalid"):!0}catch{return new ValidationError("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(q){try{const _=await this.hashDocument(q);return isErr(_)?_:await Crypto.verify(q.share,q.shareSignature,_)!==!0?new ValidationError("share signature is invalid"):!0}catch{return new ValidationError("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(q,_){return await Crypto.sha256base32(q)!==_?new ValidationError("content does not match contentHash"):!0}static getAttachmentInfo(q){return q.attachmentHash&&q.attachmentSize===0?new ValidationError("This document has had its attachment wiped"):!q.attachmentHash||!q.attachmentSize?new ValidationError("This document has no attachment."):{size:q.attachmentSize,hash:q.attachmentHash}}static updateAttachmentFields(q,_,M,$,j){const z={..._,attachmentHash:$,attachmentSize:M};return this.signDocument(q,z,j)}static authorFromCredentials(q){return q.address}},__setFunctionName(_a,"FormatEs5"),Object.defineProperty(_a,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.5"}),_a),fileExtensionRegex=/^.*\.(\w+)$/,endingWithKeypairAddrRegex=/^.*~@\w{4}\.\w{53}$/;function pathHasFileExtension(q){if(q.indexOf(".")===-1)return!1;const _=q.match(fileExtensionRegex);return!(_===null||_[1].length===53&&q.match(endingWithKeypairAddrRegex))}const DEFAULT_FORMAT=FormatEs5,DEFAULT_FORMATS=[DEFAULT_FORMAT];function getFormatWithFallback(q){return q||DEFAULT_FORMAT}function getFormatsWithFallback(q){return q||DEFAULT_FORMATS}function getFormatIntersection(q,_){const M=[];for(const $ of _)q.includes($.id)&&M.push($);return M}function getFormatLookup(q){const _=q||DEFAULT_FORMATS,M={};for(const $ of _)M[$.id]=$;return M}class MultiDeferred{constructor(){Object.defineProperty(this,"deferreds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"pending"})}resolve(_){if(this.state==="pending"){this.state="fulfilled";for(const M of this.deferreds)M.resolve(_)}}reject(_){if(this.state==="pending"){this.state="rejected";for(const M of this.deferreds)M.reject(_)}}getPromise(){const _=deferred();return this.state==="fulfilled"?_.resolve():this.state==="rejected"?_.reject():this.deferreds.add(_),_}}class PromiseEnroller{constructor(_=!1){Object.defineProperty(this,"promises",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new MultiDeferred}),Object.defineProperty(this,"allowRejectedPromises",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.allowRejectedPromises=_}enrol(_){if(this.sealed)throw new EarthstarError("Tried to enrol a promise when enrolment was already sealed.");this.promises.add(_),_.then(()=>{this.checkAllDone()}).catch(M=>{if(!this.allowRejectedPromises)throw M})}checkAllDone(){this.sealed&&(this.allowRejectedPromises?Promise.allSettled(this.promises).then(()=>{this.multiDeferred.resolve()}):Promise.all(this.promises).then(()=>{this.multiDeferred.resolve()}).catch(()=>{this.multiDeferred.reject()}))}seal(){this.sealed||(this.sealed=!0,this.checkAllDone())}isSealed(){return this.sealed}isDone(){return this.multiDeferred.getPromise()}}class CombineStream{constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"transform",{enumerable:!0,configurable:!0,writable:!0,value:new TransformStream({transform(_,M){M.enqueue(_)}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.writable.getWriter()}),Object.defineProperty(this,"readable",{enumerable:!0,configurable:!0,writable:!0,value:this.transform.readable}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]})}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){this.checkClosed();const _=this.writer,M=new WritableStream({async write($){await _.ready,await _.write($)}});return this.writables.push(M),M}async close(){this.checkClosed();for(const _ of this.writables)await _.abort();this.transform.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class CloneStream{constructor(){Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:new TransformStream(new PassThroughTransformer)}),Object.defineProperty(this,"sourceReadable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.readable}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:this.transformStream.writable})}getReadableStream(){const[_,M]=this.sourceReadable.tee();return this.sourceReadable=_,M}}class CloneMidStream{checkClosed(){if(this.closed)throw"Closed"}constructor(){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"subscribers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const _=this.subscribers;this.writable=new WritableStream({write(M){const $=_.map(({writer:j})=>new Promise(z=>{j.ready.then(()=>{j.write(M).then(z)})}));Promise.all($)}})}getReadableStream(){this.checkClosed();const _=new TransformStream({transform(M,$){$.enqueue(M)}});return this.subscribers.push({transform:_,writer:_.writable.getWriter()}),_.readable}async close(){this.checkClosed();for(const _ of this.writables)await _.abort();for(const{transform:_}of this.subscribers)await _.writable.abort(),await _.readable.cancel();this.closed=!0}isClosed(){return this.closed}}class MultiStream{checkClosed(){if(this.closed)throw"Closed"}constructor(_){Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineStream",{enumerable:!0,configurable:!0,writable:!0,value:new CombineStream}),Object.defineProperty(this,"cloneStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),_?this.cloneStream=new CloneMidStream:this.cloneStream=new CloneStream,this.combineStream.readable.pipeTo(this.cloneStream.writable)}getWritableStream(){return this.combineStream.getWritableStream()}getReadableStream(){return this.cloneStream.getReadableStream()}close(){this.checkClosed(),this.combineStream.close(),this.closed=!0}isClosed(){return this.closed}}class CallbackSink{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set})}onWrite(_){return this.callbacks.add(_),()=>{this.callbacks.delete(_)}}async write(_){for(const M of this.callbacks)await M(_)}close(){this.callbacks.clear()}}class BlockingBus{constructor(){Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"lock",{enumerable:!0,configurable:!0,writable:!0,value:new LockStream})}on(_){return this.callbacks.add(_),()=>{this.callbacks.delete(_)}}async send(_){for(const M of this.callbacks)await this.lock.run(()=>M(_))}}class PassThroughTransformer{transform(_,M){M.enqueue(_)}}class LockStream{constructor(){Object.defineProperty(this,"doneEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller}),Object.defineProperty(this,"writable",{enumerable:!0,configurable:!0,writable:!0,value:new WritableStream({async write(_){await _()}})}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:this.writable.getWriter()}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1})}checkClosed(){if(this.closed)throw"Closed"}async run(_){this.checkClosed(),await this.writer.ready;const M=this.writer.write(_);return this.doneEnroller.enrol(M),M}async close(){this.checkClosed(),this.doneEnroller.seal(),await this.doneEnroller.isDone(),this.writer.releaseLock(),await this.writable.abort(),this.closed=!0}isClosed(){return this.closed}}class ChannelTransformer{constructor(_,M){Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.channel=_,this.channelKey=M}transform(_,M){if(this.channel==="*"||this.channel===_[this.channelKey]){M.enqueue(_);return}}}class ChannelMultiStream{constructor(_,M){Object.defineProperty(this,"multistream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.multistream=new MultiStream(M),this.channelKey=_}getWritableStream(){return this.multistream.getWritableStream()}getReadableStream(_){const M=new TransformStream(new ChannelTransformer(_,this.channelKey));return this.multistream.getReadableStream().pipeThrough(M)}}function websocketWritable(q,_){const M=deferred(),$=deferred(),j=()=>{if($.state==="pending"){let z;q instanceof WebSocket$1?z=q:z=new WebSocket$1(q),$.resolve(z),z.binaryType="arraybuffer",z.readyState===z.OPEN&&M.resolve(),z.onopen=()=>{M.resolve()}}};return new WritableStream({async write(z,V){j();const G=await $;await M;try{const X=_(z);G.send(X)}catch(X){V.error(X)}G.onclose=()=>{V.error("Socket closed before we were done")}},async close(){j();const z=await $;await M,z.close()},async abort(){j();const z=await $;await M,z.close()}})}function websocketReadable(q,_){const M=deferred();let $=!1;const j=()=>{if(M.state==="pending")if(q instanceof WebSocket$1)M.resolve(q);else try{const z=new WebSocket$1(q);M.resolve(z)}catch(z){M.reject(z)}};return new ReadableStream$1({async start(z){j();const V=await M;V.binaryType="arraybuffer",V.onmessage=G=>{const X=_(G);try{z.enqueue(X)}catch{}},V.onclose=()=>{if(!$)try{z.close()}catch{}},V.onerror=G=>{$=!0,z.error(G)}},async cancel(){j(),(await M).close()}})}function bigIntToHex(q){let M=q.toString(16);return M.length%2&&(M="0"+M),M}function bigIntFromHex(q){return BigInt("0x"+q)}const TYPE_MAPPINGS={EMPTY_SET:"emptySet",LOWER_BOUND:"lowerBound",PAYLOAD:"payload",EMPTY_PAYLOAD:"emptyPayload",DONE:"done",FINGERPRINT:"fingerprint",TERMINAL:"terminal"},encoding={encode:{emptySet:q=>({type:"EMPTY_SET",canRespond:q}),lowerBound:q=>({type:"LOWER_BOUND",value:q}),payload:(q,_)=>({type:"PAYLOAD",payload:q,..._?{end:_}:{}}),emptyPayload:q=>({type:"EMPTY_PAYLOAD",upperBound:q}),done:q=>({type:"DONE",upperBound:q}),fingerprint:(q,_)=>({type:"FINGERPRINT",fingerprint:bigIntToHex(q),upperBound:_}),terminal:()=>({type:"TERMINAL"})},decode:{getType:q=>TYPE_MAPPINGS[q.type],emptySet:q=>{if(q.type==="EMPTY_SET")return q.canRespond;throw"Can't decode"},lowerBound:q=>{if(q.type==="LOWER_BOUND")return q.value;throw"Can't decode"},payload:q=>{if(q.type==="PAYLOAD")return{value:q.payload,...q.end?{end:q.end}:{}};throw"Can't decode"},emptyPayload:q=>{if(q.type==="EMPTY_PAYLOAD")return q.upperBound;throw"Can't decode"},done:q=>{if(q.type==="DONE")return q.upperBound;throw"Can't decode"},fingerprint:q=>{if(q.type==="FINGERPRINT")return{fingerprint:bigIntFromHex(q.fingerprint),upperBound:q.upperBound};throw"Can't decode"},terminal:q=>{if(q.type==="TERMINAL")return!0;throw"Can't decode"}}};class EarthstarRangeMessenger extends RangeMessenger{constructor(_,M,$){super({tree:_,encoding,fingerprintEquals:(j,z)=>j===z,payloadThreshold:M,rangeDivision:$})}}class SyncAgent{sendEvent(_){return this.inboundEventQueue.push(_)}events(){return this.outboundEventQueue}getStatus(){return{requestedCount:this.requestedCount,receivedCount:this.receivedDocsCount,sentCount:this.sentDocsCount,status:this.isDoneMultiDeferred.state==="rejected"?"aborted":this.hasPrepared.state==="pending"?"preparing":this.hasReconciled.state==="pending"?"reconciling":this.isDoneMultiDeferred.state==="fulfilled"?"done":"gossiping"}}constructor(_){Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new MultiDeferred}),Object.defineProperty(this,"inboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"outboundEventQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"gossiperInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"reconcilerInboundQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"hasPrepared",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"hasReconciled",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"hasCheckedAllExistingDocsForAttachments",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"requestedCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sentDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"receivedDocsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"counterpartId",{enumerable:!0,configurable:!0,writable:!0,value:randomId()}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.replica=_.replica,_.replica.onEvent(V=>{V.kind==="willClose"&&this.cancel()});const{treeIsReady:M}=_.syncerManager.getDocThumbnailTreeAndDocLookup(_.replica.share,getFormatsWithFallback(_.formats));M.then(()=>{this.hasPrepared.resolve()}),(async()=>{for await(const V of this.inboundEventQueue)switch(V.kind){case"RANGE_MSG":{this.reconcilerInboundQueue.push(V.message);break}default:this.gossiperInboundQueue.push(V)}})(),new ExistingDocAttachmentChecker({outboundEventQueue:this.outboundEventQueue,formats:_.formats,replica:_.replica,counterpartId:this.counterpartId,transferManager:_.transferManager,hasCheckedAllExistingDocsForAttachments:this.hasCheckedAllExistingDocsForAttachments});const $=new WantTracker,j=new SyncAgentReconciler({inboundEventQueue:this.reconcilerInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:_.syncerManager,formats:_.formats,replica:_.replica,initiateMessaging:_.initiateMessaging,wantTracker:$,payloadThreshold:_.payloadThreshold,rangeDivision:_.rangeDivision,onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}});j.isDone.then(()=>{this.hasReconciled.resolve()}),new SyncAgentGossiper({inboundEventQueue:this.gossiperInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:_.syncerManager,formats:_.formats,replica:_.replica,counterpartId:this.counterpartId,transferManager:_.transferManager,cancel:this.cancel.bind(this),reconciliationIsDone:j.isDone,wantTracker:$,syncAppetite:_.syncAppetite,onDocReceived:async()=>{this.receivedDocsCount++,await this.statusBus.send(this.getStatus())},onDocSent:async()=>{this.sentDocsCount++,await this.statusBus.send(this.getStatus())},onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}}).isDone.then(async()=>{await this.hasCheckedAllExistingDocsForAttachments,this.isDoneMultiDeferred.resolve()}),this.statusBus.send(this.getStatus())}onStatusUpdate(_){return this.statusBus.on(_)}async cancel(_){this.isDoneMultiDeferred.state==="fulfilled"||this.isDoneMultiDeferred.state==="rejected"||(this.isDoneMultiDeferred.reject(_||"Cancelled"),await this.statusBus.send(this.getStatus()),this.outboundEventQueue.push({kind:"ABORT"}),this.outboundEventQueue.close(),this.inboundEventQueue.close({immediately:!0}),this.gossiperInboundQueue.close({immediately:!0}),this.reconcilerInboundQueue.close({immediately:!0}))}isDone(){return this.isDoneMultiDeferred.getPromise()}}class SyncAgentGossiper{constructor(_){Object.defineProperty(this,"isPartnerFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"isFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:deferred()});const M=getFormatLookup(_.formats),$=_.syncerManager.getPlumTree(_.replica.share);if(_.syncAppetite==="continuous"){const V=_.replica.getQueryStream(void 0,"new",_.formats),G=new XXH64;V.pipeTo(new WritableStream({async write(X){if(X.kind==="success"&&X.sourceId!==_.counterpartId){const Y=$.getMode(X.sourceId);G.reset(),G.update(`${X.doc.path} ${X.doc.author}`);const Q=G.digest().toString(16),Z=`${X.doc.timestamp} ${Q}`;if(Y==="EAGER"){const ee=M[X.doc.format],te=ee.getAttachmentInfo(X.doc),ne=!isErr(te);let re=!1;ne&&await _.replica.getAttachment(X.doc,ee)&&(re=!0),_.outboundEventQueue.push({kind:"DOC",thumbnail:Z,doc:X.doc,attachmentHeld:re}),_.onDocSent()}else _.outboundEventQueue.push({kind:"HAVE",thumbnail:Z})}}})).catch(()=>{})}const j=_.replica.onEvent(V=>{V.kind==="attachment_ingest"&&V.sourceId!==_.counterpartId&&_.outboundEventQueue.push({kind:"NEW_ATTACHMENT",path:V.doc.path,author:V.doc.author,format:V.doc.format,hash:V.hash})}),{lookup:z}=_.syncerManager.getDocThumbnailTreeAndDocLookup(_.replica.share,getFormatsWithFallback(_.formats));(async()=>{for await(const V of _.inboundEventQueue)switch(V.kind){case"PRUNE":{$.onPrune(_.counterpartId);break}case"HAVE":{if(_.reconciliationIsDone.state==="fulfilled"&&_.syncAppetite==="once")break;_.wantTracker.addWantedThumbnail(V.thumbnail),$.onLazyMessage(V,G=>{_.outboundEventQueue.push({kind:"WANT",thumbnail:G})}),_.onDocRequested();break}case"WANT":{$.onGraftMessage(_.counterpartId);const[,G]=V.thumbnail.split(" "),X=z[G];if(!X)return;const[,Y,Q]=X,ee=(await _.replica.getAllDocsAtPath(Y,_.formats)).find(te=>te.author===Q);if(ee){const te=M[ee.format],ne=te.getAttachmentInfo(ee),re=!isErr(ne);let ie=!1;re&&await _.replica.getAttachment(ee,te)&&(ie=!0),_.outboundEventQueue.push({kind:"DOC",thumbnail:V.thumbnail,doc:ee,attachmentHeld:ie}),await _.onDocSent()}else console.error("Got a WANT event for a document not on record.");break}case"DOC":{if(this.isFulfilled.state==="fulfilled"&&_.syncAppetite==="once"||($.onEagerMessage(_.counterpartId,V)&&_.outboundEventQueue.push({kind:"PRUNE"}),_.wantTracker.isReceived(V.thumbnail)))break;const X=M[V.doc.format];if(!X){console.error(`Was sent a doc with a format we don't know about (${V.doc.format})`);break}if(V.attachmentHeld&&await _.replica.getAttachment(V.doc,M[V.doc.format])===void 0){const Q=await _.transferManager.handleDownload(V.doc,_.replica,_.counterpartId);if(isErr(Q)){const Z=X.getAttachmentInfo(V.doc);_.transferManager.registerExpectedTransfer(_.replica.share,Z.hash),_.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:Z.hash,doc:V.doc,shareAddress:_.replica.share})}}await _.replica.ingest(X,V.doc,_.counterpartId),_.wantTracker.receivedWantedThumbnail(V.thumbnail),await _.onDocReceived();break}case"NEW_ATTACHMENT":{if(_.transferManager.isAlreadyQueued(V.hash,"download"))break;const G=M[V.format],Y=(await _.replica.getAllDocsAtPath(V.path,[G])).find(Z=>V.author===Z.author);if(!Y)break;if(await _.replica.getAttachment(Y,M[Y.format])===void 0){const Z=await _.transferManager.handleDownload(Y,_.replica,_.counterpartId);if(isErr(Z)){const ee=G.getAttachmentInfo(Y);_.transferManager.registerExpectedTransfer(_.replica.share,ee.hash),_.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:ee.hash,doc:Y,shareAddress:_.replica.share})}}break}case"FULFILLED":this.isPartnerFulfilled.resolve(!0);break;case"WANT_ATTACHMENT":_.transferManager.handleUpload(V,_.replica);break;case"ABORT":await _.cancel()}})(),_.reconciliationIsDone.then(async()=>{_.syncAppetite==="once"&&(j(),_.wantTracker.seal(),await _.wantTracker.isDone(),_.outboundEventQueue.push({kind:"FULFILLED"}),this.isFulfilled.resolve())})}get isDone(){return Promise.all([this.isPartnerFulfilled,this.isFulfilled])}}class SyncAgentReconciler{constructor(_){Object.defineProperty(this,"communicationRoundsCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isDone",{enumerable:!0,configurable:!0,writable:!0,value:deferred()});const{tree:M,lookup:$,treeIsReady:j}=_.syncerManager.getDocThumbnailTreeAndDocLookup(_.replica.share,getFormatsWithFallback(_.formats));_.initiateMessaging&&j.then(()=>{for(const V of z.initialMessages())_.outboundEventQueue.push({kind:"RANGE_MSG",message:V})});const z=new EarthstarRangeMessenger(M,_.payloadThreshold,_.rangeDivision);z.onInsertion(V=>{const[G,X]=V.split(" "),Y=$[X];Y&&Y[0]>=parseInt(G)||(_.wantTracker.addWantedThumbnail(V),_.outboundEventQueue.push({kind:"WANT",thumbnail:V}),_.onDocRequested())}),(async()=>{await j;for await(const V of _.inboundEventQueue){if(this.isDone.state==="fulfilled")return;V.type==="TERMINAL"&&this.communicationRoundsCount++;const G=z.respond(V);for(const X of G)_.outboundEventQueue.push({kind:"RANGE_MSG",message:X})}})(),z.isDone().then(()=>{this.isDone.resolve(this.communicationRoundsCount)})}}class ExistingDocAttachmentChecker{constructor(_){const M=_.replica.getQueryStream({orderBy:"localIndex ASC"},"existing",_.formats),$=getFormatLookup(_.formats),j=_.transferManager.handleDownload.bind(_.transferManager);M.pipeTo(new WritableStream({start(z){_.replica.onEvent(V=>{V.kind==="willClose"&&z.error()})},async write(z){if(z.kind==="existing"||z.kind==="success"){const V=$[z.doc.format],G=await _.replica.getAttachment(z.doc,V);if(isErr(G))return;if(G===void 0){const X=await j(z.doc,_.replica,_.counterpartId);if(isErr(X)){const Y=V.getAttachmentInfo(z.doc);_.transferManager.registerExpectedTransfer(_.replica.share,Y.hash),_.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:Y.hash,doc:z.doc,shareAddress:_.replica.share})}}}}})).then(()=>{_.hasCheckedAllExistingDocsForAttachments.resolve()}).catch(()=>{_.hasCheckedAllExistingDocsForAttachments.resolve()})}}class WantTracker{constructor(){Object.defineProperty(this,"isSealed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"wantedThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"enroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller}),Object.defineProperty(this,"received",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:randomId()})}addWantedThumbnail(_){if(!this.isSealed&&!this.wantedThumbnails.has(_)){const M=deferred();this.wantedThumbnails.set(_,M),this.enroller.enrol(M)}}receivedWantedThumbnail(_){const M=this.wantedThumbnails.get(_);M&&(M.resolve(),this.received++)}isRequested(_){return this.wantedThumbnails.has(_)}isReceived(_){const M=this.wantedThumbnails.get(_);return M?M.state==="fulfilled":!1}seal(){this.enroller.seal()}isDone(){return this.enroller.isDone()}get requestedCount(){return this.wantedThumbnails.size}get receivedCount(){return this.received}}class BumpingTimeout{constructor(_,M){Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.cb=_,this.ms=M,this.timeout=setTimeout_1(_,M)}bump(){this.closed||(clearTimeout(this.timeout),this.timeout=setTimeout_1(this.cb,this.ms))}close(){this.closed=!0,clearTimeout(this.timeout)}}const TIMEOUT_MS=1e4;class AttachmentTransfer{constructor({stream:_,replica:M,doc:$,format:j,requester:z,counterpartId:V}){Object.defineProperty(this,"kind",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:"ready"}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"expectedSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sourceDoc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"transferOp",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"abortCb",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new MultiDeferred}),Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"requester",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sourceDoc=$,this.share=M.share,this.requester=z;const G=j.getAttachmentInfo($);if(isErr(G))throw new ValidationError("AttachmentTransfer was given a doc which has no attachment!");this.hash=G.hash,this.expectedSize=G.size;const X=this.updateLoaded.bind(this);if(_ instanceof ReadableStream$1){this.kind="download";let Y;this.abortCb=()=>{Y?Y.cancel():_.cancel()};const Q=()=>this.loaded,Z=()=>new ReadableStream$1({async start(ee){const te=_.getReader();Y=te;const ne=new BumpingTimeout(()=>{ee.error("Attachment download timed out.")},TIMEOUT_MS);for(;;){const{done:re,value:ie}=await te.read();if(ne.bump(),re||(X(ie.byteLength),ee.enqueue(ie),Q()>=G.size))break}ne.close(),ee.close()}});this.transferOp.resolve(()=>{const ee=deferred();return M.ingestAttachment(j,$,Z(),V).then(te=>{if(isErr(te)&&this.loaded===0){this.changeStatus("missing_attachment");return}if(isErr(te)){console.warn(`Couldn't ingest the attachment for ${$.path} by ${$.author}: ${te.message}`),ee.reject(te);return}ee.resolve()}).catch(te=>{console.log(te),ee.reject(te)}),ee})}else this.kind="upload",this.abortCb=()=>{_.abort().catch(()=>{})},M.getAttachment($,j).then(async Y=>{if(!Y){await this.changeStatus("missing_attachment"),await _.abort();return}if(isErr(Y)){await this.changeStatus("failed"),await _.abort();return}const Q=new TransformStream({transform(Z,ee){X(Z.byteLength),ee.enqueue(Z)}});this.transferOp.resolve(()=>Y.stream().then(Z=>Z.pipeThrough(Q).pipeTo(_)).catch(Z=>{console.log(Z)}))})}async start(){if(this.status!=="ready")return;const _=await this.transferOp;await this.changeStatus("in_progress"),_().then(async()=>{await this.changeStatus("complete")}).catch(async()=>{await this.changeStatus("failed")})}updateLoaded(_){this.loaded+=_,this.statusBus.send({status:this.status,bytesLoaded:this.loaded,totalBytes:this.expectedSize})}async changeStatus(_){this.status==="complete"||this.status==="failed"||this.status==="missing_attachment"||(this.status=_,await this.statusBus.send({status:_,bytesLoaded:this.loaded,totalBytes:this.expectedSize}),_==="complete"&&this.multiDeferred.resolve(),_==="failed"&&this.multiDeferred.reject("Attachment transfer failed"),_==="missing_attachment"&&this.multiDeferred.reject("The other peer does not have this attachment"))}get doc(){return this.sourceDoc}onProgress(_){return this.statusBus.on(_)}abort(){this.abortCb()}isDone(){return this.multiDeferred.getPromise()}}class TransferQueue{constructor(_){Object.defineProperty(this,"waiting",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"failed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"activeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transfersRequestedByUsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller(!0)}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"reports",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"reportBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),this.activeLimit=_}async activate(_){this.active.add(_),_.isDone().then(()=>{this.completed.add(_)}).catch(()=>{this.failed.add(_)}).finally(()=>{this.active.delete(_),this.admitNext()}),await _.start()}queue(_){this.waiting.push(_)}admitNext(){if(this.waiting.length===0||this.active.size>=this.activeLimit)return;const _=this.waiting.shift();_&&this.activate(_)}async addTransfer(_){if(this.closed){_.abort();return}_.onProgress(()=>{this.updateTransferStatus(_)}),_.requester==="us"&&this.transfersRequestedByUsEnroller.enrol(_.isDone()),this.active.size<this.activeLimit?await this.activate(_):this.queue(_)}gotAllTransfersRequestedByUs(){this.transfersRequestedByUsEnroller.seal()}cancel(){this.closed=!0,this.transfersRequestedByUsEnroller.seal();for(const _ of this.active)_.abort()}updateTransferStatus(_){this.reports[_.share]||(this.reports[_.share]={}),this.reports[_.share][_.hash+_.kind]={author:_.doc.author,path:_.doc.path,format:_.doc.format,hash:_.hash,kind:_.kind,status:_.status,bytesLoaded:_.loaded,totalBytes:_.expectedSize},this.reportBus.send(this.getReport())}getReport(){const _={};for(const M in this.reports){const $=[],j=this.reports[M];for(const z in j){const V=j[z];$.push(V)}_[M]=$}return _}hasQueuedTransfer(_,M){for(const $ of this.waiting)if($.hash===_&&$.kind===M)return!0;for(const $ of this.active)if($.hash===_&&$.kind===M)return!0;for(const $ of this.completed)if($.hash===_&&$.kind===M)return!0;return!1}onReportUpdate(_){return this.reportBus.on(_)}transfersRequestedByUsFinished(){return this.transfersRequestedByUsEnroller.isDone()}}class TransferManager{constructor(_){Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"otherSyncerId",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"receivedAllExpectedTransfersEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller}),Object.defineProperty(this,"madeAllAttachmentRequestsEnroller",{enumerable:!0,configurable:!0,writable:!0,value:new PromiseEnroller(!0)}),Object.defineProperty(this,"formatsLookup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reportDidUpdateBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"expectedTransferPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.partner=_.partner,this.queue=new TransferQueue(this.partner.concurrentTransfers),this.formats=_.formats,this.formatsLookup=getFormatLookup(this.formats),this.queue.onReportUpdate(async M=>{await this.reportDidUpdateBus.send(M)}),this.madeAllAttachmentRequestsEnroller.isDone().then(()=>{this.receivedAllExpectedTransfersEnroller.seal()}),this.receivedAllExpectedTransfersEnroller.isDone().then(()=>{this.queue.gotAllTransfersRequestedByUs()})}registerSyncAgent(_){this.madeAllAttachmentRequestsEnroller.enrol(_.isDone())}allSyncAgentsKnown(){this.madeAllAttachmentRequestsEnroller.seal()}registerExpectedTransfer(_,M){const $=`${_}_${M}`;if(this.expectedTransferPromises.has($))return;const j=deferred();this.expectedTransferPromises.set($,j),this.receivedAllExpectedTransfersEnroller.enrol(j)}async queueTransfer(_){this.queue.hasQueuedTransfer(_.hash,_.kind)||await this.queue.addTransfer(_)}async handleDownload(_,M,$){const j=this.formatsLookup[_.format],z=j.getAttachmentInfo(_);if(isErr(z))throw new EarthstarError("TransferManager: attempted to download doc with no attachment.");if(this.queue.hasQueuedTransfer(z.hash,"download"))return"queued";const V=await this.partner.getDownload({doc:_,shareAddress:M.share,syncerId:await this.otherSyncerId,attachmentHash:z.hash});if(V===void 0)return"no_attachment";if(isErr(V))return V;const G=new AttachmentTransfer({replica:M,doc:_,format:j,stream:V,requester:"us",counterpartId:$});return await this.queueTransfer(G),"queued"}async handleUpload(_,M){if(this.queue.hasQueuedTransfer(_.attachmentHash,"upload"))return!1;const $=this.formatsLookup[_.doc.format];if(!await M.getAttachment(_.doc,$))return!1;const z=await this.partner.handleUploadRequest({shareAddress:_.shareAddress,syncerId:await this.otherSyncerId,doc:_.doc,attachmentHash:_.attachmentHash});if(isErr(z))return!1;try{const V=new AttachmentTransfer({doc:_.doc,format:$,replica:M,stream:z,requester:"them",counterpartId:"unused"});await this.queueTransfer(V)}catch{return!1}return!0}async handleTransferRequest({replica:_,path:M,author:$,source:j,kind:z,formatName:V,counterpartId:G}){const X=await this.partner.handleTransferRequest(j,z);if(X===void 0||isErr(X))return;const Y=getFormatLookup(this.formats)[V];if(!Y)return;const Z=(await _.getAllDocsAtPath(M,[Y])).find(te=>te.author===$);if(!Z)return;const ee=new AttachmentTransfer({doc:Z,format:Y,replica:_,stream:X,requester:z==="upload"?"us":"them",counterpartId:G});if(ee.requester==="us"){const te=`${ee.share}_${ee.hash}`,ne=this.expectedTransferPromises.get(te);ne&&ne.resolve()}await this.queueTransfer(ee)}cancel(){this.queue.cancel()}getReport(){return this.queue.getReport()}onReportUpdate(_){return this.reportDidUpdateBus.on(_)}transfersRequestedByUsFinished(){return this.queue.transfersRequestedByUsFinished()}registerOtherSyncerId(_){this.otherSyncerId.resolve(_)}isAlreadyQueued(_,M){return this.queue.hasQueuedTransfer(_,M)}}class Syncer{constructor(_){Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:randomId()}),Object.defineProperty(this,"manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"syncAgents",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncAgentQueues",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"appetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"statusBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"formats",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transferManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerIsFulfilled",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"isDoneMultiDeferred",{enumerable:!0,configurable:!0,writable:!0,value:new MultiDeferred}),Object.defineProperty(this,"heartbeatInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bumpingTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.manager=_.manager,this.peer=_.manager.peer,this.appetite=_.partner.syncAppetite,this.formats=getFormatsWithFallback(_.formats),this.partner=_.partner,this.transferManager=new TransferManager({partner:this.partner,formats:this.formats}),this.transferManager.onReportUpdate(async()=>{await this.statusBus.send(this.getStatus())}),this.heartbeatInterval=setInterval_1(()=>{this.partner.sendEvent({kind:"HEARTBEAT"})},1e3),(async()=>{try{for await(const $ of _.partner.getEvents())this.handleIncomingEvent($)}catch($){this.cancel($||"Partner disconnected")}})();const M=randomId();Promise.all(this.peer.shares().map($=>saltAndHashShare(M,$))).then($=>{this.partner.sendEvent({kind:"DISCLOSE",salt:M,syncerId:this.id,shares:$,formats:this.formats?this.formats.map(j=>j.id):[DEFAULT_FORMAT.id],canRespond:!1})}),this.transferManager.transfersRequestedByUsFinished().then(async()=>{_.partner.syncAppetite!=="continuous"&&(await this.partner.sendEvent({kind:"SYNCER_FULFILLED"}),await this.partnerIsFulfilled,clearInterval(this.heartbeatInterval),await this.partner.closeConnection(),this.bumpingTimeout.close(),this.isDoneMultiDeferred.resolve())}),this.peer.onReplicasChange(async $=>{if(this.appetite==="once")return;const j=Array.from($.keys());for(const[V,G]of this.syncAgents)j.includes(V)===!1&&(await G.cancel("Replica was removed from peer."),this.syncAgents.delete(V));const z=randomId();Promise.all(j.map(V=>saltAndHashShare(z,V))).then(V=>{this.partner.sendEvent({kind:"DISCLOSE",salt:z,syncerId:this.id,shares:V,formats:this.formats?this.formats.map(G=>G.id):[DEFAULT_FORMAT.id],canRespond:!0})})}),this.bumpingTimeout=new BumpingTimeout(()=>{this.cancel("No communication from the other peer in the last three seconds.")},TIMEOUT_MS)}addShare(_,M,$){if(this.syncAgents.has(_))return;const j=this.peer.getReplica(_);if(!j){console.error("Couldn't get the replica for a share we had in common.");return}const z=new SyncAgent({replica:j,formats:M,syncerManager:this.manager,transferManager:this.transferManager,initiateMessaging:$,payloadThreshold:this.partner.payloadThreshold,rangeDivision:this.partner.rangeDivision,syncAppetite:this.appetite});z.onStatusUpdate(()=>{this.statusBus.send(this.getStatus())}),this.syncAgents.set(_,z),this.transferManager.registerSyncAgent(z);const V=this.syncAgentQueues.get(_);let G;if(V)G=V;else{const X=new AsyncQueue;G=X,this.syncAgentQueues.set(_,X)}(async()=>{for await(const X of G)z.sendEvent(X)})(),(async()=>{for await(const X of z.events())await this.partner.sendEvent({to:_,...X})})()}async handleIncomingEvent(_){if(this.bumpingTimeout.bump(),this.isDoneMultiDeferred.state==="pending")switch(_.kind){case"DISCLOSE":{const M=getFormatIntersection(_.formats,this.formats);if(M.length===0)break;const $=new Set(_.shares),j=new Set,z=new Set;for(const G of this.peer.shares()){const X=await saltAndHashShare(_.salt,G);$.has(X)?j.add(G):z.add(G)}const V=this.id>_.syncerId;for(const G of j)this.addShare(G,M,V);for(const G of z){const X=this.syncAgents.get(G);X&&(X.cancel("No longer in common with the other peer."),this.syncAgents.delete(G))}if(this.transferManager.registerOtherSyncerId(_.syncerId),this.appetite==="once"&&this.transferManager.allSyncAgentsKnown(),_.canRespond){const G=randomId();Promise.all(this.peer.shares().map(X=>saltAndHashShare(G,X))).then(X=>{this.partner.sendEvent({kind:"DISCLOSE",salt:G,syncerId:this.id,shares:X,formats:this.formats?this.formats.map(Y=>Y.id):[DEFAULT_FORMAT.id],canRespond:!1})})}j.size===0&&this.appetite==="once"&&this.partner.sendEvent({kind:"SYNCER_FULFILLED"});break}case"SYNCER_FULFILLED":{this.partnerIsFulfilled.resolve();break}case"HEARTBEAT":break;default:{const{to:M}=_,$=this.syncAgentQueues.get(M);if(!$){const j=new AsyncQueue;j.push(_),this.syncAgentQueues.set(M,j);break}$.push(_)}}}getStatus(){const _={};for(const[M,$]of this.syncAgents)_[M]={docs:$.getStatus(),attachments:this.transferManager.getReport()[M]||[]};return _}onStatusChange(_){return this.statusBus.on(_)}async cancel(_){this.bumpingTimeout.close(),this.isDoneMultiDeferred.reject(_);for(const[M,$]of this.syncAgents)await $.cancel();clearInterval(this.heartbeatInterval),this.transferManager.cancel(),await this.partner.closeConnection()}handleTransferRequest({shareAddress:_,path:M,author:$,source:j,kind:z,formatName:V}){if(this.isDoneMultiDeferred.state!=="pending")return;const G=this.peer.getReplica(_);if(!G)return;let X="unused";if(z==="upload"){const Y=this.syncAgents.get(_);Y&&(X=Y.counterpartId)}return this.transferManager.handleTransferRequest({replica:G,author:$,formatName:V,kind:z,path:M,source:j,counterpartId:X})}isDone(){return this.isDoneMultiDeferred.getPromise()}}function saltAndHashShare(q,_){return Crypto.sha256base32(q+_+q)}class PartnerLocal{constructor(_,M,$,j){Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:1024}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outgoingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"partnerPeer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partnerSyncer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.syncAppetite=$,this.partnerPeer=_;const{incomingQueue:z,outgoingQueue:V}=this;this.partnerSyncer=new Syncer({manager:_.syncerManager,formats:j,partner:{syncAppetite:$,getEvents(){return z},sendEvent(G){return V.push(G),Promise.resolve()},concurrentTransfers:1024,payloadThreshold:32,rangeDivision:32,async getDownload(G){const X=M.getReplica(G.shareAddress);if(!X)throw new ValidationError("Tried to get a receiving transfer for an unknown share.");const Y=await X.replicaDriver.attachmentDriver.getAttachment(G.doc.format,G.attachmentHash);if(Y&&!isErr(Y))return await Y.stream()},closeConnection(){return V.close(),Promise.resolve()},handleUploadRequest(G){return Promise.resolve(new NotSupportedError("PartnerLocal does not support uploads."))},handleTransferRequest(G,X){return Promise.resolve(new NotSupportedError("PartnerLocal does not support transfer requests."))}}})}getEvents(){return this.outgoingQueue}sendEvent(_){return this.incomingQueue.push(_),Promise.resolve()}closeConnection(){return this.incomingQueue.close(),Promise.resolve()}async getDownload(_){const M=this.partnerPeer.getReplica(_.shareAddress);if(!M)throw new ValidationError("Tried to get a receiving transfer for an unknown share.");const $=await M.replicaDriver.attachmentDriver.getAttachment(_.doc.format,_.attachmentHash);if($&&!isErr($))return await $.stream()}handleUploadRequest(_){return Promise.resolve(new NotSupportedError("PartnerLocal does not support uploads."))}handleTransferRequest(_,M){return Promise.resolve(new NotSupportedError("PartnerLocal does not support transfer requests."))}}class PartnerWebServer{constructor(_){Object.defineProperty(this,"syncAppetite",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"concurrentTransfers",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(this,"payloadThreshold",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"rangeDivision",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(this,"isSecure",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wsUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socket",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"incomingQueue",{enumerable:!0,configurable:!0,writable:!0,value:new AsyncQueue}),Object.defineProperty(this,"socketIsReady",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),this.syncAppetite=_.appetite;const M=new URL(_.url),$=`${M.host}${M.pathname==="/"?"":M.pathname}`;this.isSecure=M.protocol==="https:"||M.protocol==="wss:",this.wsUrl=`${this.isSecure?"wss://":"ws://"}${$}/'`;const j=new URL(_.appetite,this.wsUrl);this.socket=new WebSocket$1(j.toString()),this.socket.onopen=()=>{this.socketIsReady.resolve()},this.socket.binaryType="arraybuffer",this.socket.onmessage=z=>{this.incomingQueue.push(JSON.parse(z.data))},this.socket.onclose=()=>{this.incomingQueue.close()},this.socket.onerror=z=>{if("error"in z){this.incomingQueue.close({withError:z.error});return}this.incomingQueue.close({withError:new EarthstarError("Websocket error.")})}}async sendEvent(_){if(await this.socketIsReady,!(this.socket.readyState===this.socket.CLOSED||this.socket.readyState===this.socket.CLOSING))return this.socket.send(JSON.stringify(_))}getEvents(){return this.incomingQueue}closeConnection(){return this.socket.close(),Promise.resolve()}getDownload(_){const M=new URL(`${_.syncerId}/download/${_.shareAddress}/${_.doc.format}/${_.doc.author}${_.doc.path}`,this.wsUrl),$=websocketReadable(M.toString(),j=>j.data instanceof ArrayBuffer?new Uint8Array(j.data):null);return Promise.resolve($)}handleUploadRequest(_){const M=new URL(`${_.syncerId}/upload/${_.shareAddress}/${_.doc.format}/${_.doc.author}${_.doc.path}`,this.wsUrl),$=websocketWritable(M.toString(),j=>j);return Promise.resolve($)}handleTransferRequest(_,M){return Promise.resolve(new NotSupportedError("SyncDriverWebClient does not support external transfer requests."))}}function compareThumbnails(q,_){const[M,$]=q.split(" "),[j,z]=_.split(" "),V=parseInt(M),G=parseInt(j);return V>G?1:V<G?-1:$>z?1:$<z?-1:0}const docThumbnailMonoid={lift:q=>hash(q),combine:(q,_)=>q+_,neutral:BigInt(0)};class DocThumbnailTree extends FingerprintTree{constructor(){super(docThumbnailMonoid,compareThumbnails)}}class PlumTree{constructor(){Object.defineProperty(this,"messagingModes",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"eagerMessageThumbnails",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"haveTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}getMode(_){const M=this.messagingModes.get(_);if(M)return M;const $=this.messagingModes.size===0?"EAGER":"LAZY";return this.messagingModes.set(_,$),"EAGER"}onEagerMessage(_,M){const $=this.haveTimeouts.get(M.thumbnail);return $?(clearTimeout($),!1):this.eagerMessageThumbnails.has(M.thumbnail)?(this.messagingModes.set(_,"LAZY"),!0):(this.eagerMessageThumbnails.add(M.thumbnail),!1)}onLazyMessage(_,M){if(!this.haveTimeouts.has(_.thumbnail)){const $=setTimeout_1(()=>{M(_.thumbnail)},5);this.haveTimeouts.set(_.thumbnail,$)}}onGraftMessage(_){this.messagingModes.set(_,"EAGER")}onPrune(_){this.messagingModes.set(_,"LAZY")}}class SyncerManager{constructor(_){Object.defineProperty(this,"syncers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"syncerEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"peer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docThumbnailTreeAndLookup",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"hasher",{enumerable:!0,configurable:!0,writable:!0,value:new XXH64}),Object.defineProperty(this,"plumTrees",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.peer=_}addPartner(_,M,$){const j=new Syncer({manager:this,partner:_,formats:$});return this.syncers.set(j.id,{syncer:j,description:M}),this.syncerEventBus.send(this.syncers),j}getSyncers(){return this.syncers}getDocThumbnailTreeAndDocLookup(_,M){const $=M.map(ee=>ee.id),j=`${_} ${$}`,z=this.docThumbnailTreeAndLookup.get(j);if(z){const[ee,te]=z;return{tree:ee,lookup:te,treeIsReady:Promise.resolve(!0)}}const V=this.peer.getReplica(_);if(!V)throw new EarthstarError("A DocThumbnailTree was requested for a share the peer doesn't know about, big problem!");const G=this.hasher,X=V.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"everything",M),Y=new DocThumbnailTree,Q={},Z=deferred();return X.pipeTo(new WritableStream({write(ee){if(ee.kind==="processed_all_existing"){Z.resolve();return}G.reset(),G.update(`${ee.doc.path} ${ee.doc.author}`);const te=G.digest().toString(16),ne=`${ee.doc.timestamp} ${te}`;(ee.kind==="existing"||ee.kind==="success")&&(Q[te]=[ee.doc.timestamp,ee.doc.path,ee.doc.author],Y.insert(ne)),ee.kind==="expire"&&(delete Q[te],Y.remove(ne))}})),{tree:Y,lookup:Q,treeIsReady:Z}}getPlumTree(_){const M=this.plumTrees.get(_);if(M)return M;const $=new PlumTree;return this.plumTrees.set(_,$),$}onSyncersChange(_){return this.syncerEventBus.on(_)}}const logger$5=new Logger("peer","orangeRed"),J$1=JSON.stringify;class Peer{constructor(){Object.defineProperty(this,"replicaEventBus",{enumerable:!0,configurable:!0,writable:!0,value:new BlockingBus}),Object.defineProperty(this,"syncerManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),logger$5.debug("constructor"),this.syncerManager=new SyncerManager(this)}hasShare(_){return this.replicaMap.has(_)}shares(){const _=[...this.replicaMap.keys()];return _.sort(),_}replicas(){const _=[...this.replicaMap.keys()];return _.sort(),_.map(M=>this.replicaMap.get(M))}size(){return this.replicaMap.size}getReplica(_){return this.replicaMap.get(_)}async addReplica(_){if(logger$5.debug(`addReplica(${J$1(_.share)})`),this.replicaMap.has(_.share))throw logger$5.debug("already had a replica with that share"),new Error(`Peer.addReplica: already has a replica with share ${J$1(_.share)}.  Don't add another one.`);this.replicaMap.set(_.share,_),await this.replicaEventBus.send(this.replicaMap),logger$5.debug("    ...addReplica: done")}async removeReplicaByShare(_){logger$5.debug(`removeReplicaByShare(${J$1(_)})`),this.replicaMap.delete(_),await this.replicaEventBus.send(this.replicaMap)}async removeReplica(_){const M=this.replicaMap.get(_.share);_===M?(logger$5.debug(`removeReplica(${J$1(_.share)})`),await this.removeReplicaByShare(_.share)):logger$5.debug(`removeReplica(${J$1(_.share)}) -- same share but it's a different instance now; ignoring`)}sync(_,M=!1,$){try{const j=new PartnerWebServer({url:_,appetite:M?"continuous":"once"});return this.syncerManager.addPartner(j,_,$)}catch{if(_ instanceof Peer){const j=new PartnerLocal(_,this,M?"continuous":"once",$);return this.syncerManager.addPartner(j,"Local",$)}console.error("Provided an invalid target for syncing to a peer:",_);return}}addSyncPartner(_,M,$){return this.syncerManager.addPartner(_,M,$)}getSyncers(){return this.syncerManager.getSyncers()}onReplicasChange(_){return this.replicaEventBus.on(_)}onSyncersChange(_){return this.syncerManager.onSyncersChange(_)}discover(_){const M=this;return{async*[Symbol.asyncIterator](){for await(const $ of _.events){if($.kind==="SERVICE_STOPPED")break;if($.kind==="PEER_EXITED"){yield $;continue}if($.kind==="PEER_INITIATED_SYNC"){const j=await $.begin(M);yield{kind:"PEER_INITIATED_SYNC",description:$.description,syncer:j};continue}yield{kind:"PEER_DISCOVERED",description:$.description,sync:async j=>await $.begin(M,j!=null&&j.syncContinuously?"continuous":"once")}}}}}}const DEFAULT_QUERY={historyMode:"latest",orderBy:"path ASC",startAfter:void 0,limit:void 0,filter:void 0,formats:["es.5"]},logger$4=new Logger("query","green");function cleanUpQuery(q){var j,z,V,G;const _={...DEFAULT_QUERY,...q},M={query:{limit:0},isValid:!1,willMatch:"nothing"};if(_.limit!==void 0&&_.limit<0)return logger$4.debug("cleanUpQuery: unreasonable limit - returning empty invalid query",M),M;if((j=_.orderBy)!=null&&j.startsWith("path")&&((z=_.startAfter)==null?void 0:z.localIndex)!==void 0)return logger$4.debug('cleanUpQuery: orderBy is "path" but startAfter is not compatible - returning empty invalid query',M),M;if((V=_.orderBy)!=null&&V.startsWith("localIndex")&&((G=_.startAfter)==null?void 0:G.path)!==void 0)return logger$4.debug('cleanUpQuery: orderBy is "localIndex" but startAfter is not compatible - returning empty invalid query',M),M;if(_.historyMode!==void 0&&_.historyMode!=="all"&&_.historyMode!=="latest")return logger$4.debug(`cleanUpQuery: unknown historyMode ${JSON.stringify(_.historyMode)} - returning empty invalid query`,M),M;if(_.orderBy!==void 0&&["path ASC","path DESC","localIndex ASC","localIndex DESC"].indexOf(_.orderBy)===-1)return logger$4.debug(`cleanUpQuery: unrecognized orderBy value ${JSON.stringify(_.orderBy)} - returning empty invalid query`,M),M;let $=_.historyMode==="all"?"all":"all-latest";if(_.filter!==void 0&&!shallowEqualObjects(_.filter,{})&&($="some"),_.startAfter!==void 0&&!shallowEqualObjects(_.startAfter,{})&&($="some"),_.limit!==void 0&&(_.limit>0&&($="some"),_.limit===0&&($="nothing")),_.filter!==void 0){const X=_.filter;X.path&&X.pathStartsWith&&!X.path.startsWith(X.pathStartsWith)&&($="nothing"),X.path&&X.pathEndsWith&&!X.path.endsWith(X.pathEndsWith)&&($="nothing"),X.timestamp&&X.timestampGt&&!(X.timestamp>X.timestampGt)&&($="nothing"),X.timestamp&&X.timestampLt&&!(X.timestamp<X.timestampLt)&&($="nothing"),X.timestampGt&&X.timestampLt&&!(X.timestampLt+1<X.timestampGt)&&($="nothing")}if($==="nothing"){let X={query:{limit:0},isValid:!0,willMatch:"nothing"};return logger$4.debug("cleanUpQuery - this query will match nothing, so returning a simpler query that also matches nothing",X),X}return logger$4.debug(`cleanUpQuery - query is ok!  willMatch = ${$}`),{query:_,isValid:!0,willMatch:$}}function docMatchesFilter(q,_){return!(_.path!==void 0&&q.path!==_.path||_.pathStartsWith!==void 0&&!q.path.startsWith(_.pathStartsWith)||_.pathEndsWith!==void 0&&!q.path.endsWith(_.pathEndsWith)||_.author!==void 0&&q.author!==_.author||_.timestamp!==void 0&&q.timestamp!==_.timestamp||_.timestampGt!==void 0&&!(q.timestamp>_.timestampGt)||_.timestampLt!==void 0&&!(q.timestamp<_.timestampLt))}new Logger("query helpers","gold");var Cmp;(function(q){q[q.LT=-1]="LT",q[q.EQ=0]="EQ",q[q.GT=1]="GT"})(Cmp||(Cmp={}));function compareBasic(q,_,M="ASC"){if(Array.isArray(q)&&shallowEqualArrays(q,_)||typeof q=="object"&&shallowEqualObjects(q,_)||q===_)return Cmp.EQ;if(M==="ASC"||M===void 0)return q<_?Cmp.LT:Cmp.GT;if(M==="DESC")return q>_?Cmp.LT:Cmp.GT;throw new Error("unexpected sort order to compareBasic: "+JSON.stringify(M))}function compareArrays(q,_,M){let $=Math.min(q.length,_.length);for(let V=0;V<$;V++){let G=(M==null?void 0:M[V])??"ASC",X=compareBasic(q[V],_[V],G);if(X!==Cmp.EQ)return X}if(q.length===_.length)return Cmp.EQ;let j=Math.min(q.length,_.length),z=(M==null?void 0:M[j])??"ASC";return compareBasic(q.length,_.length,z)}function compareByObjKey(q,_="ASC"){return(M,$)=>compareBasic(M[q],$[q],_)}const J=JSON.stringify,logger$3=new Logger("replica","gold"),loggerSet=new Logger("replica set","gold"),loggerIngest=new Logger("replica ingest","gold");function docCompareNewestFirst(q,_){return compareArrays([q.timestamp,q.signature],[_.timestamp,q.signature],["DESC","ASC"])}class MultiformatReplica{constructor({driver:_,config:M}){var j;Object.defineProperty(this,"replicaId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicaDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formatsConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isClosed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ingestLockStream",{enumerable:!0,configurable:!0,writable:!0,value:new LockStream}),Object.defineProperty(this,"eventMultiStream",{enumerable:!0,configurable:!0,writable:!0,value:new ChannelMultiStream("kind",!0)}),Object.defineProperty(this,"eventWriter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbackSink",{enumerable:!0,configurable:!0,writable:!0,value:new CallbackSink}),Object.defineProperty(this,"eraseInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"expireEventTimeouts",{enumerable:!0,configurable:!0,writable:!0,value:new Map});const $=checkShareIsValid(_.docDriver.share);if(isErr($))throw $;logger$3.debug(`constructor.  driver = ${(j=_==null?void 0:_.constructor)==null?void 0:j.name}`),this.replicaId="replica-"+randomId(),this.share=_.docDriver.share,this.replicaDriver=_,this.formatsConfig=M||{},this.eventWriter=this.eventMultiStream.getWritableStream().getWriter(),this.eventMultiStream.getReadableStream("*").pipeTo(new WritableStream(this.callbackSink)),this.eraseInterval=setInterval_1(()=>{this.isClosed()?clearInterval(this.eraseInterval):this.pruneExpiredDocsAndAttachments()},1e3*60*60)}isClosed(){return this._isClosed}async close(_){if(logger$3.debug("closing..."),this._isClosed)throw new ReplicaIsClosedError;await this.ingestLockStream.close();for(const M of this.expireEventTimeouts.values())clearTimeout(M);return logger$3.debug("    sending willClose blockingly..."),await this.eventWriter.write({kind:"willClose"}),logger$3.debug("    marking self as closed..."),_===!1&&await this.pruneExpiredDocsAndAttachments(),await this.replicaDriver.attachmentDriver.clearStaging(),this._isClosed=!0,logger$3.debug(`    closing ReplicaDriver (erase = ${_})...`),await this.replicaDriver.docDriver.close(_),await this.replicaDriver.attachmentDriver.close(_),clearInterval(this.eraseInterval),logger$3.debug("    sending didClose nonblockingly..."),await this.eventWriter.write({kind:"didClose"}),logger$3.debug("...closing done"),Promise.resolve()}async getConfig(_){if(this._isClosed)throw new ReplicaIsClosedError;return await this.replicaDriver.docDriver.getConfig(_)}async setConfig(_,M){if(this._isClosed)throw new ReplicaIsClosedError;return await this.replicaDriver.docDriver.setConfig(_,M)}async listConfigKeys(){if(this._isClosed)throw new ReplicaIsClosedError;return await this.replicaDriver.docDriver.listConfigKeys()}async deleteConfig(_){if(this._isClosed)throw new ReplicaIsClosedError;return await this.replicaDriver.docDriver.deleteConfig(_)}getMaxLocalIndex(){if(this._isClosed)throw new ReplicaIsClosedError;return this.replicaDriver.docDriver.getMaxLocalIndex()}getAllDocs(_){return logger$3.debug("getAllDocs()"),this.queryDocs({historyMode:"all",orderBy:"path ASC"},_)}getLatestDocs(_){return logger$3.debug("getLatestDocs()"),this.queryDocs({historyMode:"latest",orderBy:"path ASC"},_)}getAllDocsAtPath(_,M){return logger$3.debug(`getAllDocsAtPath("${_}")`),this.queryDocs({historyMode:"all",orderBy:"path ASC",filter:{path:_}},M)}async getLatestDocAtPath(_,M){logger$3.debug(`getLatestDocsAtPath("${_}")`);const $=await this.queryDocs({historyMode:"latest",orderBy:"path ASC",filter:{path:_}},M?[M]:void 0);if($.length!==0)return $[0]}async queryDocs(_={},M){if(logger$3.debug("queryDocs",_),this._isClosed)throw new ReplicaIsClosedError;const $=getFormatsWithFallback(M);return await this.replicaDriver.docDriver.queryDocs({..._,formats:$.map(j=>j.id)})}async queryPaths(_={},M){const $=await this.queryDocs(_,M),j=new Set($.map(({path:z})=>z));return Array.from(j).sort()}async queryAuthors(_={},M){const $=await this.queryDocs(_,M),j=new Set($.map(({author:z})=>z));return Array.from(j).sort()}async set(_,M,$=DEFAULT_FORMAT){if(loggerSet.debug("set",M),this._isClosed)throw new ReplicaIsClosedError;loggerSet.debug("...deciding timestamp: getting latest doc at the same path (from any author)");const j=await this.getLatestDocAtPath(M.path);let z;typeof M.timestamp=="number"?z=M.timestamp:j===void 0?z=microsecondNow():z=Math.max(microsecondNow(),j.timestamp+1),loggerSet.debug("...generating doc");let V;if(j){const Y=$.removeExtraFields(j);isErr(Y)||(V=Y.doc)}const G=await $.generateDocument({keypair:_,input:{...M,format:$.id},share:this.share,timestamp:z,prevLatestDoc:V,config:this.formatsConfig[$.id]});if(isErr(G))return{kind:"failure",reason:"invalid_document",err:G};if(loggerSet.debug("...signature =",G.doc.signature),G.attachment){const Y=await this.replicaDriver.attachmentDriver.stage($.id,G.attachment);if(isErr(Y))return{kind:"failure",reason:"invalid_document",err:Y};const Q=await $.updateAttachmentFields(_,G.doc,Y.size,Y.hash,this.formatsConfig[$.id]);if(isErr(Q))return await Y.reject(),{kind:"failure",reason:"invalid_document",err:Q};loggerSet.debug("...ingesting attachment"),loggerSet.debug("-----------------------"),await Y.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:Q,hash:Y.hash,size:Y.size,sourceId:"local"}),loggerSet.debug("...done ingesting attachment"),loggerSet.debug("...ingesting"),loggerSet.debug("-----------------------");const Z=await this.ingest($,Q,"local");return loggerSet.debug("...done ingesting"),loggerSet.debug("...set is done."),Z}loggerSet.debug("...ingesting"),loggerSet.debug("-----------------------");const X=await this.ingest($,G.doc,"local");return loggerSet.debug("...done ingesting"),loggerSet.debug("...set is done."),X}async ingest(_,M,$){if(loggerIngest.debug("ingest",M),this._isClosed)throw new ReplicaIsClosedError;loggerIngest.debug("...removing extra fields");const j=_.removeExtraFields(M);if(isErr(j))return{kind:"failure",reason:"invalid_document",err:j};M=j.doc;const z=j.extras;Object.keys(z).length>0&&loggerIngest.debug(`...extra fields found: ${J(z)}`);const V=await _.checkDocumentIsValid(M);if(isErr(V))return{kind:"failure",reason:"invalid_document",err:V};const G=deferred();return await this.ingestLockStream.run(async()=>{loggerIngest.debug(" >> ingest: start of protected region"),loggerIngest.debug("  > getting other history docs at the same path by any author");const X=await this.getAllDocsAtPath(M.path,[_]);loggerIngest.debug(`  > ...got ${X.length}`),loggerIngest.debug("  > getting prevLatest and prevSameAuthor");const Y=X[0]??null,Q=X.filter(re=>re.author===M.author)[0]??null;loggerIngest.debug("  > checking if new doc is latest at this path"),X.push(M),X.sort(docCompareNewestFirst);const Z=X[0]===M;if(loggerIngest.debug(`  > ...isLatest: ${Z}`),!Z&&Q!==null){loggerIngest.debug("  > new doc is not latest and there is another one from the same author...");const re=docCompareNewestFirst(M,Q);if(re===Cmp.GT){loggerIngest.debug("  > new doc is GT prevSameAuthor, so it is obsolete"),G.resolve({kind:"nothing_happened",reason:"obsolete_from_same_author",doc:M});return}if(re===Cmp.EQ){loggerIngest.debug("  > new doc is EQ prevSameAuthor, so it is redundant (already_had_it)"),G.resolve({kind:"nothing_happened",reason:"already_had_it",doc:M});return}}loggerIngest.debug("  > upserting into ReplicaDriver...");const ee=await this.replicaDriver.docDriver.upsert(M);loggerIngest.debug("  > ...done upserting into ReplicaDriver"),loggerIngest.debug("  > ...getting ReplicaDriver maxLocalIndex...");const te=await this.replicaDriver.docDriver.getMaxLocalIndex();loggerIngest.debug(" >> ingest: end of protected region, returning a WriteEvent from the lock");const ne={kind:"success",maxLocalIndex:te,doc:ee,docIsLatest:Z,prevDocFromSameAuthor:Q,prevLatestDoc:Y,sourceId:$};if(G.resolve(ne),await this.eventWriter.write(ne),ee.deleteAfter){const re=`${ee.path}|${ee.author}`,ie=this.expireEventTimeouts.get(re);ie&&clearTimeout(ie);const se=ee.deleteAfter/1e3-Date.now();this.expireEventTimeouts.set(re,setTimeout_1(()=>{this.eventWriter.write({kind:"expire",doc:ee})},se))}}),G}async overwriteAllDocsByAuthor(_,M){const $=getFormatWithFallback(M);if(logger$3.debug(`overwriteAllDocsByAuthor("${_.address}")`),this._isClosed)throw new ReplicaIsClosedError;const j=await this.queryDocs({filter:{author:_.address},historyMode:"all"},[$]);logger$3.debug(`    ...found ${j.length} docs to overwrite`);let z=0,V=0;for(const G of j){const X=await this.wipeDocument(_,G,getFormatWithFallback(M));if(isErr(X))return X;z+=1}return logger$3.debug(`    ...done; ${z} overwritten to be empty; ${V} were already empty; out of total ${j.length} docs`),z}async wipeDocAtPath(_,M,$=DEFAULT_FORMAT){const j=await this.getLatestDocAtPath(M,$);return j?this.wipeDocument(_,j,$):new ValidationError("No document exists at that path")}async wipeDocument(_,M,$){const j={...M,timestamp:Math.max(M.timestamp+1,Date.now()*1e3),author:_.address},z=await $.wipeDocument(_,j,this.formatsConfig[$.id]);if(isErr(z))return{kind:"failure",err:z,reason:"invalid_document"};const V=await this.ingest($,z,"local");if(V.kind==="success"){const G=$.getAttachmentInfo(M);if(!isErr(G)){const X=await this.replicaDriver.attachmentDriver.erase($.id,G.hash);isErr(X)||await this.eventWriter.write({kind:"attachment_prune",format:$.id,hash:G.hash})}}return V}async pruneExpiredDocsAndAttachments(_=DEFAULT_FORMATS){const M=await this.replicaDriver.docDriver.eraseExpiredDocs();for(const V of M)await this.eventWriter.write({kind:"expire",doc:V});const $=getFormatLookup(_),j={};await this.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"existing",_).pipeTo(new WritableStream({write(V){if(V.kind==="existing"){const G=$[V.doc.format],X=G.getAttachmentInfo(V.doc);if(!isErr(X)){const Y=j[G.id];Y?Y.add(X.hash):j[G.id]=new Set([X.hash])}}}}));const z=await this.replicaDriver.attachmentDriver.filter(j);for(const V of z)await this.eventWriter.write({kind:"attachment_prune",format:V.format,hash:V.hash})}getEventStream(_="*"){return this.eventMultiStream.getReadableStream(_)}getQueryStream(_={},M,$){const j=this.queryDocs.bind(this),z=this.getEventStream.bind(this);return new ReadableStream$1({async start(V){if(M==="existing"||M==="everything"){const Y=await j(_,$);for(const Q of Y)V.enqueue({kind:"existing",doc:Q})}if(V.enqueue({kind:"processed_all_existing"}),M==="existing"){V.close();return}const X=z().getReader();for(;;){const{done:Y,value:Q}=await X.read();if(Y)return;if(Q.kind==="expire"||Q.kind==="success"){if(_.filter&&docMatchesFilter(Q.doc,_.filter)){V.enqueue(Q);continue}V.enqueue(Q);continue}Q.kind==="didClose"&&V.close()}}})}onEvent(_){return this.callbackSink.onWrite(_)}async ingestAttachment(_,M,$,j){if(this._isClosed)throw new ReplicaIsClosedError;const z=_.removeExtraFields(M);if(isErr(z))return Promise.resolve(z);M=z.doc;const V=await _.checkDocumentIsValid(M);if(isErr(V))return Promise.resolve(V);const G=await this.getAttachment(M,_);if(G&&!isErr(G))return!1;const X=_.getAttachmentInfo(M);if(isErr(X))return Promise.resolve(X);const Y=await this.replicaDriver.attachmentDriver.stage(M.format,$);return isErr(Y)?Y:Y.hash!==X.hash?(await Y.reject(),new ValidationError("Attachment's hash did not match the document's")):Y.size!==X.size?(await Y.reject(),new ValidationError("Attachment's size did not match the document's")):(await Y.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:M,hash:Y.hash,size:Y.size,sourceId:j}),!0)}getAttachment(_,M=DEFAULT_FORMAT){if(_.deleteAfter&&_.deleteAfter<Date.now()*1e3)return Promise.resolve(new ValidationError("This document has expired"));const $=M.getAttachmentInfo(_);return isErr($)?Promise.resolve($):this.replicaDriver.attachmentDriver.getAttachment(_.format,$.hash)}addAttachments(_,M){const $=getFormatsWithFallback(M),j={};for(const V of $)j[V.id]=V;const z=_.map(V=>new Promise(G=>{const Y=j[V.format].getAttachmentInfo(V);if(!isErr(Y))this.replicaDriver.attachmentDriver.getAttachment(V.format,Y.hash).then(Q=>{G({...V,attachment:Q})});else return G({...V,attachment:Y})}));return Promise.all(z)}}class Replica extends MultiformatReplica{constructor(_){super({driver:_.driver,config:{"es.5":{shareSecret:_.shareSecret}}})}}const logger$2=new Logger("replica-cache","green");function justLocalIndex({_localIndex:q}){return q}function sortAndLimit(q,_){const M=[];for(const $ of _)if(!(q.orderBy==="path ASC"&&q.startAfter!==void 0&&q.startAfter.path!==void 0&&$.path<=q.startAfter.path)&&!(q.orderBy==="path DESC"&&q.startAfter!==void 0&&q.startAfter.path!==void 0&&$.path>=q.startAfter.path)&&!(q.orderBy==="localIndex ASC"&&q.startAfter!==void 0&&q.startAfter.localIndex!==void 0&&($._localIndex||0)<=q.startAfter.localIndex)&&!(q.orderBy==="localIndex DESC"&&q.startAfter!==void 0&&q.startAfter.localIndex!==void 0&&($._localIndex||0)>=q.startAfter.localIndex)&&(M.push($),q.limit!==void 0&&M.length>=q.limit))break;return M}class ReplicaCache{constructor(_,M,$){Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"replica",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"timeToLive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onCacheUpdatedCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"onFireCacheUpdatedsWrapper",{enumerable:!0,configurable:!0,writable:!0,value:G=>G()}),Object.defineProperty(this,"attachmentCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.replica=_,this.timeToLive=M||1e3,$&&(this.onFireCacheUpdatedsWrapper=$);const j=this.onReplicaEvent.bind(this),z=this.close.bind(this),V=this.isClosed.bind(this);this.replica.getEventStream("*").pipeTo(new WritableStream({async write(G){G.kind==="attachment_ingest"||G.kind==="success"||G.kind==="expire"?await j(G):G.kind==="willClose"&&!V()&&await z()}})).catch(()=>{})}async close(){if(this.closed)throw new ReplicaCacheIsClosedError;this.closed=!0,await Promise.all(Array.from(this.docCache.values()).map(_=>_.close())),this.docCache.clear(),this.onCacheUpdatedCallbacks.clear()}isClosed(){return this.closed}getAllDocs(_){return this.queryDocs({historyMode:"all",orderBy:"path DESC"},_)}getLatestDocs(_){return this.queryDocs({historyMode:"latest",orderBy:"path DESC"},_)}getAllDocsAtPath(_,M){return this.queryDocs({historyMode:"all",orderBy:"path DESC",filter:{path:_}},M)}getLatestDocAtPath(_,M){const $=this.queryDocs({historyMode:"latest",orderBy:"path DESC",filter:{path:_}},M?[M]:void 0);if($.length!==0)return $[0]}queryDocs(_={},M){if(this.closed)throw new ReplicaCacheIsClosedError;if(this.replica.isClosed())throw new ReplicaIsClosedError;const j={..._,formats:(M||DEFAULT_FORMATS).map(ne=>ne.id)},z=cleanUpQuery(j);if(z.willMatch==="nothing")return[];const V=stringify$1(z.query),G=this.docCache.get(V);if(G)return Date.now()>G.expires&&this.replica.queryDocs(_,M).then(ne=>{const re=ne.map(justLocalIndex).sort(),ie=G.docs.map(justLocalIndex).sort();shallowEqualArrays(re,ie)||(this.docCache.set(V,{stream:G.stream,close:G.close,docs:ne,expires:Date.now()+this.timeToLive}),logger$2.debug("Updated cache because result expired."),this.fireOnCacheUpdateds())}),G.docs;const X=this.replica.getQueryStream(_,"new",M),Y=new CallbackSink,Q=Y.onWrite(ne=>{(ne.kind==="existing"||ne.kind==="success")&&(logger$2.debug({doc:ne.doc.path,queryString:V}),this._updateCache(V,ne.doc))}),Z=new WritableStream(Y),ee=new AbortController;X.pipeTo(Z,{signal:ee.signal});const te=()=>{Q()};return this.docCache.set(V,{stream:X,docs:[],expires:Date.now()+this.timeToLive,close:te}),this.replica.queryDocs(j).then(ne=>{this.docCache.set(V,{stream:X,close:te,docs:ne,expires:Date.now()+this.timeToLive}),logger$2.debug("Updated cache with a new entry."),this.fireOnCacheUpdateds()}),[]}queryPaths(_={},M){const $=this.queryDocs(_,M),j=new Set($.map(({path:z})=>z));return Array.from(j).sort()}queryAuthors(_={},M){const $=this.queryDocs(_,M),j=new Set($.map(({author:z})=>z));return Array.from(j).sort()}_updateCache(_,M){const $=this.docCache.get(_);if(!$)return;const j=JSON.parse(_),z=()=>{const te=[...$.docs,M];this.docCache.set(_,{...$,docs:sortAndLimit(j,te)}),this.fireOnCacheUpdateds()},V=({exact:te})=>{const ne=$.docs.map(re=>te&&re.path===M.path&&re.author===M.author||!te&&re.path===M.path?M:re);this.docCache.set(_,{...$,docs:sortAndLimit(j,ne)}),this.fireOnCacheUpdateds()},G=$.docs.filter(te=>te.path===M.path),X=$.docs.filter(te=>te.path===M.path&&te.author===M.author);if(G.length===0){(j.filter&&docMatchesFilter(M,j.filter)||!j.filter)&&(logger$2.debug("Updated cache after appending a doc to a entry with matching filter."),z());return}if((j.historyMode||"latest")==="all"){if(X.length===0){logger$2.debug("Updated cache after appending a version of a doc to a historyMode: all query."),z();return}logger$2.debug("Updated cache after replacing a version of a doc in a historyMode: all query."),V({exact:!0});return}const Q=G[0],Z=M.author!==(Q==null?void 0:Q.author)||!shallowEqualObjects(M,Q),ee=M.timestamp>Q.timestamp;if(Z&&ee){logger$2.debug("Updated cache after replacing a doc with its latest version."),V({exact:!1});return}}fireOnCacheUpdateds(){this.version++,this.onFireCacheUpdatedsWrapper(()=>{this.onCacheUpdatedCallbacks.forEach(_=>{_()})})}onCacheUpdated(_){if(this.closed)throw new ReplicaCacheIsClosedError;if(this.replica.isClosed())throw new ReplicaIsClosedError;return this.onCacheUpdatedCallbacks.add(_),()=>{this.onCacheUpdatedCallbacks.delete(_)}}set(_,M,$){if(this.closed)throw new ReplicaCacheIsClosedError;return this.replica.set(_,M,$)}overwriteAllDocsByAuthor(_,M){if(this.closed)throw new ReplicaCacheIsClosedError;if(this.replica.isClosed())throw new ReplicaIsClosedError;return this.replica.overwriteAllDocsByAuthor(_,M)}wipeDocAtPath(_,M,$=DEFAULT_FORMAT){if(this.closed)throw new ReplicaCacheIsClosedError;return this.replica.wipeDocAtPath(_,M,$)}async onReplicaEvent(_){const M=`${_.doc.path}|${_.doc.author}`,$=this.attachmentCache.get(M);if(!$)return;const j=await this.replica.getAttachment(_.doc,$.format);this.attachmentCache.set(M,{expires:Date.now()+this.timeToLive,attachment:j,format:$.format}),this.fireOnCacheUpdateds()}getAttachment(_,M=DEFAULT_FORMAT){if(this.closed)throw new ReplicaCacheIsClosedError;if(this.replica.isClosed())throw new ReplicaIsClosedError;const $=M.getAttachmentInfo(_);if(isErr($))return $;const j=`${_.path}|${_.author}`,z=this.attachmentCache.get(j);if(z)return Date.now()>z.expires&&this.replica.getAttachment(_,M).then(V=>{this.attachmentCache.set(j,{expires:Date.now()+this.timeToLive,attachment:V,format:M}),this.fireOnCacheUpdateds()}),_.deleteAfter&&Date.now()*1e3>_.deleteAfter?new ValidationError("This document has expired"):z.attachment;this.attachmentCache.set(j,{attachment:void 0,expires:Date.now()+this.timeToLive,format:M}),this.replica.getAttachment(_,M).then(V=>{this.attachmentCache.set(j,{expires:Date.now()+this.timeToLive,attachment:V,format:M}),this.fireOnCacheUpdateds()})}addAttachments(_,M){const $=[],j=getFormatLookup(M);for(const z of _){const V=this.getAttachment(z,j[z.format]);$.push({...z,attachment:V})}return $}}new Logger("storage driver async memory","yellow");async function streamToBytes(q){let _=new Uint8Array;return await q.pipeTo(new WritableStream({write(M){const $=new Uint8Array(_.length+M.length);$.set(_),$.set(M,_.length),_=$}})),_}async function createInvitationURL(q,_,M){const $=parseShareAddress(q);if(isErr($))return new ValidationError("Invalid share address.");for(const G of _)try{new URL(G)}catch{return new ValidationError(`Could not parse ${G} as a URL.`)}const j=_.map(G=>`&server=${G}`).join("&");let z="";if(M){const G=await Crypto.checkKeypairIsValid({shareAddress:q,secret:M});if(isErr(G))return new ValidationError(`Supplied the wrong secret for ${q}`);z=`&secret=${M}`}return`earthstar://${q}/?invite${j}${z}&v=2`}async function parseInvitationURL(q){try{const _=new URL(q),M=_.hostname.length>0?_.hostname:_.pathname.replaceAll("/",""),$=parseShareAddress(M);if(isErr($))return new ValidationError("Invitation did not include a valid share address.");const j=new URLSearchParams(_.search),z=j.get("invite"),V=j.get("v");if(z===null)return new ValidationError("Not an invitation URL");if(V===null)return new ValidationError("Invitation version not specified.");if(V!=="2")return new ValidationError(`Invitation version is ${V}, expected version 2.`);const G=j.getAll("server");for(const Y of G)try{new URL(Y)}catch{return new ValidationError(`Invitation's servers included a malformed URL: ${Y}`)}const X=j.get("secret");if(X){const Y=await Crypto.checkKeypairIsValid({shareAddress:M,secret:X});if(isErr(Y))return new ValidationError(`Invitation contains the wrong secret for share ${M}.`)}return{shareAddress:M,secret:X||void 0,servers:G}}catch{return new ValidationError("Could not parse the invitation URL.")}}const EARTHSTAR_KEY="earthstar",AUTHOR_KEY="current_author",SHARES_KEY="shares",SHARE_SECRETS_KEY="share_secrets",SERVERS_KEY="servers";class SharedSettings{constructor(_){Object.defineProperty(this,"namespace",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:localStorage}),Object.defineProperty(this,"authorChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"sharesChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"shareSecretsChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"serversChangedCbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),this.namespace=_==null?void 0:_.namespace,_!=null&&_.sessionOnly&&(this.storage=sessionStorage),addEventListener("storage",M=>{switch(M.key){case makeStorageKey(AUTHOR_KEY,this.namespace):{this.fireAuthorEvent();break}case makeStorageKey(SHARES_KEY,this.namespace):{this.fireSharesEvent();break}case makeStorageKey(SHARE_SECRETS_KEY,this.namespace):{this.fireSecretsEvent();break}case makeStorageKey(SERVERS_KEY,this.namespace):{this.fireServersEvent();break}}})}get author(){const _=makeStorageKey(AUTHOR_KEY,this.namespace);return getParsedValue(this.storage,_,isParsedAuthorKeypair)||null}set author(_){const M=makeStorageKey(AUTHOR_KEY,this.namespace);this.storage.setItem(M,JSON.stringify(_)),this.fireAuthorEvent()}get shares(){const _=makeStorageKey(SHARES_KEY,this.namespace);return getParsedValue(this.storage,_,isParsedSharesArray)||[]}addShare(_){if(isErr(checkShareIsValid(_)))return new ValidationError("Not a valid share");const M=makeStorageKey(SHARES_KEY,this.namespace),$=new Set([...this.shares,_]),j=Array.from($);return this.storage.setItem(M,JSON.stringify(j)),this.fireSharesEvent(),j}removeShare(_){const M=this.shares,$=M.findIndex(z=>z===_);if($===-1)return new ValidationError("That share is not known yet");M.splice($,1);const j=makeStorageKey(SHARES_KEY,this.namespace);return this.storage.setItem(j,JSON.stringify(M)),this.fireSharesEvent(),M}get shareSecrets(){const _=makeStorageKey(SHARE_SECRETS_KEY,this.namespace);return getParsedValue(this.storage,_,isParsedSecretsDict)||{}}async addSecret(_,M){if(!this.shares.find(V=>_===V))return new ValidationError("This share is not yet known.");if(isErr(await Crypto.checkKeypairIsValid({shareAddress:_,secret:M})))return new ValidationError("Not the right secret for this share.");const j=makeStorageKey(SHARE_SECRETS_KEY,this.namespace),z={...this.shareSecrets,[_]:M};return this.storage.setItem(j,JSON.stringify(z)),this.fireSecretsEvent(),z}removeSecret(_){const M=this.shareSecrets;if(!M[_])return new ValidationError("Unknown share");const j=makeStorageKey(SHARE_SECRETS_KEY,this.namespace),z={...M};return delete z[_],this.storage.setItem(j,JSON.stringify(z)),this.fireSecretsEvent(),z}get servers(){const _=makeStorageKey(SERVERS_KEY,this.namespace);return getParsedValue(this.storage,_,isParsedUrlArray)||[]}addServer(_){try{const M=new URL(_),$=new Set([...this.servers,M.toString()]),j=Array.from($),z=makeStorageKey(SERVERS_KEY,this.namespace);return this.storage.setItem(z,JSON.stringify(j)),this.fireServersEvent(),j}catch{return new ValidationError("Not a valid URL.")}}removeServer(_){try{const M=new URL(_),$=this.servers,j=$.findIndex(V=>V===M.toString());if(j===-1)return new ValidationError("That server is not known yet");$.splice(j,1);const z=makeStorageKey(SERVERS_KEY,this.namespace);return this.storage.setItem(z,JSON.stringify($)),this.fireServersEvent(),$}catch{return new ValidationError("Not a valid URL")}}clear(){const _=makeStorageKey(AUTHOR_KEY,this.namespace);this.storage.setItem(_,JSON.stringify(null));const M=makeStorageKey(SHARES_KEY,this.namespace);this.storage.setItem(M,JSON.stringify([]));const $=makeStorageKey(SHARE_SECRETS_KEY,this.namespace);this.storage.setItem($,JSON.stringify({}));const j=makeStorageKey(SERVERS_KEY,this.namespace);this.storage.setItem(j,JSON.stringify([])),this.fireAuthorEvent(),this.fireSharesEvent(),this.fireSecretsEvent(),this.fireServersEvent()}onAuthorChanged(_){return this.authorChangedCbs.add(_),()=>{this.authorChangedCbs.delete(_)}}onSharesChanged(_){return this.sharesChangedCbs.add(_),()=>{this.sharesChangedCbs.delete(_)}}onShareSecretsChanged(_){return this.shareSecretsChangedCbs.add(_),()=>{this.shareSecretsChangedCbs.delete(_)}}onServersChanged(_){return this.serversChangedCbs.add(_),()=>{this.serversChangedCbs.delete(_)}}getPeer({sync:_,onCreateReplica:M}){const $=new Peer,j=this.shares;for(const Y of j){const Q=M(Y,this.shareSecrets[Y]);$.addReplica(Q)}const z=this.onSharesChanged(async Y=>{const Q=$.replicas(),Z=$.shares();for(const ee of Q)Y.includes(ee.share)||($.removeReplica(ee),await ee.close(!1));for(const ee of Y)if(!Z.includes(ee)){const te=M(ee,this.shareSecrets[ee]);$.addReplica(te)}}),V=this.onShareSecretsChanged(async Y=>{const Q=$.shares(),Z=Object.keys(Y);for(const ee of Q)if(!Z.includes(ee)){const te=$.getReplica(ee);te&&($.removeReplica(te),te.close(!1));const ne=M(ee);$.addReplica(ne)}for(const ee of Z){const te=$.getReplica(ee);if(te!=null&&te.formatsConfig["es.5"]&&te.formatsConfig["es.5"].shareSecret)continue;await(te==null?void 0:te.close(!1)),$.removeReplicaByShare(ee);const ne=M(ee,Y[ee]);$.addReplica(ne)}});if(_)for(const Y of this.servers)$.sync(Y,_==="continuous");const G=this.onServersChanged(Y=>{if(_){const Q=$.getSyncers();for(const[Z,{description:ee,syncer:te}]of Q)Y.includes(ee)||te.cancel();for(const Z of Y)$.sync(Z,_==="continuous")}});return{peer:$,unsubscribeFromSettings:()=>{z(),V(),G()}}}fireAuthorEvent(){const _=this.author;for(const M of this.authorChangedCbs)M(_)}fireSharesEvent(){const _=this.shares;for(const M of this.sharesChangedCbs)M(_)}fireSecretsEvent(){const _=this.shareSecrets;for(const M of this.shareSecretsChangedCbs)M(_)}fireServersEvent(){const _=this.servers;for(const M of this.serversChangedCbs)M(_)}async redeemInvitationURL(_){const M=await parseInvitationURL(_);if(isErr(M))return M;this.addShare(M.shareAddress);for(const $ of M.servers)this.addServer($);return M.secret&&this.addSecret(M.shareAddress,M.secret),!0}}function makeStorageKey(q,_){return`${EARTHSTAR_KEY}:${_?`${_}:`:""}${q}`}function getParsedValue(q,_,M){const $=q.getItem(_);if($!==null)try{const j=JSON.parse($);return M(j)?j:void 0}catch{return}}function isObject(q){return!(q==null||typeof q!="object")}function isParsedAuthorKeypair(q){return!(!isObject(q)||Object.keys(q).length!==2||!("address"in q)||!("secret"in q))}function isParsedSharesArray(q){return!(!Array.isArray(q)||q.some(_=>typeof _!="string")||q.some(_=>isErr(checkShareIsValid(_))))}function isParsedSecretsDict(q){if(!isObject(q))return!1;for(const _ in q){const M=q[_];if(typeof M!="string"||isErr(Crypto.checkKeypairIsValid({shareAddress:_,secret:M})))return!1}return!0}function isParsedUrlArray(q){if(!Array.isArray(q)||q.some(_=>typeof _!="string"))return!1;for(const _ of q)try{new URL(_)}catch{return!1}return!0}function cubicOut(q){const _=q-1;return _*_*_+1}function fly(q,{delay:_=0,duration:M=400,easing:$=cubicOut,x:j=0,y:z=0,opacity:V=0}={}){const G=getComputedStyle(q),X=+G.opacity,Y=G.transform==="none"?"":G.transform,Q=X*(1-V),[Z,ee]=split_css_unit(j),[te,ne]=split_css_unit(z);return{delay:_,duration:M,easing:$,css:(re,ie)=>`
			transform: ${Y} translate(${(1-re)*Z}${ee}, ${(1-re)*te}${ne});
			opacity: ${X-Q*ie}`}}function slide(q,{delay:_=0,duration:M=400,easing:$=cubicOut,axis:j="y"}={}){const z=getComputedStyle(q),V=+z.opacity,G=j==="y"?"height":"width",X=parseFloat(z[G]),Y=j==="y"?["top","bottom"]:["left","right"],Q=Y.map(se=>`${se[0].toUpperCase()}${se.slice(1)}`),Z=parseFloat(z[`padding${Q[0]}`]),ee=parseFloat(z[`padding${Q[1]}`]),te=parseFloat(z[`margin${Q[0]}`]),ne=parseFloat(z[`margin${Q[1]}`]),re=parseFloat(z[`border${Q[0]}Width`]),ie=parseFloat(z[`border${Q[1]}Width`]);return{delay:_,duration:M,easing:$,css:se=>`overflow: hidden;opacity: ${Math.min(se*20,1)*V};${G}: ${se*X}px;padding-${Y[0]}: ${se*Z}px;padding-${Y[1]}: ${se*ee}px;margin-${Y[0]}: ${se*te}px;margin-${Y[1]}: ${se*ne}px;border-${Y[0]}-width: ${se*re}px;border-${Y[1]}-width: ${se*ie}px;`}}function scale(q,{delay:_=0,duration:M=400,easing:$=cubicOut,start:j=0,opacity:z=0}={}){const V=getComputedStyle(q),G=+V.opacity,X=V.transform==="none"?"":V.transform,Y=1-j,Q=G*(1-z);return{delay:_,duration:M,easing:$,css:(Z,ee)=>`
			transform: ${X} scale(${1-Y*ee});
			opacity: ${G-Q*ee}
		`}}const subscriber_queue=[];function readable(q,_){return{subscribe:writable(q,_).subscribe}}function writable(q,_=noop){let M;const $=new Set;function j(G){if(safe_not_equal(q,G)&&(q=G,M)){const X=!subscriber_queue.length;for(const Y of $)Y[1](),subscriber_queue.push(Y,q);if(X){for(let Y=0;Y<subscriber_queue.length;Y+=2)subscriber_queue[Y][0](subscriber_queue[Y+1]);subscriber_queue.length=0}}}function z(G){j(G(q))}function V(G,X=noop){const Y=[G,X];return $.add(Y),$.size===1&&(M=_(j)||noop),G(q),()=>{$.delete(Y),$.size===0&&M&&(M(),M=null)}}return{set:j,update:z,subscribe:V}}function derived(q,_,M){const $=!Array.isArray(q),j=$?[q]:q,z=_.length<2;return readable(M,V=>{let G=!1;const X=[];let Y=0,Q=noop;const Z=()=>{if(Y)return;Q();const te=_($?X[0]:X,V);z?V(te):Q=is_function(te)?te:noop},ee=j.map((te,ne)=>subscribe(te,re=>{X[ne]=re,Y&=~(1<<ne),G&&Z()},()=>{Y|=1<<ne}));return G=!0,Z(),function(){run_all(ee),Q(),G=!1}})}const authorKeypair=writable({address:"",secret:""});new Logger("storage driver localStorage","gold");const logger$1=new Logger("replica driver indexeddb","gold");function docComparePathASCthenNewestFirst(q,_){return compareArrays([q.path,q.timestamp,q.signature],[_.path,_.timestamp,q.signature],["ASC","DESC","ASC"])}function docComparePathDESCthenNewestFirst(q,_){return compareArrays([q.path,q.timestamp,q.signature],[_.path,_.timestamp,q.signature],["DESC","DESC","ASC"])}const DOCS_STORE="docs",CONFIG_STORE="config";class DocDriverIndexedDB{constructor(_,M){Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"gotInitialMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"localMaxLocalIndex",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1});const $=checkShareIsValid(_);if(isErr($))throw $;if(this.share=_,logger$1.debug("constructor"),!window.indexedDB)throw new EarthstarError("IndexedDB is not supported by this runtime.");const j=dntGlobalThis.indexedDB.open(`earthstar:share_docs:${this.share}${M?`/${M}`:""}`,1);j.onerror=()=>{throw logger$1.error(`Could not open IndexedDB for ${this.share}'s attachments.`),logger$1.error(j.error),new EarthstarError(`Could not open IndexedDB for ${this.share}'s attachments.`)},j.onupgradeneeded=function(){const z=j.result,V=z.createObjectStore(DOCS_STORE,{keyPath:["path","author"]});V.createIndex("comboIndex",["_localIndex","timestamp","path","author"],{unique:!0}),V.createIndex("pathTimestampIndex",["path","timestamp"],{unique:!1}),V.createIndex("pathAuthorIndex",["path","author"],{unique:!0}),V.createIndex("deleteAfterIndex","deleteAfter",{unique:!1}),V.createIndex("localIndexIndex","_localIndex",{unique:!0}),z.createObjectStore(CONFIG_STORE,{keyPath:"key"}).createIndex("keyIndex",["key"],{unique:!0})},j.onsuccess=()=>{this.db.resolve(j.result);const V=j.result.transaction([DOCS_STORE],"readonly").objectStore(DOCS_STORE).index("localIndexIndex").openCursor(null,"prev");V.onsuccess=()=>{V.result?this.gotInitialMaxLocalIndex.resolve(V.result.value._localIndex):this.gotInitialMaxLocalIndex.resolve(-1)}},this.gotInitialMaxLocalIndex.then(z=>{this.localMaxLocalIndex=z})}isClosed(){return this.closed}async close(_){if(this.closed)throw new ReplicaIsClosedError;this.closed=!0;const M=deferred();if(_){const j=(await this.db).transaction([DOCS_STORE,CONFIG_STORE],"readwrite"),z=deferred(),V=deferred(),G=j.objectStore(DOCS_STORE).clear().onsuccess=()=>{z.resolve()},X=j.objectStore(CONFIG_STORE).clear().onsuccess=()=>{V.resolve()};await Promise.all([G,X]),M.resolve()}else M.resolve();return(await this.db).close(),await sleep(20),M}async getMaxLocalIndex(){return await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex}async queryDocs(_){var Q,Z,ee,te,ne,re,ie,se,le,he,ce,ae,de;const $=(await this.db).transaction([DOCS_STORE],"readonly").objectStore(DOCS_STORE),j=deferred(),{query:z,willMatch:V}=cleanUpQuery(_);if(logger$1.debug(`    cleanUpQuery.  willMatch = ${V}`),V==="nothing")return[];if((Q=z.filter)!=null&&Q.path&&z.historyMode==="latest"){const ge=IDBKeyRange.bound([z.filter.path,z.filter.timestampGt||0],[z.filter.path,z.filter.timestampLt||Number.MAX_SAFE_INTEGER]),oe=$.index("pathTimestampIndex").openCursor(ge,"prev");oe.onsuccess=()=>{var we;(we=oe.result)!=null&&we.value?j.resolve([oe.result.value]):j.resolve([])}}else if((Z=z.filter)!=null&&Z.path&&z.historyMode==="all"){const ge=$.index("pathAuthorIndex"),fe=IDBKeyRange.bound([z.filter.path," "],[z.filter.path,"~"]),oe=ge.getAll(fe);oe.onsuccess=()=>{oe.result?j.resolve(Array.from(oe.result)):j.resolve([])}}else{const ge=((ee=z.startAfter)==null?void 0:ee.path)||((te=z.filter)==null?void 0:te.path)||((ne=z.filter)==null?void 0:ne.pathStartsWith)||" ",fe=((re=z.filter)==null?void 0:re.author)||" ",oe=((ie=z.filter)==null?void 0:ie.timestamp)||((se=z.filter)==null?void 0:se.timestampGt)||0,we=((le=z.startAfter)==null?void 0:le.localIndex)||0,De=((he=z.filter)==null?void 0:he.path)||"~",ve=((ce=z.filter)==null?void 0:ce.author)||"~",Ce=((ae=z.filter)==null?void 0:ae.timestamp)||((de=z.filter)==null?void 0:de.timestampLt)||Number.MAX_SAFE_INTEGER,ue=Number.MAX_SAFE_INTEGER,Pe=IDBKeyRange.bound([we,oe,ge,fe],[ue,Ce,De,ve]),Le=$.index("comboIndex").getAll(Pe);Le.onsuccess=()=>{Le.result?j.resolve(Le.result):j.resolve([])}}const G=await j;if(z.historyMode==="latest"){const ge=G.splice(0,G.length),fe=new Map;for(const oe of ge){const we=fe.get(oe.path);(!we||we.timestamp<oe.timestamp)&&fe.set(oe.path,oe)}G.push(...fe.values())}const X=[];logger$1.debug("    filtering docs");const Y=Date.now()*1e3;for(const ge of G)ge.deleteAfter&&ge.deleteAfter<Y||z.filter&&!docMatchesFilter(ge,z.filter)||X.push(ge);if(logger$1.debug(`    ordering docs: ${z.orderBy}`),z.orderBy==="path ASC")X.sort(docComparePathASCthenNewestFirst);else if(z.orderBy==="path DESC")X.sort(docComparePathDESCthenNewestFirst);else if(z.orderBy==="localIndex ASC")X.sort(compareByObjKey("_localIndex","ASC"));else if(z.orderBy==="localIndex DESC")X.sort(compareByObjKey("_localIndex","DESC"));else if(z.orderBy)throw new ValidationError("unrecognized query orderBy: "+JSON.stringify(z.orderBy));return z.limit!==void 0&&G.length>=z.limit?X.slice(0,z.limit):(logger$1.debug(`    queryDocs is done: found ${X.length} docs.`),X)}async upsert(_){const M=await this.db,j=M.transaction([DOCS_STORE],"readwrite").objectStore(DOCS_STORE).index("pathAuthorIndex"),z=deferred(),V=j.openCursor([_.path,_.author]);if(await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex+=1,_._localIndex=this.localMaxLocalIndex,V.onsuccess=()=>{if(V.result){const Z=V.result.update(_);Z.onsuccess=()=>{z.resolve(!!Z.result)}}else z.resolve(!1)},await z)return _;const Y=M.transaction([DOCS_STORE],"readwrite").objectStore(DOCS_STORE).put(_),Q=deferred();return Y.onsuccess=()=>{Q.resolve()},Y.onerror=()=>{throw Y.error},await Q,_}async eraseExpiredDocs(){const _=[],j=(await this.db).transaction([DOCS_STORE],"readwrite").objectStore(DOCS_STORE).index("deleteAfterIndex"),z=Date.now()*1e3,V=IDBKeyRange.bound(0,z),G=j.openCursor(V),X=deferred();return G.onsuccess=()=>{var Y;if((Y=G.result)!=null&&Y.value){const Q=G.result.value;if(Q.deleteAfter!==null&&Q.deleteAfter!==void 0){_.push(Q);const Z=G.result.delete();Z.onsuccess=()=>{var ee;(ee=G.result)==null||ee.continue()}}}else X.resolve()},await X,_}async getConfig(_){const $=(await this.db).transaction([CONFIG_STORE],"readonly").objectStore(CONFIG_STORE),j=deferred(),z=$.get(_);return z.onsuccess=()=>{var V;j.resolve((V=z.result)==null?void 0:V.value)},j}async setConfig(_,M){const j=(await this.db).transaction([CONFIG_STORE],"readwrite").objectStore(CONFIG_STORE),z=deferred(),V=j.put({key:_,value:M});return V.onsuccess=()=>{z.resolve()},z}async listConfigKeys(){const M=(await this.db).transaction([CONFIG_STORE],"readonly").objectStore(CONFIG_STORE),$=deferred(),z=M.index("keyIndex").openKeyCursor(),V=[];return z.onsuccess=()=>{z.result?(V.push(z.result.primaryKey),z.result.continue()):$.resolve(V)},$}async deleteConfig(_){const $=(await this.db).transaction([CONFIG_STORE],"readwrite").objectStore(CONFIG_STORE),j=deferred(),z=$.index("keyIndex"),V=IDBKeyRange.bound([_],[_]),G=z.openCursor(V);return G.onsuccess=()=>{if(G.result){const X=G.result.delete();X.onsuccess=()=>{j.resolve(!0)}}else j.resolve(!1)},j}}const logger=new Logger("replica driver indexeddb","gold"),ATTACHMENT_STAGING_STORE="attachment_staging_index",ATTACHMENT_INDEX_STORE="attachments_index",ATTACHMENT_BYTES_STORE="attachments_bytes";class AttachmentDriverIndexedDB{constructor(_,M){if(Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:deferred()}),Object.defineProperty(this,"share",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.share=_,!window.indexedDB)throw new EarthstarError("IndexedDB is not supported by this runtime.");const $=dntGlobalThis.indexedDB.open(`earthstar:share_attachments:${this.share}${M?`/${M}`:""}`,1);$.onerror=()=>{throw logger.error(`Could not open IndexedDB for ${this.share}'s attachments.`),logger.error($.error),new EarthstarError(`Could not open IndexedDB for ${this.share}'s attachments.`)},$.onupgradeneeded=function(){const j=$.result;j.createObjectStore(ATTACHMENT_BYTES_STORE),j.createObjectStore(ATTACHMENT_INDEX_STORE,{keyPath:"id"}),j.createObjectStore(ATTACHMENT_STAGING_STORE,{keyPath:"id"})},$.onsuccess=()=>{this.db.resolve($.result)}}getIndexKey(_,M){return`${_}___${M}`}async getAttachment(_,M){if(this.closed)throw new ReplicaIsClosedError;const $=deferred(),j=this.getIndexKey(_,M),z=await this.db,G=z.transaction([ATTACHMENT_INDEX_STORE],"readonly").objectStore(ATTACHMENT_INDEX_STORE).get(j),X=deferred();return G.onerror=()=>{X.reject()},G.onsuccess=()=>{G.result===void 0?X.reject():X.resolve(G.result.blobKey)},X.then(Y=>{const Z=z.transaction([ATTACHMENT_BYTES_STORE],"readonly").objectStore(ATTACHMENT_BYTES_STORE).get(Y);Z.onsuccess=()=>{const ee=new Blob$1([Z.result]);$.resolve({bytes:async()=>new Uint8Array(await ee.arrayBuffer()),stream:()=>Promise.resolve(ee.stream())})},Z.onerror=()=>{$.resolve(void 0)}}).catch(()=>{$.resolve(void 0)}),$}async erase(_,M){if(this.closed)throw new ReplicaIsClosedError;const $=deferred(),j=this.getIndexKey(_,M),z=await this.db,G=z.transaction([ATTACHMENT_INDEX_STORE],"readonly").objectStore(ATTACHMENT_INDEX_STORE).get(j),X=deferred();return G.onerror=()=>{X.reject()},G.onsuccess=()=>{z.transaction([ATTACHMENT_INDEX_STORE],"readwrite").objectStore(ATTACHMENT_INDEX_STORE).delete(j),G.result===void 0?X.reject():X.resolve(G.result.blobKey)},X.then(Y=>{const Q=z.transaction([ATTACHMENT_BYTES_STORE],"readwrite").objectStore(ATTACHMENT_BYTES_STORE).delete(Y);Q.onsuccess=()=>{$.resolve(!0)},Q.onerror=()=>{$.resolve(void 0)}}).catch(()=>{$.resolve(new ValidationError("No attachment found"))}),$}async stage(_,M){if(this.closed)throw new ReplicaIsClosedError;const $=await this.db,j=M instanceof Uint8Array?M:await streamToBytes(M),z=await Crypto.sha256base32(j),V=this.getIndexKey(_,z),G=`${V}___${randomId()}`,X=$.transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_STAGING_STORE],"readwrite"),Y=X.objectStore(ATTACHMENT_BYTES_STORE).put(j,G),Q=X.objectStore(ATTACHMENT_STAGING_STORE).put({id:V,blobKey:G}),Z=deferred(),ee=deferred();return Y.onsuccess=()=>Z.resolve(),Q.onsuccess=()=>ee.resolve(),await Z,await ee,{hash:z,size:j.byteLength,reject:async()=>{const te=$.transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_STAGING_STORE],"readwrite"),ne=te.objectStore(ATTACHMENT_BYTES_STORE).delete(G),re=te.objectStore(ATTACHMENT_STAGING_STORE).delete(V),ie=deferred(),se=deferred();ne.onsuccess=()=>{ie.resolve()},re.onsuccess=()=>{se.resolve()},await Promise.all([ie,se])},commit:async()=>{const te=$.transaction([ATTACHMENT_INDEX_STORE,ATTACHMENT_STAGING_STORE],"readwrite"),ne=te.objectStore(ATTACHMENT_STAGING_STORE).delete(V),re=te.objectStore(ATTACHMENT_INDEX_STORE).put({id:V,blobKey:G}),ie=deferred(),se=deferred();ne.onsuccess=()=>ie.resolve(),re.onsuccess=()=>se.resolve(),await Promise.all([ie,se])}}}async wipe(){if(this.closed)throw new ReplicaIsClosedError;const M=(await this.db).transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_INDEX_STORE,ATTACHMENT_STAGING_STORE],"readwrite"),$=M.objectStore(ATTACHMENT_BYTES_STORE).clear(),j=M.objectStore(ATTACHMENT_INDEX_STORE).clear(),z=M.objectStore(ATTACHMENT_STAGING_STORE).clear(),V=deferred(),G=deferred(),X=deferred();$.onsuccess=()=>V.resolve(),j.onsuccess=()=>G.resolve(),z.onsuccess=()=>X.resolve(),await Promise.all([V,G,X])}async clearStaging(){if(this.closed)throw new ReplicaIsClosedError;const M=(await this.db).transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_STAGING_STORE]),$=M.objectStore(ATTACHMENT_STAGING_STORE).openCursor(),j=deferred();return $.onsuccess=()=>{const z=$.result;if(!z){j.resolve();return}const V=z.value.blobKey,G=M.objectStore(ATTACHMENT_BYTES_STORE).delete(V);z.delete(),G.onsuccess=()=>{z.continue()},G.onerror=()=>{z.continue()}},j}async filter(_){if(this.closed)throw new ReplicaIsClosedError;const $=(await this.db).transaction([ATTACHMENT_BYTES_STORE,ATTACHMENT_INDEX_STORE],"readwrite"),j=50,z=[],V=[],G=deferred(),X=(Y=null)=>{const Q=$.objectStore(ATTACHMENT_INDEX_STORE).getAll(Y,j);Q.onsuccess=()=>{const Z=Q.result;for(const ee of Z){const[te,ne]=ee.id.split("___");_[te]&&!_[te].has(ne)&&(z.push({format:te,hash:ne}),V.push(this.erase(te,ne)))}if(Z.length===j){const ee=Z[Z.length-1],te=IDBKeyRange.lowerBound(ee.id,!0);X(te)}else G.resolve()}};return X(),await G,await Promise.all(V),z}isClosed(){return this.closed}async close(_){if(this.closed)throw new ReplicaIsClosedError;_&&await this.wipe(),this.closed=!0,(await this.db).close(),await sleep(20)}}class ReplicaDriverWeb{constructor(_,M){Object.defineProperty(this,"docDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachmentDriver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.docDriver=new DocDriverIndexedDB(_,M),this.attachmentDriver=new AttachmentDriverIndexedDB(_,M)}}const initialKeypair={shareAddress:"+commons.buxxyxhoa3uxpanzrb6ki7btpzvkm5cf7brjptev3bmim3rk77hbq",secret:"bua7c7t567hf6d7tot25rjpzrzf3cl2ytb5zgt3ewqgbuitk3ibna"},shareKeypair=writable(initialKeypair),replicaDetails=writable(null);shareKeypair.subscribe(q=>{console.log("shareKeypair store changed:",q);const _=q.shareAddress,M=q.secret,$=new Replica({driver:new ReplicaDriverWeb(_),shareSecret:M});replicaDetails.set({replica:$})});const settings=new SharedSettings,shares=writable(settings.shares);settings.onSharesChanged(q=>{shares.set(q)});const secrets=writable(settings.shareSecrets);settings.onShareSecretsChanged(q=>{secrets.set(q)});const servers=writable(settings.servers);settings.onServersChanged(q=>{servers.set(q)});function removeShare(q){const _=settings.removeShare(q);Array.isArray(_)?shares.set(_):console.error(_)}function updateShares(q){shares.set(q)}const studioShares=derived(shares,q=>q.filter(_=>!_.includes("commons"))),commonsShares=derived(shares,q=>q.filter(_=>_.includes("commons"))),statusStore=writable(null),UploadId_svelte_svelte_type_style_lang="";function create_fragment$14(q){let _,M,$,j,z,V;return{c(){_=element("input"),M=space(),$=element("div"),j=element("button"),j.innerHTML=`Upload your current alias in .JSON

    <span class="tooltiptext svelte-llh4qb">It is a JSON file</span>`,set_style(_,"display","none"),attr(_,"type","file"),attr(_,"accept",".json, .txt"),attr(j,"class","tooltip phase1 my-2  svelte-llh4qb"),attr($,"class","flex w-auto lg:w-11/12 items-center align-center flex-col")},m(G,X){insert(G,_,X),q[3](_),insert(G,M,X),insert(G,$,X),append($,j),z||(V=[listen(_,"change",q[2]),listen(j,"click",q[4])],z=!0)},p:noop,i:noop,o:noop,d(G){G&&detach(_),q[3](null),G&&detach(M),G&&detach($),z=!1,run_all(V)}}}function readFileAsync$1(q){return new Promise((_,M)=>{let $=new FileReader;$.onload=()=>{_($.result)},$.onerror=M,$.readAsBinaryString(q)})}function instance$12(q,_,M){const $=createEventDispatcher();let j;async function z(Y){let Q=Y.target.files[0],Z=await readFileAsync$1(Q);try{let ee=JSON.parse(Z);$("newIdentity",ee)}catch{$("error")}}const V=Y=>z(Y);function G(Y){binding_callbacks[Y?"unshift":"push"](()=>{j=Y,M(0,j)})}return[j,z,V,G,()=>{j.click()}]}class UploadId extends SvelteComponent{constructor(_){super(),init(this,_,instance$12,create_fragment$14,safe_not_equal,{})}}const Identity_svelte_svelte_type_style_lang="";function create_else_block_1$5(q){let _,M;return{c(){_=element("br"),M=text(q[1])},m($,j){insert($,_,j),insert($,M,j)},p($,j){j&2&&set_data(M,$[1])},d($){$&&detach(_),$&&detach(M)}}}function create_if_block_5$8(q){let _,M,$,j;return{c(){_=element("div"),M=element("input"),attr(M,"class","w-auto lg:w-2/3 svelte-19qp35a"),attr(M,"type","text"),attr(M,"spellcheck","false"),attr(M,"maxlength","4")},m(z,V){insert(z,_,V),append(_,M),set_input_value(M,q[3]),$||(j=[listen(M,"input",q[14]),listen(M,"keypress",q[15]),listen(M,"focus",q[16]),listen(M,"keypress",q[17])],$=!0)},p(z,V){V&8&&M.value!==z[3]&&set_input_value(M,z[3])},d(z){z&&detach(_),$=!1,run_all(j)}}}function create_if_block_1$t(q){let _,M;function $(V,G){return V[4]==="ID must be 4 characters long"?create_if_block_2$n:V[4]==="ID must start with a letter"?create_if_block_3$d:V[4]==="ID must not contain special characters"?create_if_block_4$b:create_else_block$h}let j=$(q),z=j(q);return{c(){_=element("blockquote"),z.c()},m(V,G){insert(V,_,G),z.m(_,null)},p(V,G){j!==(j=$(V))&&(z.d(1),z=j(V),z&&(z.c(),z.m(_,null)))},i(V){M||add_render_callback(()=>{M=create_in_transition(_,fly,{y:50,duration:2e3}),M.start()})},o:noop,d(V){V&&detach(_),z.d()}}}function create_else_block$h(q){let _,M,$;return{c(){_=text("Press enter or click on "),M=element("b"),M.textContent="Change alias",$=text(" to generate a new keypair.")},m(j,z){insert(j,_,z),insert(j,M,z),insert(j,$,z)},d(j){j&&detach(_),j&&detach(M),j&&detach($)}}}function create_if_block_4$b(q){let _;return{c(){_=element("i"),_.innerHTML=`<strong>Special characters are not allowed.</strong> 
                  <br/>`},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_3$d(q){let _;return{c(){_=element("i"),_.innerHTML=`<strong>A valid alias must begin with a letter.</strong> It needs to
                  be 4 characters long and can only contain letters and numbers.`},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_2$n(q){let _;return{c(){_=element("i"),_.innerHTML="A valid id <strong>needs to be 4 characters long</strong>."},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block$C(q){let _,M,$;return{c(){_=element("blockquote"),_.innerHTML="<strong>Please upload a valid identity file</strong>"},m(j,z){insert(j,_,z),$=!0},i(j){$||(add_render_callback(()=>{$&&(M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!0)),M.run(1))}),$=!0)},o(j){M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!1)),M.run(0),$=!1},d(j){j&&detach(_),j&&M&&M.end()}}}function create_fragment$13(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee,te,ne,re,ie,se,le,he,ce,ae,de,ge,fe,oe,we,De,ve,Ce,ue,Pe,ze,Le,Me,Ne,Ye,Ie,Oe,Se,pe,me,be,Ee,ke,Fe,Be,Ue,nt,rt;function _e(He,Ze){return He[7]?create_if_block_5$8:create_else_block_1$5}let We=_e(q),Xe=We(q),Te=q[5]&&create_if_block_1$t(q),Re=q[6]===!0&&create_if_block$C();return ae=new UploadId({}),ae.$on("newIdentity",q[12]),ae.$on("error",q[10]),{c(){_=element("div"),M=element("div"),$=element("div"),j=element("div"),z=element("h3"),z.textContent="manage alias",V=space(),G=element("h4"),X=element("b"),X.textContent="Your current alias:",Y=space(),Xe.c(),Q=space(),Z=element("div"),ee=element("button"),ee.textContent="edit current alias",te=space(),ne=element("button"),ne.textContent="change alias",re=space(),ie=element("div"),se=element("div"),Te&&Te.c(),le=space(),Re&&Re.c(),he=space(),ce=element("div"),create_component(ae.$$.fragment),de=space(),ge=element("div"),ge.textContent=`Your alias (the identity you assume on this platform when interacting with
      others) is represented by the keypair seen below. It contains an address
      and a secret. If you intend on using the same alias consistently, it is
      important that you save your keypair safe in folder offline. Workspaces
      you have been invited to may be tied to your alias. Always keep a backup
      of all keypairs of your workspaces and aliases.`,fe=space(),oe=element("div"),we=element("div"),De=element("b"),De.textContent="Address:",ve=space(),Ce=text(q[2]),ue=space(),Pe=element("br"),ze=space(),Le=element("b"),Le.textContent="Secret:",Me=space(),Ne=text(q[8]),Ye=space(),Ie=element("div"),Oe=element("button"),Oe.textContent="download your current alias in .JSON",Se=space(),pe=element("div"),me=element("div"),be=element("h5"),be.innerHTML="<b>generate a new alias</b>",Ee=space(),ke=element("div"),ke.textContent="You can always assume a new identity.",Fe=space(),Be=element("button"),Be.textContent="generate alias",attr(G,"class","my-4"),attr(j,"class","flex flex-col"),attr(ee,"class","phase1 w-auto lg:w-11/12 mx-4"),attr(ne,"class","phase1 w-auto lg:w-11/12"),attr(Z,"class","my-4 flex flex-row h-1/3"),attr($,"class","w-4/5 flex flex-row justify-between items-end"),attr(se,"class","text-left flex-grow"),attr(ie,"class","w-4/5 flex flex-row justify-between"),attr(ge,"class","w-4/5 2xl:w-3/5 pt-4 mt-2"),attr(oe,"class","my-6"),attr(Oe,"class","phase1 w-auto lg:w-11/12"),attr(Ie,"class","mt-4 flex items-start align-left flex-col"),attr(be,"class","mt-12"),attr(ke,"class","w-auto"),attr(Be,"class","phase1 my-4"),attr(M,"class","flex flex-col items-start pb-24"),attr(_,"class","w-full text-left")},m(He,Ze){insert(He,_,Ze),append(_,M),append(M,$),append($,j),append(j,z),append(j,V),append(j,G),append(G,X),append(G,Y),Xe.m(G,null),append($,Q),append($,Z),append(Z,ee),append(Z,te),append(Z,ne),append(M,re),append(M,ie),append(ie,se),Te&&Te.m(se,null),append(se,le),Re&&Re.m(se,null),append(ie,he),append(ie,ce),mount_component(ae,ce,null),append(M,de),append(M,ge),append(M,fe),append(M,oe),append(oe,we),append(we,De),append(we,ve),append(we,Ce),append(we,ue),append(we,Pe),append(we,ze),append(we,Le),append(we,Me),append(we,Ne),append(M,Ye),append(M,Ie),append(Ie,Oe),append(M,Se),append(M,pe),append(pe,me),append(me,be),append(me,Ee),append(me,ke),append(me,Fe),append(me,Be),Ue=!0,nt||(rt=[listen(ee,"click",q[11]),listen(ne,"click",q[0]),listen(Oe,"click",q[18]),listen(Be,"click",q[19])],nt=!0)},p(He,[Ze]){We===(We=_e(He))&&Xe?Xe.p(He,Ze):(Xe.d(1),Xe=We(He),Xe&&(Xe.c(),Xe.m(G,null))),He[5]?Te?(Te.p(He,Ze),Ze&32&&transition_in(Te,1)):(Te=create_if_block_1$t(He),Te.c(),transition_in(Te,1),Te.m(se,le)):Te&&(Te.d(1),Te=null),He[6]===!0?Re?Ze&64&&transition_in(Re,1):(Re=create_if_block$C(),Re.c(),transition_in(Re,1),Re.m(se,null)):Re&&(group_outros(),transition_out(Re,1,1,()=>{Re=null}),check_outros()),(!Ue||Ze&4)&&set_data(Ce,He[2]),(!Ue||Ze&256)&&set_data(Ne,He[8])},i(He){Ue||(transition_in(Te),transition_in(Re),transition_in(ae.$$.fragment,He),Ue=!0)},o(He){transition_out(Re),transition_out(ae.$$.fragment,He),Ue=!1},d(He){He&&detach(_),Xe.d(),Te&&Te.d(),Re&&Re.d(),destroy_component(ae),nt=!1,run_all(rt)}}}function isNumber(q){return/[0-9]/.test(q)}function isSpecialChar(q){return/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(q)}function RandomId(){let q="",_="abcdefghijklmnopqrstuvwxyz",M=_.length,$="abcdefghijklmnopqrstuvwxyz0123456789",j=$.length;q+=_.charAt(Math.floor(Math.random()*M));for(let z=0;z<3;z++)q+=$.charAt(Math.floor(Math.random()*j));return q}function instance$11(q,_,M){let $,j,z,V;component_subscribe(q,authorKeypair,ge=>M(13,V=ge));let G,X,Y=!1,Q=!1,Z=!1;function ee(){let ge=document.createElement("a"),fe=new Blob([JSON.stringify(V)],{type:"text/plain"}),oe=V.address+".json";ge.href=URL.createObjectURL(fe),ge.download=oe,ge.style.display="none",document.body.appendChild(ge),ge.click()}async function te(ge){ge=="r"&&M(3,G=RandomId());let fe=G.slice(0,1);if(isNumber(fe))console.log("firstChar",fe),M(4,X="ID must start with a letter");else if(G.length!==4)M(4,X="ID must be 4 characters long");else if(isSpecialChar(G))M(4,X="ID must not contain special characters");else{let oe=await Crypto.generateAuthorKeypair(G),we=oe.address,De=oe.secret;authorKeypair.set({address:we,secret:De}),M(4,X=null),M(5,Y=!1),settings.author=oe}}function ne(){M(6,Q=!0)}onMount(async()=>{settings.author?authorKeypair.set(settings.author):(!V||!V.address)&&te("r")});function re(){M(7,Z=!Z)}function ie(ge){let fe=ge.detail;authorKeypair.set(fe),settings.author=fe}function se(){G=this.value,M(3,G),M(1,z),M(2,$),M(13,V)}const le=()=>{M(5,Y=!0)},he=()=>{M(5,Y=!0)},ce=()=>te(),ae=()=>ee(),de=()=>te("r");return q.$$.update=()=>{q.$$.dirty&8192&&M(2,$=V.address),q.$$.dirty&8192&&M(8,j=V.secret),q.$$.dirty&4&&M(1,z=$.slice(0,5)),q.$$.dirty&2&&M(3,G=z.slice(1,5))},[te,z,$,G,X,Y,Q,Z,j,ee,ne,re,ie,V,se,le,he,ce,ae,de]}class Identity extends SvelteComponent{constructor(_){super(),init(this,_,instance$11,create_fragment$13,safe_not_equal,{generateID:0})}get generateID(){return this.$$.ctx[0]}}const ValidateId_svelte_svelte_type_style_lang="";function create_if_block$B(q){let _,M;return{c(){_=element("p"),M=text(q[1]),attr(_,"class","text-2xl")},m($,j){insert($,_,j),append(_,M)},p($,j){j&2&&set_data(M,$[1])},d($){$&&detach(_)}}}function create_fragment$12(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee,te;Y=new UploadId({}),Y.$on("alias",q[5]),Y.$on("error",q[6]),Y.$on("newIdentity",q[3]);let ne=q[1]&&create_if_block$B(q);return{c(){_=element("div"),M=element("label"),M.textContent="Have an existing ID?",$=space(),j=element("div"),z=element("textarea"),V=space(),G=element("button"),G.textContent="Validate ID",X=space(),create_component(Y.$$.fragment),Q=space(),ne&&ne.c(),attr(M,"for","keypair"),attr(z,"class","px-5 my-2 svelte-5at67e"),attr(z,"id","keypair"),attr(z,"placeholder",`Paste it here:       
{
"address": "", 
"secret": ""
}`),attr(G,"class","phase1 mx-4 my-2"),attr(j,"class","flex md:flex-row items-end mx-0 flex-col svelte-5at67e"),attr(_,"class","flex flex-col items-start mx-0 svelte-5at67e")},m(re,ie){insert(re,_,ie),append(_,M),append(_,$),append(_,j),append(j,z),set_input_value(z,q[0]),append(j,V),append(j,G),append(j,X),mount_component(Y,j,null),append(_,Q),ne&&ne.m(_,null),Z=!0,ee||(te=[listen(z,"input",q[4]),listen(G,"click",q[2])],ee=!0)},p(re,[ie]){ie&1&&set_input_value(z,re[0]),re[1]?ne?ne.p(re,ie):(ne=create_if_block$B(re),ne.c(),ne.m(_,null)):ne&&(ne.d(1),ne=null)},i(re){Z||(transition_in(Y.$$.fragment,re),Z=!0)},o(re){transition_out(Y.$$.fragment,re),Z=!1},d(re){re&&detach(_),destroy_component(Y),ne&&ne.d(),ee=!1,run_all(te)}}}function instance$10(q,_,M){const $=createEventDispatcher();let j="",z="";function V(ee){ee.address&&ee.secret?isErr(checkAuthorIsValid(ee.address))?(M(1,z="Invalid address"),$("error")):(authorKeypair.set({address:ee.address,secret:ee.secret}),settings.author=ee,$("validated")):(M(1,z="Invalid keypair"),$("error"))}function G(){try{let ee=JSON.parse(j);V(ee)}catch{M(1,z="Invalid JSON"),$("error")}}function X(ee){V(ee.detail)}function Y(){j=this.value,M(0,j)}function Q(ee){bubble.call(this,q,ee)}function Z(ee){bubble.call(this,q,ee)}return[j,z,G,X,Y,Q,Z]}class ValidateId extends SvelteComponent{constructor(_){super(),init(this,_,instance$10,create_fragment$12,safe_not_equal,{})}}const FileSharing_svelte_svelte_type_style_lang="";function create_fragment$11(q){let _,M,$,j,z;return{c(){_=element("div"),M=element("div"),$=element("button"),$.textContent="file upload",attr($,"class","phase1"),attr(M,"class","svelte-1483hci"),attr(_,"class","svelte-1483hci")},m(V,G){insert(V,_,G),append(_,M),append(M,$),j||(z=[listen($,"click",q[0]),listen($,"keypress",q[0])],j=!0)},p:noop,i:noop,o:noop,d(V){V&&detach(_),j=!1,run_all(z)}}}function instance$$(q,_,M){const $=createEventDispatcher();let{xy:j=void 0}=_;function z(){$("selected",{type:"file",location:j})}return q.$$set=V=>{"xy"in V&&M(1,j=V.xy)},[z,j]}class FileSharing extends SvelteComponent{constructor(_){super(),init(this,_,instance$$,create_fragment$11,safe_not_equal,{xy:1})}}const cacheDetails=writable(null);replicaDetails.subscribe(q=>{if(!q||!q.replica){console.error("Replica is undefined or does not contain a valid replica property");return}try{const _=new ReplicaCache(q.replica);cacheDetails.set(_)}catch(_){console.error("Failed to create new cache:",_)}});const time=readable(new Date,function(_){const M=setInterval(()=>{_(new Date)},1e3);return function(){clearInterval(M)}}),start=new Date;derived(time,q=>Math.round((Number(q)-Number(start))/1e3));const defaultState={},studioGridStore=writable(defaultState),commonsGridStore=writable(defaultState);function setIsCellOccupied(q,_){const j=_===1?3:4,z=_===1?2:3;q=q.filter(X=>!/^\/documents\/page\d+\/newPage$/.test(X.path));let V=Array(6).fill().map(()=>Array(9).fill().map(()=>[]));q.forEach(X=>{const Y=parseInt(X.path.split("/")[j]),Q=parseInt(X.path.split("/")[z]);V[Q][Y].push(X)});let G=V.map(X=>X.map(Y=>Y.length>0));studioGridStore.update(X=>(X[_]=G,X))}function isCommonsCellOccupied(q){let $=Array(6).fill().map(()=>Array(9).fill().map(()=>[]));q.forEach(z=>{const V=parseInt(z.path.split("/")[3]),G=parseInt(z.path.split("/")[2]);$[G][V].push(z)});let j=$.map(z=>z.map(V=>V.length>0));commonsGridStore.set(j)}function mapNumberToLetter$2(q){return String.fromCharCode(65+q)}function pathToXY(q){let _=q.split("/"),M,$;_.length===6?(M=_[2],$=_[3]):_.length===7&&(M=_[3],$=_[4]);let j=Number(M)+1,z=mapNumberToLetter$2(Number($));return[j,z]}const Voice_svelte_svelte_type_style_lang$1="";function create_fragment$10(q){let _,M,$,j;return{c(){_=element("div"),M=element("button"),M.textContent="record audio",attr(M,"class","phase1"),attr(_,"class","svelte-lllvde")},m(z,V){insert(z,_,V),append(_,M),$||(j=listen(M,"click",q[0]),$=!0)},p:noop,i:noop,o:noop,d(z){z&&detach(_),$=!1,j()}}}function instance$_(q,_,M){const $=createEventDispatcher();let{xy:j=void 0}=_;function z(){$("selected",{type:"audio",location:j})}return q.$$set=V=>{"xy"in V&&M(1,j=V.xy)},[z,j]}let Voice$1=class extends SvelteComponent{constructor(_){super(),init(this,_,instance$_,create_fragment$10,safe_not_equal,{xy:1})}};const TextInput_svelte_svelte_type_style_lang="";function create_fragment$$(q){let _,M,$,j,z;return{c(){_=element("div"),M=element("div"),$=element("button"),$.textContent="written text",attr($,"class","phase1"),attr(M,"class","svelte-j8m7xm"),attr(_,"class","svelte-j8m7xm")},m(V,G){insert(V,_,G),append(_,M),append(M,$),j||(z=listen($,"click",q[0]),j=!0)},p:noop,i:noop,o:noop,d(V){V&&detach(_),j=!1,z()}}}function instance$Z(q,_,M){const $=createEventDispatcher();let{xy:j=[0,0]}=_;function z(){$("selected",{type:"text",location:j})}return q.$$set=V=>{"xy"in V&&M(1,j=V.xy)},[z,j]}class TextInput extends SvelteComponent{constructor(_){super(),init(this,_,instance$Z,create_fragment$$,safe_not_equal,{xy:1})}}const GridUpload_svelte_svelte_type_style_lang="";function get_each_context$c(q,_,M){const $=q.slice();return $[24]=_[M],$[26]=M,$}function get_each_context_1$3(q,_,M){const $=q.slice();return $[24]=_[M],$[28]=M,$}function get_each_context_2$2(q,_,M){const $=q.slice();return $[29]=_[M],$}function create_if_block_1$s(q){let _,M,$,j,z,V=mapNumberToLetter$1(q[7][1])+"",G,X,Y=q[7][0]+1+"",Q,Z,ee,te,ne,re,ie,se,le,he,ce,ae,de;return te=new TextInput({props:{xy:q[7]}}),te.$on("selected",q[15]),re=new FileSharing({props:{xy:q[7]}}),re.$on("selected",q[16]),se=new Voice$1({props:{xy:q[7]}}),se.$on("selected",q[17]),{c(){_=element("div"),M=element("div"),$=text(`What artefact would you like to create? 
      `),j=element("br"),z=space(),G=text(V),X=text(", "),Q=text(Y),Z=space(),ee=element("div"),create_component(te.$$.fragment),ne=space(),create_component(re.$$.fragment),ie=space(),create_component(se.$$.fragment),le=space(),he=element("button"),he.textContent="close",attr(M,"class","mt-6 brown text-left px-6 svelte-p1o47u"),attr(he,"class","phase1"),attr(ee,"class","flex-col"),attr(_,"class","modal pb-6  svelte-p1o47u"),attr(_,"style",q[9])},m(ge,fe){insert(ge,_,fe),append(_,M),append(M,$),append(M,j),append(M,z),append(M,G),append(M,X),append(M,Q),append(_,Z),append(_,ee),mount_component(te,ee,null),append(ee,ne),mount_component(re,ee,null),append(ee,ie),mount_component(se,ee,null),append(ee,le),append(ee,he),ce=!0,ae||(de=listen(he,"click",q[11]),ae=!0)},p(ge,fe){(!ce||fe[0]&128)&&V!==(V=mapNumberToLetter$1(ge[7][1])+"")&&set_data(G,V),(!ce||fe[0]&128)&&Y!==(Y=ge[7][0]+1+"")&&set_data(Q,Y);const oe={};fe[0]&128&&(oe.xy=ge[7]),te.$set(oe);const we={};fe[0]&128&&(we.xy=ge[7]),re.$set(we);const De={};fe[0]&128&&(De.xy=ge[7]),se.$set(De),(!ce||fe[0]&512)&&attr(_,"style",ge[9])},i(ge){ce||(transition_in(te.$$.fragment,ge),transition_in(re.$$.fragment,ge),transition_in(se.$$.fragment,ge),ce=!0)},o(ge){transition_out(te.$$.fragment,ge),transition_out(re.$$.fragment,ge),transition_out(se.$$.fragment,ge),ce=!1},d(ge){ge&&detach(_),destroy_component(te),destroy_component(re),destroy_component(se),ae=!1,de()}}}function create_each_block_2$2(q){let _,M,$=q[29].pageNumber+"",j,z;return{c(){_=element("option"),M=text("# "),j=text($),_.__value=z=q[29].pageNumber,_.value=_.__value},m(V,G){insert(V,_,G),append(_,M),append(_,j)},p(V,G){G[0]&1&&$!==($=V[29].pageNumber+"")&&set_data(j,$),G[0]&1&&z!==(z=V[29].pageNumber)&&(_.__value=z,_.value=_.__value)},d(V){V&&detach(_)}}}function create_if_block$A(q){let _=mapNumberToLetter$1(q[28])+"",M,$,j=q[26]+1+"",z;return{c(){M=text(_),$=text(", "),z=text(j)},m(V,G){insert(V,M,G),insert(V,$,G),insert(V,z,G)},p(V,G){G[0]&2&&_!==(_=mapNumberToLetter$1(V[28])+"")&&set_data(M,_),G[0]&2&&j!==(j=V[26]+1+"")&&set_data(z,j)},d(V){V&&detach(M),V&&detach($),V&&detach(z)}}}function create_each_block_1$3(q,_){let M,$,j,z,V=!(_[8][_[26]]&&_[8][_[26]][_[28]])&&create_if_block$A(_);function G(){return _[19](_[26],_[28])}function X(...Y){return _[20](_[26],_[28],...Y)}return{key:q,first:null,c(){M=element("div"),V&&V.c(),$=space(),set_style(M,"display","flex"),set_style(M,"justify-content","center"),set_style(M,"align-items","center"),set_style(M,"height","100%"),attr(M,"class","svelte-p1o47u"),toggle_class(M,"active",_[6][_[26]][_[28]]),toggle_class(M,"occupied",_[8][_[26]]&&_[8][_[26]][_[28]]),this.first=M},m(Y,Q){insert(Y,M,Q),V&&V.m(M,null),append(M,$),j||(z=[listen(M,"click",function(){is_function(_[8][_[26]]&&_[8][_[26]][_[28]]?void 0:G)&&(_[8][_[26]]&&_[8][_[26]][_[28]]?void 0:G).apply(this,arguments)}),listen(M,"keypress",X)],j=!0)},p(Y,Q){_=Y,_[8][_[26]]&&_[8][_[26]][_[28]]?V&&(V.d(1),V=null):V?V.p(_,Q):(V=create_if_block$A(_),V.c(),V.m(M,$)),Q[0]&66&&toggle_class(M,"active",_[6][_[26]][_[28]]),Q[0]&258&&toggle_class(M,"occupied",_[8][_[26]]&&_[8][_[26]][_[28]])},d(Y){Y&&detach(M),V&&V.d(),j=!1,run_all(z)}}}function create_each_block$c(q,_){let M,$=[],j=new Map,z,V=Array(_[1][1]).fill();const G=X=>X[28];for(let X=0;X<V.length;X+=1){let Y=get_each_context_1$3(_,V,X),Q=G(Y);j.set(Q,$[X]=create_each_block_1$3(Q,Y))}return{key:q,first:null,c(){M=empty();for(let X=0;X<$.length;X+=1)$[X].c();z=empty(),this.first=M},m(X,Y){insert(X,M,Y);for(let Q=0;Q<$.length;Q+=1)$[Q]&&$[Q].m(X,Y);insert(X,z,Y)},p(X,Y){_=X,Y[0]&1346&&(V=Array(_[1][1]).fill(),$=update_keyed_each($,Y,G,1,_,V,j,z.parentNode,destroy_block,create_each_block_1$3,z,get_each_context_1$3))},d(X){X&&detach(M);for(let Y=0;Y<$.length;Y+=1)$[Y].d(X);X&&detach(z)}}}function create_fragment$_(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee=[],te=new Map,ne,re,ie,se=q[2]&&create_if_block_1$s(q),le=q[0],he=[];for(let de=0;de<le.length;de+=1)he[de]=create_each_block_2$2(get_each_context_2$2(q,le,de));let ce=Array(q[1][0]).fill();const ae=de=>de[26];for(let de=0;de<ce.length;de+=1){let ge=get_each_context$c(q,ce,de),fe=ae(ge);te.set(fe,ee[de]=create_each_block$c(fe,ge))}return{c(){_=element("div"),M=element("div"),se&&se.c(),$=space(),j=element("div"),z=element("h4"),V=text("Select page   "),G=element("span"),X=element("select");for(let de=0;de<he.length;de+=1)he[de].c();Y=text(`
then location on map`),Q=space(),Z=element("div");for(let de=0;de<ee.length;de+=1)ee[de].c();attr(X,"id","pageDropdown"),attr(X,"class","svelte-p1o47u"),q[3]===void 0&&add_render_callback(()=>q[18].call(X)),attr(G,"class","inline-dropdown svelte-p1o47u"),attr(z,"class","py-6 svelte-p1o47u"),attr(Z,"class","container mt-8 svelte-p1o47u"),set_style(Z,"grid-template-rows",q[5]),set_style(Z,"grid-template-columns",q[4]),attr(j,"class","pb-32 background-white svelte-p1o47u"),set_style(M,"position","relative"),set_style(M,"z-index","52"),set_style(_,"position","fixed")},m(de,ge){insert(de,_,ge),append(_,M),se&&se.m(M,null),append(M,$),append(M,j),append(j,z),append(z,V),append(z,G),append(G,X);for(let fe=0;fe<he.length;fe+=1)he[fe]&&he[fe].m(X,null);select_option(X,q[3],!0),append(z,Y),append(j,Q),append(j,Z);for(let fe=0;fe<ee.length;fe+=1)ee[fe]&&ee[fe].m(Z,null);ne=!0,re||(ie=listen(X,"change",q[18]),re=!0)},p(de,ge){if(de[2]?se?(se.p(de,ge),ge[0]&4&&transition_in(se,1)):(se=create_if_block_1$s(de),se.c(),transition_in(se,1),se.m(M,$)):se&&(group_outros(),transition_out(se,1,1,()=>{se=null}),check_outros()),ge[0]&1){le=de[0];let fe;for(fe=0;fe<le.length;fe+=1){const oe=get_each_context_2$2(de,le,fe);he[fe]?he[fe].p(oe,ge):(he[fe]=create_each_block_2$2(oe),he[fe].c(),he[fe].m(X,null))}for(;fe<he.length;fe+=1)he[fe].d(1);he.length=le.length}ge[0]&9&&select_option(X,de[3]),ge[0]&1346&&(ce=Array(de[1][0]).fill(),ee=update_keyed_each(ee,ge,ae,1,de,ce,te,Z,destroy_block,create_each_block$c,null,get_each_context$c)),(!ne||ge[0]&32)&&set_style(Z,"grid-template-rows",de[5]),(!ne||ge[0]&16)&&set_style(Z,"grid-template-columns",de[4])},i(de){ne||(transition_in(se),ne=!0)},o(de){transition_out(se),ne=!1},d(de){de&&detach(_),se&&se.d(),destroy_each(he,de);for(let ge=0;ge<ee.length;ge+=1)ee[ge].d();re=!1,ie()}}}function mapNumberToLetter$1(q){return String.fromCharCode(65+q)}function instance$Y(q,_,M){let $,j;component_subscribe(q,studioGridStore,we=>M(14,j=we));let{windowWidth:z}=_,{pages:V}=_,G,X,Y,Q,Z=[],ee=!1,te=["0px","0px"],ne=V&&V[0]&&V[0].pageNumber,re=[];function ie(we,De){M(7,Z=[we,De,ne]),le([we,De]),setTimeout(()=>{M(2,ee=!0),M(13,te=[we*50+"px",De*50+50+"px"])},500)}function se([we,De],[ve,Ce]){return(we-Z[0])*(we-ve)<=0&&(De-Z[1])*(De-Ce)<=0}function le(we){M(6,Q=Q.map((De,ve)=>De.map((Ce,ue)=>se([ve,ue],we))))}function he(){M(2,ee=!1),M(6,Q=Array(G[0]).fill(0).map(we=>Array(G[1]).fill(!1)))}function ce(we){bubble.call(this,q,we)}function ae(we){bubble.call(this,q,we)}function de(we){bubble.call(this,q,we)}function ge(){ne=select_value(this),M(3,ne),M(0,V)}const fe=(we,De)=>ie(we,De),oe=(we,De,ve)=>{(ve.key==="Enter"||ve.key===" ")&&(re[we]&&re[we][De]||ie(we,De))};return q.$$set=we=>{"windowWidth"in we&&M(12,z=we.windowWidth),"pages"in we&&M(0,V=we.pages)},q.$$.update=()=>{q.$$.dirty[0]&4098&&(z<=768?M(1,G=[18,3]):M(1,G=[6,9]),M(4,X=`repeat(${G[1]}, 1fr)`),M(5,Y=`repeat(${G[0]}, 1fr)`),M(6,Q=Array(G[0]).fill(0).map(we=>Array(G[1]).fill(!1)))),q.$$.dirty[0]&16394&&(j[ne]?M(8,re=j[ne]):M(8,re=Array(G[0]).fill(0).map(()=>Array(G[1]).fill(!1)))),q.$$.dirty[0]&8196&&M(9,$=`top: ${te[0]}; left: ${te[1]}; visibility: ${ee?"visible":"hidden"};`)},[V,G,ee,ne,X,Y,Q,Z,re,$,ie,he,z,te,j,ce,ae,de,ge,fe,oe]}class GridUpload extends SvelteComponent{constructor(_){super(),init(this,_,instance$Y,create_fragment$_,safe_not_equal,{windowWidth:12,pages:0},null,[-1,-1])}}function supressWarnings(){const q=console.warn;console.warn=_=>{_.includes("unknown prop")||_.includes("unexpected slot")||q(_)},onMount(()=>{console.warn=q})}function get_each_context_5$1(q,_,M){const $=q.slice();return $[18]=_[M],$}function get_each_context_4$1(q,_,M){const $=q.slice();return $[18]=_[M],$}function get_each_context_1$2(q,_,M){const $=q.slice();return $[10]=_[M],$}function get_each_context_2$1(q,_,M){const $=q.slice();return $[13]=_[M],$[15]=M,$}function get_each_context_3$1(q,_,M){const $=q.slice();return $[16]=_[M],$[15]=M,$}function get_each_context$b(q,_,M){const $=q.slice();return $[7]=_[M],$}function create_if_block_1$r(q){let _,M,$,j;const z=[create_if_block_2$m,create_if_block_3$c,create_else_block_1$4],V=[];function G(X,Y){return X[0]==="table"?0:X[0]==="list"?1:2}return _=G(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(X,Y){V[_].m(X,Y),insert(X,$,Y),j=!0},p(X,Y){let Q=_;_=G(X),_===Q?V[_].p(X,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(X,Y):(M=V[_]=z[_](X),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(X){j||(transition_in(M),j=!0)},o(X){transition_out(M),j=!1},d(X){V[_].d(X),X&&detach($)}}}function create_if_block$z(q){let _,M,$=q[1],j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block$b(get_each_context$b(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,G){for(let X=0;X<j.length;X+=1)j[X]&&j[X].m(V,G);insert(V,_,G),M=!0},p(V,G){if(G&34){$=V[1];let X;for(X=0;X<$.length;X+=1){const Y=get_each_context$b(V,$,X);j[X]?(j[X].p(Y,G),transition_in(j[X],1)):(j[X]=create_each_block$b(Y),j[X].c(),transition_in(j[X],1),j[X].m(_.parentNode,_))}for(group_outros(),X=$.length;X<j.length;X+=1)z(X);check_outros()}},i(V){if(!M){for(let G=0;G<$.length;G+=1)transition_in(j[G]);M=!0}},o(V){j=j.filter(Boolean);for(let G=0;G<j.length;G+=1)transition_out(j[G]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_else_block_1$4(q){let _,M,$;const j=[q[6]];var z=q[5][q[0]];function V(G){let X={$$slots:{default:[create_default_slot_11]},$$scope:{ctx:G}};for(let Y=0;Y<j.length;Y+=1)X=assign(X,j[Y]);return{props:X}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(G,X){_&&mount_component(_,G,X),insert(G,M,X),$=!0},p(G,X){const Y=X&64?get_spread_update(j,[get_spread_object(G[6])]):{};if(X&8388706&&(Y.$$scope={dirty:X,ctx:G}),X&33&&z!==(z=G[5][G[0]])){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(G)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(G){$||(_&&transition_in(_.$$.fragment,G),$=!0)},o(G){_&&transition_out(_.$$.fragment,G),$=!1},d(G){G&&detach(M),_&&destroy_component(_,G)}}}function create_if_block_3$c(q){let _,M,$,j;const z=[create_if_block_4$a,create_else_block$g],V=[];function G(X,Y){return X[4]?0:1}return _=G(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(X,Y){V[_].m(X,Y),insert(X,$,Y),j=!0},p(X,Y){let Q=_;_=G(X),_===Q?V[_].p(X,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(X,Y):(M=V[_]=z[_](X),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(X){j||(transition_in(M),j=!0)},o(X){transition_out(M),j=!1},d(X){V[_].d(X),X&&detach($)}}}function create_if_block_2$m(q){let _,M,$;var j=q[5].table;function z(V){return{props:{$$slots:{default:[create_default_slot$6]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,G){_&&mount_component(_,V,G),insert(V,M,G),$=!0},p(V,G){const X={};if(G&8388716&&(X.$$scope={dirty:G,ctx:V}),G&32&&j!==(j=V[5].table)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(X)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_else_block_2$1(q){let _=q[6].raw+"",M;return{c(){M=text(_)},m($,j){insert($,M,j)},p($,j){j&64&&_!==(_=$[6].raw+"")&&set_data(M,_)},i:noop,o:noop,d($){$&&detach(M)}}}function create_if_block_5$7(q){let _,M;return _=new Parser$1({props:{tokens:q[1],renderers:q[5]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.tokens=$[1]),j&32&&(z.renderers=$[5]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot_11(q){let _,M,$,j;const z=[create_if_block_5$7,create_else_block_2$1],V=[];function G(X,Y){return X[1]?0:1}return _=G(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(X,Y){V[_].m(X,Y),insert(X,$,Y),j=!0},p(X,Y){let Q=_;_=G(X),_===Q?V[_].p(X,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(X,Y):(M=V[_]=z[_](X),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(X){j||(transition_in(M),j=!0)},o(X){transition_out(M),j=!1},d(X){V[_].d(X),X&&detach($)}}}function create_else_block$g(q){let _,M,$;const j=[{ordered:q[4]},q[6]];var z=q[5].list;function V(G){let X={$$slots:{default:[create_default_slot_9]},$$scope:{ctx:G}};for(let Y=0;Y<j.length;Y+=1)X=assign(X,j[Y]);return{props:X}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(G,X){_&&mount_component(_,G,X),insert(G,M,X),$=!0},p(G,X){const Y=X&80?get_spread_update(j,[X&16&&{ordered:G[4]},X&64&&get_spread_object(G[6])]):{};if(X&8388704&&(Y.$$scope={dirty:X,ctx:G}),X&32&&z!==(z=G[5].list)){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(G)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(G){$||(_&&transition_in(_.$$.fragment,G),$=!0)},o(G){_&&transition_out(_.$$.fragment,G),$=!1},d(G){G&&detach(M),_&&destroy_component(_,G)}}}function create_if_block_4$a(q){let _,M,$;const j=[{ordered:q[4]},q[6]];var z=q[5].list;function V(G){let X={$$slots:{default:[create_default_slot_7$1]},$$scope:{ctx:G}};for(let Y=0;Y<j.length;Y+=1)X=assign(X,j[Y]);return{props:X}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(G,X){_&&mount_component(_,G,X),insert(G,M,X),$=!0},p(G,X){const Y=X&80?get_spread_update(j,[X&16&&{ordered:G[4]},X&64&&get_spread_object(G[6])]):{};if(X&8388704&&(Y.$$scope={dirty:X,ctx:G}),X&32&&z!==(z=G[5].list)){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(G)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(G){$||(_&&transition_in(_.$$.fragment,G),$=!0)},o(G){_&&transition_out(_.$$.fragment,G),$=!1},d(G){G&&detach(M),_&&destroy_component(_,G)}}}function create_default_slot_10(q){let _,M,$;return _=new Parser$1({props:{tokens:q[18].tokens,renderers:q[5]}}),{c(){create_component(_.$$.fragment),M=space()},m(j,z){mount_component(_,j,z),insert(j,M,z),$=!0},p(j,z){const V={};z&64&&(V.tokens=j[18].tokens),z&32&&(V.renderers=j[5]),_.$set(V)},i(j){$||(transition_in(_.$$.fragment,j),$=!0)},o(j){transition_out(_.$$.fragment,j),$=!1},d(j){destroy_component(_,j),j&&detach(M)}}}function create_each_block_5$1(q){let _,M,$;const j=[q[18]];var z=q[5].unorderedlistitem||q[5].listitem;function V(G){let X={$$slots:{default:[create_default_slot_10]},$$scope:{ctx:G}};for(let Y=0;Y<j.length;Y+=1)X=assign(X,j[Y]);return{props:X}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(G,X){_&&mount_component(_,G,X),insert(G,M,X),$=!0},p(G,X){const Y=X&64?get_spread_update(j,[get_spread_object(G[18])]):{};if(X&8388704&&(Y.$$scope={dirty:X,ctx:G}),X&32&&z!==(z=G[5].unorderedlistitem||G[5].listitem)){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(G)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(G){$||(_&&transition_in(_.$$.fragment,G),$=!0)},o(G){_&&transition_out(_.$$.fragment,G),$=!1},d(G){G&&detach(M),_&&destroy_component(_,G)}}}function create_default_slot_9(q){let _,M,$=q[6].items,j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_5$1(get_each_context_5$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,G){for(let X=0;X<j.length;X+=1)j[X]&&j[X].m(V,G);insert(V,_,G),M=!0},p(V,G){if(G&96){$=V[6].items;let X;for(X=0;X<$.length;X+=1){const Y=get_each_context_5$1(V,$,X);j[X]?(j[X].p(Y,G),transition_in(j[X],1)):(j[X]=create_each_block_5$1(Y),j[X].c(),transition_in(j[X],1),j[X].m(_.parentNode,_))}for(group_outros(),X=$.length;X<j.length;X+=1)z(X);check_outros()}},i(V){if(!M){for(let G=0;G<$.length;G+=1)transition_in(j[G]);M=!0}},o(V){j=j.filter(Boolean);for(let G=0;G<j.length;G+=1)transition_out(j[G]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_default_slot_8$1(q){let _,M,$;return _=new Parser$1({props:{tokens:q[18].tokens,renderers:q[5]}}),{c(){create_component(_.$$.fragment),M=space()},m(j,z){mount_component(_,j,z),insert(j,M,z),$=!0},p(j,z){const V={};z&64&&(V.tokens=j[18].tokens),z&32&&(V.renderers=j[5]),_.$set(V)},i(j){$||(transition_in(_.$$.fragment,j),$=!0)},o(j){transition_out(_.$$.fragment,j),$=!1},d(j){destroy_component(_,j),j&&detach(M)}}}function create_each_block_4$1(q){let _,M,$;const j=[q[18]];var z=q[5].orderedlistitem||q[5].listitem;function V(G){let X={$$slots:{default:[create_default_slot_8$1]},$$scope:{ctx:G}};for(let Y=0;Y<j.length;Y+=1)X=assign(X,j[Y]);return{props:X}}return z&&(_=construct_svelte_component(z,V(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(G,X){_&&mount_component(_,G,X),insert(G,M,X),$=!0},p(G,X){const Y=X&64?get_spread_update(j,[get_spread_object(G[18])]):{};if(X&8388704&&(Y.$$scope={dirty:X,ctx:G}),X&32&&z!==(z=G[5].orderedlistitem||G[5].listitem)){if(_){group_outros();const Q=_;transition_out(Q.$$.fragment,1,0,()=>{destroy_component(Q,1)}),check_outros()}z?(_=construct_svelte_component(z,V(G)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else z&&_.$set(Y)},i(G){$||(_&&transition_in(_.$$.fragment,G),$=!0)},o(G){_&&transition_out(_.$$.fragment,G),$=!1},d(G){G&&detach(M),_&&destroy_component(_,G)}}}function create_default_slot_7$1(q){let _,M,$=q[6].items,j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_4$1(get_each_context_4$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,G){for(let X=0;X<j.length;X+=1)j[X]&&j[X].m(V,G);insert(V,_,G),M=!0},p(V,G){if(G&96){$=V[6].items;let X;for(X=0;X<$.length;X+=1){const Y=get_each_context_4$1(V,$,X);j[X]?(j[X].p(Y,G),transition_in(j[X],1)):(j[X]=create_each_block_4$1(Y),j[X].c(),transition_in(j[X],1),j[X].m(_.parentNode,_))}for(group_outros(),X=$.length;X<j.length;X+=1)z(X);check_outros()}},i(V){if(!M){for(let G=0;G<$.length;G+=1)transition_in(j[G]);M=!0}},o(V){j=j.filter(Boolean);for(let G=0;G<j.length;G+=1)transition_out(j[G]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_default_slot_6$1(q){let _,M,$;return _=new Parser$1({props:{tokens:q[16].tokens,renderers:q[5]}}),{c(){create_component(_.$$.fragment),M=space()},m(j,z){mount_component(_,j,z),insert(j,M,z),$=!0},p(j,z){const V={};z&4&&(V.tokens=j[16].tokens),z&32&&(V.renderers=j[5]),_.$set(V)},i(j){$||(transition_in(_.$$.fragment,j),$=!0)},o(j){transition_out(_.$$.fragment,j),$=!1},d(j){destroy_component(_,j),j&&detach(M)}}}function create_each_block_3$1(q){let _,M,$;var j=q[5].tablecell;function z(V){return{props:{header:!0,align:V[6].align[V[15]]||"center",$$slots:{default:[create_default_slot_6$1]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,G){_&&mount_component(_,V,G),insert(V,M,G),$=!0},p(V,G){const X={};if(G&64&&(X.align=V[6].align[V[15]]||"center"),G&8388644&&(X.$$scope={dirty:G,ctx:V}),G&32&&j!==(j=V[5].tablecell)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(X)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_default_slot_5$1(q){let _,M,$=q[2],j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_3$1(get_each_context_3$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,G){for(let X=0;X<j.length;X+=1)j[X]&&j[X].m(V,G);insert(V,_,G),M=!0},p(V,G){if(G&100){$=V[2];let X;for(X=0;X<$.length;X+=1){const Y=get_each_context_3$1(V,$,X);j[X]?(j[X].p(Y,G),transition_in(j[X],1)):(j[X]=create_each_block_3$1(Y),j[X].c(),transition_in(j[X],1),j[X].m(_.parentNode,_))}for(group_outros(),X=$.length;X<j.length;X+=1)z(X);check_outros()}},i(V){if(!M){for(let G=0;G<$.length;G+=1)transition_in(j[G]);M=!0}},o(V){j=j.filter(Boolean);for(let G=0;G<j.length;G+=1)transition_out(j[G]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_default_slot_4$1(q){let _,M,$;var j=q[5].tablerow;function z(V){return{props:{$$slots:{default:[create_default_slot_5$1]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,G){_&&mount_component(_,V,G),insert(V,M,G),$=!0},p(V,G){const X={};if(G&8388708&&(X.$$scope={dirty:G,ctx:V}),G&32&&j!==(j=V[5].tablerow)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(X)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_default_slot_3$1(q){let _,M;return _=new Parser$1({props:{tokens:q[13].tokens,renderers:q[5]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&8&&(z.tokens=$[13].tokens),j&32&&(z.renderers=$[5]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_each_block_2$1(q){let _,M,$;var j=q[5].tablecell;function z(V){return{props:{header:!1,align:V[6].align[V[15]]||"center",$$slots:{default:[create_default_slot_3$1]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,G){_&&mount_component(_,V,G),insert(V,M,G),$=!0},p(V,G){const X={};if(G&64&&(X.align=V[6].align[V[15]]||"center"),G&8388648&&(X.$$scope={dirty:G,ctx:V}),G&32&&j!==(j=V[5].tablecell)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(X)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_default_slot_2$1(q){let _,M,$=q[10],j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_2$1(get_each_context_2$1(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=space()},m(V,G){for(let X=0;X<j.length;X+=1)j[X]&&j[X].m(V,G);insert(V,_,G),M=!0},p(V,G){if(G&104){$=V[10];let X;for(X=0;X<$.length;X+=1){const Y=get_each_context_2$1(V,$,X);j[X]?(j[X].p(Y,G),transition_in(j[X],1)):(j[X]=create_each_block_2$1(Y),j[X].c(),transition_in(j[X],1),j[X].m(_.parentNode,_))}for(group_outros(),X=$.length;X<j.length;X+=1)z(X);check_outros()}},i(V){if(!M){for(let G=0;G<$.length;G+=1)transition_in(j[G]);M=!0}},o(V){j=j.filter(Boolean);for(let G=0;G<j.length;G+=1)transition_out(j[G]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_each_block_1$2(q){let _,M,$;var j=q[5].tablerow;function z(V){return{props:{$$slots:{default:[create_default_slot_2$1]},$$scope:{ctx:V}}}}return j&&(_=construct_svelte_component(j,z(q))),{c(){_&&create_component(_.$$.fragment),M=empty()},m(V,G){_&&mount_component(_,V,G),insert(V,M,G),$=!0},p(V,G){const X={};if(G&8388712&&(X.$$scope={dirty:G,ctx:V}),G&32&&j!==(j=V[5].tablerow)){if(_){group_outros();const Y=_;transition_out(Y.$$.fragment,1,0,()=>{destroy_component(Y,1)}),check_outros()}j?(_=construct_svelte_component(j,z(V)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else j&&_.$set(X)},i(V){$||(_&&transition_in(_.$$.fragment,V),$=!0)},o(V){_&&transition_out(_.$$.fragment,V),$=!1},d(V){V&&detach(M),_&&destroy_component(_,V)}}}function create_default_slot_1$1(q){let _,M,$=q[3],j=[];for(let V=0;V<$.length;V+=1)j[V]=create_each_block_1$2(get_each_context_1$2(q,$,V));const z=V=>transition_out(j[V],1,1,()=>{j[V]=null});return{c(){for(let V=0;V<j.length;V+=1)j[V].c();_=empty()},m(V,G){for(let X=0;X<j.length;X+=1)j[X]&&j[X].m(V,G);insert(V,_,G),M=!0},p(V,G){if(G&104){$=V[3];let X;for(X=0;X<$.length;X+=1){const Y=get_each_context_1$2(V,$,X);j[X]?(j[X].p(Y,G),transition_in(j[X],1)):(j[X]=create_each_block_1$2(Y),j[X].c(),transition_in(j[X],1),j[X].m(_.parentNode,_))}for(group_outros(),X=$.length;X<j.length;X+=1)z(X);check_outros()}},i(V){if(!M){for(let G=0;G<$.length;G+=1)transition_in(j[G]);M=!0}},o(V){j=j.filter(Boolean);for(let G=0;G<j.length;G+=1)transition_out(j[G]);M=!1},d(V){destroy_each(j,V),V&&detach(_)}}}function create_default_slot$6(q){let _,M,$,j,z;var V=q[5].tablehead;function G(Q){return{props:{$$slots:{default:[create_default_slot_4$1]},$$scope:{ctx:Q}}}}V&&(_=construct_svelte_component(V,G(q)));var X=q[5].tablebody;function Y(Q){return{props:{$$slots:{default:[create_default_slot_1$1]},$$scope:{ctx:Q}}}}return X&&($=construct_svelte_component(X,Y(q))),{c(){_&&create_component(_.$$.fragment),M=space(),$&&create_component($.$$.fragment),j=empty()},m(Q,Z){_&&mount_component(_,Q,Z),insert(Q,M,Z),$&&mount_component($,Q,Z),insert(Q,j,Z),z=!0},p(Q,Z){const ee={};if(Z&8388708&&(ee.$$scope={dirty:Z,ctx:Q}),Z&32&&V!==(V=Q[5].tablehead)){if(_){group_outros();const ne=_;transition_out(ne.$$.fragment,1,0,()=>{destroy_component(ne,1)}),check_outros()}V?(_=construct_svelte_component(V,G(Q)),create_component(_.$$.fragment),transition_in(_.$$.fragment,1),mount_component(_,M.parentNode,M)):_=null}else V&&_.$set(ee);const te={};if(Z&8388712&&(te.$$scope={dirty:Z,ctx:Q}),Z&32&&X!==(X=Q[5].tablebody)){if($){group_outros();const ne=$;transition_out(ne.$$.fragment,1,0,()=>{destroy_component(ne,1)}),check_outros()}X?($=construct_svelte_component(X,Y(Q)),create_component($.$$.fragment),transition_in($.$$.fragment,1),mount_component($,j.parentNode,j)):$=null}else X&&$.$set(te)},i(Q){z||(_&&transition_in(_.$$.fragment,Q),$&&transition_in($.$$.fragment,Q),z=!0)},o(Q){_&&transition_out(_.$$.fragment,Q),$&&transition_out($.$$.fragment,Q),z=!1},d(Q){_&&destroy_component(_,Q),Q&&detach(M),Q&&detach(j),$&&destroy_component($,Q)}}}function create_each_block$b(q){let _,M;const $=[q[7],{renderers:q[5]}];let j={};for(let z=0;z<$.length;z+=1)j=assign(j,$[z]);return _=new Parser$1({props:j}),{c(){create_component(_.$$.fragment)},m(z,V){mount_component(_,z,V),M=!0},p(z,V){const G=V&34?get_spread_update($,[V&2&&get_spread_object(z[7]),V&32&&{renderers:z[5]}]):{};_.$set(G)},i(z){M||(transition_in(_.$$.fragment,z),M=!0)},o(z){transition_out(_.$$.fragment,z),M=!1},d(z){destroy_component(_,z)}}}function create_fragment$Z(q){let _,M,$,j;const z=[create_if_block$z,create_if_block_1$r],V=[];function G(X,Y){return X[0]?X[5][X[0]]?1:-1:0}return~(_=G(q))&&(M=V[_]=z[_](q)),{c(){M&&M.c(),$=empty()},m(X,Y){~_&&V[_].m(X,Y),insert(X,$,Y),j=!0},p(X,[Y]){let Q=_;_=G(X),_===Q?~_&&V[_].p(X,Y):(M&&(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros()),~_?(M=V[_],M?M.p(X,Y):(M=V[_]=z[_](X),M.c()),transition_in(M,1),M.m($.parentNode,$)):M=null)},i(X){j||(transition_in(M),j=!0)},o(X){transition_out(M),j=!1},d(X){~_&&V[_].d(X),X&&detach($)}}}function instance$X(q,_,M){const $=["type","tokens","header","rows","ordered","renderers"];let j=compute_rest_props(_,$),{type:z=void 0}=_,{tokens:V=void 0}=_,{header:G=void 0}=_,{rows:X=void 0}=_,{ordered:Y=!1}=_,{renderers:Q}=_;return supressWarnings(),q.$$set=Z=>{_=assign(assign({},_),exclude_internal_props(Z)),M(6,j=compute_rest_props(_,$)),"type"in Z&&M(0,z=Z.type),"tokens"in Z&&M(1,V=Z.tokens),"header"in Z&&M(2,G=Z.header),"rows"in Z&&M(3,X=Z.rows),"ordered"in Z&&M(4,Y=Z.ordered),"renderers"in Z&&M(5,Q=Z.renderers)},[z,V,G,X,Y,Q,j]}let Parser$1=class extends SvelteComponent{constructor(_){super(),init(this,_,instance$X,create_fragment$Z,safe_not_equal,{type:0,tokens:1,header:2,rows:3,ordered:4,renderers:5})}};function getDefaults(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let defaults=getDefaults();function changeDefaults(q){defaults=q}const escapeTest=/[&<>"']/,escapeReplace=new RegExp(escapeTest.source,"g"),escapeTestNoEncode=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode=new RegExp(escapeTestNoEncode.source,"g"),escapeReplacements={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},getEscapeReplacement=q=>escapeReplacements[q];function escape$1(q,_){if(_){if(escapeTest.test(q))return q.replace(escapeReplace,getEscapeReplacement)}else if(escapeTestNoEncode.test(q))return q.replace(escapeReplaceNoEncode,getEscapeReplacement);return q}const unescapeTest=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function unescape$1(q){return q.replace(unescapeTest,(_,M)=>(M=M.toLowerCase(),M==="colon"?":":M.charAt(0)==="#"?M.charAt(1)==="x"?String.fromCharCode(parseInt(M.substring(2),16)):String.fromCharCode(+M.substring(1)):""))}const caret=/(^|[^\[])\^/g;function edit(q,_){q=typeof q=="string"?q:q.source,_=_||"";const M={replace:($,j)=>(j=j.source||j,j=j.replace(caret,"$1"),q=q.replace($,j),M),getRegex:()=>new RegExp(q,_)};return M}const nonWordAndColonTest=/[^\w:]/g,originIndependentUrl=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function cleanUrl(q,_,M){if(q){let $;try{$=decodeURIComponent(unescape$1(M)).replace(nonWordAndColonTest,"").toLowerCase()}catch{return null}if($.indexOf("javascript:")===0||$.indexOf("vbscript:")===0||$.indexOf("data:")===0)return null}_&&!originIndependentUrl.test(M)&&(M=resolveUrl(_,M));try{M=encodeURI(M).replace(/%25/g,"%")}catch{return null}return M}const baseUrls={},justDomain=/^[^:]+:\/*[^/]*$/,protocol=/^([^:]+:)[\s\S]*$/,domain=/^([^:]+:\/*[^/]*)[\s\S]*$/;function resolveUrl(q,_){baseUrls[" "+q]||(justDomain.test(q)?baseUrls[" "+q]=q+"/":baseUrls[" "+q]=rtrim(q,"/",!0)),q=baseUrls[" "+q];const M=q.indexOf(":")===-1;return _.substring(0,2)==="//"?M?_:q.replace(protocol,"$1")+_:_.charAt(0)==="/"?M?_:q.replace(domain,"$1")+_:q+_}const noopTest={exec:function(){}};function splitCells(q,_){const M=q.replace(/\|/g,(z,V,G)=>{let X=!1,Y=V;for(;--Y>=0&&G[Y]==="\\";)X=!X;return X?"|":" |"}),$=M.split(/ \|/);let j=0;if($[0].trim()||$.shift(),$.length>0&&!$[$.length-1].trim()&&$.pop(),$.length>_)$.splice(_);else for(;$.length<_;)$.push("");for(;j<$.length;j++)$[j]=$[j].trim().replace(/\\\|/g,"|");return $}function rtrim(q,_,M){const $=q.length;if($===0)return"";let j=0;for(;j<$;){const z=q.charAt($-j-1);if(z===_&&!M)j++;else if(z!==_&&M)j++;else break}return q.slice(0,$-j)}function findClosingBracket(q,_){if(q.indexOf(_[1])===-1)return-1;const M=q.length;let $=0,j=0;for(;j<M;j++)if(q[j]==="\\")j++;else if(q[j]===_[0])$++;else if(q[j]===_[1]&&($--,$<0))return j;return-1}function checkSanitizeDeprecation(q){q&&q.sanitize&&!q.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function repeatString(q,_){if(_<1)return"";let M="";for(;_>1;)_&1&&(M+=q),_>>=1,q+=q;return M+q}function outputLink(q,_,M,$){const j=_.href,z=_.title?escape$1(_.title):null,V=q[1].replace(/\\([\[\]])/g,"$1");if(q[0].charAt(0)!=="!"){$.state.inLink=!0;const G={type:"link",raw:M,href:j,title:z,text:V,tokens:$.inlineTokens(V)};return $.state.inLink=!1,G}return{type:"image",raw:M,href:j,title:z,text:escape$1(V)}}function indentCodeCompensation(q,_){const M=q.match(/^(\s+)(?:```)/);if(M===null)return _;const $=M[1];return _.split(`
`).map(j=>{const z=j.match(/^\s+/);if(z===null)return j;const[V]=z;return V.length>=$.length?j.slice($.length):j}).join(`
`)}class Tokenizer{constructor(_){this.options=_||defaults}space(_){const M=this.rules.block.newline.exec(_);if(M&&M[0].length>0)return{type:"space",raw:M[0]}}code(_){const M=this.rules.block.code.exec(_);if(M){const $=M[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:M[0],codeBlockStyle:"indented",text:this.options.pedantic?$:rtrim($,`
`)}}}fences(_){const M=this.rules.block.fences.exec(_);if(M){const $=M[0],j=indentCodeCompensation($,M[3]||"");return{type:"code",raw:$,lang:M[2]?M[2].trim().replace(this.rules.inline._escapes,"$1"):M[2],text:j}}}heading(_){const M=this.rules.block.heading.exec(_);if(M){let $=M[2].trim();if(/#$/.test($)){const j=rtrim($,"#");(this.options.pedantic||!j||/ $/.test(j))&&($=j.trim())}return{type:"heading",raw:M[0],depth:M[1].length,text:$,tokens:this.lexer.inline($)}}}hr(_){const M=this.rules.block.hr.exec(_);if(M)return{type:"hr",raw:M[0]}}blockquote(_){const M=this.rules.block.blockquote.exec(_);if(M){const $=M[0].replace(/^ *>[ \t]?/gm,""),j=this.lexer.state.top;this.lexer.state.top=!0;const z=this.lexer.blockTokens($);return this.lexer.state.top=j,{type:"blockquote",raw:M[0],tokens:z,text:$}}}list(_){let M=this.rules.block.list.exec(_);if(M){let $,j,z,V,G,X,Y,Q,Z,ee,te,ne,re=M[1].trim();const ie=re.length>1,se={type:"list",raw:"",ordered:ie,start:ie?+re.slice(0,-1):"",loose:!1,items:[]};re=ie?`\\d{1,9}\\${re.slice(-1)}`:`\\${re}`,this.options.pedantic&&(re=ie?re:"[*+-]");const le=new RegExp(`^( {0,3}${re})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;_&&(ne=!1,!(!(M=le.exec(_))||this.rules.block.hr.test(_)));){if($=M[0],_=_.substring($.length),Q=M[2].split(`
`,1)[0].replace(/^\t+/,ce=>" ".repeat(3*ce.length)),Z=_.split(`
`,1)[0],this.options.pedantic?(V=2,te=Q.trimLeft()):(V=M[2].search(/[^ ]/),V=V>4?1:V,te=Q.slice(V),V+=M[1].length),X=!1,!Q&&/^ *$/.test(Z)&&($+=Z+`
`,_=_.substring(Z.length+1),ne=!0),!ne){const ce=new RegExp(`^ {0,${Math.min(3,V-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),ae=new RegExp(`^ {0,${Math.min(3,V-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),de=new RegExp(`^ {0,${Math.min(3,V-1)}}(?:\`\`\`|~~~)`),ge=new RegExp(`^ {0,${Math.min(3,V-1)}}#`);for(;_&&(ee=_.split(`
`,1)[0],Z=ee,this.options.pedantic&&(Z=Z.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(de.test(Z)||ge.test(Z)||ce.test(Z)||ae.test(_)));){if(Z.search(/[^ ]/)>=V||!Z.trim())te+=`
`+Z.slice(V);else{if(X||Q.search(/[^ ]/)>=4||de.test(Q)||ge.test(Q)||ae.test(Q))break;te+=`
`+Z}!X&&!Z.trim()&&(X=!0),$+=ee+`
`,_=_.substring(ee.length+1),Q=Z.slice(V)}}se.loose||(Y?se.loose=!0:/\n *\n *$/.test($)&&(Y=!0)),this.options.gfm&&(j=/^\[[ xX]\] /.exec(te),j&&(z=j[0]!=="[ ] ",te=te.replace(/^\[[ xX]\] +/,""))),se.items.push({type:"list_item",raw:$,task:!!j,checked:z,loose:!1,text:te}),se.raw+=$}se.items[se.items.length-1].raw=$.trimRight(),se.items[se.items.length-1].text=te.trimRight(),se.raw=se.raw.trimRight();const he=se.items.length;for(G=0;G<he;G++)if(this.lexer.state.top=!1,se.items[G].tokens=this.lexer.blockTokens(se.items[G].text,[]),!se.loose){const ce=se.items[G].tokens.filter(de=>de.type==="space"),ae=ce.length>0&&ce.some(de=>/\n.*\n/.test(de.raw));se.loose=ae}if(se.loose)for(G=0;G<he;G++)se.items[G].loose=!0;return se}}html(_){const M=this.rules.block.html.exec(_);if(M){const $={type:"html",raw:M[0],pre:!this.options.sanitizer&&(M[1]==="pre"||M[1]==="script"||M[1]==="style"),text:M[0]};if(this.options.sanitize){const j=this.options.sanitizer?this.options.sanitizer(M[0]):escape$1(M[0]);$.type="paragraph",$.text=j,$.tokens=this.lexer.inline(j)}return $}}def(_){const M=this.rules.block.def.exec(_);if(M){const $=M[1].toLowerCase().replace(/\s+/g," "),j=M[2]?M[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",z=M[3]?M[3].substring(1,M[3].length-1).replace(this.rules.inline._escapes,"$1"):M[3];return{type:"def",tag:$,raw:M[0],href:j,title:z}}}table(_){const M=this.rules.block.table.exec(_);if(M){const $={type:"table",header:splitCells(M[1]).map(j=>({text:j})),align:M[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:M[3]&&M[3].trim()?M[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if($.header.length===$.align.length){$.raw=M[0];let j=$.align.length,z,V,G,X;for(z=0;z<j;z++)/^ *-+: *$/.test($.align[z])?$.align[z]="right":/^ *:-+: *$/.test($.align[z])?$.align[z]="center":/^ *:-+ *$/.test($.align[z])?$.align[z]="left":$.align[z]=null;for(j=$.rows.length,z=0;z<j;z++)$.rows[z]=splitCells($.rows[z],$.header.length).map(Y=>({text:Y}));for(j=$.header.length,V=0;V<j;V++)$.header[V].tokens=this.lexer.inline($.header[V].text);for(j=$.rows.length,V=0;V<j;V++)for(X=$.rows[V],G=0;G<X.length;G++)X[G].tokens=this.lexer.inline(X[G].text);return $}}}lheading(_){const M=this.rules.block.lheading.exec(_);if(M)return{type:"heading",raw:M[0],depth:M[2].charAt(0)==="="?1:2,text:M[1],tokens:this.lexer.inline(M[1])}}paragraph(_){const M=this.rules.block.paragraph.exec(_);if(M){const $=M[1].charAt(M[1].length-1)===`
`?M[1].slice(0,-1):M[1];return{type:"paragraph",raw:M[0],text:$,tokens:this.lexer.inline($)}}}text(_){const M=this.rules.block.text.exec(_);if(M)return{type:"text",raw:M[0],text:M[0],tokens:this.lexer.inline(M[0])}}escape(_){const M=this.rules.inline.escape.exec(_);if(M)return{type:"escape",raw:M[0],text:escape$1(M[1])}}tag(_){const M=this.rules.inline.tag.exec(_);if(M)return!this.lexer.state.inLink&&/^<a /i.test(M[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(M[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(M[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(M[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:M[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(M[0]):escape$1(M[0]):M[0]}}link(_){const M=this.rules.inline.link.exec(_);if(M){const $=M[2].trim();if(!this.options.pedantic&&/^</.test($)){if(!/>$/.test($))return;const V=rtrim($.slice(0,-1),"\\");if(($.length-V.length)%2===0)return}else{const V=findClosingBracket(M[2],"()");if(V>-1){const X=(M[0].indexOf("!")===0?5:4)+M[1].length+V;M[2]=M[2].substring(0,V),M[0]=M[0].substring(0,X).trim(),M[3]=""}}let j=M[2],z="";if(this.options.pedantic){const V=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(j);V&&(j=V[1],z=V[3])}else z=M[3]?M[3].slice(1,-1):"";return j=j.trim(),/^</.test(j)&&(this.options.pedantic&&!/>$/.test($)?j=j.slice(1):j=j.slice(1,-1)),outputLink(M,{href:j&&j.replace(this.rules.inline._escapes,"$1"),title:z&&z.replace(this.rules.inline._escapes,"$1")},M[0],this.lexer)}}reflink(_,M){let $;if(($=this.rules.inline.reflink.exec(_))||($=this.rules.inline.nolink.exec(_))){let j=($[2]||$[1]).replace(/\s+/g," ");if(j=M[j.toLowerCase()],!j){const z=$[0].charAt(0);return{type:"text",raw:z,text:z}}return outputLink($,j,$[0],this.lexer)}}emStrong(_,M,$=""){let j=this.rules.inline.emStrong.lDelim.exec(_);if(!j||j[3]&&$.match(/[\p{L}\p{N}]/u))return;const z=j[1]||j[2]||"";if(!z||z&&($===""||this.rules.inline.punctuation.exec($))){const V=j[0].length-1;let G,X,Y=V,Q=0;const Z=j[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(Z.lastIndex=0,M=M.slice(-1*_.length+V);(j=Z.exec(M))!=null;){if(G=j[1]||j[2]||j[3]||j[4]||j[5]||j[6],!G)continue;if(X=G.length,j[3]||j[4]){Y+=X;continue}else if((j[5]||j[6])&&V%3&&!((V+X)%3)){Q+=X;continue}if(Y-=X,Y>0)continue;X=Math.min(X,X+Y+Q);const ee=_.slice(0,V+j.index+(j[0].length-G.length)+X);if(Math.min(V,X)%2){const ne=ee.slice(1,-1);return{type:"em",raw:ee,text:ne,tokens:this.lexer.inlineTokens(ne)}}const te=ee.slice(2,-2);return{type:"strong",raw:ee,text:te,tokens:this.lexer.inlineTokens(te)}}}}codespan(_){const M=this.rules.inline.code.exec(_);if(M){let $=M[2].replace(/\n/g," ");const j=/[^ ]/.test($),z=/^ /.test($)&&/ $/.test($);return j&&z&&($=$.substring(1,$.length-1)),$=escape$1($,!0),{type:"codespan",raw:M[0],text:$}}}br(_){const M=this.rules.inline.br.exec(_);if(M)return{type:"br",raw:M[0]}}del(_){const M=this.rules.inline.del.exec(_);if(M)return{type:"del",raw:M[0],text:M[2],tokens:this.lexer.inlineTokens(M[2])}}autolink(_,M){const $=this.rules.inline.autolink.exec(_);if($){let j,z;return $[2]==="@"?(j=escape$1(this.options.mangle?M($[1]):$[1]),z="mailto:"+j):(j=escape$1($[1]),z=j),{type:"link",raw:$[0],text:j,href:z,tokens:[{type:"text",raw:j,text:j}]}}}url(_,M){let $;if($=this.rules.inline.url.exec(_)){let j,z;if($[2]==="@")j=escape$1(this.options.mangle?M($[0]):$[0]),z="mailto:"+j;else{let V;do V=$[0],$[0]=this.rules.inline._backpedal.exec($[0])[0];while(V!==$[0]);j=escape$1($[0]),$[1]==="www."?z="http://"+$[0]:z=$[0]}return{type:"link",raw:$[0],text:j,href:z,tokens:[{type:"text",raw:j,text:j}]}}}inlineText(_,M){const $=this.rules.inline.text.exec(_);if($){let j;return this.lexer.state.inRawBlock?j=this.options.sanitize?this.options.sanitizer?this.options.sanitizer($[0]):escape$1($[0]):$[0]:j=escape$1(this.options.smartypants?M($[0]):$[0]),{type:"text",raw:$[0],text:j}}}}const block={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:noopTest,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};block._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;block._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;block.def=edit(block.def).replace("label",block._label).replace("title",block._title).getRegex();block.bullet=/(?:[*+-]|\d{1,9}[.)])/;block.listItemStart=edit(/^( *)(bull) */).replace("bull",block.bullet).getRegex();block.list=edit(block.list).replace(/bull/g,block.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+block.def.source+")").getRegex();block._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";block._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;block.html=edit(block.html,"i").replace("comment",block._comment).replace("tag",block._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();block.paragraph=edit(block._paragraph).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.blockquote=edit(block.blockquote).replace("paragraph",block.paragraph).getRegex();block.normal={...block};block.gfm={...block.normal,table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"};block.gfm.table=edit(block.gfm.table).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.gfm.paragraph=edit(block._paragraph).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",block.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.pedantic={...block.normal,html:edit(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",block._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:noopTest,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:edit(block.normal._paragraph).replace("hr",block.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",block.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const inline={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:noopTest,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:noopTest,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};inline._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";inline.punctuation=edit(inline.punctuation).replace(/punctuation/g,inline._punctuation).getRegex();inline.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;inline.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g;inline._comment=edit(block._comment).replace("(?:-->|$)","-->").getRegex();inline.emStrong.lDelim=edit(inline.emStrong.lDelim).replace(/punct/g,inline._punctuation).getRegex();inline.emStrong.rDelimAst=edit(inline.emStrong.rDelimAst,"g").replace(/punct/g,inline._punctuation).getRegex();inline.emStrong.rDelimUnd=edit(inline.emStrong.rDelimUnd,"g").replace(/punct/g,inline._punctuation).getRegex();inline._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;inline._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;inline._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;inline.autolink=edit(inline.autolink).replace("scheme",inline._scheme).replace("email",inline._email).getRegex();inline._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;inline.tag=edit(inline.tag).replace("comment",inline._comment).replace("attribute",inline._attribute).getRegex();inline._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;inline._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;inline._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;inline.link=edit(inline.link).replace("label",inline._label).replace("href",inline._href).replace("title",inline._title).getRegex();inline.reflink=edit(inline.reflink).replace("label",inline._label).replace("ref",block._label).getRegex();inline.nolink=edit(inline.nolink).replace("ref",block._label).getRegex();inline.reflinkSearch=edit(inline.reflinkSearch,"g").replace("reflink",inline.reflink).replace("nolink",inline.nolink).getRegex();inline.normal={...inline};inline.pedantic={...inline.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:edit(/^!?\[(label)\]\((.*?)\)/).replace("label",inline._label).getRegex(),reflink:edit(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",inline._label).getRegex()};inline.gfm={...inline.normal,escape:edit(inline.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/};inline.gfm.url=edit(inline.gfm.url,"i").replace("email",inline.gfm._extended_email).getRegex();inline.breaks={...inline.gfm,br:edit(inline.br).replace("{2,}","*").getRegex(),text:edit(inline.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};function smartypants(q){return q.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function mangle(q){let _="",M,$;const j=q.length;for(M=0;M<j;M++)$=q.charCodeAt(M),Math.random()>.5&&($="x"+$.toString(16)),_+="&#"+$+";";return _}class Lexer{constructor(_){this.tokens=[],this.tokens.links=Object.create(null),this.options=_||defaults,this.options.tokenizer=this.options.tokenizer||new Tokenizer,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const M={block:block.normal,inline:inline.normal};this.options.pedantic?(M.block=block.pedantic,M.inline=inline.pedantic):this.options.gfm&&(M.block=block.gfm,this.options.breaks?M.inline=inline.breaks:M.inline=inline.gfm),this.tokenizer.rules=M}static get rules(){return{block,inline}}static lex(_,M){return new Lexer(M).lex(_)}static lexInline(_,M){return new Lexer(M).inlineTokens(_)}lex(_){_=_.replace(/\r\n|\r/g,`
`),this.blockTokens(_,this.tokens);let M;for(;M=this.inlineQueue.shift();)this.inlineTokens(M.src,M.tokens);return this.tokens}blockTokens(_,M=[]){this.options.pedantic?_=_.replace(/\t/g,"    ").replace(/^ +$/gm,""):_=_.replace(/^( *)(\t+)/gm,(G,X,Y)=>X+"    ".repeat(Y.length));let $,j,z,V;for(;_;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(G=>($=G.call({lexer:this},_,M))?(_=_.substring($.raw.length),M.push($),!0):!1))){if($=this.tokenizer.space(_)){_=_.substring($.raw.length),$.raw.length===1&&M.length>0?M[M.length-1].raw+=`
`:M.push($);continue}if($=this.tokenizer.code(_)){_=_.substring($.raw.length),j=M[M.length-1],j&&(j.type==="paragraph"||j.type==="text")?(j.raw+=`
`+$.raw,j.text+=`
`+$.text,this.inlineQueue[this.inlineQueue.length-1].src=j.text):M.push($);continue}if($=this.tokenizer.fences(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.heading(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.hr(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.blockquote(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.list(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.html(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.def(_)){_=_.substring($.raw.length),j=M[M.length-1],j&&(j.type==="paragraph"||j.type==="text")?(j.raw+=`
`+$.raw,j.text+=`
`+$.raw,this.inlineQueue[this.inlineQueue.length-1].src=j.text):this.tokens.links[$.tag]||(this.tokens.links[$.tag]={href:$.href,title:$.title});continue}if($=this.tokenizer.table(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.lheading(_)){_=_.substring($.raw.length),M.push($);continue}if(z=_,this.options.extensions&&this.options.extensions.startBlock){let G=1/0;const X=_.slice(1);let Y;this.options.extensions.startBlock.forEach(function(Q){Y=Q.call({lexer:this},X),typeof Y=="number"&&Y>=0&&(G=Math.min(G,Y))}),G<1/0&&G>=0&&(z=_.substring(0,G+1))}if(this.state.top&&($=this.tokenizer.paragraph(z))){j=M[M.length-1],V&&j.type==="paragraph"?(j.raw+=`
`+$.raw,j.text+=`
`+$.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=j.text):M.push($),V=z.length!==_.length,_=_.substring($.raw.length);continue}if($=this.tokenizer.text(_)){_=_.substring($.raw.length),j=M[M.length-1],j&&j.type==="text"?(j.raw+=`
`+$.raw,j.text+=`
`+$.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=j.text):M.push($);continue}if(_){const G="Infinite loop on byte: "+_.charCodeAt(0);if(this.options.silent){console.error(G);break}else throw new Error(G)}}return this.state.top=!0,M}inline(_,M=[]){return this.inlineQueue.push({src:_,tokens:M}),M}inlineTokens(_,M=[]){let $,j,z,V=_,G,X,Y;if(this.tokens.links){const Q=Object.keys(this.tokens.links);if(Q.length>0)for(;(G=this.tokenizer.rules.inline.reflinkSearch.exec(V))!=null;)Q.includes(G[0].slice(G[0].lastIndexOf("[")+1,-1))&&(V=V.slice(0,G.index)+"["+repeatString("a",G[0].length-2)+"]"+V.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(G=this.tokenizer.rules.inline.blockSkip.exec(V))!=null;)V=V.slice(0,G.index)+"["+repeatString("a",G[0].length-2)+"]"+V.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(G=this.tokenizer.rules.inline.escapedEmSt.exec(V))!=null;)V=V.slice(0,G.index+G[0].length-2)+"++"+V.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;_;)if(X||(Y=""),X=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(Q=>($=Q.call({lexer:this},_,M))?(_=_.substring($.raw.length),M.push($),!0):!1))){if($=this.tokenizer.escape(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.tag(_)){_=_.substring($.raw.length),j=M[M.length-1],j&&$.type==="text"&&j.type==="text"?(j.raw+=$.raw,j.text+=$.text):M.push($);continue}if($=this.tokenizer.link(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.reflink(_,this.tokens.links)){_=_.substring($.raw.length),j=M[M.length-1],j&&$.type==="text"&&j.type==="text"?(j.raw+=$.raw,j.text+=$.text):M.push($);continue}if($=this.tokenizer.emStrong(_,V,Y)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.codespan(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.br(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.del(_)){_=_.substring($.raw.length),M.push($);continue}if($=this.tokenizer.autolink(_,mangle)){_=_.substring($.raw.length),M.push($);continue}if(!this.state.inLink&&($=this.tokenizer.url(_,mangle))){_=_.substring($.raw.length),M.push($);continue}if(z=_,this.options.extensions&&this.options.extensions.startInline){let Q=1/0;const Z=_.slice(1);let ee;this.options.extensions.startInline.forEach(function(te){ee=te.call({lexer:this},Z),typeof ee=="number"&&ee>=0&&(Q=Math.min(Q,ee))}),Q<1/0&&Q>=0&&(z=_.substring(0,Q+1))}if($=this.tokenizer.inlineText(z,smartypants)){_=_.substring($.raw.length),$.raw.slice(-1)!=="_"&&(Y=$.raw.slice(-1)),X=!0,j=M[M.length-1],j&&j.type==="text"?(j.raw+=$.raw,j.text+=$.text):M.push($);continue}if(_){const Q="Infinite loop on byte: "+_.charCodeAt(0);if(this.options.silent){console.error(Q);break}else throw new Error(Q)}}return M}}class Renderer{constructor(_){this.options=_||defaults}code(_,M,$){const j=(M||"").match(/\S*/)[0];if(this.options.highlight){const z=this.options.highlight(_,j);z!=null&&z!==_&&($=!0,_=z)}return _=_.replace(/\n$/,"")+`
`,j?'<pre><code class="'+this.options.langPrefix+escape$1(j)+'">'+($?_:escape$1(_,!0))+`</code></pre>
`:"<pre><code>"+($?_:escape$1(_,!0))+`</code></pre>
`}blockquote(_){return`<blockquote>
${_}</blockquote>
`}html(_){return _}heading(_,M,$,j){if(this.options.headerIds){const z=this.options.headerPrefix+j.slug($);return`<h${M} id="${z}">${_}</h${M}>
`}return`<h${M}>${_}</h${M}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(_,M,$){const j=M?"ol":"ul",z=M&&$!==1?' start="'+$+'"':"";return"<"+j+z+`>
`+_+"</"+j+`>
`}listitem(_){return`<li>${_}</li>
`}checkbox(_){return"<input "+(_?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(_){return`<p>${_}</p>
`}table(_,M){return M&&(M=`<tbody>${M}</tbody>`),`<table>
<thead>
`+_+`</thead>
`+M+`</table>
`}tablerow(_){return`<tr>
${_}</tr>
`}tablecell(_,M){const $=M.header?"th":"td";return(M.align?`<${$} align="${M.align}">`:`<${$}>`)+_+`</${$}>
`}strong(_){return`<strong>${_}</strong>`}em(_){return`<em>${_}</em>`}codespan(_){return`<code>${_}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(_){return`<del>${_}</del>`}link(_,M,$){if(_=cleanUrl(this.options.sanitize,this.options.baseUrl,_),_===null)return $;let j='<a href="'+_+'"';return M&&(j+=' title="'+M+'"'),j+=">"+$+"</a>",j}image(_,M,$){if(_=cleanUrl(this.options.sanitize,this.options.baseUrl,_),_===null)return $;let j=`<img src="${_}" alt="${$}"`;return M&&(j+=` title="${M}"`),j+=this.options.xhtml?"/>":">",j}text(_){return _}}class TextRenderer{strong(_){return _}em(_){return _}codespan(_){return _}del(_){return _}html(_){return _}text(_){return _}link(_,M,$){return""+$}image(_,M,$){return""+$}br(){return""}}class Slugger{constructor(){this.seen={}}serialize(_){return _.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(_,M){let $=_,j=0;if(this.seen.hasOwnProperty($)){j=this.seen[_];do j++,$=_+"-"+j;while(this.seen.hasOwnProperty($))}return M||(this.seen[_]=j,this.seen[$]=0),$}slug(_,M={}){const $=this.serialize(_);return this.getNextSafeSlug($,M.dryrun)}}class Parser{constructor(_){this.options=_||defaults,this.options.renderer=this.options.renderer||new Renderer,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new TextRenderer,this.slugger=new Slugger}static parse(_,M){return new Parser(M).parse(_)}static parseInline(_,M){return new Parser(M).parseInline(_)}parse(_,M=!0){let $="",j,z,V,G,X,Y,Q,Z,ee,te,ne,re,ie,se,le,he,ce,ae,de;const ge=_.length;for(j=0;j<ge;j++){if(te=_[j],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[te.type]&&(de=this.options.extensions.renderers[te.type].call({parser:this},te),de!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(te.type))){$+=de||"";continue}switch(te.type){case"space":continue;case"hr":{$+=this.renderer.hr();continue}case"heading":{$+=this.renderer.heading(this.parseInline(te.tokens),te.depth,unescape$1(this.parseInline(te.tokens,this.textRenderer)),this.slugger);continue}case"code":{$+=this.renderer.code(te.text,te.lang,te.escaped);continue}case"table":{for(Z="",Q="",G=te.header.length,z=0;z<G;z++)Q+=this.renderer.tablecell(this.parseInline(te.header[z].tokens),{header:!0,align:te.align[z]});for(Z+=this.renderer.tablerow(Q),ee="",G=te.rows.length,z=0;z<G;z++){for(Y=te.rows[z],Q="",X=Y.length,V=0;V<X;V++)Q+=this.renderer.tablecell(this.parseInline(Y[V].tokens),{header:!1,align:te.align[V]});ee+=this.renderer.tablerow(Q)}$+=this.renderer.table(Z,ee);continue}case"blockquote":{ee=this.parse(te.tokens),$+=this.renderer.blockquote(ee);continue}case"list":{for(ne=te.ordered,re=te.start,ie=te.loose,G=te.items.length,ee="",z=0;z<G;z++)le=te.items[z],he=le.checked,ce=le.task,se="",le.task&&(ae=this.renderer.checkbox(he),ie?le.tokens.length>0&&le.tokens[0].type==="paragraph"?(le.tokens[0].text=ae+" "+le.tokens[0].text,le.tokens[0].tokens&&le.tokens[0].tokens.length>0&&le.tokens[0].tokens[0].type==="text"&&(le.tokens[0].tokens[0].text=ae+" "+le.tokens[0].tokens[0].text)):le.tokens.unshift({type:"text",text:ae}):se+=ae),se+=this.parse(le.tokens,ie),ee+=this.renderer.listitem(se,ce,he);$+=this.renderer.list(ee,ne,re);continue}case"html":{$+=this.renderer.html(te.text);continue}case"paragraph":{$+=this.renderer.paragraph(this.parseInline(te.tokens));continue}case"text":{for(ee=te.tokens?this.parseInline(te.tokens):te.text;j+1<ge&&_[j+1].type==="text";)te=_[++j],ee+=`
`+(te.tokens?this.parseInline(te.tokens):te.text);$+=M?this.renderer.paragraph(ee):ee;continue}default:{const fe='Token with "'+te.type+'" type was not found.';if(this.options.silent){console.error(fe);return}else throw new Error(fe)}}}return $}parseInline(_,M){M=M||this.renderer;let $="",j,z,V;const G=_.length;for(j=0;j<G;j++){if(z=_[j],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[z.type]&&(V=this.options.extensions.renderers[z.type].call({parser:this},z),V!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(z.type))){$+=V||"";continue}switch(z.type){case"escape":{$+=M.text(z.text);break}case"html":{$+=M.html(z.text);break}case"link":{$+=M.link(z.href,z.title,this.parseInline(z.tokens,M));break}case"image":{$+=M.image(z.href,z.title,z.text);break}case"strong":{$+=M.strong(this.parseInline(z.tokens,M));break}case"em":{$+=M.em(this.parseInline(z.tokens,M));break}case"codespan":{$+=M.codespan(z.text);break}case"br":{$+=M.br();break}case"del":{$+=M.del(this.parseInline(z.tokens,M));break}case"text":{$+=M.text(z.text);break}default:{const X='Token with "'+z.type+'" type was not found.';if(this.options.silent){console.error(X);return}else throw new Error(X)}}}return $}}class Hooks{constructor(_){this.options=_||defaults}preprocess(_){return _}postprocess(_){return _}}Ht(Hooks,"passThroughHooks",new Set(["preprocess","postprocess"]));function onError(q,_,M){return $=>{if($.message+=`
Please report this to https://github.com/markedjs/marked.`,q){const j="<p>An error occurred:</p><pre>"+escape$1($.message+"",!0)+"</pre>";if(_)return Promise.resolve(j);if(M){M(null,j);return}return j}if(_)return Promise.reject($);if(M){M($);return}throw $}}function parseMarkdown(q,_){return(M,$,j)=>{typeof $=="function"&&(j=$,$=null);const z={...$};$={...marked.defaults,...z};const V=onError($.silent,$.async,j);if(typeof M>"u"||M===null)return V(new Error("marked(): input parameter is undefined or null"));if(typeof M!="string")return V(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(M)+", string expected"));if(checkSanitizeDeprecation($),$.hooks&&($.hooks.options=$),j){const G=$.highlight;let X;try{$.hooks&&(M=$.hooks.preprocess(M)),X=q(M,$)}catch(Z){return V(Z)}const Y=function(Z){let ee;if(!Z)try{$.walkTokens&&marked.walkTokens(X,$.walkTokens),ee=_(X,$),$.hooks&&(ee=$.hooks.postprocess(ee))}catch(te){Z=te}return $.highlight=G,Z?V(Z):j(null,ee)};if(!G||G.length<3||(delete $.highlight,!X.length))return Y();let Q=0;marked.walkTokens(X,function(Z){Z.type==="code"&&(Q++,setTimeout(()=>{G(Z.text,Z.lang,function(ee,te){if(ee)return Y(ee);te!=null&&te!==Z.text&&(Z.text=te,Z.escaped=!0),Q--,Q===0&&Y()})},0))}),Q===0&&Y();return}if($.async)return Promise.resolve($.hooks?$.hooks.preprocess(M):M).then(G=>q(G,$)).then(G=>$.walkTokens?Promise.all(marked.walkTokens(G,$.walkTokens)).then(()=>G):G).then(G=>_(G,$)).then(G=>$.hooks?$.hooks.postprocess(G):G).catch(V);try{$.hooks&&(M=$.hooks.preprocess(M));const G=q(M,$);$.walkTokens&&marked.walkTokens(G,$.walkTokens);let X=_(G,$);return $.hooks&&(X=$.hooks.postprocess(X)),X}catch(G){return V(G)}}}function marked(q,_,M){return parseMarkdown(Lexer.lex,Parser.parse)(q,_,M)}marked.options=marked.setOptions=function(q){return marked.defaults={...marked.defaults,...q},changeDefaults(marked.defaults),marked};marked.getDefaults=getDefaults;marked.defaults=defaults;marked.use=function(...q){const _=marked.defaults.extensions||{renderers:{},childTokens:{}};q.forEach(M=>{const $={...M};if($.async=marked.defaults.async||$.async||!1,M.extensions&&(M.extensions.forEach(j=>{if(!j.name)throw new Error("extension name required");if(j.renderer){const z=_.renderers[j.name];z?_.renderers[j.name]=function(...V){let G=j.renderer.apply(this,V);return G===!1&&(G=z.apply(this,V)),G}:_.renderers[j.name]=j.renderer}if(j.tokenizer){if(!j.level||j.level!=="block"&&j.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");_[j.level]?_[j.level].unshift(j.tokenizer):_[j.level]=[j.tokenizer],j.start&&(j.level==="block"?_.startBlock?_.startBlock.push(j.start):_.startBlock=[j.start]:j.level==="inline"&&(_.startInline?_.startInline.push(j.start):_.startInline=[j.start]))}j.childTokens&&(_.childTokens[j.name]=j.childTokens)}),$.extensions=_),M.renderer){const j=marked.defaults.renderer||new Renderer;for(const z in M.renderer){const V=j[z];j[z]=(...G)=>{let X=M.renderer[z].apply(j,G);return X===!1&&(X=V.apply(j,G)),X}}$.renderer=j}if(M.tokenizer){const j=marked.defaults.tokenizer||new Tokenizer;for(const z in M.tokenizer){const V=j[z];j[z]=(...G)=>{let X=M.tokenizer[z].apply(j,G);return X===!1&&(X=V.apply(j,G)),X}}$.tokenizer=j}if(M.hooks){const j=marked.defaults.hooks||new Hooks;for(const z in M.hooks){const V=j[z];Hooks.passThroughHooks.has(z)?j[z]=G=>{if(marked.defaults.async)return Promise.resolve(M.hooks[z].call(j,G)).then(Y=>V.call(j,Y));const X=M.hooks[z].call(j,G);return V.call(j,X)}:j[z]=(...G)=>{let X=M.hooks[z].apply(j,G);return X===!1&&(X=V.apply(j,G)),X}}$.hooks=j}if(M.walkTokens){const j=marked.defaults.walkTokens;$.walkTokens=function(z){let V=[];return V.push(M.walkTokens.call(this,z)),j&&(V=V.concat(j.call(this,z))),V}}marked.setOptions($)})};marked.walkTokens=function(q,_){let M=[];for(const $ of q)switch(M=M.concat(_.call(marked,$)),$.type){case"table":{for(const j of $.header)M=M.concat(marked.walkTokens(j.tokens,_));for(const j of $.rows)for(const z of j)M=M.concat(marked.walkTokens(z.tokens,_));break}case"list":{M=M.concat(marked.walkTokens($.items,_));break}default:marked.defaults.extensions&&marked.defaults.extensions.childTokens&&marked.defaults.extensions.childTokens[$.type]?marked.defaults.extensions.childTokens[$.type].forEach(function(j){M=M.concat(marked.walkTokens($[j],_))}):$.tokens&&(M=M.concat(marked.walkTokens($.tokens,_)))}return M};marked.parseInline=parseMarkdown(Lexer.lexInline,Parser.parseInline);marked.Parser=Parser;marked.parser=Parser.parse;marked.Renderer=Renderer;marked.TextRenderer=TextRenderer;marked.Lexer=Lexer;marked.lexer=Lexer.lex;marked.Tokenizer=Tokenizer;marked.Slugger=Slugger;marked.Hooks=Hooks;marked.parse=marked;marked.options;marked.setOptions;marked.use;marked.walkTokens;marked.parseInline;Parser.parse;Lexer.lex;const key={};function create_else_block$f(q){let _;return{c(){_=text(q[1])},m(M,$){insert(M,_,$)},p(M,$){$&2&&set_data(_,M[1])},i:noop,o:noop,d(M){M&&detach(_)}}}function create_if_block_5$6(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h6"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block_4$9(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h5"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block_3$b(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h4"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block_2$l(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h3"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block_1$q(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h2"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block$y(q){let _,M;const $=q[5].default,j=create_slot($,q,q[4],null);return{c(){_=element("h1"),j&&j.c(),attr(_,"id",q[2])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&16)&&update_slot_base(j,$,z,z[4],M?get_slot_changes($,z[4],V,null):get_all_dirty_from_scope(z[4]),null),(!M||V&4)&&attr(_,"id",z[2])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_fragment$Y(q){let _,M,$,j;const z=[create_if_block$y,create_if_block_1$q,create_if_block_2$l,create_if_block_3$b,create_if_block_4$9,create_if_block_5$6,create_else_block$f],V=[];function G(X,Y){return X[0]===1?0:X[0]===2?1:X[0]===3?2:X[0]===4?3:X[0]===5?4:X[0]===6?5:6}return _=G(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(X,Y){V[_].m(X,Y),insert(X,$,Y),j=!0},p(X,[Y]){let Q=_;_=G(X),_===Q?V[_].p(X,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(X,Y):(M=V[_]=z[_](X),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(X){j||(transition_in(M),j=!0)},o(X){transition_out(M),j=!1},d(X){V[_].d(X),X&&detach($)}}}function instance$W(q,_,M){let $,{$$slots:j={},$$scope:z}=_,{depth:V}=_,{raw:G}=_,{text:X}=_;const{slug:Y,getOptions:Q}=getContext(key),Z=Q();return q.$$set=ee=>{"depth"in ee&&M(0,V=ee.depth),"raw"in ee&&M(1,G=ee.raw),"text"in ee&&M(3,X=ee.text),"$$scope"in ee&&M(4,z=ee.$$scope)},q.$$.update=()=>{q.$$.dirty&8&&M(2,$=Z.headerIds?Z.headerPrefix+Y(X):void 0)},[V,G,$,X,z,j]}class Heading extends SvelteComponent{constructor(_){super(),init(this,_,instance$W,create_fragment$Y,safe_not_equal,{depth:0,raw:1,text:3})}}function create_fragment$X(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("p"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$V(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Paragraph extends SvelteComponent{constructor(_){super(),init(this,_,instance$V,create_fragment$X,safe_not_equal,{})}}function create_fragment$W(q){let _;const M=q[3].default,$=create_slot(M,q,q[2],null);return{c(){$&&$.c()},m(j,z){$&&$.m(j,z),_=!0},p(j,[z]){$&&$.p&&(!_||z&4)&&update_slot_base($,M,j,j[2],_?get_slot_changes(M,j[2],z,null):get_all_dirty_from_scope(j[2]),null)},i(j){_||(transition_in($,j),_=!0)},o(j){transition_out($,j),_=!1},d(j){$&&$.d(j)}}}function instance$U(q,_,M){let{$$slots:$={},$$scope:j}=_,{text:z}=_,{raw:V}=_;return q.$$set=G=>{"text"in G&&M(0,z=G.text),"raw"in G&&M(1,V=G.raw),"$$scope"in G&&M(2,j=G.$$scope)},[z,V,j,$]}class Text extends SvelteComponent{constructor(_){super(),init(this,_,instance$U,create_fragment$W,safe_not_equal,{text:0,raw:1})}}function create_fragment$V(q){let _,M;return{c(){_=element("img"),src_url_equal(_.src,M=q[0])||attr(_,"src",M),attr(_,"title",q[1]),attr(_,"alt",q[2])},m($,j){insert($,_,j)},p($,[j]){j&1&&!src_url_equal(_.src,M=$[0])&&attr(_,"src",M),j&2&&attr(_,"title",$[1]),j&4&&attr(_,"alt",$[2])},i:noop,o:noop,d($){$&&detach(_)}}}function instance$T(q,_,M){let{href:$=""}=_,{title:j=void 0}=_,{text:z=""}=_;return q.$$set=V=>{"href"in V&&M(0,$=V.href),"title"in V&&M(1,j=V.title),"text"in V&&M(2,z=V.text)},[$,j,z]}let Image$1=class extends SvelteComponent{constructor(_){super(),init(this,_,instance$T,create_fragment$V,safe_not_equal,{href:0,title:1,text:2})}};function create_fragment$U(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("a"),j&&j.c(),attr(_,"href",q[0]),attr(_,"title",q[1])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null),(!M||V&1)&&attr(_,"href",z[0]),(!M||V&2)&&attr(_,"title",z[1])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$S(q,_,M){let{$$slots:$={},$$scope:j}=_,{href:z=""}=_,{title:V=void 0}=_;return q.$$set=G=>{"href"in G&&M(0,z=G.href),"title"in G&&M(1,V=G.title),"$$scope"in G&&M(2,j=G.$$scope)},[z,V,j,$]}class Link extends SvelteComponent{constructor(_){super(),init(this,_,instance$S,create_fragment$U,safe_not_equal,{href:0,title:1})}}function create_fragment$T(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("em"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$R(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Em extends SvelteComponent{constructor(_){super(),init(this,_,instance$R,create_fragment$T,safe_not_equal,{})}}function create_fragment$S(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("del"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$Q(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Del extends SvelteComponent{constructor(_){super(),init(this,_,instance$Q,create_fragment$S,safe_not_equal,{})}}function create_fragment$R(q){let _,M=q[0].replace(/`/g,"")+"",$;return{c(){_=element("code"),$=text(M)},m(j,z){insert(j,_,z),append(_,$)},p(j,[z]){z&1&&M!==(M=j[0].replace(/`/g,"")+"")&&set_data($,M)},i:noop,o:noop,d(j){j&&detach(_)}}}function instance$P(q,_,M){let{raw:$}=_;return q.$$set=j=>{"raw"in j&&M(0,$=j.raw)},[$]}class Codespan extends SvelteComponent{constructor(_){super(),init(this,_,instance$P,create_fragment$R,safe_not_equal,{raw:0})}}function create_fragment$Q(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("strong"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$O(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Strong extends SvelteComponent{constructor(_){super(),init(this,_,instance$O,create_fragment$Q,safe_not_equal,{})}}function create_fragment$P(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("table"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$N(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Table extends SvelteComponent{constructor(_){super(),init(this,_,instance$N,create_fragment$P,safe_not_equal,{})}}function create_fragment$O(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("thead"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$M(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class TableHead extends SvelteComponent{constructor(_){super(),init(this,_,instance$M,create_fragment$O,safe_not_equal,{})}}function create_fragment$N(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("tbody"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$L(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class TableBody extends SvelteComponent{constructor(_){super(),init(this,_,instance$L,create_fragment$N,safe_not_equal,{})}}function create_fragment$M(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("tr"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$K(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class TableRow extends SvelteComponent{constructor(_){super(),init(this,_,instance$K,create_fragment$M,safe_not_equal,{})}}function create_else_block$e(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("td"),j&&j.c(),attr(_,"align",q[1])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null),(!M||V&2)&&attr(_,"align",z[1])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block$x(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("th"),j&&j.c(),attr(_,"align",q[1])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null),(!M||V&2)&&attr(_,"align",z[1])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_fragment$L(q){let _,M,$,j;const z=[create_if_block$x,create_else_block$e],V=[];function G(X,Y){return X[0]?0:1}return _=G(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(X,Y){V[_].m(X,Y),insert(X,$,Y),j=!0},p(X,[Y]){let Q=_;_=G(X),_===Q?V[_].p(X,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(X,Y):(M=V[_]=z[_](X),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(X){j||(transition_in(M),j=!0)},o(X){transition_out(M),j=!1},d(X){V[_].d(X),X&&detach($)}}}function instance$J(q,_,M){let{$$slots:$={},$$scope:j}=_,{header:z}=_,{align:V}=_;return q.$$set=G=>{"header"in G&&M(0,z=G.header),"align"in G&&M(1,V=G.align),"$$scope"in G&&M(2,j=G.$$scope)},[z,V,j,$]}class TableCell extends SvelteComponent{constructor(_){super(),init(this,_,instance$J,create_fragment$L,safe_not_equal,{header:0,align:1})}}function create_else_block$d(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("ul"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_if_block$w(q){let _,M;const $=q[3].default,j=create_slot($,q,q[2],null);return{c(){_=element("ol"),j&&j.c(),attr(_,"start",q[1])},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,V){j&&j.p&&(!M||V&4)&&update_slot_base(j,$,z,z[2],M?get_slot_changes($,z[2],V,null):get_all_dirty_from_scope(z[2]),null),(!M||V&2)&&attr(_,"start",z[1])},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function create_fragment$K(q){let _,M,$,j;const z=[create_if_block$w,create_else_block$d],V=[];function G(X,Y){return X[0]?0:1}return _=G(q),M=V[_]=z[_](q),{c(){M.c(),$=empty()},m(X,Y){V[_].m(X,Y),insert(X,$,Y),j=!0},p(X,[Y]){let Q=_;_=G(X),_===Q?V[_].p(X,Y):(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros(),M=V[_],M?M.p(X,Y):(M=V[_]=z[_](X),M.c()),transition_in(M,1),M.m($.parentNode,$))},i(X){j||(transition_in(M),j=!0)},o(X){transition_out(M),j=!1},d(X){V[_].d(X),X&&detach($)}}}function instance$I(q,_,M){let{$$slots:$={},$$scope:j}=_,{ordered:z}=_,{start:V}=_;return q.$$set=G=>{"ordered"in G&&M(0,z=G.ordered),"start"in G&&M(1,V=G.start),"$$scope"in G&&M(2,j=G.$$scope)},[z,V,j,$]}class List extends SvelteComponent{constructor(_){super(),init(this,_,instance$I,create_fragment$K,safe_not_equal,{ordered:0,start:1})}}function create_fragment$J(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("li"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$H(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class ListItem extends SvelteComponent{constructor(_){super(),init(this,_,instance$H,create_fragment$J,safe_not_equal,{})}}function create_fragment$I(q){let _;return{c(){_=element("hr")},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}class Hr extends SvelteComponent{constructor(_){super(),init(this,_,null,create_fragment$I,safe_not_equal,{})}}function create_fragment$H(q){let _,M;return{c(){_=new HtmlTag(!1),M=empty(),_.a=M},m($,j){_.m(q[0],$,j),insert($,M,j)},p($,[j]){j&1&&_.p($[0])},i:noop,o:noop,d($){$&&detach(M),$&&_.d()}}}function instance$G(q,_,M){let{text:$}=_;return q.$$set=j=>{"text"in j&&M(0,$=j.text)},[$]}class Html extends SvelteComponent{constructor(_){super(),init(this,_,instance$G,create_fragment$H,safe_not_equal,{text:0})}}function create_fragment$G(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("blockquote"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$F(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Blockquote extends SvelteComponent{constructor(_){super(),init(this,_,instance$F,create_fragment$G,safe_not_equal,{})}}function create_fragment$F(q){let _,M,$;return{c(){_=element("pre"),M=element("code"),$=text(q[1]),attr(_,"class",q[0])},m(j,z){insert(j,_,z),append(_,M),append(M,$)},p(j,[z]){z&2&&set_data($,j[1]),z&1&&attr(_,"class",j[0])},i:noop,o:noop,d(j){j&&detach(_)}}}function instance$E(q,_,M){let{lang:$}=_,{text:j}=_;return q.$$set=z=>{"lang"in z&&M(0,$=z.lang),"text"in z&&M(1,j=z.text)},[$,j]}class Code extends SvelteComponent{constructor(_){super(),init(this,_,instance$E,create_fragment$F,safe_not_equal,{lang:0,text:1})}}function create_fragment$E(q){let _,M;const $=q[1].default,j=create_slot($,q,q[0],null);return{c(){_=element("br"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(z,V),M=!0},p(z,[V]){j&&j.p&&(!M||V&1)&&update_slot_base(j,$,z,z[0],M?get_slot_changes($,z[0],V,null):get_all_dirty_from_scope(z[0]),null)},i(z){M||(transition_in(j,z),M=!0)},o(z){transition_out(j,z),M=!1},d(z){z&&detach(_),j&&j.d(z)}}}function instance$D(q,_,M){let{$$slots:$={},$$scope:j}=_;return q.$$set=z=>{"$$scope"in z&&M(0,j=z.$$scope)},[j,$]}class Br extends SvelteComponent{constructor(_){super(),init(this,_,instance$D,create_fragment$E,safe_not_equal,{})}}const defaultRenderers={heading:Heading,paragraph:Paragraph,text:Text,image:Image$1,link:Link,em:Em,strong:Strong,codespan:Codespan,del:Del,table:Table,tablehead:TableHead,tablebody:TableBody,tablerow:TableRow,tablecell:TableCell,list:List,orderedlistitem:null,unorderedlistitem:null,listitem:ListItem,hr:Hr,html:Html,blockquote:Blockquote,code:Code,br:Br},defaultOptions={baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,xhtml:!1};function create_fragment$D(q){let _,M;return _=new Parser$1({props:{tokens:q[0],renderers:q[1]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,[j]){const z={};j&1&&(z.tokens=$[0]),j&2&&(z.renderers=$[1]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function instance$C(q,_,M){let $,j,z,V,{source:G=[]}=_,{renderers:X={}}=_,{options:Y={}}=_,{isInline:Q=!1}=_;const Z=createEventDispatcher();let ee,te,ne;return setContext(key,{slug:re=>j?j.slug(re):"",getOptions:()=>z}),onMount(()=>{M(7,ne=!0)}),q.$$set=re=>{"source"in re&&M(2,G=re.source),"renderers"in re&&M(3,X=re.renderers),"options"in re&&M(4,Y=re.options),"isInline"in re&&M(5,Q=re.isInline)},q.$$.update=()=>{q.$$.dirty&4&&M(8,$=Array.isArray(G)),q.$$.dirty&4&&(j=G?new Slugger:void 0),q.$$.dirty&16&&M(9,z={...defaultOptions,...Y}),q.$$.dirty&869&&($?M(0,ee=G):(M(6,te=new Lexer(z)),M(0,ee=Q?te.inlineTokens(G):te.lex(G)),Z("parsed",{tokens:ee}))),q.$$.dirty&8&&M(1,V={...defaultRenderers,...X}),q.$$.dirty&385&&ne&&!$&&Z("parsed",{tokens:ee})},[ee,V,G,X,Y,Q,te,ne,$,z]}class SvelteMarkdown extends SvelteComponent{constructor(_){super(),init(this,_,instance$C,create_fragment$D,safe_not_equal,{source:2,renderers:3,options:4,isInline:5})}}function commonjsRequire(q){throw new Error('Could not dynamically require "'+q+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};(function(module,exports){(function(_,M){module.exports=_.pdfjsLib=M()})(globalThis,()=>(()=>{var __webpack_modules__=[,(q,_)=>{var ft;Object.defineProperty(_,"__esModule",{value:!0}),_.VerbosityLevel=_.Util=_.UnknownErrorException=_.UnexpectedResponseException=_.TextRenderingMode=_.RenderingIntentFlag=_.PromiseCapability=_.PermissionFlag=_.PasswordResponses=_.PasswordException=_.PageActionEventType=_.OPS=_.MissingPDFException=_.MAX_IMAGE_SIZE_TO_CACHE=_.LINE_FACTOR=_.LINE_DESCENT_FACTOR=_.InvalidPDFException=_.ImageKind=_.IDENTITY_MATRIX=_.FormatError=_.FeatureTest=_.FONT_IDENTITY_MATRIX=_.DocumentActionEventType=_.CMapCompressionType=_.BaseException=_.BASELINE_FACTOR=_.AnnotationType=_.AnnotationReplyType=_.AnnotationPrefix=_.AnnotationMode=_.AnnotationFlag=_.AnnotationFieldFlag=_.AnnotationEditorType=_.AnnotationEditorPrefix=_.AnnotationEditorParamsType=_.AnnotationBorderStyleType=_.AnnotationActionEventType=_.AbortException=void 0,_.assert=Ne,_.bytesToString=Ue,_.createValidAbsoluteUrl=Ie,_.getModificationDate=pt,_.getUuid=It,_.getVerbosityLevel=Pe,_.info=ze,_.isArrayBuffer=Qe,_.isArrayEqual=dt,_.isNodeJS=void 0,_.normalizeUnicode=xt,_.objectFromMap=We,_.objectSize=_e,_.setVerbosityLevel=ue,_.shadow=Oe,_.string32=rt,_.stringToBytes=nt,_.stringToPDFString=$e,_.stringToUTF8String=je,_.unreachable=Me,_.utf8StringToString=Ke,_.warn=Le;const M=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");_.isNodeJS=M;const $=[1,0,0,1,0,0];_.IDENTITY_MATRIX=$;const j=[.001,0,0,.001,0,0];_.FONT_IDENTITY_MATRIX=j;const z=1e7;_.MAX_IMAGE_SIZE_TO_CACHE=z;const V=1.35;_.LINE_FACTOR=V;const G=.35;_.LINE_DESCENT_FACTOR=G;const X=G/V;_.BASELINE_FACTOR=X;const Y={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};_.RenderingIntentFlag=Y;const Q={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};_.AnnotationMode=Q;const Z="pdfjs_internal_editor_";_.AnnotationEditorPrefix=Z;const ee={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};_.AnnotationEditorType=ee;const te={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};_.AnnotationEditorParamsType=te;const ne={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};_.PermissionFlag=ne;const re={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};_.TextRenderingMode=re;const ie={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};_.ImageKind=ie;const se={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};_.AnnotationType=se;const le={GROUP:"Group",REPLY:"R"};_.AnnotationReplyType=le;const he={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};_.AnnotationFlag=he;const ce={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};_.AnnotationFieldFlag=ce;const ae={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};_.AnnotationBorderStyleType=ae;const de={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};_.AnnotationActionEventType=de;const ge={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};_.DocumentActionEventType=ge;const fe={O:"PageOpen",C:"PageClose"};_.PageActionEventType=fe;const oe={ERRORS:0,WARNINGS:1,INFOS:5};_.VerbosityLevel=oe;const we={NONE:0,BINARY:1};_.CMapCompressionType=we;const De={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};_.OPS=De;const ve={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};_.PasswordResponses=ve;let Ce=oe.WARNINGS;function ue(lt){Number.isInteger(lt)&&(Ce=lt)}function Pe(){return Ce}function ze(lt){Ce>=oe.INFOS&&console.log(`Info: ${lt}`)}function Le(lt){Ce>=oe.WARNINGS&&console.log(`Warning: ${lt}`)}function Me(lt){throw new Error(lt)}function Ne(lt,et){lt||Me(et)}function Ye(lt){switch(lt==null?void 0:lt.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Ie(lt,et=null,tt=null){if(!lt)return null;try{if(tt&&typeof lt=="string"){if(tt.addDefaultProtocol&&lt.startsWith("www.")){const gt=lt.match(/\./g);(gt==null?void 0:gt.length)>=2&&(lt=`http://${lt}`)}if(tt.tryConvertEncoding)try{lt=je(lt)}catch{}}const mt=et?new URL(lt,et):new URL(lt);if(Ye(mt))return mt}catch{}return null}function Oe(lt,et,tt,mt=!1){return Object.defineProperty(lt,et,{value:tt,enumerable:!mt,configurable:!0,writable:!1}),tt}const Se=function(){function et(tt,mt){this.constructor===et&&Me("Cannot initialize BaseException."),this.message=tt,this.name=mt}return et.prototype=new Error,et.constructor=et,et}();_.BaseException=Se;class pe extends Se{constructor(et,tt){super(et,"PasswordException"),this.code=tt}}_.PasswordException=pe;class me extends Se{constructor(et,tt){super(et,"UnknownErrorException"),this.details=tt}}_.UnknownErrorException=me;class be extends Se{constructor(et){super(et,"InvalidPDFException")}}_.InvalidPDFException=be;class Ee extends Se{constructor(et){super(et,"MissingPDFException")}}_.MissingPDFException=Ee;class ke extends Se{constructor(et,tt){super(et,"UnexpectedResponseException"),this.status=tt}}_.UnexpectedResponseException=ke;class Fe extends Se{constructor(et){super(et,"FormatError")}}_.FormatError=Fe;class Be extends Se{constructor(et){super(et,"AbortException")}}_.AbortException=Be;function Ue(lt){(typeof lt!="object"||(lt==null?void 0:lt.length)===void 0)&&Me("Invalid argument for bytesToString");const et=lt.length,tt=8192;if(et<tt)return String.fromCharCode.apply(null,lt);const mt=[];for(let gt=0;gt<et;gt+=tt){const Ut=Math.min(gt+tt,et),jt=lt.subarray(gt,Ut);mt.push(String.fromCharCode.apply(null,jt))}return mt.join("")}function nt(lt){typeof lt!="string"&&Me("Invalid argument for stringToBytes");const et=lt.length,tt=new Uint8Array(et);for(let mt=0;mt<et;++mt)tt[mt]=lt.charCodeAt(mt)&255;return tt}function rt(lt){return String.fromCharCode(lt>>24&255,lt>>16&255,lt>>8&255,lt&255)}function _e(lt){return Object.keys(lt).length}function We(lt){const et=Object.create(null);for(const[tt,mt]of lt)et[tt]=mt;return et}function Xe(){const lt=new Uint8Array(4);return lt[0]=1,new Uint32Array(lt.buffer,0,1)[0]===1}function Te(){try{return new Function(""),!0}catch{return!1}}class Re{static get isLittleEndian(){return Oe(this,"isLittleEndian",Xe())}static get isEvalSupported(){return Oe(this,"isEvalSupported",Te())}static get isOffscreenCanvasSupported(){return Oe(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?Oe(this,"platform",{isWin:!1,isMac:!1}):Oe(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var et,tt;return Oe(this,"isCSSRoundSupported",(tt=(et=globalThis.CSS)==null?void 0:et.supports)==null?void 0:tt.call(et,"width: round(1.5px, 1px)"))}}_.FeatureTest=Re;const He=[...Array(256).keys()].map(lt=>lt.toString(16).padStart(2,"0"));class Ze{static makeHexColor(et,tt,mt){return`#${He[et]}${He[tt]}${He[mt]}`}static scaleMinMax(et,tt){let mt;et[0]?(et[0]<0&&(mt=tt[0],tt[0]=tt[1],tt[1]=mt),tt[0]*=et[0],tt[1]*=et[0],et[3]<0&&(mt=tt[2],tt[2]=tt[3],tt[3]=mt),tt[2]*=et[3],tt[3]*=et[3]):(mt=tt[0],tt[0]=tt[2],tt[2]=mt,mt=tt[1],tt[1]=tt[3],tt[3]=mt,et[1]<0&&(mt=tt[2],tt[2]=tt[3],tt[3]=mt),tt[2]*=et[1],tt[3]*=et[1],et[2]<0&&(mt=tt[0],tt[0]=tt[1],tt[1]=mt),tt[0]*=et[2],tt[1]*=et[2]),tt[0]+=et[4],tt[1]+=et[4],tt[2]+=et[5],tt[3]+=et[5]}static transform(et,tt){return[et[0]*tt[0]+et[2]*tt[1],et[1]*tt[0]+et[3]*tt[1],et[0]*tt[2]+et[2]*tt[3],et[1]*tt[2]+et[3]*tt[3],et[0]*tt[4]+et[2]*tt[5]+et[4],et[1]*tt[4]+et[3]*tt[5]+et[5]]}static applyTransform(et,tt){const mt=et[0]*tt[0]+et[1]*tt[2]+tt[4],gt=et[0]*tt[1]+et[1]*tt[3]+tt[5];return[mt,gt]}static applyInverseTransform(et,tt){const mt=tt[0]*tt[3]-tt[1]*tt[2],gt=(et[0]*tt[3]-et[1]*tt[2]+tt[2]*tt[5]-tt[4]*tt[3])/mt,Ut=(-et[0]*tt[1]+et[1]*tt[0]+tt[4]*tt[1]-tt[5]*tt[0])/mt;return[gt,Ut]}static getAxialAlignedBoundingBox(et,tt){const mt=this.applyTransform(et,tt),gt=this.applyTransform(et.slice(2,4),tt),Ut=this.applyTransform([et[0],et[3]],tt),jt=this.applyTransform([et[2],et[1]],tt);return[Math.min(mt[0],gt[0],Ut[0],jt[0]),Math.min(mt[1],gt[1],Ut[1],jt[1]),Math.max(mt[0],gt[0],Ut[0],jt[0]),Math.max(mt[1],gt[1],Ut[1],jt[1])]}static inverseTransform(et){const tt=et[0]*et[3]-et[1]*et[2];return[et[3]/tt,-et[1]/tt,-et[2]/tt,et[0]/tt,(et[2]*et[5]-et[4]*et[3])/tt,(et[4]*et[1]-et[5]*et[0])/tt]}static singularValueDecompose2dScale(et){const tt=[et[0],et[2],et[1],et[3]],mt=et[0]*tt[0]+et[1]*tt[2],gt=et[0]*tt[1]+et[1]*tt[3],Ut=et[2]*tt[0]+et[3]*tt[2],jt=et[2]*tt[1]+et[3]*tt[3],at=(mt+jt)/2,yt=Math.sqrt((mt+jt)**2-4*(mt*jt-Ut*gt))/2,Ft=at+yt||1,vt=at-yt||1;return[Math.sqrt(Ft),Math.sqrt(vt)]}static normalizeRect(et){const tt=et.slice(0);return et[0]>et[2]&&(tt[0]=et[2],tt[2]=et[0]),et[1]>et[3]&&(tt[1]=et[3],tt[3]=et[1]),tt}static intersect(et,tt){const mt=Math.max(Math.min(et[0],et[2]),Math.min(tt[0],tt[2])),gt=Math.min(Math.max(et[0],et[2]),Math.max(tt[0],tt[2]));if(mt>gt)return null;const Ut=Math.max(Math.min(et[1],et[3]),Math.min(tt[1],tt[3])),jt=Math.min(Math.max(et[1],et[3]),Math.max(tt[1],tt[3]));return Ut>jt?null:[mt,Ut,gt,jt]}static bezierBoundingBox(et,tt,mt,gt,Ut,jt,at,yt){const Ft=[],vt=[[],[]];let Tt,Pt,$t,bt,Lt,Ct,qe,Ae;for(let st=0;st<2;++st){if(st===0?(Pt=6*et-12*mt+6*Ut,Tt=-3*et+9*mt-9*Ut+3*at,$t=3*mt-3*et):(Pt=6*tt-12*gt+6*jt,Tt=-3*tt+9*gt-9*jt+3*yt,$t=3*gt-3*tt),Math.abs(Tt)<1e-12){if(Math.abs(Pt)<1e-12)continue;bt=-$t/Pt,0<bt&&bt<1&&Ft.push(bt);continue}qe=Pt*Pt-4*$t*Tt,Ae=Math.sqrt(qe),!(qe<0)&&(Lt=(-Pt+Ae)/(2*Tt),0<Lt&&Lt<1&&Ft.push(Lt),Ct=(-Pt-Ae)/(2*Tt),0<Ct&&Ct<1&&Ft.push(Ct))}let xe=Ft.length,Ve;const Je=xe;for(;xe--;)bt=Ft[xe],Ve=1-bt,vt[0][xe]=Ve*Ve*Ve*et+3*Ve*Ve*bt*mt+3*Ve*bt*bt*Ut+bt*bt*bt*at,vt[1][xe]=Ve*Ve*Ve*tt+3*Ve*Ve*bt*gt+3*Ve*bt*bt*jt+bt*bt*bt*yt;return vt[0][Je]=et,vt[1][Je]=tt,vt[0][Je+1]=at,vt[1][Je+1]=yt,vt[0].length=vt[1].length=Je+2,[Math.min(...vt[0]),Math.min(...vt[1]),Math.max(...vt[0]),Math.max(...vt[1])]}}_.Util=Ze;const ot=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function $e(lt){if(lt[0]>="ï"){let tt;if(lt[0]==="þ"&&lt[1]==="ÿ"?tt="utf-16be":lt[0]==="ÿ"&&lt[1]==="þ"?tt="utf-16le":lt[0]==="ï"&&lt[1]==="»"&&lt[2]==="¿"&&(tt="utf-8"),tt)try{const mt=new TextDecoder(tt,{fatal:!0}),gt=nt(lt);return mt.decode(gt)}catch(mt){Le(`stringToPDFString: "${mt}".`)}}const et=[];for(let tt=0,mt=lt.length;tt<mt;tt++){const gt=ot[lt.charCodeAt(tt)];et.push(gt?String.fromCharCode(gt):lt.charAt(tt))}return et.join("")}function je(lt){return decodeURIComponent(escape(lt))}function Ke(lt){return unescape(encodeURIComponent(lt))}function Qe(lt){return typeof lt=="object"&&(lt==null?void 0:lt.byteLength)!==void 0}function dt(lt,et){if(lt.length!==et.length)return!1;for(let tt=0,mt=lt.length;tt<mt;tt++)if(lt[tt]!==et[tt])return!1;return!0}function pt(lt=new Date){return[lt.getUTCFullYear().toString(),(lt.getUTCMonth()+1).toString().padStart(2,"0"),lt.getUTCDate().toString().padStart(2,"0"),lt.getUTCHours().toString().padStart(2,"0"),lt.getUTCMinutes().toString().padStart(2,"0"),lt.getUTCSeconds().toString().padStart(2,"0")].join("")}class wt{constructor(){Ge(this,ft,!1);this.promise=new Promise((et,tt)=>{this.resolve=mt=>{ut(this,ft,!0),et(mt)},this.reject=mt=>{ut(this,ft,!0),tt(mt)}})}get settled(){return ye(this,ft)}}ft=new WeakMap,_.PromiseCapability=wt;let St=null,Rt=null;function xt(lt){return St||(St=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Rt=new Map([["ﬅ","ſt"]])),lt.replaceAll(St,(et,tt,mt)=>tt?tt.normalize("NFKC"):Rt.get(mt))}function It(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const lt=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(lt);else for(let et=0;et<32;et++)lt[et]=Math.floor(Math.random()*255);return Ue(lt)}const ht="pdfjs_internal_id_";_.AnnotationPrefix=ht},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var q,M,$,j,Zt,V,hn,X,Y,Q,Z,ee,te,ne,re,ie,fn,le,he,Sn,ae,de;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(fe){if(typeof fe=="string"||fe instanceof URL?fe={url:fe}:(0,_util.isArrayBuffer)(fe)&&(fe={data:fe}),typeof fe!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!fe.url&&!fe.data&&!fe.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const oe=new PDFDocumentLoadingTask,{docId:we}=oe,De=fe.url?getUrlProp(fe.url):null,ve=fe.data?getDataProp(fe.data):null,Ce=fe.httpHeaders||null,ue=fe.withCredentials===!0,Pe=fe.password??null,ze=fe.range instanceof PDFDataRangeTransport?fe.range:null,Le=Number.isInteger(fe.rangeChunkSize)&&fe.rangeChunkSize>0?fe.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let Me=fe.worker instanceof PDFWorker?fe.worker:null;const Ne=fe.verbosity,Ye=typeof fe.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(fe.docBaseUrl)?fe.docBaseUrl:null,Ie=typeof fe.cMapUrl=="string"?fe.cMapUrl:null,Oe=fe.cMapPacked!==!1,Se=fe.CMapReaderFactory||DefaultCMapReaderFactory,pe=typeof fe.standardFontDataUrl=="string"?fe.standardFontDataUrl:null,me=fe.StandardFontDataFactory||DefaultStandardFontDataFactory,be=fe.stopAtErrors!==!0,Ee=Number.isInteger(fe.maxImageSize)&&fe.maxImageSize>-1?fe.maxImageSize:-1,ke=fe.isEvalSupported!==!1,Fe=typeof fe.isOffscreenCanvasSupported=="boolean"?fe.isOffscreenCanvasSupported:!_util.isNodeJS,Be=Number.isInteger(fe.canvasMaxAreaInBytes)?fe.canvasMaxAreaInBytes:-1,Ue=typeof fe.disableFontFace=="boolean"?fe.disableFontFace:_util.isNodeJS,nt=fe.fontExtraProperties===!0,rt=fe.enableXfa===!0,_e=fe.ownerDocument||globalThis.document,We=fe.disableRange===!0,Xe=fe.disableStream===!0,Te=fe.disableAutoFetch===!0,Re=fe.pdfBug===!0,He=ze?ze.length:fe.length??NaN,Ze=typeof fe.useSystemFonts=="boolean"?fe.useSystemFonts:!_util.isNodeJS&&!Ue,ot=typeof fe.useWorkerFetch=="boolean"?fe.useWorkerFetch:Se===_display_utils.DOMCMapReaderFactory&&me===_display_utils.DOMStandardFontDataFactory&&Ie&&pe&&(0,_display_utils.isValidFetchUrl)(Ie,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(pe,document.baseURI),$e=fe.canvasFactory||new DefaultCanvasFactory({ownerDocument:_e}),je=fe.filterFactory||new DefaultFilterFactory({docId:we,ownerDocument:_e}),Ke=null;(0,_util.setVerbosityLevel)(Ne);const Qe={canvasFactory:$e,filterFactory:je};if(ot||(Qe.cMapReaderFactory=new Se({baseUrl:Ie,isCompressed:Oe}),Qe.standardFontDataFactory=new me({baseUrl:pe})),!Me){const wt={verbosity:Ne,port:_worker_options.GlobalWorkerOptions.workerPort};Me=wt.port?PDFWorker.fromPort(wt):new PDFWorker(wt),oe._worker=Me}const dt={docId:we,apiVersion:"3.11.174",data:ve,password:Pe,disableAutoFetch:Te,rangeChunkSize:Le,length:He,docBaseUrl:Ye,enableXfa:rt,evaluatorOptions:{maxImageSize:Ee,disableFontFace:Ue,ignoreErrors:be,isEvalSupported:ke,isOffscreenCanvasSupported:Fe,canvasMaxAreaInBytes:Be,fontExtraProperties:nt,useSystemFonts:Ze,cMapUrl:ot?Ie:null,standardFontDataUrl:ot?pe:null}},pt={ignoreErrors:be,isEvalSupported:ke,disableFontFace:Ue,fontExtraProperties:nt,enableXfa:rt,ownerDocument:_e,disableAutoFetch:Te,pdfBug:Re,styleElement:Ke};return Me.promise.then(function(){if(oe.destroyed)throw new Error("Loading aborted");const wt=_fetchDocument(Me,dt),St=new Promise(function(Rt){let xt;ze?xt=new _transport_stream.PDFDataTransportStream({length:He,initialData:ze.initialData,progressiveDone:ze.progressiveDone,contentDispositionFilename:ze.contentDispositionFilename,disableRange:We,disableStream:Xe},ze):ve||(xt=(ht=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(ht):(0,_display_utils.isValidFetchUrl)(ht.url)?new _displayFetch_stream.PDFFetchStream(ht):new _displayNetwork.PDFNetworkStream(ht))({url:De,length:He,httpHeaders:Ce,withCredentials:ue,rangeChunkSize:Le,disableRange:We,disableStream:Xe})),Rt(xt)});return Promise.all([wt,St]).then(function([Rt,xt]){if(oe.destroyed)throw new Error("Loading aborted");const It=new _message_handler.MessageHandler(we,Rt,Me.port),ht=new WorkerTransport(It,oe,xt,pt,Qe);oe._transport=ht,It.send("Ready",null)})}).catch(oe._capability.reject),oe}async function _fetchDocument(fe,oe){if(fe.destroyed)throw new Error("Worker was destroyed");const we=await fe.messageHandler.sendWithPromise("GetDocRequest",oe,oe.data?[oe.data.buffer]:null);if(fe.destroyed)throw new Error("Worker was destroyed");return we}function getUrlProp(fe){if(fe instanceof URL)return fe.href;try{return new URL(fe,window.location).href}catch{if(_util.isNodeJS&&typeof fe=="string")return fe}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(fe){if(_util.isNodeJS&&typeof Buffer<"u"&&fe instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(fe instanceof Uint8Array&&fe.byteLength===fe.buffer.byteLength)return fe;if(typeof fe=="string")return(0,_util.stringToBytes)(fe);if(typeof fe=="object"&&!isNaN(fe==null?void 0:fe.length)||(0,_util.isArrayBuffer)(fe))return new Uint8Array(fe);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const _=class _{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${rn(_,q)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var oe,we,De;this.destroyed=!0;try{(oe=this._worker)!=null&&oe.port&&(this._worker._pendingDestroy=!0),await((we=this._transport)==null?void 0:we.destroy())}catch(ve){throw(De=this._worker)!=null&&De.port&&delete this._worker._pendingDestroy,ve}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};q=new WeakMap,Ge(_,q,0);let PDFDocumentLoadingTask=_;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(oe,we,De=!1,ve=null){this.length=oe,this.initialData=we,this.progressiveDone=De,this.contentDispositionFilename=ve,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(oe){this._rangeListeners.push(oe)}addProgressListener(oe){this._progressListeners.push(oe)}addProgressiveReadListener(oe){this._progressiveReadListeners.push(oe)}addProgressiveDoneListener(oe){this._progressiveDoneListeners.push(oe)}onDataRange(oe,we){for(const De of this._rangeListeners)De(oe,we)}onDataProgress(oe,we){this._readyCapability.promise.then(()=>{for(const De of this._progressListeners)De(oe,we)})}onDataProgressiveRead(oe){this._readyCapability.promise.then(()=>{for(const we of this._progressiveReadListeners)we(oe)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const oe of this._progressiveDoneListeners)oe()})}transportReady(){this._readyCapability.resolve()}requestDataRange(oe,we){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(oe,we){this._pdfInfo=oe,this._transport=we,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(De=>{if(!De)return De;const ve=[];for(const Ce in De)ve.push(...De[Ce]);return ve}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(oe){return this._transport.getPage(oe)}getPageIndex(oe){return this._transport.getPageIndex(oe)}getDestinations(){return this._transport.getDestinations()}getDestination(oe){return this._transport.getDestination(oe)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(oe=!1){return this._transport.startCleanup(oe||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(oe,we,De,ve=!1){Ge(this,j);Ge(this,V);Ge(this,M,null);Ge(this,$,!1);this._pageIndex=oe,this._pageInfo=we,this._transport=De,this._stats=ve?new _display_utils.StatTimer:null,this._pdfBug=ve,this.commonObjs=De.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:oe,rotation:we=this.rotate,offsetX:De=0,offsetY:ve=0,dontFlip:Ce=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:oe,rotation:we,offsetX:De,offsetY:ve,dontFlip:Ce})}getAnnotations({intent:oe="display"}={}){const we=this._transport.getRenderingIntent(oe);return this._transport.getAnnotations(this._pageIndex,we.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var oe;return((oe=this._transport._htmlForXfa)==null?void 0:oe.children[this._pageIndex])||null}render({canvasContext:oe,viewport:we,intent:De="display",annotationMode:ve=_util.AnnotationMode.ENABLE,transform:Ce=null,background:ue=null,optionalContentConfigPromise:Pe=null,annotationCanvasMap:ze=null,pageColors:Le=null,printAnnotationStorage:Me=null}){var me,be;(me=this._stats)==null||me.time("Overall");const Ne=this._transport.getRenderingIntent(De,ve,Me);ut(this,$,!1),it(this,V,hn).call(this),Pe||(Pe=this._transport.getOptionalContentConfig());let Ye=this._intentStates.get(Ne.cacheKey);Ye||(Ye=Object.create(null),this._intentStates.set(Ne.cacheKey,Ye)),Ye.streamReaderCancelTimeout&&(clearTimeout(Ye.streamReaderCancelTimeout),Ye.streamReaderCancelTimeout=null);const Ie=!!(Ne.renderingIntent&_util.RenderingIntentFlag.PRINT);Ye.displayReadyCapability||(Ye.displayReadyCapability=new _util.PromiseCapability,Ye.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(be=this._stats)==null||be.time("Page Request"),this._pumpOperatorList(Ne));const Oe=Ee=>{var ke,Fe;Ye.renderTasks.delete(Se),(this._maybeCleanupAfterRender||Ie)&&ut(this,$,!0),it(this,j,Zt).call(this,!Ie),Ee?(Se.capability.reject(Ee),this._abortOperatorList({intentState:Ye,reason:Ee instanceof Error?Ee:new Error(Ee)})):Se.capability.resolve(),(ke=this._stats)==null||ke.timeEnd("Rendering"),(Fe=this._stats)==null||Fe.timeEnd("Overall")},Se=new InternalRenderTask({callback:Oe,params:{canvasContext:oe,viewport:we,transform:Ce,background:ue},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:ze,operatorList:Ye.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!Ie,pdfBug:this._pdfBug,pageColors:Le});(Ye.renderTasks||(Ye.renderTasks=new Set)).add(Se);const pe=Se.task;return Promise.all([Ye.displayReadyCapability.promise,Pe]).then(([Ee,ke])=>{var Fe;if(this.destroyed){Oe();return}(Fe=this._stats)==null||Fe.time("Rendering"),Se.initializeGraphics({transparency:Ee,optionalContentConfig:ke}),Se.operatorListChanged()}).catch(Oe),pe}getOperatorList({intent:oe="display",annotationMode:we=_util.AnnotationMode.ENABLE,printAnnotationStorage:De=null}={}){var ze;function ve(){ue.operatorList.lastChunk&&(ue.opListReadCapability.resolve(ue.operatorList),ue.renderTasks.delete(Pe))}const Ce=this._transport.getRenderingIntent(oe,we,De,!0);let ue=this._intentStates.get(Ce.cacheKey);ue||(ue=Object.create(null),this._intentStates.set(Ce.cacheKey,ue));let Pe;return ue.opListReadCapability||(Pe=Object.create(null),Pe.operatorListChanged=ve,ue.opListReadCapability=new _util.PromiseCapability,(ue.renderTasks||(ue.renderTasks=new Set)).add(Pe),ue.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(ze=this._stats)==null||ze.time("Page Request"),this._pumpOperatorList(Ce)),ue.opListReadCapability.promise}streamTextContent({includeMarkedContent:oe=!1,disableNormalization:we=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:oe===!0,disableNormalization:we===!0},{highWaterMark:100,size(ve){return ve.items.length}})}getTextContent(oe={}){if(this._transport._htmlForXfa)return this.getXfa().then(De=>_xfa_text.XfaText.textContent(De));const we=this.streamTextContent(oe);return new Promise(function(De,ve){function Ce(){ue.read().then(function({value:ze,done:Le}){if(Le){De(Pe);return}Object.assign(Pe.styles,ze.styles),Pe.items.push(...ze.items),Ce()},ve)}const ue=we.getReader(),Pe={items:[],styles:Object.create(null)};Ce()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const oe=[];for(const we of this._intentStates.values())if(this._abortOperatorList({intentState:we,reason:new Error("Page was destroyed."),force:!0}),!we.opListReadCapability)for(const De of we.renderTasks)oe.push(De.completed),De.cancel();return this.objs.clear(),ut(this,$,!1),it(this,V,hn).call(this),Promise.all(oe)}cleanup(oe=!1){ut(this,$,!0);const we=it(this,j,Zt).call(this,!1);return oe&&we&&this._stats&&(this._stats=new _display_utils.StatTimer),we}_startRenderPage(oe,we){var ve,Ce;const De=this._intentStates.get(we);De&&((ve=this._stats)==null||ve.timeEnd("Page Request"),(Ce=De.displayReadyCapability)==null||Ce.resolve(oe))}_renderPageChunk(oe,we){for(let De=0,ve=oe.length;De<ve;De++)we.operatorList.fnArray.push(oe.fnArray[De]),we.operatorList.argsArray.push(oe.argsArray[De]);we.operatorList.lastChunk=oe.lastChunk,we.operatorList.separateAnnots=oe.separateAnnots;for(const De of we.renderTasks)De.operatorListChanged();oe.lastChunk&&it(this,j,Zt).call(this,!0)}_pumpOperatorList({renderingIntent:oe,cacheKey:we,annotationStorageSerializable:De}){const{map:ve,transfers:Ce}=De,Pe=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:oe,cacheKey:we,annotationStorage:ve},Ce).getReader(),ze=this._intentStates.get(we);ze.streamReader=Pe;const Le=()=>{Pe.read().then(({value:Me,done:Ne})=>{if(Ne){ze.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(Me,ze),Le())},Me=>{if(ze.streamReader=null,!this._transport.destroyed){if(ze.operatorList){ze.operatorList.lastChunk=!0;for(const Ne of ze.renderTasks)Ne.operatorListChanged();it(this,j,Zt).call(this,!0)}if(ze.displayReadyCapability)ze.displayReadyCapability.reject(Me);else if(ze.opListReadCapability)ze.opListReadCapability.reject(Me);else throw Me}})};Le()}_abortOperatorList({intentState:oe,reason:we,force:De=!1}){if(oe.streamReader){if(oe.streamReaderCancelTimeout&&(clearTimeout(oe.streamReaderCancelTimeout),oe.streamReaderCancelTimeout=null),!De){if(oe.renderTasks.size>0)return;if(we instanceof _display_utils.RenderingCancelledException){let ve=RENDERING_CANCELLED_TIMEOUT;we.extraDelay>0&&we.extraDelay<1e3&&(ve+=we.extraDelay),oe.streamReaderCancelTimeout=setTimeout(()=>{oe.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:oe,reason:we,force:!0})},ve);return}}if(oe.streamReader.cancel(new _util.AbortException(we.message)).catch(()=>{}),oe.streamReader=null,!this._transport.destroyed){for(const[ve,Ce]of this._intentStates)if(Ce===oe){this._intentStates.delete(ve);break}this.cleanup()}}}get stats(){return this._stats}}M=new WeakMap,$=new WeakMap,j=new WeakSet,Zt=function(oe=!1){if(it(this,V,hn).call(this),!ye(this,$)||this.destroyed)return!1;if(oe)return ut(this,M,setTimeout(()=>{ut(this,M,null),it(this,j,Zt).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:we,operatorList:De}of this._intentStates.values())if(we.size>0||!De.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),ut(this,$,!1),!0},V=new WeakSet,hn=function(){ye(this,M)&&(clearTimeout(ye(this,M)),ut(this,M,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){Ge(this,X,new Set);Ge(this,Y,Promise.resolve())}postMessage(oe,we){const De={data:structuredClone(oe,we?{transfer:we}:null)};ye(this,Y).then(()=>{for(const ve of ye(this,X))ve.call(this,De)})}addEventListener(oe,we){ye(this,X).add(we)}removeEventListener(oe,we){ye(this,X).delete(we)}terminate(){ye(this,X).clear()}}X=new WeakMap,Y=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const fe=(Q=document==null?void 0:document.currentScript)==null?void 0:Q.src;fe&&(PDFWorkerUtil.fallbackWorkerSrc=fe.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(fe,oe){let we;try{if(we=new URL(fe),!we.origin||we.origin==="null")return!1}catch{return!1}const De=new URL(oe,we);return we.origin===De.origin},PDFWorkerUtil.createCDNWrapper=function(fe){const oe=`importScripts("${fe}");`;return URL.createObjectURL(new Blob([oe]))}}const _PDFWorker=class _PDFWorker{constructor({name:fe=null,port:oe=null,verbosity:we=(0,_util.getVerbosityLevel)()}={}){var De;if(this.name=fe,this.destroyed=!1,this.verbosity=we,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,oe){if((De=ye(_PDFWorker,Z))!=null&&De.has(oe))throw new Error("Cannot use more than one PDFWorker per port.");(ye(_PDFWorker,Z)||ut(_PDFWorker,Z,new WeakMap)).set(oe,this),this._initializeFromPort(oe);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(fe){this._port=fe,this._messageHandler=new _message_handler.MessageHandler("main","worker",fe),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:fe}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,fe)||(fe=PDFWorkerUtil.createCDNWrapper(new URL(fe,window.location).href));const oe=new Worker(fe),we=new _message_handler.MessageHandler("main","worker",oe),De=()=>{oe.removeEventListener("error",ve),we.destroy(),oe.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},ve=()=>{this._webWorker||De()};oe.addEventListener("error",ve),we.on("test",ue=>{if(oe.removeEventListener("error",ve),this.destroyed){De();return}ue?(this._messageHandler=we,this._port=oe,this._webWorker=oe,this._readyCapability.resolve(),we.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),we.destroy(),oe.terminate())}),we.on("ready",ue=>{if(oe.removeEventListener("error",ve),this.destroyed){De();return}try{Ce()}catch{this._setupFakeWorker()}});const Ce=()=>{const ue=new Uint8Array;we.send("test",ue,[ue.buffer])};Ce();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(fe=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const oe=new LoopbackPort;this._port=oe;const we=`fake${PDFWorkerUtil.fakeWorkerId++}`,De=new _message_handler.MessageHandler(we+"_worker",we,oe);fe.setup(De,oe);const ve=new _message_handler.MessageHandler(we,we+"_worker",oe);this._messageHandler=ve,this._readyCapability.resolve(),ve.send("configure",{verbosity:this.verbosity})}).catch(fe=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${fe.message}".`))})}destroy(){var fe;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(fe=ye(_PDFWorker,Z))==null||fe.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(fe){var we;if(!(fe!=null&&fe.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const oe=(we=ye(this,Z))==null?void 0:we.get(fe.port);if(oe){if(oe._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return oe}return new _PDFWorker(fe)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var fe;try{return((fe=globalThis.pdfjsWorker)==null?void 0:fe.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};Z=new WeakMap,Ge(_PDFWorker,Z,void 0);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(oe,we,De,ve,Ce){Ge(this,ie);Ge(this,ee,new Map);Ge(this,te,new Map);Ge(this,ne,new Map);Ge(this,re,null);this.messageHandler=oe,this.loadingTask=we,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:ve.ownerDocument,styleElement:ve.styleElement}),this._params=ve,this.canvasFactory=Ce.canvasFactory,this.filterFactory=Ce.filterFactory,this.cMapReaderFactory=Ce.cMapReaderFactory,this.standardFontDataFactory=Ce.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=De,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(oe,we=_util.AnnotationMode.ENABLE,De=null,ve=!1){let Ce=_util.RenderingIntentFlag.DISPLAY,ue=_annotation_storage.SerializableEmpty;switch(oe){case"any":Ce=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":Ce=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${oe}`)}switch(we){case _util.AnnotationMode.DISABLE:Ce+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:Ce+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:Ce+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,ue=(Ce&_util.RenderingIntentFlag.PRINT&&De instanceof _annotation_storage.PrintAnnotationStorage?De:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${we}`)}return ve&&(Ce+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:Ce,cacheKey:`${Ce}_${ue.hash}`,annotationStorageSerializable:ue}}destroy(){var De;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(De=ye(this,re))==null||De.reject(new Error("Worker was destroyed during onPassword callback"));const oe=[];for(const ve of ye(this,te).values())oe.push(ve._destroy());ye(this,te).clear(),ye(this,ne).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const we=this.messageHandler.sendWithPromise("Terminate",null);return oe.push(we),Promise.all(oe).then(()=>{var ve;this.commonObjs.clear(),this.fontLoader.clear(),ye(this,ee).clear(),this.filterFactory.destroy(),(ve=this._networkStream)==null||ve.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:oe,loadingTask:we}=this;oe.on("GetReader",(De,ve)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=Ce=>{this._lastProgress={loaded:Ce.loaded,total:Ce.total}},ve.onPull=()=>{this._fullReader.read().then(function({value:Ce,done:ue}){if(ue){ve.close();return}(0,_util.assert)(Ce instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),ve.enqueue(new Uint8Array(Ce),1,[Ce])}).catch(Ce=>{ve.error(Ce)})},ve.onCancel=Ce=>{this._fullReader.cancel(Ce),ve.ready.catch(ue=>{if(!this.destroyed)throw ue})}}),oe.on("ReaderHeadersReady",De=>{const ve=new _util.PromiseCapability,Ce=this._fullReader;return Ce.headersReady.then(()=>{var ue;(!Ce.isStreamingSupported||!Ce.isRangeSupported)&&(this._lastProgress&&((ue=we.onProgress)==null||ue.call(we,this._lastProgress)),Ce.onProgress=Pe=>{var ze;(ze=we.onProgress)==null||ze.call(we,{loaded:Pe.loaded,total:Pe.total})}),ve.resolve({isStreamingSupported:Ce.isStreamingSupported,isRangeSupported:Ce.isRangeSupported,contentLength:Ce.contentLength})},ve.reject),ve.promise}),oe.on("GetRangeReader",(De,ve)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const Ce=this._networkStream.getRangeReader(De.begin,De.end);if(!Ce){ve.close();return}ve.onPull=()=>{Ce.read().then(function({value:ue,done:Pe}){if(Pe){ve.close();return}(0,_util.assert)(ue instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),ve.enqueue(new Uint8Array(ue),1,[ue])}).catch(ue=>{ve.error(ue)})},ve.onCancel=ue=>{Ce.cancel(ue),ve.ready.catch(Pe=>{if(!this.destroyed)throw Pe})}}),oe.on("GetDoc",({pdfInfo:De})=>{this._numPages=De.numPages,this._htmlForXfa=De.htmlForXfa,delete De.htmlForXfa,we._capability.resolve(new PDFDocumentProxy(De,this))}),oe.on("DocException",function(De){let ve;switch(De.name){case"PasswordException":ve=new _util.PasswordException(De.message,De.code);break;case"InvalidPDFException":ve=new _util.InvalidPDFException(De.message);break;case"MissingPDFException":ve=new _util.MissingPDFException(De.message);break;case"UnexpectedResponseException":ve=new _util.UnexpectedResponseException(De.message,De.status);break;case"UnknownErrorException":ve=new _util.UnknownErrorException(De.message,De.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}we._capability.reject(ve)}),oe.on("PasswordRequest",De=>{if(ut(this,re,new _util.PromiseCapability),we.onPassword){const ve=Ce=>{Ce instanceof Error?ye(this,re).reject(Ce):ye(this,re).resolve({password:Ce})};try{we.onPassword(ve,De.code)}catch(Ce){ye(this,re).reject(Ce)}}else ye(this,re).reject(new _util.PasswordException(De.message,De.code));return ye(this,re).promise}),oe.on("DataLoaded",De=>{var ve;(ve=we.onProgress)==null||ve.call(we,{loaded:De.length,total:De.length}),this.downloadInfoCapability.resolve(De)}),oe.on("StartRenderPage",De=>{if(this.destroyed)return;ye(this,te).get(De.pageIndex)._startRenderPage(De.transparency,De.cacheKey)}),oe.on("commonobj",([De,ve,Ce])=>{var ue;if(!this.destroyed&&!this.commonObjs.has(De))switch(ve){case"Font":const Pe=this._params;if("error"in Ce){const Me=Ce.error;(0,_util.warn)(`Error during font loading: ${Me}`),this.commonObjs.resolve(De,Me);break}const ze=Pe.pdfBug&&((ue=globalThis.FontInspector)!=null&&ue.enabled)?(Me,Ne)=>globalThis.FontInspector.fontAdded(Me,Ne):null,Le=new _font_loader.FontFaceObject(Ce,{isEvalSupported:Pe.isEvalSupported,disableFontFace:Pe.disableFontFace,ignoreErrors:Pe.ignoreErrors,inspectFont:ze});this.fontLoader.bind(Le).catch(Me=>oe.sendWithPromise("FontFallback",{id:De})).finally(()=>{!Pe.fontExtraProperties&&Le.data&&(Le.data=null),this.commonObjs.resolve(De,Le)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(De,Ce);break;default:throw new Error(`Got unknown common object type ${ve}`)}}),oe.on("obj",([De,ve,Ce,ue])=>{var ze;if(this.destroyed)return;const Pe=ye(this,te).get(ve);if(!Pe.objs.has(De))switch(Ce){case"Image":if(Pe.objs.resolve(De,ue),ue){let Le;if(ue.bitmap){const{width:Me,height:Ne}=ue;Le=Me*Ne*4}else Le=((ze=ue.data)==null?void 0:ze.length)||0;Le>_util.MAX_IMAGE_SIZE_TO_CACHE&&(Pe._maybeCleanupAfterRender=!0)}break;case"Pattern":Pe.objs.resolve(De,ue);break;default:throw new Error(`Got unknown object type ${Ce}`)}}),oe.on("DocProgress",De=>{var ve;this.destroyed||(ve=we.onProgress)==null||ve.call(we,{loaded:De.loaded,total:De.total})}),oe.on("FetchBuiltInCMap",De=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(De):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),oe.on("FetchStandardFontData",De=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(De):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var De;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:oe,transfers:we}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:oe,filename:((De=this._fullReader)==null?void 0:De.filename)??null},we).finally(()=>{this.annotationStorage.resetModified()})}getPage(oe){if(!Number.isInteger(oe)||oe<=0||oe>this._numPages)return Promise.reject(new Error("Invalid page request."));const we=oe-1,De=ye(this,ne).get(we);if(De)return De;const ve=this.messageHandler.sendWithPromise("GetPage",{pageIndex:we}).then(Ce=>{if(this.destroyed)throw new Error("Transport destroyed");const ue=new PDFPageProxy(we,Ce,this,this._params.pdfBug);return ye(this,te).set(we,ue),ue});return ye(this,ne).set(we,ve),ve}getPageIndex(oe){return typeof oe!="object"||oe===null||!Number.isInteger(oe.num)||oe.num<0||!Number.isInteger(oe.gen)||oe.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:oe.num,gen:oe.gen})}getAnnotations(oe,we){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:oe,intent:we})}getFieldObjects(){return it(this,ie,fn).call(this,"GetFieldObjects")}hasJSActions(){return it(this,ie,fn).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(oe){return typeof oe!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:oe})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return it(this,ie,fn).call(this,"GetDocJSActions")}getPageJSActions(oe){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:oe})}getStructTree(oe){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:oe})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(oe=>new _optional_content_config.OptionalContentConfig(oe))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const oe="GetMetadata",we=ye(this,ee).get(oe);if(we)return we;const De=this.messageHandler.sendWithPromise(oe,null).then(ve=>{var Ce,ue;return{info:ve[0],metadata:ve[1]?new _metadata.Metadata(ve[1]):null,contentDispositionFilename:((Ce=this._fullReader)==null?void 0:Ce.filename)??null,contentLength:((ue=this._fullReader)==null?void 0:ue.contentLength)??null}});return ye(this,ee).set(oe,De),De}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(oe=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const we of ye(this,te).values())if(!we.cleanup())throw new Error(`startCleanup: Page ${we.pageNumber} is currently rendering.`);this.commonObjs.clear(),oe||this.fontLoader.clear(),ye(this,ee).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:oe,enableXfa:we}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:oe,enableXfa:we})}}ee=new WeakMap,te=new WeakMap,ne=new WeakMap,re=new WeakMap,ie=new WeakSet,fn=function(oe,we=null){const De=ye(this,ee).get(oe);if(De)return De;const ve=this.messageHandler.sendWithPromise(oe,we);return ye(this,ee).set(oe,ve),ve};class PDFObjects{constructor(){Ge(this,he);Ge(this,le,Object.create(null))}get(oe,we=null){if(we){const ve=it(this,he,Sn).call(this,oe);return ve.capability.promise.then(()=>we(ve.data)),null}const De=ye(this,le)[oe];if(!(De!=null&&De.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${oe}.`);return De.data}has(oe){const we=ye(this,le)[oe];return(we==null?void 0:we.capability.settled)||!1}resolve(oe,we=null){const De=it(this,he,Sn).call(this,oe);De.data=we,De.capability.resolve()}clear(){var oe;for(const we in ye(this,le)){const{data:De}=ye(this,le)[we];(oe=De==null?void 0:De.bitmap)==null||oe.close()}ut(this,le,Object.create(null))}}le=new WeakMap,he=new WeakSet,Sn=function(oe){var we;return(we=ye(this,le))[oe]||(we[oe]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(oe){Ge(this,ae,null);ut(this,ae,oe),this.onContinue=null}get promise(){return ye(this,ae).capability.promise}cancel(oe=0){ye(this,ae).cancel(null,oe)}get separateAnnots(){const{separateAnnots:oe}=ye(this,ae).operatorList;if(!oe)return!1;const{annotationCanvasMap:we}=ye(this,ae);return oe.form||oe.canvas&&(we==null?void 0:we.size)>0}}ae=new WeakMap,exports.RenderTask=RenderTask;const ge=class ge{constructor({callback:oe,params:we,objs:De,commonObjs:ve,annotationCanvasMap:Ce,operatorList:ue,pageIndex:Pe,canvasFactory:ze,filterFactory:Le,useRequestAnimationFrame:Me=!1,pdfBug:Ne=!1,pageColors:Ye=null}){this.callback=oe,this.params=we,this.objs=De,this.commonObjs=ve,this.annotationCanvasMap=Ce,this.operatorListIdx=null,this.operatorList=ue,this._pageIndex=Pe,this.canvasFactory=ze,this.filterFactory=Le,this._pdfBug=Ne,this.pageColors=Ye,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=Me===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=we.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:oe=!1,optionalContentConfig:we}){var Pe,ze;if(this.cancelled)return;if(this._canvas){if(ye(ge,de).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");ye(ge,de).add(this._canvas)}this._pdfBug&&((Pe=globalThis.StepperManager)!=null&&Pe.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:De,viewport:ve,transform:Ce,background:ue}=this.params;this.gfx=new _canvas.CanvasGraphics(De,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:we},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:Ce,viewport:ve,transparency:oe,background:ue}),this.operatorListIdx=0,this.graphicsReady=!0,(ze=this.graphicsReadyCallback)==null||ze.call(this)}cancel(oe=null,we=0){var De;this.running=!1,this.cancelled=!0,(De=this.gfx)==null||De.endDrawing(),ye(ge,de).delete(this._canvas),this.callback(oe||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,we))}operatorListChanged(){var oe;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(oe=this.stepper)==null||oe.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),ye(ge,de).delete(this._canvas),this.callback())))}};de=new WeakMap,Ge(ge,de,new WeakSet);let InternalRenderTask=ge;const version="3.11.174";exports.version=version;const build="ce8716743";exports.build=build},(q,_,M)=>{var Y,Q,Z,lr,te;Object.defineProperty(_,"__esModule",{value:!0}),_.SerializableEmpty=_.PrintAnnotationStorage=_.AnnotationStorage=void 0;var $=M(1),j=M(4),z=M(8);const V=Object.freeze({map:null,hash:"",transfers:void 0});_.SerializableEmpty=V;class G{constructor(){Ge(this,Z);Ge(this,Y,!1);Ge(this,Q,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(re,ie){const se=ye(this,Q).get(re);return se===void 0?ie:Object.assign(ie,se)}getRawValue(re){return ye(this,Q).get(re)}remove(re){if(ye(this,Q).delete(re),ye(this,Q).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const ie of ye(this,Q).values())if(ie instanceof j.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(re,ie){const se=ye(this,Q).get(re);let le=!1;if(se!==void 0)for(const[he,ce]of Object.entries(ie))se[he]!==ce&&(le=!0,se[he]=ce);else le=!0,ye(this,Q).set(re,ie);le&&it(this,Z,lr).call(this),ie instanceof j.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(ie.constructor._type)}has(re){return ye(this,Q).has(re)}getAll(){return ye(this,Q).size>0?(0,$.objectFromMap)(ye(this,Q)):null}setAll(re){for(const[ie,se]of Object.entries(re))this.setValue(ie,se)}get size(){return ye(this,Q).size}resetModified(){ye(this,Y)&&(ut(this,Y,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new X(this)}get serializable(){if(ye(this,Q).size===0)return V;const re=new Map,ie=new z.MurmurHash3_64,se=[],le=Object.create(null);let he=!1;for(const[ce,ae]of ye(this,Q)){const de=ae instanceof j.AnnotationEditor?ae.serialize(!1,le):ae;de&&(re.set(ce,de),ie.update(`${ce}:${JSON.stringify(de)}`),he||(he=!!de.bitmap))}if(he)for(const ce of re.values())ce.bitmap&&se.push(ce.bitmap);return re.size>0?{map:re,hash:ie.hexdigest(),transfers:se}:V}}Y=new WeakMap,Q=new WeakMap,Z=new WeakSet,lr=function(){ye(this,Y)||(ut(this,Y,!0),typeof this.onSetModified=="function"&&this.onSetModified())},_.AnnotationStorage=G;class X extends G{constructor(ie){super();Ge(this,te,void 0);const{map:se,hash:le,transfers:he}=ie.serializable,ce=structuredClone(se,he?{transfer:he}:null);ut(this,te,{map:ce,hash:le,transfers:he})}get print(){(0,$.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return ye(this,te)}}te=new WeakMap,_.PrintAnnotationStorage=X},(q,_,M)=>{var X,Y,Q,Z,ee,te,ne,re,ie,se,le,he,ce,ae,de,Fn,fe,Tn,we,Pn,ve,Rn,ue,ur,ze,cr,Me,dr,Ye,xn,Oe,hr;Object.defineProperty(_,"__esModule",{value:!0}),_.AnnotationEditor=void 0;var $=M(5),j=M(1),z=M(6);const pe=class pe{constructor(be){Ge(this,de);Ge(this,fe);Ge(this,ve);Ge(this,ue);Ge(this,ze);Ge(this,Me);Ge(this,Ye);Ge(this,Oe);Ge(this,X,"");Ge(this,Y,!1);Ge(this,Q,null);Ge(this,Z,null);Ge(this,ee,null);Ge(this,te,!1);Ge(this,ne,null);Ge(this,re,this.focusin.bind(this));Ge(this,ie,this.focusout.bind(this));Ge(this,se,!1);Ge(this,le,!1);Ge(this,he,!1);Ht(this,"_initialOptions",Object.create(null));Ht(this,"_uiManager",null);Ht(this,"_focusEventsAllowed",!0);Ht(this,"_l10nPromise",null);Ge(this,ce,!1);Ge(this,ae,pe._zIndex++);this.constructor===pe&&(0,j.unreachable)("Cannot initialize AnnotationEditor."),this.parent=be.parent,this.id=be.id,this.width=this.height=null,this.pageIndex=be.parent.pageIndex,this.name=be.name,this.div=null,this._uiManager=be.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=be.isCentered,this._structTreeParentId=null;const{rotation:Ee,rawDims:{pageWidth:ke,pageHeight:Fe,pageX:Be,pageY:Ue}}=this.parent.viewport;this.rotation=Ee,this.pageRotation=(360+Ee-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[ke,Fe],this.pageTranslation=[Be,Ue];const[nt,rt]=this.parentDimensions;this.x=be.x/nt,this.y=be.y/rt,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,j.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(be){const Ee=new G({id:be.parent.getNextId(),parent:be.parent,uiManager:be._uiManager});Ee.annotationElementId=be.annotationElementId,Ee.deleted=!0,Ee._uiManager.addToAnnotationStorage(Ee)}static initialize(be,Ee=null){if(pe._l10nPromise||(pe._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(Fe=>[Fe,be.get(Fe)]))),Ee!=null&&Ee.strings)for(const Fe of Ee.strings)pe._l10nPromise.set(Fe,be.get(Fe));if(pe._borderLineWidth!==-1)return;const ke=getComputedStyle(document.documentElement);pe._borderLineWidth=parseFloat(ke.getPropertyValue("--outline-width"))||0}static updateDefaultParams(be,Ee){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(be){return!1}static paste(be,Ee){(0,j.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return ye(this,ce)}set _isDraggable(be){var Ee;ut(this,ce,be),(Ee=this.div)==null||Ee.classList.toggle("draggable",be)}center(){const[be,Ee]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*Ee/(be*2),this.y+=this.width*be/(Ee*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*Ee/(be*2),this.y-=this.width*be/(Ee*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(be){this._uiManager.addCommands(be)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=ye(this,ae)}setParent(be){be!==null&&(this.pageIndex=be.pageIndex,this.pageDimensions=be.pageDimensions),this.parent=be}focusin(be){this._focusEventsAllowed&&(ye(this,se)?ut(this,se,!1):this.parent.setSelected(this))}focusout(be){var ke;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const Ee=be.relatedTarget;Ee!=null&&Ee.closest(`#${this.id}`)||(be.preventDefault(),(ke=this.parent)!=null&&ke.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(be,Ee,ke,Fe){const[Be,Ue]=this.parentDimensions;[ke,Fe]=this.screenToPageTranslation(ke,Fe),this.x=(be+ke)/Be,this.y=(Ee+Fe)/Ue,this.fixAndSetPosition()}translate(be,Ee){it(this,de,Fn).call(this,this.parentDimensions,be,Ee)}translateInPage(be,Ee){it(this,de,Fn).call(this,this.pageDimensions,be,Ee),this.div.scrollIntoView({block:"nearest"})}drag(be,Ee){const[ke,Fe]=this.parentDimensions;if(this.x+=be/ke,this.y+=Ee/Fe,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:_e,y:We}=this.div.getBoundingClientRect();this.parent.findNewParent(this,_e,We)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:Be,y:Ue}=this;const[nt,rt]=it(this,fe,Tn).call(this);Be+=nt,Ue+=rt,this.div.style.left=`${(100*Be).toFixed(2)}%`,this.div.style.top=`${(100*Ue).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[be,Ee]=this.pageDimensions;let{x:ke,y:Fe,width:Be,height:Ue}=this;switch(Be*=be,Ue*=Ee,ke*=be,Fe*=Ee,this.rotation){case 0:ke=Math.max(0,Math.min(be-Be,ke)),Fe=Math.max(0,Math.min(Ee-Ue,Fe));break;case 90:ke=Math.max(0,Math.min(be-Ue,ke)),Fe=Math.min(Ee,Math.max(Be,Fe));break;case 180:ke=Math.min(be,Math.max(Be,ke)),Fe=Math.min(Ee,Math.max(Ue,Fe));break;case 270:ke=Math.min(be,Math.max(Ue,ke)),Fe=Math.max(0,Math.min(Ee-Be,Fe));break}this.x=ke/=be,this.y=Fe/=Ee;const[nt,rt]=it(this,fe,Tn).call(this);ke+=nt,Fe+=rt;const{style:_e}=this.div;_e.left=`${(100*ke).toFixed(2)}%`,_e.top=`${(100*Fe).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(be,Ee){var ke;return it(ke=pe,we,Pn).call(ke,be,Ee,this.parentRotation)}pageTranslationToScreen(be,Ee){var ke;return it(ke=pe,we,Pn).call(ke,be,Ee,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:be,pageDimensions:[Ee,ke]}=this,Fe=Ee*be,Be=ke*be;return j.FeatureTest.isCSSRoundSupported?[Math.round(Fe),Math.round(Be)]:[Fe,Be]}setDims(be,Ee){var Be;const[ke,Fe]=this.parentDimensions;this.div.style.width=`${(100*be/ke).toFixed(2)}%`,ye(this,te)||(this.div.style.height=`${(100*Ee/Fe).toFixed(2)}%`),(Be=ye(this,Q))==null||Be.classList.toggle("small",be<pe.SMALL_EDITOR_SIZE||Ee<pe.SMALL_EDITOR_SIZE)}fixDims(){const{style:be}=this.div,{height:Ee,width:ke}=be,Fe=ke.endsWith("%"),Be=!ye(this,te)&&Ee.endsWith("%");if(Fe&&Be)return;const[Ue,nt]=this.parentDimensions;Fe||(be.width=`${(100*parseFloat(ke)/Ue).toFixed(2)}%`),!ye(this,te)&&!Be&&(be.height=`${(100*parseFloat(Ee)/nt).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(ye(this,Q))return;const be=ut(this,Q,document.createElement("button"));be.className="altText";const Ee=await pe._l10nPromise.get("editor_alt_text_button_label");be.textContent=Ee,be.setAttribute("aria-label",Ee),be.tabIndex="0",be.addEventListener("contextmenu",z.noContextMenu),be.addEventListener("pointerdown",ke=>ke.stopPropagation()),be.addEventListener("click",ke=>{ke.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),be.addEventListener("keydown",ke=>{ke.target===be&&ke.key==="Enter"&&(ke.preventDefault(),this._uiManager.editAltText(this))}),it(this,Ye,xn).call(this),this.div.append(be),pe.SMALL_EDITOR_SIZE||(pe.SMALL_EDITOR_SIZE=Math.min(128,Math.round(be.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:ye(this,X),decorative:ye(this,Y)}}set altTextData({altText:be,decorative:Ee}){ye(this,X)===be&&ye(this,Y)===Ee||(ut(this,X,be),ut(this,Y,Ee),it(this,Ye,xn).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",ye(this,re)),this.div.addEventListener("focusout",ye(this,ie));const[be,Ee]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*Ee/be).toFixed(2)}%`,this.div.style.maxHeight=`${(100*be/Ee).toFixed(2)}%`);const[ke,Fe]=this.getInitialTranslation();return this.translate(ke,Fe),(0,$.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(be){const{isMac:Ee}=j.FeatureTest.platform;if(be.button!==0||be.ctrlKey&&Ee){be.preventDefault();return}ut(this,se,!0),it(this,Oe,hr).call(this,be)}moveInDOM(){var be;(be=this.parent)==null||be.moveEditorInDOM(this)}_setParentAndPosition(be,Ee,ke){be.changeParent(this),this.x=Ee,this.y=ke,this.fixAndSetPosition()}getRect(be,Ee){const ke=this.parentScale,[Fe,Be]=this.pageDimensions,[Ue,nt]=this.pageTranslation,rt=be/ke,_e=Ee/ke,We=this.x*Fe,Xe=this.y*Be,Te=this.width*Fe,Re=this.height*Be;switch(this.rotation){case 0:return[We+rt+Ue,Be-Xe-_e-Re+nt,We+rt+Te+Ue,Be-Xe-_e+nt];case 90:return[We+_e+Ue,Be-Xe+rt+nt,We+_e+Re+Ue,Be-Xe+rt+Te+nt];case 180:return[We-rt-Te+Ue,Be-Xe+_e+nt,We-rt+Ue,Be-Xe+_e+Re+nt];case 270:return[We-_e-Re+Ue,Be-Xe-rt-Te+nt,We-_e+Ue,Be-Xe-rt+nt];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(be,Ee){const[ke,Fe,Be,Ue]=be,nt=Be-ke,rt=Ue-Fe;switch(this.rotation){case 0:return[ke,Ee-Ue,nt,rt];case 90:return[ke,Ee-Fe,rt,nt];case 180:return[Be,Ee-Fe,nt,rt];case 270:return[Be,Ee-Ue,rt,nt];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){ut(this,he,!0)}disableEditMode(){ut(this,he,!1)}isInEditMode(){return ye(this,he)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var be,Ee;(be=this.div)==null||be.addEventListener("focusin",ye(this,re)),(Ee=this.div)==null||Ee.addEventListener("focusout",ye(this,ie))}serialize(be=!1,Ee=null){(0,j.unreachable)("An editor must be serializable")}static deserialize(be,Ee,ke){const Fe=new this.prototype.constructor({parent:Ee,id:Ee.getNextId(),uiManager:ke});Fe.rotation=be.rotation;const[Be,Ue]=Fe.pageDimensions,[nt,rt,_e,We]=Fe.getRectInCurrentCoords(be.rect,Ue);return Fe.x=nt/Be,Fe.y=rt/Ue,Fe.width=_e/Be,Fe.height=We/Ue,Fe}remove(){var be;this.div.removeEventListener("focusin",ye(this,re)),this.div.removeEventListener("focusout",ye(this,ie)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(be=ye(this,Q))==null||be.remove(),ut(this,Q,null),ut(this,Z,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(it(this,ue,ur).call(this),ye(this,ne).classList.remove("hidden"))}select(){var be;this.makeResizable(),(be=this.div)==null||be.classList.add("selectedEditor")}unselect(){var be,Ee,ke;(be=ye(this,ne))==null||be.classList.add("hidden"),(Ee=this.div)==null||Ee.classList.remove("selectedEditor"),(ke=this.div)!=null&&ke.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(be,Ee){}disableEditing(){ye(this,Q)&&(ye(this,Q).hidden=!0)}enableEditing(){ye(this,Q)&&(ye(this,Q).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return ye(this,le)}set isEditing(be){ut(this,le,be),this.parent&&(be?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(be,Ee){ut(this,te,!0);const ke=be/Ee,{style:Fe}=this.div;Fe.aspectRatio=ke,Fe.height="auto"}static get MIN_SIZE(){return 16}};X=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,re=new WeakMap,ie=new WeakMap,se=new WeakMap,le=new WeakMap,he=new WeakMap,ce=new WeakMap,ae=new WeakMap,de=new WeakSet,Fn=function([be,Ee],ke,Fe){[ke,Fe]=this.screenToPageTranslation(ke,Fe),this.x+=ke/be,this.y+=Fe/Ee,this.fixAndSetPosition()},fe=new WeakSet,Tn=function(){const[be,Ee]=this.parentDimensions,{_borderLineWidth:ke}=pe,Fe=ke/be,Be=ke/Ee;switch(this.rotation){case 90:return[-Fe,Be];case 180:return[Fe,Be];case 270:return[Fe,-Be];default:return[-Fe,-Be]}},we=new WeakSet,Pn=function(be,Ee,ke){switch(ke){case 90:return[Ee,-be];case 180:return[-be,-Ee];case 270:return[-Ee,be];default:return[be,Ee]}},ve=new WeakSet,Rn=function(be){switch(be){case 90:{const[Ee,ke]=this.pageDimensions;return[0,-Ee/ke,ke/Ee,0]}case 180:return[-1,0,0,-1];case 270:{const[Ee,ke]=this.pageDimensions;return[0,Ee/ke,-ke/Ee,0]}default:return[1,0,0,1]}},ue=new WeakSet,ur=function(){if(ye(this,ne))return;ut(this,ne,document.createElement("div")),ye(this,ne).classList.add("resizers");const be=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||be.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const Ee of be){const ke=document.createElement("div");ye(this,ne).append(ke),ke.classList.add("resizer",Ee),ke.addEventListener("pointerdown",it(this,ze,cr).bind(this,Ee)),ke.addEventListener("contextmenu",z.noContextMenu)}this.div.prepend(ye(this,ne))},ze=new WeakSet,cr=function(be,Ee){Ee.preventDefault();const{isMac:ke}=j.FeatureTest.platform;if(Ee.button!==0||Ee.ctrlKey&&ke)return;const Fe=it(this,Me,dr).bind(this,be),Be=this._isDraggable;this._isDraggable=!1;const Ue={passive:!0,capture:!0};window.addEventListener("pointermove",Fe,Ue);const nt=this.x,rt=this.y,_e=this.width,We=this.height,Xe=this.parent.div.style.cursor,Te=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(Ee.target).cursor;const Re=()=>{this._isDraggable=Be,window.removeEventListener("pointerup",Re),window.removeEventListener("blur",Re),window.removeEventListener("pointermove",Fe,Ue),this.parent.div.style.cursor=Xe,this.div.style.cursor=Te;const He=this.x,Ze=this.y,ot=this.width,$e=this.height;He===nt&&Ze===rt&&ot===_e&&$e===We||this.addCommands({cmd:()=>{this.width=ot,this.height=$e,this.x=He,this.y=Ze;const[je,Ke]=this.parentDimensions;this.setDims(je*ot,Ke*$e),this.fixAndSetPosition()},undo:()=>{this.width=_e,this.height=We,this.x=nt,this.y=rt;const[je,Ke]=this.parentDimensions;this.setDims(je*_e,Ke*We),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",Re),window.addEventListener("blur",Re)},Me=new WeakSet,dr=function(be,Ee){const[ke,Fe]=this.parentDimensions,Be=this.x,Ue=this.y,nt=this.width,rt=this.height,_e=pe.MIN_SIZE/ke,We=pe.MIN_SIZE/Fe,Xe=mt=>Math.round(mt*1e4)/1e4,Te=it(this,ve,Rn).call(this,this.rotation),Re=(mt,gt)=>[Te[0]*mt+Te[2]*gt,Te[1]*mt+Te[3]*gt],He=it(this,ve,Rn).call(this,360-this.rotation),Ze=(mt,gt)=>[He[0]*mt+He[2]*gt,He[1]*mt+He[3]*gt];let ot,$e,je=!1,Ke=!1;switch(be){case"topLeft":je=!0,ot=(mt,gt)=>[0,0],$e=(mt,gt)=>[mt,gt];break;case"topMiddle":ot=(mt,gt)=>[mt/2,0],$e=(mt,gt)=>[mt/2,gt];break;case"topRight":je=!0,ot=(mt,gt)=>[mt,0],$e=(mt,gt)=>[0,gt];break;case"middleRight":Ke=!0,ot=(mt,gt)=>[mt,gt/2],$e=(mt,gt)=>[0,gt/2];break;case"bottomRight":je=!0,ot=(mt,gt)=>[mt,gt],$e=(mt,gt)=>[0,0];break;case"bottomMiddle":ot=(mt,gt)=>[mt/2,gt],$e=(mt,gt)=>[mt/2,0];break;case"bottomLeft":je=!0,ot=(mt,gt)=>[0,gt],$e=(mt,gt)=>[mt,0];break;case"middleLeft":Ke=!0,ot=(mt,gt)=>[0,gt/2],$e=(mt,gt)=>[mt,gt/2];break}const Qe=ot(nt,rt),dt=$e(nt,rt);let pt=Re(...dt);const wt=Xe(Be+pt[0]),St=Xe(Ue+pt[1]);let Rt=1,xt=1,[It,ht]=this.screenToPageTranslation(Ee.movementX,Ee.movementY);if([It,ht]=Ze(It/ke,ht/Fe),je){const mt=Math.hypot(nt,rt);Rt=xt=Math.max(Math.min(Math.hypot(dt[0]-Qe[0]-It,dt[1]-Qe[1]-ht)/mt,1/nt,1/rt),_e/nt,We/rt)}else Ke?Rt=Math.max(_e,Math.min(1,Math.abs(dt[0]-Qe[0]-It)))/nt:xt=Math.max(We,Math.min(1,Math.abs(dt[1]-Qe[1]-ht)))/rt;const ft=Xe(nt*Rt),lt=Xe(rt*xt);pt=Re(...$e(ft,lt));const et=wt-pt[0],tt=St-pt[1];this.width=ft,this.height=lt,this.x=et,this.y=tt,this.setDims(ke*ft,Fe*lt),this.fixAndSetPosition()},Ye=new WeakSet,xn=async function(){var ke;const be=ye(this,Q);if(!be)return;if(!ye(this,X)&&!ye(this,Y)){be.classList.remove("done"),(ke=ye(this,Z))==null||ke.remove();return}pe._l10nPromise.get("editor_alt_text_edit_button_label").then(Fe=>{be.setAttribute("aria-label",Fe)});let Ee=ye(this,Z);if(!Ee){ut(this,Z,Ee=document.createElement("span")),Ee.className="tooltip",Ee.setAttribute("role","tooltip");const Fe=Ee.id=`alt-text-tooltip-${this.id}`;be.setAttribute("aria-describedby",Fe);const Be=100;be.addEventListener("mouseenter",()=>{ut(this,ee,setTimeout(()=>{ut(this,ee,null),ye(this,Z).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},Be))}),be.addEventListener("mouseleave",()=>{var Ue;clearTimeout(ye(this,ee)),ut(this,ee,null),(Ue=ye(this,Z))==null||Ue.classList.remove("show")})}be.classList.add("done"),Ee.innerText=ye(this,Y)?await pe._l10nPromise.get("editor_alt_text_decorative_tooltip"):ye(this,X),Ee.parentNode||be.append(Ee)},Oe=new WeakSet,hr=function(be){if(!this._isDraggable)return;const Ee=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let ke,Fe;Ee&&(ke={passive:!0,capture:!0},Fe=Ue=>{const[nt,rt]=this.screenToPageTranslation(Ue.movementX,Ue.movementY);this._uiManager.dragSelectedEditors(nt,rt)},window.addEventListener("pointermove",Fe,ke));const Be=()=>{if(window.removeEventListener("pointerup",Be),window.removeEventListener("blur",Be),Ee&&window.removeEventListener("pointermove",Fe,ke),ut(this,se,!1),!this._uiManager.endDragSession()){const{isMac:Ue}=j.FeatureTest.platform;be.ctrlKey&&!Ue||be.shiftKey||be.metaKey&&Ue?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",Be),window.addEventListener("blur",Be)},Ge(pe,we),Ht(pe,"_borderLineWidth",-1),Ht(pe,"_colorManager",new $.ColorManager),Ht(pe,"_zIndex",1),Ht(pe,"SMALL_EDITOR_SIZE",0);let V=pe;_.AnnotationEditor=V;class G extends V{constructor(be){super(be),this.annotationElementId=be.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(q,_,M)=>{var te,ne,re,ie,se,In,ce,ae,de,ge,fe,fr,De,ve,Ce,ue,Pe,ze,Le,Me,Ne,Ye,Ie,Oe,Se,pe,me,be,Ee,ke,Fe,Be,Ue,nt,rt,_e,We,Xe,Te,Re,He,Ze,ot,$e,je,Ke,Qe,pr,pt,Bn,St,Mn,xt,pn,ht,On,lt,Ln,tt,Gt,gt,sn,jt,mr,yt,_r,vt,Nn,Pt,an,bt,$n;Object.defineProperty(_,"__esModule",{value:!0}),_.KeyboardManager=_.CommandManager=_.ColorManager=_.AnnotationEditorUIManager=void 0,_.bindEvents=z,_.opacityToHex=V;var $=M(1),j=M(6);function z(qe,Ae,xe){for(const Ve of xe)Ae.addEventListener(Ve,qe[Ve].bind(qe))}function V(qe){return Math.round(Math.min(255,Math.max(1,255*qe))).toString(16).padStart(2,"0")}class G{constructor(){Ge(this,te,0)}getId(){return`${$.AnnotationEditorPrefix}${rn(this,te)._++}`}}te=new WeakMap;const he=class he{constructor(){Ge(this,se);Ge(this,ne,(0,$.getUuid)());Ge(this,re,0);Ge(this,ie,null)}static get _isSVGFittingCanvas(){const Ae='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',Ve=new OffscreenCanvas(1,3).getContext("2d"),Je=new Image;Je.src=Ae;const st=Je.decode().then(()=>(Ve.drawImage(Je,0,0,1,1,0,0,1,3),new Uint32Array(Ve.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,$.shadow)(this,"_isSVGFittingCanvas",st)}async getFromFile(Ae){const{lastModified:xe,name:Ve,size:Je,type:st}=Ae;return it(this,se,In).call(this,`${xe}_${Ve}_${Je}_${st}`,Ae)}async getFromUrl(Ae){return it(this,se,In).call(this,Ae,Ae)}async getFromId(Ae){ye(this,ie)||ut(this,ie,new Map);const xe=ye(this,ie).get(Ae);return xe?xe.bitmap?(xe.refCounter+=1,xe):xe.file?this.getFromFile(xe.file):this.getFromUrl(xe.url):null}getSvgUrl(Ae){const xe=ye(this,ie).get(Ae);return xe!=null&&xe.isSvg?xe.svgUrl:null}deleteId(Ae){ye(this,ie)||ut(this,ie,new Map);const xe=ye(this,ie).get(Ae);xe&&(xe.refCounter-=1,xe.refCounter===0&&(xe.bitmap=null))}isValidId(Ae){return Ae.startsWith(`image_${ye(this,ne)}_`)}};ne=new WeakMap,re=new WeakMap,ie=new WeakMap,se=new WeakSet,In=async function(Ae,xe){ye(this,ie)||ut(this,ie,new Map);let Ve=ye(this,ie).get(Ae);if(Ve===null)return null;if(Ve!=null&&Ve.bitmap)return Ve.refCounter+=1,Ve;try{Ve||(Ve={bitmap:null,id:`image_${ye(this,ne)}_${rn(this,re)._++}`,refCounter:0,isSvg:!1});let Je;if(typeof xe=="string"){Ve.url=xe;const st=await fetch(xe);if(!st.ok)throw new Error(st.statusText);Je=await st.blob()}else Je=Ve.file=xe;if(Je.type==="image/svg+xml"){const st=he._isSVGFittingCanvas,ct=new FileReader,_t=new Image,Dt=new Promise((At,Mt)=>{_t.onload=()=>{Ve.bitmap=_t,Ve.isSvg=!0,At()},ct.onload=async()=>{const Et=Ve.svgUrl=ct.result;_t.src=await st?`${Et}#svgView(preserveAspectRatio(none))`:Et},_t.onerror=ct.onerror=Mt});ct.readAsDataURL(Je),await Dt}else Ve.bitmap=await createImageBitmap(Je);Ve.refCounter=1}catch(Je){console.error(Je),Ve=null}return ye(this,ie).set(Ae,Ve),Ve&&ye(this,ie).set(Ve.id,Ve),Ve};let X=he;class Y{constructor(Ae=128){Ge(this,ce,[]);Ge(this,ae,!1);Ge(this,de,void 0);Ge(this,ge,-1);ut(this,de,Ae)}add({cmd:Ae,undo:xe,mustExec:Ve,type:Je=NaN,overwriteIfSameType:st=!1,keepUndo:ct=!1}){if(Ve&&Ae(),ye(this,ae))return;const _t={cmd:Ae,undo:xe,type:Je};if(ye(this,ge)===-1){ye(this,ce).length>0&&(ye(this,ce).length=0),ut(this,ge,0),ye(this,ce).push(_t);return}if(st&&ye(this,ce)[ye(this,ge)].type===Je){ct&&(_t.undo=ye(this,ce)[ye(this,ge)].undo),ye(this,ce)[ye(this,ge)]=_t;return}const Dt=ye(this,ge)+1;Dt===ye(this,de)?ye(this,ce).splice(0,1):(ut(this,ge,Dt),Dt<ye(this,ce).length&&ye(this,ce).splice(Dt)),ye(this,ce).push(_t)}undo(){ye(this,ge)!==-1&&(ut(this,ae,!0),ye(this,ce)[ye(this,ge)].undo(),ut(this,ae,!1),ut(this,ge,ye(this,ge)-1))}redo(){ye(this,ge)<ye(this,ce).length-1&&(ut(this,ge,ye(this,ge)+1),ut(this,ae,!0),ye(this,ce)[ye(this,ge)].cmd(),ut(this,ae,!1))}hasSomethingToUndo(){return ye(this,ge)!==-1}hasSomethingToRedo(){return ye(this,ge)<ye(this,ce).length-1}destroy(){ut(this,ce,null)}}ce=new WeakMap,ae=new WeakMap,de=new WeakMap,ge=new WeakMap,_.CommandManager=Y;class Q{constructor(Ae){Ge(this,fe);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:xe}=$.FeatureTest.platform;for(const[Ve,Je,st={}]of Ae)for(const ct of Ve){const _t=ct.startsWith("mac+");xe&&_t?(this.callbacks.set(ct.slice(4),{callback:Je,options:st}),this.allKeys.add(ct.split("+").at(-1))):!xe&&!_t&&(this.callbacks.set(ct,{callback:Je,options:st}),this.allKeys.add(ct.split("+").at(-1)))}}exec(Ae,xe){if(!this.allKeys.has(xe.key))return;const Ve=this.callbacks.get(it(this,fe,fr).call(this,xe));if(!Ve)return;const{callback:Je,options:{bubbles:st=!1,args:ct=[],checker:_t=null}}=Ve;_t&&!_t(Ae,xe)||(Je.bind(Ae,...ct)(),st||(xe.stopPropagation(),xe.preventDefault()))}}fe=new WeakSet,fr=function(Ae){Ae.altKey&&this.buffer.push("alt"),Ae.ctrlKey&&this.buffer.push("ctrl"),Ae.metaKey&&this.buffer.push("meta"),Ae.shiftKey&&this.buffer.push("shift"),this.buffer.push(Ae.key);const xe=this.buffer.join("+");return this.buffer.length=0,xe},_.KeyboardManager=Q;const we=class we{get _colors(){const Ae=new Map([["CanvasText",null],["Canvas",null]]);return(0,j.getColorValues)(Ae),(0,$.shadow)(this,"_colors",Ae)}convert(Ae){const xe=(0,j.getRGB)(Ae);if(!window.matchMedia("(forced-colors: active)").matches)return xe;for(const[Ve,Je]of this._colors)if(Je.every((st,ct)=>st===xe[ct]))return we._colorsMapping.get(Ve);return xe}getHexCode(Ae){const xe=this._colors.get(Ae);return xe?$.Util.makeHexColor(...xe):Ae}};Ht(we,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Z=we;_.ColorManager=Z;const Ct=class Ct{constructor(Ae,xe,Ve,Je,st,ct){Ge(this,Qe);Ge(this,pt);Ge(this,St);Ge(this,xt);Ge(this,ht);Ge(this,lt);Ge(this,tt);Ge(this,gt);Ge(this,jt);Ge(this,yt);Ge(this,vt);Ge(this,Pt);Ge(this,bt);Ge(this,De,null);Ge(this,ve,new Map);Ge(this,Ce,new Map);Ge(this,ue,null);Ge(this,Pe,null);Ge(this,ze,new Y);Ge(this,Le,0);Ge(this,Me,new Set);Ge(this,Ne,null);Ge(this,Ye,null);Ge(this,Ie,new Set);Ge(this,Oe,null);Ge(this,Se,new G);Ge(this,pe,!1);Ge(this,me,!1);Ge(this,be,null);Ge(this,Ee,$.AnnotationEditorType.NONE);Ge(this,ke,new Set);Ge(this,Fe,null);Ge(this,Be,this.blur.bind(this));Ge(this,Ue,this.focus.bind(this));Ge(this,nt,this.copy.bind(this));Ge(this,rt,this.cut.bind(this));Ge(this,_e,this.paste.bind(this));Ge(this,We,this.keydown.bind(this));Ge(this,Xe,this.onEditingAction.bind(this));Ge(this,Te,this.onPageChanging.bind(this));Ge(this,Re,this.onScaleChanging.bind(this));Ge(this,He,this.onRotationChanging.bind(this));Ge(this,Ze,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});Ge(this,ot,[0,0]);Ge(this,$e,null);Ge(this,je,null);Ge(this,Ke,null);ut(this,je,Ae),ut(this,Ke,xe),ut(this,ue,Ve),this._eventBus=Je,this._eventBus._on("editingaction",ye(this,Xe)),this._eventBus._on("pagechanging",ye(this,Te)),this._eventBus._on("scalechanging",ye(this,Re)),this._eventBus._on("rotationchanging",ye(this,He)),ut(this,Pe,st.annotationStorage),ut(this,Oe,st.filterFactory),ut(this,Fe,ct),this.viewParameters={realScale:j.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const Ae=Ct.prototype,xe=st=>{const{activeElement:ct}=document;return ct&&ye(st,je).contains(ct)&&st.hasSomethingToControl()},Ve=this.TRANSLATE_SMALL,Je=this.TRANSLATE_BIG;return(0,$.shadow)(this,"_keyboardManager",new Q([[["ctrl+a","mac+meta+a"],Ae.selectAll],[["ctrl+z","mac+meta+z"],Ae.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],Ae.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],Ae.delete],[["Escape","mac+Escape"],Ae.unselectAll],[["ArrowLeft","mac+ArrowLeft"],Ae.translateSelectedEditors,{args:[-Ve,0],checker:xe}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Ae.translateSelectedEditors,{args:[-Je,0],checker:xe}],[["ArrowRight","mac+ArrowRight"],Ae.translateSelectedEditors,{args:[Ve,0],checker:xe}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Ae.translateSelectedEditors,{args:[Je,0],checker:xe}],[["ArrowUp","mac+ArrowUp"],Ae.translateSelectedEditors,{args:[0,-Ve],checker:xe}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Ae.translateSelectedEditors,{args:[0,-Je],checker:xe}],[["ArrowDown","mac+ArrowDown"],Ae.translateSelectedEditors,{args:[0,Ve],checker:xe}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Ae.translateSelectedEditors,{args:[0,Je],checker:xe}]]))}destroy(){it(this,xt,pn).call(this),it(this,pt,Bn).call(this),this._eventBus._off("editingaction",ye(this,Xe)),this._eventBus._off("pagechanging",ye(this,Te)),this._eventBus._off("scalechanging",ye(this,Re)),this._eventBus._off("rotationchanging",ye(this,He));for(const Ae of ye(this,Ce).values())Ae.destroy();ye(this,Ce).clear(),ye(this,ve).clear(),ye(this,Ie).clear(),ut(this,De,null),ye(this,ke).clear(),ye(this,ze).destroy(),ye(this,ue).destroy()}get hcmFilter(){return(0,$.shadow)(this,"hcmFilter",ye(this,Fe)?ye(this,Oe).addHCMFilter(ye(this,Fe).foreground,ye(this,Fe).background):"none")}get direction(){return(0,$.shadow)(this,"direction",getComputedStyle(ye(this,je)).direction)}editAltText(Ae){var xe;(xe=ye(this,ue))==null||xe.editAltText(this,Ae)}onPageChanging({pageNumber:Ae}){ut(this,Le,Ae-1)}focusMainContainer(){ye(this,je).focus()}findParent(Ae,xe){for(const Ve of ye(this,Ce).values()){const{x:Je,y:st,width:ct,height:_t}=Ve.div.getBoundingClientRect();if(Ae>=Je&&Ae<=Je+ct&&xe>=st&&xe<=st+_t)return Ve}return null}disableUserSelect(Ae=!1){ye(this,Ke).classList.toggle("noUserSelect",Ae)}addShouldRescale(Ae){ye(this,Ie).add(Ae)}removeShouldRescale(Ae){ye(this,Ie).delete(Ae)}onScaleChanging({scale:Ae}){this.commitOrRemove(),this.viewParameters.realScale=Ae*j.PixelsPerInch.PDF_TO_CSS_UNITS;for(const xe of ye(this,Ie))xe.onScaleChanging()}onRotationChanging({pagesRotation:Ae}){this.commitOrRemove(),this.viewParameters.rotation=Ae}addToAnnotationStorage(Ae){!Ae.isEmpty()&&ye(this,Pe)&&!ye(this,Pe).has(Ae.id)&&ye(this,Pe).setValue(Ae.id,Ae)}blur(){if(!this.hasSelection)return;const{activeElement:Ae}=document;for(const xe of ye(this,ke))if(xe.div.contains(Ae)){ut(this,be,[xe,Ae]),xe._focusEventsAllowed=!1;break}}focus(){if(!ye(this,be))return;const[Ae,xe]=ye(this,be);ut(this,be,null),xe.addEventListener("focusin",()=>{Ae._focusEventsAllowed=!0},{once:!0}),xe.focus()}addEditListeners(){it(this,St,Mn).call(this),it(this,ht,On).call(this)}removeEditListeners(){it(this,xt,pn).call(this),it(this,lt,Ln).call(this)}copy(Ae){var Ve;if(Ae.preventDefault(),(Ve=ye(this,De))==null||Ve.commitOrRemove(),!this.hasSelection)return;const xe=[];for(const Je of ye(this,ke)){const st=Je.serialize(!0);st&&xe.push(st)}xe.length!==0&&Ae.clipboardData.setData("application/pdfjs",JSON.stringify(xe))}cut(Ae){this.copy(Ae),this.delete()}paste(Ae){Ae.preventDefault();const{clipboardData:xe}=Ae;for(const st of xe.items)for(const ct of ye(this,Ye))if(ct.isHandlingMimeForPasting(st.type)){ct.paste(st,this.currentLayer);return}let Ve=xe.getData("application/pdfjs");if(!Ve)return;try{Ve=JSON.parse(Ve)}catch(st){(0,$.warn)(`paste: "${st.message}".`);return}if(!Array.isArray(Ve))return;this.unselectAll();const Je=this.currentLayer;try{const st=[];for(const Dt of Ve){const At=Je.deserialize(Dt);if(!At)return;st.push(At)}const ct=()=>{for(const Dt of st)it(this,vt,Nn).call(this,Dt);it(this,bt,$n).call(this,st)},_t=()=>{for(const Dt of st)Dt.remove()};this.addCommands({cmd:ct,undo:_t,mustExec:!0})}catch(st){(0,$.warn)(`paste: "${st.message}".`)}}keydown(Ae){var xe;(xe=this.getActive())!=null&&xe.shouldGetKeyboardEvents()||Ct._keyboardManager.exec(this,Ae)}onEditingAction(Ae){["undo","redo","delete","selectAll"].includes(Ae.name)&&this[Ae.name]()}setEditingState(Ae){Ae?(it(this,Qe,pr).call(this),it(this,St,Mn).call(this),it(this,ht,On).call(this),it(this,tt,Gt).call(this,{isEditing:ye(this,Ee)!==$.AnnotationEditorType.NONE,isEmpty:it(this,Pt,an).call(this),hasSomethingToUndo:ye(this,ze).hasSomethingToUndo(),hasSomethingToRedo:ye(this,ze).hasSomethingToRedo(),hasSelectedEditor:!1})):(it(this,pt,Bn).call(this),it(this,xt,pn).call(this),it(this,lt,Ln).call(this),it(this,tt,Gt).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(Ae){if(!ye(this,Ye)){ut(this,Ye,Ae);for(const xe of ye(this,Ye))it(this,gt,sn).call(this,xe.defaultPropertiesToUpdate)}}getId(){return ye(this,Se).getId()}get currentLayer(){return ye(this,Ce).get(ye(this,Le))}getLayer(Ae){return ye(this,Ce).get(Ae)}get currentPageIndex(){return ye(this,Le)}addLayer(Ae){ye(this,Ce).set(Ae.pageIndex,Ae),ye(this,pe)?Ae.enable():Ae.disable()}removeLayer(Ae){ye(this,Ce).delete(Ae.pageIndex)}updateMode(Ae,xe=null){if(ye(this,Ee)!==Ae){if(ut(this,Ee,Ae),Ae===$.AnnotationEditorType.NONE){this.setEditingState(!1),it(this,yt,_r).call(this);return}this.setEditingState(!0),it(this,jt,mr).call(this),this.unselectAll();for(const Ve of ye(this,Ce).values())Ve.updateMode(Ae);if(xe){for(const Ve of ye(this,ve).values())if(Ve.annotationElementId===xe){this.setSelected(Ve),Ve.enterInEditMode();break}}}}updateToolbar(Ae){Ae!==ye(this,Ee)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:Ae})}updateParams(Ae,xe){if(ye(this,Ye)){if(Ae===$.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(Ae);return}for(const Ve of ye(this,ke))Ve.updateParams(Ae,xe);for(const Ve of ye(this,Ye))Ve.updateDefaultParams(Ae,xe)}}enableWaiting(Ae=!1){if(ye(this,me)!==Ae){ut(this,me,Ae);for(const xe of ye(this,Ce).values())Ae?xe.disableClick():xe.enableClick(),xe.div.classList.toggle("waiting",Ae)}}getEditors(Ae){const xe=[];for(const Ve of ye(this,ve).values())Ve.pageIndex===Ae&&xe.push(Ve);return xe}getEditor(Ae){return ye(this,ve).get(Ae)}addEditor(Ae){ye(this,ve).set(Ae.id,Ae)}removeEditor(Ae){var xe;ye(this,ve).delete(Ae.id),this.unselect(Ae),(!Ae.annotationElementId||!ye(this,Me).has(Ae.annotationElementId))&&((xe=ye(this,Pe))==null||xe.remove(Ae.id))}addDeletedAnnotationElement(Ae){ye(this,Me).add(Ae.annotationElementId),Ae.deleted=!0}isDeletedAnnotationElement(Ae){return ye(this,Me).has(Ae)}removeDeletedAnnotationElement(Ae){ye(this,Me).delete(Ae.annotationElementId),Ae.deleted=!1}setActiveEditor(Ae){ye(this,De)!==Ae&&(ut(this,De,Ae),Ae&&it(this,gt,sn).call(this,Ae.propertiesToUpdate))}toggleSelected(Ae){if(ye(this,ke).has(Ae)){ye(this,ke).delete(Ae),Ae.unselect(),it(this,tt,Gt).call(this,{hasSelectedEditor:this.hasSelection});return}ye(this,ke).add(Ae),Ae.select(),it(this,gt,sn).call(this,Ae.propertiesToUpdate),it(this,tt,Gt).call(this,{hasSelectedEditor:!0})}setSelected(Ae){for(const xe of ye(this,ke))xe!==Ae&&xe.unselect();ye(this,ke).clear(),ye(this,ke).add(Ae),Ae.select(),it(this,gt,sn).call(this,Ae.propertiesToUpdate),it(this,tt,Gt).call(this,{hasSelectedEditor:!0})}isSelected(Ae){return ye(this,ke).has(Ae)}unselect(Ae){Ae.unselect(),ye(this,ke).delete(Ae),it(this,tt,Gt).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return ye(this,ke).size!==0}undo(){ye(this,ze).undo(),it(this,tt,Gt).call(this,{hasSomethingToUndo:ye(this,ze).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:it(this,Pt,an).call(this)})}redo(){ye(this,ze).redo(),it(this,tt,Gt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:ye(this,ze).hasSomethingToRedo(),isEmpty:it(this,Pt,an).call(this)})}addCommands(Ae){ye(this,ze).add(Ae),it(this,tt,Gt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:it(this,Pt,an).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const Ae=[...ye(this,ke)],xe=()=>{for(const Je of Ae)Je.remove()},Ve=()=>{for(const Je of Ae)it(this,vt,Nn).call(this,Je)};this.addCommands({cmd:xe,undo:Ve,mustExec:!0})}commitOrRemove(){var Ae;(Ae=ye(this,De))==null||Ae.commitOrRemove()}hasSomethingToControl(){return ye(this,De)||this.hasSelection}selectAll(){for(const Ae of ye(this,ke))Ae.commit();it(this,bt,$n).call(this,ye(this,ve).values())}unselectAll(){if(ye(this,De)){ye(this,De).commitOrRemove();return}if(this.hasSelection){for(const Ae of ye(this,ke))Ae.unselect();ye(this,ke).clear(),it(this,tt,Gt).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(Ae,xe,Ve=!1){if(Ve||this.commitOrRemove(),!this.hasSelection)return;ye(this,ot)[0]+=Ae,ye(this,ot)[1]+=xe;const[Je,st]=ye(this,ot),ct=[...ye(this,ke)],_t=1e3;ye(this,$e)&&clearTimeout(ye(this,$e)),ut(this,$e,setTimeout(()=>{ut(this,$e,null),ye(this,ot)[0]=ye(this,ot)[1]=0,this.addCommands({cmd:()=>{for(const Dt of ct)ye(this,ve).has(Dt.id)&&Dt.translateInPage(Je,st)},undo:()=>{for(const Dt of ct)ye(this,ve).has(Dt.id)&&Dt.translateInPage(-Je,-st)},mustExec:!1})},_t));for(const Dt of ct)Dt.translateInPage(Ae,xe)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),ut(this,Ne,new Map);for(const Ae of ye(this,ke))ye(this,Ne).set(Ae,{savedX:Ae.x,savedY:Ae.y,savedPageIndex:Ae.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!ye(this,Ne))return!1;this.disableUserSelect(!1);const Ae=ye(this,Ne);ut(this,Ne,null);let xe=!1;for(const[{x:Je,y:st,pageIndex:ct},_t]of Ae)_t.newX=Je,_t.newY=st,_t.newPageIndex=ct,xe||(xe=Je!==_t.savedX||st!==_t.savedY||ct!==_t.savedPageIndex);if(!xe)return!1;const Ve=(Je,st,ct,_t)=>{if(ye(this,ve).has(Je.id)){const Dt=ye(this,Ce).get(_t);Dt?Je._setParentAndPosition(Dt,st,ct):(Je.pageIndex=_t,Je.x=st,Je.y=ct)}};return this.addCommands({cmd:()=>{for(const[Je,{newX:st,newY:ct,newPageIndex:_t}]of Ae)Ve(Je,st,ct,_t)},undo:()=>{for(const[Je,{savedX:st,savedY:ct,savedPageIndex:_t}]of Ae)Ve(Je,st,ct,_t)},mustExec:!0}),!0}dragSelectedEditors(Ae,xe){if(ye(this,Ne))for(const Ve of ye(this,Ne).keys())Ve.drag(Ae,xe)}rebuild(Ae){if(Ae.parent===null){const xe=this.getLayer(Ae.pageIndex);xe?(xe.changeParent(Ae),xe.addOrRebuild(Ae)):(this.addEditor(Ae),this.addToAnnotationStorage(Ae),Ae.rebuild())}else Ae.parent.addOrRebuild(Ae)}isActive(Ae){return ye(this,De)===Ae}getActive(){return ye(this,De)}getMode(){return ye(this,Ee)}get imageManager(){return(0,$.shadow)(this,"imageManager",new X)}};De=new WeakMap,ve=new WeakMap,Ce=new WeakMap,ue=new WeakMap,Pe=new WeakMap,ze=new WeakMap,Le=new WeakMap,Me=new WeakMap,Ne=new WeakMap,Ye=new WeakMap,Ie=new WeakMap,Oe=new WeakMap,Se=new WeakMap,pe=new WeakMap,me=new WeakMap,be=new WeakMap,Ee=new WeakMap,ke=new WeakMap,Fe=new WeakMap,Be=new WeakMap,Ue=new WeakMap,nt=new WeakMap,rt=new WeakMap,_e=new WeakMap,We=new WeakMap,Xe=new WeakMap,Te=new WeakMap,Re=new WeakMap,He=new WeakMap,Ze=new WeakMap,ot=new WeakMap,$e=new WeakMap,je=new WeakMap,Ke=new WeakMap,Qe=new WeakSet,pr=function(){window.addEventListener("focus",ye(this,Ue)),window.addEventListener("blur",ye(this,Be))},pt=new WeakSet,Bn=function(){window.removeEventListener("focus",ye(this,Ue)),window.removeEventListener("blur",ye(this,Be))},St=new WeakSet,Mn=function(){window.addEventListener("keydown",ye(this,We),{capture:!0})},xt=new WeakSet,pn=function(){window.removeEventListener("keydown",ye(this,We),{capture:!0})},ht=new WeakSet,On=function(){document.addEventListener("copy",ye(this,nt)),document.addEventListener("cut",ye(this,rt)),document.addEventListener("paste",ye(this,_e))},lt=new WeakSet,Ln=function(){document.removeEventListener("copy",ye(this,nt)),document.removeEventListener("cut",ye(this,rt)),document.removeEventListener("paste",ye(this,_e))},tt=new WeakSet,Gt=function(Ae){Object.entries(Ae).some(([Ve,Je])=>ye(this,Ze)[Ve]!==Je)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(ye(this,Ze),Ae)})},gt=new WeakSet,sn=function(Ae){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:Ae})},jt=new WeakSet,mr=function(){if(!ye(this,pe)){ut(this,pe,!0);for(const Ae of ye(this,Ce).values())Ae.enable()}},yt=new WeakSet,_r=function(){if(this.unselectAll(),ye(this,pe)){ut(this,pe,!1);for(const Ae of ye(this,Ce).values())Ae.disable()}},vt=new WeakSet,Nn=function(Ae){const xe=ye(this,Ce).get(Ae.pageIndex);xe?xe.addOrRebuild(Ae):this.addEditor(Ae)},Pt=new WeakSet,an=function(){if(ye(this,ve).size===0)return!0;if(ye(this,ve).size===1)for(const Ae of ye(this,ve).values())return Ae.isEmpty();return!1},bt=new WeakSet,$n=function(Ae){ye(this,ke).clear();for(const xe of Ae)xe.isEmpty()||(ye(this,ke).add(xe),xe.select());it(this,tt,Gt).call(this,{hasSelectedEditor:!0})},Ht(Ct,"TRANSLATE_SMALL",1),Ht(Ct,"TRANSLATE_BIG",10);let ee=Ct;_.AnnotationEditorUIManager=ee},(q,_,M)=>{var Le,Me,Ne,Ye,Ie,Oe,Se,pe,me,be,Ee,ke,Jt,Be,en,nt,Un,_e,mn,Xe,_n,Re,on,Ze,ln;Object.defineProperty(_,"__esModule",{value:!0}),_.StatTimer=_.RenderingCancelledException=_.PixelsPerInch=_.PageViewport=_.PDFDateString=_.DOMStandardFontDataFactory=_.DOMSVGFactory=_.DOMFilterFactory=_.DOMCanvasFactory=_.DOMCMapReaderFactory=void 0,_.deprecated=ge,_.getColorValues=ve,_.getCurrentTransform=Ce,_.getCurrentTransformInverse=ue,_.getFilenameFromUrl=se,_.getPdfFilenameFromUrl=le,_.getRGB=De,_.getXfaPageViewport=we,_.isDataScheme=re,_.isPdfFile=ie,_.isValidFetchUrl=ce,_.loadScript=de,_.noContextMenu=ae,_.setLayerDimensions=Pe;var $=M(7),j=M(1);const z="http://www.w3.org/2000/svg",ze=class ze{};Ht(ze,"CSS",96),Ht(ze,"PDF",72),Ht(ze,"PDF_TO_CSS_UNITS",ze.CSS/ze.PDF);let V=ze;_.PixelsPerInch=V;class G extends $.BaseFilterFactory{constructor({docId:Ke,ownerDocument:Qe=globalThis.document}={}){super();Ge(this,ke);Ge(this,Be);Ge(this,nt);Ge(this,_e);Ge(this,Xe);Ge(this,Re);Ge(this,Ze);Ge(this,Le,void 0);Ge(this,Me,void 0);Ge(this,Ne,void 0);Ge(this,Ye,void 0);Ge(this,Ie,void 0);Ge(this,Oe,void 0);Ge(this,Se,void 0);Ge(this,pe,void 0);Ge(this,me,void 0);Ge(this,be,void 0);Ge(this,Ee,0);ut(this,Ne,Ke),ut(this,Ye,Qe)}addFilter(Ke){if(!Ke)return"none";let Qe=ye(this,ke,Jt).get(Ke);if(Qe)return Qe;let dt,pt,wt,St;if(Ke.length===1){const ht=Ke[0],ft=new Array(256);for(let lt=0;lt<256;lt++)ft[lt]=ht[lt]/255;St=dt=pt=wt=ft.join(",")}else{const[ht,ft,lt]=Ke,et=new Array(256),tt=new Array(256),mt=new Array(256);for(let gt=0;gt<256;gt++)et[gt]=ht[gt]/255,tt[gt]=ft[gt]/255,mt[gt]=lt[gt]/255;dt=et.join(","),pt=tt.join(","),wt=mt.join(","),St=`${dt}${pt}${wt}`}if(Qe=ye(this,ke,Jt).get(St),Qe)return ye(this,ke,Jt).set(Ke,Qe),Qe;const Rt=`g_${ye(this,Ne)}_transfer_map_${rn(this,Ee)._++}`,xt=`url(#${Rt})`;ye(this,ke,Jt).set(Ke,xt),ye(this,ke,Jt).set(St,xt);const It=it(this,_e,mn).call(this,Rt);return it(this,Re,on).call(this,dt,pt,wt,It),xt}addHCMFilter(Ke,Qe){var ft;const dt=`${Ke}-${Qe}`;if(ye(this,Oe)===dt)return ye(this,Se);if(ut(this,Oe,dt),ut(this,Se,"none"),(ft=ye(this,Ie))==null||ft.remove(),!Ke||!Qe)return ye(this,Se);const pt=it(this,Ze,ln).call(this,Ke);Ke=j.Util.makeHexColor(...pt);const wt=it(this,Ze,ln).call(this,Qe);if(Qe=j.Util.makeHexColor(...wt),ye(this,Be,en).style.color="",Ke==="#000000"&&Qe==="#ffffff"||Ke===Qe)return ye(this,Se);const St=new Array(256);for(let lt=0;lt<=255;lt++){const et=lt/255;St[lt]=et<=.03928?et/12.92:((et+.055)/1.055)**2.4}const Rt=St.join(","),xt=`g_${ye(this,Ne)}_hcm_filter`,It=ut(this,pe,it(this,_e,mn).call(this,xt));it(this,Re,on).call(this,Rt,Rt,Rt,It),it(this,nt,Un).call(this,It);const ht=(lt,et)=>{const tt=pt[lt]/255,mt=wt[lt]/255,gt=new Array(et+1);for(let Ut=0;Ut<=et;Ut++)gt[Ut]=tt+Ut/et*(mt-tt);return gt.join(",")};return it(this,Re,on).call(this,ht(0,5),ht(1,5),ht(2,5),It),ut(this,Se,`url(#${xt})`),ye(this,Se)}addHighlightHCMFilter(Ke,Qe,dt,pt){var mt;const wt=`${Ke}-${Qe}-${dt}-${pt}`;if(ye(this,me)===wt)return ye(this,be);if(ut(this,me,wt),ut(this,be,"none"),(mt=ye(this,pe))==null||mt.remove(),!Ke||!Qe)return ye(this,be);const[St,Rt]=[Ke,Qe].map(it(this,Ze,ln).bind(this));let xt=Math.round(.2126*St[0]+.7152*St[1]+.0722*St[2]),It=Math.round(.2126*Rt[0]+.7152*Rt[1]+.0722*Rt[2]),[ht,ft]=[dt,pt].map(it(this,Ze,ln).bind(this));It<xt&&([xt,It,ht,ft]=[It,xt,ft,ht]),ye(this,Be,en).style.color="";const lt=(gt,Ut,jt)=>{const at=new Array(256),yt=(It-xt)/jt,Ft=gt/255,vt=(Ut-gt)/(255*jt);let Tt=0;for(let Pt=0;Pt<=jt;Pt++){const $t=Math.round(xt+Pt*yt),bt=Ft+Pt*vt;for(let Lt=Tt;Lt<=$t;Lt++)at[Lt]=bt;Tt=$t+1}for(let Pt=Tt;Pt<256;Pt++)at[Pt]=at[Tt-1];return at.join(",")},et=`g_${ye(this,Ne)}_hcm_highlight_filter`,tt=ut(this,pe,it(this,_e,mn).call(this,et));return it(this,nt,Un).call(this,tt),it(this,Re,on).call(this,lt(ht[0],ft[0],5),lt(ht[1],ft[1],5),lt(ht[2],ft[2],5),tt),ut(this,be,`url(#${et})`),ye(this,be)}destroy(Ke=!1){Ke&&(ye(this,Se)||ye(this,be))||(ye(this,Me)&&(ye(this,Me).parentNode.parentNode.remove(),ut(this,Me,null)),ye(this,Le)&&(ye(this,Le).clear(),ut(this,Le,null)),ut(this,Ee,0))}}Le=new WeakMap,Me=new WeakMap,Ne=new WeakMap,Ye=new WeakMap,Ie=new WeakMap,Oe=new WeakMap,Se=new WeakMap,pe=new WeakMap,me=new WeakMap,be=new WeakMap,Ee=new WeakMap,ke=new WeakSet,Jt=function(){return ye(this,Le)||ut(this,Le,new Map)},Be=new WeakSet,en=function(){if(!ye(this,Me)){const Ke=ye(this,Ye).createElement("div"),{style:Qe}=Ke;Qe.visibility="hidden",Qe.contain="strict",Qe.width=Qe.height=0,Qe.position="absolute",Qe.top=Qe.left=0,Qe.zIndex=-1;const dt=ye(this,Ye).createElementNS(z,"svg");dt.setAttribute("width",0),dt.setAttribute("height",0),ut(this,Me,ye(this,Ye).createElementNS(z,"defs")),Ke.append(dt),dt.append(ye(this,Me)),ye(this,Ye).body.append(Ke)}return ye(this,Me)},nt=new WeakSet,Un=function(Ke){const Qe=ye(this,Ye).createElementNS(z,"feColorMatrix");Qe.setAttribute("type","matrix"),Qe.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),Ke.append(Qe)},_e=new WeakSet,mn=function(Ke){const Qe=ye(this,Ye).createElementNS(z,"filter");return Qe.setAttribute("color-interpolation-filters","sRGB"),Qe.setAttribute("id",Ke),ye(this,Be,en).append(Qe),Qe},Xe=new WeakSet,_n=function(Ke,Qe,dt){const pt=ye(this,Ye).createElementNS(z,Qe);pt.setAttribute("type","discrete"),pt.setAttribute("tableValues",dt),Ke.append(pt)},Re=new WeakSet,on=function(Ke,Qe,dt,pt){const wt=ye(this,Ye).createElementNS(z,"feComponentTransfer");pt.append(wt),it(this,Xe,_n).call(this,wt,"feFuncR",Ke),it(this,Xe,_n).call(this,wt,"feFuncG",Qe),it(this,Xe,_n).call(this,wt,"feFuncB",dt)},Ze=new WeakSet,ln=function(Ke){return ye(this,Be,en).style.color=Ke,De(getComputedStyle(ye(this,Be,en)).getPropertyValue("color"))},_.DOMFilterFactory=G;class X extends $.BaseCanvasFactory{constructor({ownerDocument:je=globalThis.document}={}){super(),this._document=je}_createCanvas(je,Ke){const Qe=this._document.createElement("canvas");return Qe.width=je,Qe.height=Ke,Qe}}_.DOMCanvasFactory=X;async function Y($e,je=!1){if(ce($e,document.baseURI)){const Ke=await fetch($e);if(!Ke.ok)throw new Error(Ke.statusText);return je?new Uint8Array(await Ke.arrayBuffer()):(0,j.stringToBytes)(await Ke.text())}return new Promise((Ke,Qe)=>{const dt=new XMLHttpRequest;dt.open("GET",$e,!0),je&&(dt.responseType="arraybuffer"),dt.onreadystatechange=()=>{if(dt.readyState===XMLHttpRequest.DONE){if(dt.status===200||dt.status===0){let pt;if(je&&dt.response?pt=new Uint8Array(dt.response):!je&&dt.responseText&&(pt=(0,j.stringToBytes)(dt.responseText)),pt){Ke(pt);return}}Qe(new Error(dt.statusText))}},dt.send(null)})}class Q extends $.BaseCMapReaderFactory{_fetchData(je,Ke){return Y(je,this.isCompressed).then(Qe=>({cMapData:Qe,compressionType:Ke}))}}_.DOMCMapReaderFactory=Q;class Z extends $.BaseStandardFontDataFactory{_fetchData(je){return Y(je,!0)}}_.DOMStandardFontDataFactory=Z;class ee extends $.BaseSVGFactory{_createSVG(je){return document.createElementNS(z,je)}}_.DOMSVGFactory=ee;class te{constructor({viewBox:je,scale:Ke,rotation:Qe,offsetX:dt=0,offsetY:pt=0,dontFlip:wt=!1}){this.viewBox=je,this.scale=Ke,this.rotation=Qe,this.offsetX=dt,this.offsetY=pt;const St=(je[2]+je[0])/2,Rt=(je[3]+je[1])/2;let xt,It,ht,ft;switch(Qe%=360,Qe<0&&(Qe+=360),Qe){case 180:xt=-1,It=0,ht=0,ft=1;break;case 90:xt=0,It=1,ht=1,ft=0;break;case 270:xt=0,It=-1,ht=-1,ft=0;break;case 0:xt=1,It=0,ht=0,ft=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}wt&&(ht=-ht,ft=-ft);let lt,et,tt,mt;xt===0?(lt=Math.abs(Rt-je[1])*Ke+dt,et=Math.abs(St-je[0])*Ke+pt,tt=(je[3]-je[1])*Ke,mt=(je[2]-je[0])*Ke):(lt=Math.abs(St-je[0])*Ke+dt,et=Math.abs(Rt-je[1])*Ke+pt,tt=(je[2]-je[0])*Ke,mt=(je[3]-je[1])*Ke),this.transform=[xt*Ke,It*Ke,ht*Ke,ft*Ke,lt-xt*Ke*St-ht*Ke*Rt,et-It*Ke*St-ft*Ke*Rt],this.width=tt,this.height=mt}get rawDims(){const{viewBox:je}=this;return(0,j.shadow)(this,"rawDims",{pageWidth:je[2]-je[0],pageHeight:je[3]-je[1],pageX:je[0],pageY:je[1]})}clone({scale:je=this.scale,rotation:Ke=this.rotation,offsetX:Qe=this.offsetX,offsetY:dt=this.offsetY,dontFlip:pt=!1}={}){return new te({viewBox:this.viewBox.slice(),scale:je,rotation:Ke,offsetX:Qe,offsetY:dt,dontFlip:pt})}convertToViewportPoint(je,Ke){return j.Util.applyTransform([je,Ke],this.transform)}convertToViewportRectangle(je){const Ke=j.Util.applyTransform([je[0],je[1]],this.transform),Qe=j.Util.applyTransform([je[2],je[3]],this.transform);return[Ke[0],Ke[1],Qe[0],Qe[1]]}convertToPdfPoint(je,Ke){return j.Util.applyInverseTransform([je,Ke],this.transform)}}_.PageViewport=te;class ne extends j.BaseException{constructor(je,Ke=0){super(je,"RenderingCancelledException"),this.extraDelay=Ke}}_.RenderingCancelledException=ne;function re($e){const je=$e.length;let Ke=0;for(;Ke<je&&$e[Ke].trim()==="";)Ke++;return $e.substring(Ke,Ke+5).toLowerCase()==="data:"}function ie($e){return typeof $e=="string"&&/\.pdf$/i.test($e)}function se($e,je=!1){return je||([$e]=$e.split(/[#?]/,1)),$e.substring($e.lastIndexOf("/")+1)}function le($e,je="document.pdf"){if(typeof $e!="string")return je;if(re($e))return(0,j.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),je;const Ke=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,Qe=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,dt=Ke.exec($e);let pt=Qe.exec(dt[1])||Qe.exec(dt[2])||Qe.exec(dt[3]);if(pt&&(pt=pt[0],pt.includes("%")))try{pt=Qe.exec(decodeURIComponent(pt))[0]}catch{}return pt||je}class he{constructor(){Ht(this,"started",Object.create(null));Ht(this,"times",[])}time(je){je in this.started&&(0,j.warn)(`Timer is already running for ${je}`),this.started[je]=Date.now()}timeEnd(je){je in this.started||(0,j.warn)(`Timer has not been started for ${je}`),this.times.push({name:je,start:this.started[je],end:Date.now()}),delete this.started[je]}toString(){const je=[];let Ke=0;for(const{name:Qe}of this.times)Ke=Math.max(Qe.length,Ke);for(const{name:Qe,start:dt,end:pt}of this.times)je.push(`${Qe.padEnd(Ke)} ${pt-dt}ms
`);return je.join("")}}_.StatTimer=he;function ce($e,je){try{const{protocol:Ke}=je?new URL($e,je):new URL($e);return Ke==="http:"||Ke==="https:"}catch{return!1}}function ae($e){$e.preventDefault()}function de($e,je=!1){return new Promise((Ke,Qe)=>{const dt=document.createElement("script");dt.src=$e,dt.onload=function(pt){je&&dt.remove(),Ke(pt)},dt.onerror=function(){Qe(new Error(`Cannot load script at: ${dt.src}`))},(document.head||document.documentElement).append(dt)})}function ge($e){console.log("Deprecated API usage: "+$e)}let fe;class oe{static toDateObject(je){if(!je||typeof je!="string")return null;fe||(fe=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const Ke=fe.exec(je);if(!Ke)return null;const Qe=parseInt(Ke[1],10);let dt=parseInt(Ke[2],10);dt=dt>=1&&dt<=12?dt-1:0;let pt=parseInt(Ke[3],10);pt=pt>=1&&pt<=31?pt:1;let wt=parseInt(Ke[4],10);wt=wt>=0&&wt<=23?wt:0;let St=parseInt(Ke[5],10);St=St>=0&&St<=59?St:0;let Rt=parseInt(Ke[6],10);Rt=Rt>=0&&Rt<=59?Rt:0;const xt=Ke[7]||"Z";let It=parseInt(Ke[8],10);It=It>=0&&It<=23?It:0;let ht=parseInt(Ke[9],10)||0;return ht=ht>=0&&ht<=59?ht:0,xt==="-"?(wt+=It,St+=ht):xt==="+"&&(wt-=It,St-=ht),new Date(Date.UTC(Qe,dt,pt,wt,St,Rt))}}_.PDFDateString=oe;function we($e,{scale:je=1,rotation:Ke=0}){const{width:Qe,height:dt}=$e.attributes.style,pt=[0,0,parseInt(Qe),parseInt(dt)];return new te({viewBox:pt,scale:je,rotation:Ke})}function De($e){if($e.startsWith("#")){const je=parseInt($e.slice(1),16);return[(je&16711680)>>16,(je&65280)>>8,je&255]}return $e.startsWith("rgb(")?$e.slice(4,-1).split(",").map(je=>parseInt(je)):$e.startsWith("rgba(")?$e.slice(5,-1).split(",").map(je=>parseInt(je)).slice(0,3):((0,j.warn)(`Not a valid color format: "${$e}"`),[0,0,0])}function ve($e){const je=document.createElement("span");je.style.visibility="hidden",document.body.append(je);for(const Ke of $e.keys()){je.style.color=Ke;const Qe=window.getComputedStyle(je).color;$e.set(Ke,De(Qe))}je.remove()}function Ce($e){const{a:je,b:Ke,c:Qe,d:dt,e:pt,f:wt}=$e.getTransform();return[je,Ke,Qe,dt,pt,wt]}function ue($e){const{a:je,b:Ke,c:Qe,d:dt,e:pt,f:wt}=$e.getTransform().invertSelf();return[je,Ke,Qe,dt,pt,wt]}function Pe($e,je,Ke=!1,Qe=!0){if(je instanceof te){const{pageWidth:dt,pageHeight:pt}=je.rawDims,{style:wt}=$e,St=j.FeatureTest.isCSSRoundSupported,Rt=`var(--scale-factor) * ${dt}px`,xt=`var(--scale-factor) * ${pt}px`,It=St?`round(${Rt}, 1px)`:`calc(${Rt})`,ht=St?`round(${xt}, 1px)`:`calc(${xt})`;!Ke||je.rotation%180===0?(wt.width=It,wt.height=ht):(wt.width=ht,wt.height=It)}Qe&&$e.setAttribute("data-main-rotation",je.rotation)}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.BaseStandardFontDataFactory=_.BaseSVGFactory=_.BaseFilterFactory=_.BaseCanvasFactory=_.BaseCMapReaderFactory=void 0;var $=M(1);class j{constructor(){this.constructor===j&&(0,$.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(Q){return"none"}addHCMFilter(Q,Z){return"none"}addHighlightHCMFilter(Q,Z,ee,te){return"none"}destroy(Q=!1){}}_.BaseFilterFactory=j;class z{constructor(){this.constructor===z&&(0,$.unreachable)("Cannot initialize BaseCanvasFactory.")}create(Q,Z){if(Q<=0||Z<=0)throw new Error("Invalid canvas size");const ee=this._createCanvas(Q,Z);return{canvas:ee,context:ee.getContext("2d")}}reset(Q,Z,ee){if(!Q.canvas)throw new Error("Canvas is not specified");if(Z<=0||ee<=0)throw new Error("Invalid canvas size");Q.canvas.width=Z,Q.canvas.height=ee}destroy(Q){if(!Q.canvas)throw new Error("Canvas is not specified");Q.canvas.width=0,Q.canvas.height=0,Q.canvas=null,Q.context=null}_createCanvas(Q,Z){(0,$.unreachable)("Abstract method `_createCanvas` called.")}}_.BaseCanvasFactory=z;class V{constructor({baseUrl:Q=null,isCompressed:Z=!0}){this.constructor===V&&(0,$.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=Q,this.isCompressed=Z}async fetch({name:Q}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!Q)throw new Error("CMap name must be specified.");const Z=this.baseUrl+Q+(this.isCompressed?".bcmap":""),ee=this.isCompressed?$.CMapCompressionType.BINARY:$.CMapCompressionType.NONE;return this._fetchData(Z,ee).catch(te=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${Z}`)})}_fetchData(Q,Z){(0,$.unreachable)("Abstract method `_fetchData` called.")}}_.BaseCMapReaderFactory=V;class G{constructor({baseUrl:Q=null}){this.constructor===G&&(0,$.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=Q}async fetch({filename:Q}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!Q)throw new Error("Font filename must be specified.");const Z=`${this.baseUrl}${Q}`;return this._fetchData(Z).catch(ee=>{throw new Error(`Unable to load font data at: ${Z}`)})}_fetchData(Q){(0,$.unreachable)("Abstract method `_fetchData` called.")}}_.BaseStandardFontDataFactory=G;class X{constructor(){this.constructor===X&&(0,$.unreachable)("Cannot initialize BaseSVGFactory.")}create(Q,Z,ee=!1){if(Q<=0||Z<=0)throw new Error("Invalid SVG dimensions");const te=this._createSVG("svg:svg");return te.setAttribute("version","1.1"),ee||(te.setAttribute("width",`${Q}px`),te.setAttribute("height",`${Z}px`)),te.setAttribute("preserveAspectRatio","none"),te.setAttribute("viewBox",`0 0 ${Q} ${Z}`),te}createElement(Q){if(typeof Q!="string")throw new Error("Invalid SVG element type");return this._createSVG(Q)}_createSVG(Q){(0,$.unreachable)("Abstract method `_createSVG` called.")}}_.BaseSVGFactory=X},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.MurmurHash3_64=void 0;var $=M(1);const j=3285377520,z=4294901760,V=65535;class G{constructor(Y){this.h1=Y?Y&4294967295:j,this.h2=Y?Y&4294967295:j}update(Y){let Q,Z;if(typeof Y=="string"){Q=new Uint8Array(Y.length*2),Z=0;for(let ge=0,fe=Y.length;ge<fe;ge++){const oe=Y.charCodeAt(ge);oe<=255?Q[Z++]=oe:(Q[Z++]=oe>>>8,Q[Z++]=oe&255)}}else if((0,$.isArrayBuffer)(Y))Q=Y.slice(),Z=Q.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const ee=Z>>2,te=Z-ee*4,ne=new Uint32Array(Q.buffer,0,ee);let re=0,ie=0,se=this.h1,le=this.h2;const he=3432918353,ce=461845907,ae=he&V,de=ce&V;for(let ge=0;ge<ee;ge++)ge&1?(re=ne[ge],re=re*he&z|re*ae&V,re=re<<15|re>>>17,re=re*ce&z|re*de&V,se^=re,se=se<<13|se>>>19,se=se*5+3864292196):(ie=ne[ge],ie=ie*he&z|ie*ae&V,ie=ie<<15|ie>>>17,ie=ie*ce&z|ie*de&V,le^=ie,le=le<<13|le>>>19,le=le*5+3864292196);switch(re=0,te){case 3:re^=Q[ee*4+2]<<16;case 2:re^=Q[ee*4+1]<<8;case 1:re^=Q[ee*4],re=re*he&z|re*ae&V,re=re<<15|re>>>17,re=re*ce&z|re*de&V,ee&1?se^=re:le^=re}this.h1=se,this.h2=le}hexdigest(){let Y=this.h1,Q=this.h2;return Y^=Q>>>1,Y=Y*3981806797&z|Y*36045&V,Q=Q*4283543511&z|((Q<<16|Y>>>16)*2950163797&z)>>>16,Y^=Q>>>1,Y=Y*444984403&z|Y*60499&V,Q=Q*3301882366&z|((Q<<16|Y>>>16)*3120437893&z)>>>16,Y^=Q>>>1,(Y>>>0).toString(16).padStart(8,"0")+(Q>>>0).toString(16).padStart(8,"0")}}_.MurmurHash3_64=G},(q,_,M)=>{var V;Object.defineProperty(_,"__esModule",{value:!0}),_.FontLoader=_.FontFaceObject=void 0;var $=M(1);class j{constructor({ownerDocument:X=globalThis.document,styleElement:Y=null}){Ge(this,V,new Set);this._document=X,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(X){this.nativeFontFaces.add(X),this._document.fonts.add(X)}removeNativeFontFace(X){this.nativeFontFaces.delete(X),this._document.fonts.delete(X)}insertRule(X){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const Y=this.styleElement.sheet;Y.insertRule(X,Y.cssRules.length)}clear(){for(const X of this.nativeFontFaces)this._document.fonts.delete(X);this.nativeFontFaces.clear(),ye(this,V).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(X){if(!(!X||ye(this,V).has(X.loadedName))){if((0,$.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:Y,src:Q,style:Z}=X,ee=new FontFace(Y,Q,Z);this.addNativeFontFace(ee);try{await ee.load(),ye(this,V).add(Y)}catch{(0,$.warn)(`Cannot load system font: ${X.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(ee)}return}(0,$.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(X){if(X.attached||X.missingFile&&!X.systemFontInfo)return;if(X.attached=!0,X.systemFontInfo){await this.loadSystemFont(X.systemFontInfo);return}if(this.isFontLoadingAPISupported){const Q=X.createNativeFontFace();if(Q){this.addNativeFontFace(Q);try{await Q.loaded}catch(Z){throw(0,$.warn)(`Failed to load font '${Q.family}': '${Z}'.`),X.disableFontFace=!0,Z}}return}const Y=X.createFontFaceRule();if(Y){if(this.insertRule(Y),this.isSyncFontLoadingSupported)return;await new Promise(Q=>{const Z=this._queueLoadingCallback(Q);this._prepareFontLoadEvent(X,Z)})}}get isFontLoadingAPISupported(){var Y;const X=!!((Y=this._document)!=null&&Y.fonts);return(0,$.shadow)(this,"isFontLoadingAPISupported",X)}get isSyncFontLoadingSupported(){let X=!1;return($.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(X=!0),(0,$.shadow)(this,"isSyncFontLoadingSupported",X)}_queueLoadingCallback(X){function Y(){for((0,$.assert)(!Z.done,"completeRequest() cannot be called twice."),Z.done=!0;Q.length>0&&Q[0].done;){const ee=Q.shift();setTimeout(ee.callback,0)}}const{loadingRequests:Q}=this,Z={done:!1,complete:Y,callback:X};return Q.push(Z),Z}get _loadTestFont(){const X=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,$.shadow)(this,"_loadTestFont",X)}_prepareFontLoadEvent(X,Y){function Q(De,ve){return De.charCodeAt(ve)<<24|De.charCodeAt(ve+1)<<16|De.charCodeAt(ve+2)<<8|De.charCodeAt(ve+3)&255}function Z(De,ve,Ce,ue){const Pe=De.substring(0,ve),ze=De.substring(ve+Ce);return Pe+ue+ze}let ee,te;const ne=this._document.createElement("canvas");ne.width=1,ne.height=1;const re=ne.getContext("2d");let ie=0;function se(De,ve){if(++ie>30){(0,$.warn)("Load test font never loaded."),ve();return}if(re.font="30px "+De,re.fillText(".",0,20),re.getImageData(0,0,1,1).data[3]>0){ve();return}setTimeout(se.bind(null,De,ve))}const le=`lt${Date.now()}${this.loadTestFontId++}`;let he=this._loadTestFont;he=Z(he,976,le.length,le);const ae=16,de=1482184792;let ge=Q(he,ae);for(ee=0,te=le.length-3;ee<te;ee+=4)ge=ge-de+Q(le,ee)|0;ee<le.length&&(ge=ge-de+Q(le+"XXX",ee)|0),he=Z(he,ae,4,(0,$.string32)(ge));const fe=`url(data:font/opentype;base64,${btoa(he)});`,oe=`@font-face {font-family:"${le}";src:${fe}}`;this.insertRule(oe);const we=this._document.createElement("div");we.style.visibility="hidden",we.style.width=we.style.height="10px",we.style.position="absolute",we.style.top=we.style.left="0px";for(const De of[X.loadedName,le]){const ve=this._document.createElement("span");ve.textContent="Hi",ve.style.fontFamily=De,we.append(ve)}this._document.body.append(we),se(le,()=>{we.remove(),Y.complete()})}}V=new WeakMap,_.FontLoader=j;class z{constructor(X,{isEvalSupported:Y=!0,disableFontFace:Q=!1,ignoreErrors:Z=!1,inspectFont:ee=null}){this.compiledGlyphs=Object.create(null);for(const te in X)this[te]=X[te];this.isEvalSupported=Y!==!1,this.disableFontFace=Q===!0,this.ignoreErrors=Z===!0,this._inspectFont=ee}createNativeFontFace(){var Y;if(!this.data||this.disableFontFace)return null;let X;if(!this.cssFontInfo)X=new FontFace(this.loadedName,this.data,{});else{const Q={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(Q.style=`oblique ${this.cssFontInfo.italicAngle}deg`),X=new FontFace(this.cssFontInfo.fontFamily,this.data,Q)}return(Y=this._inspectFont)==null||Y.call(this,this),X}createFontFaceRule(){var Z;if(!this.data||this.disableFontFace)return null;const X=(0,$.bytesToString)(this.data),Y=`url(data:${this.mimetype};base64,${btoa(X)});`;let Q;if(!this.cssFontInfo)Q=`@font-face {font-family:"${this.loadedName}";src:${Y}}`;else{let ee=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(ee+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),Q=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${ee}src:${Y}}`}return(Z=this._inspectFont)==null||Z.call(this,this,Y),Q}getPathGenerator(X,Y){if(this.compiledGlyphs[Y]!==void 0)return this.compiledGlyphs[Y];let Q;try{Q=X.get(this.loadedName+"_path_"+Y)}catch(Z){if(!this.ignoreErrors)throw Z;return(0,$.warn)(`getPathGenerator - ignoring character: "${Z}".`),this.compiledGlyphs[Y]=function(ee,te){}}if(this.isEvalSupported&&$.FeatureTest.isEvalSupported){const Z=[];for(const ee of Q){const te=ee.args!==void 0?ee.args.join(","):"";Z.push("c.",ee.cmd,"(",te,`);
`)}return this.compiledGlyphs[Y]=new Function("c","size",Z.join(""))}return this.compiledGlyphs[Y]=function(Z,ee){for(const te of Q)te.cmd==="scale"&&(te.args=[ee,-ee]),Z[te.cmd].apply(Z,te.args)}}}_.FontFaceObject=z},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.NodeStandardFontDataFactory=_.NodeFilterFactory=_.NodeCanvasFactory=_.NodeCMapReaderFactory=void 0;var $=M(7);M(1);const j=function(Y){return new Promise((Q,Z)=>{require$$5.readFile(Y,(te,ne)=>{if(te||!ne){Z(new Error(te));return}Q(new Uint8Array(ne))})})};class z extends $.BaseFilterFactory{}_.NodeFilterFactory=z;class V extends $.BaseCanvasFactory{_createCanvas(Q,Z){return require$$5.createCanvas(Q,Z)}}_.NodeCanvasFactory=V;class G extends $.BaseCMapReaderFactory{_fetchData(Q,Z){return j(Q).then(ee=>({cMapData:ee,compressionType:Z}))}}_.NodeCMapReaderFactory=G;class X extends $.BaseStandardFontDataFactory{_fetchData(Q){return j(Q)}}_.NodeStandardFontDataFactory=X},(q,_,M)=>{var Me,jn,Ye,zn;Object.defineProperty(_,"__esModule",{value:!0}),_.CanvasGraphics=void 0;var $=M(1),j=M(6),z=M(12),V=M(13);const G=16,X=100,Y=4096,Q=15,Z=10,ee=1e3,te=16;function ne(Se,pe){if(Se._removeMirroring)throw new Error("Context is already forwarding operations.");Se.__originalSave=Se.save,Se.__originalRestore=Se.restore,Se.__originalRotate=Se.rotate,Se.__originalScale=Se.scale,Se.__originalTranslate=Se.translate,Se.__originalTransform=Se.transform,Se.__originalSetTransform=Se.setTransform,Se.__originalResetTransform=Se.resetTransform,Se.__originalClip=Se.clip,Se.__originalMoveTo=Se.moveTo,Se.__originalLineTo=Se.lineTo,Se.__originalBezierCurveTo=Se.bezierCurveTo,Se.__originalRect=Se.rect,Se.__originalClosePath=Se.closePath,Se.__originalBeginPath=Se.beginPath,Se._removeMirroring=()=>{Se.save=Se.__originalSave,Se.restore=Se.__originalRestore,Se.rotate=Se.__originalRotate,Se.scale=Se.__originalScale,Se.translate=Se.__originalTranslate,Se.transform=Se.__originalTransform,Se.setTransform=Se.__originalSetTransform,Se.resetTransform=Se.__originalResetTransform,Se.clip=Se.__originalClip,Se.moveTo=Se.__originalMoveTo,Se.lineTo=Se.__originalLineTo,Se.bezierCurveTo=Se.__originalBezierCurveTo,Se.rect=Se.__originalRect,Se.closePath=Se.__originalClosePath,Se.beginPath=Se.__originalBeginPath,delete Se._removeMirroring},Se.save=function(){pe.save(),this.__originalSave()},Se.restore=function(){pe.restore(),this.__originalRestore()},Se.translate=function(be,Ee){pe.translate(be,Ee),this.__originalTranslate(be,Ee)},Se.scale=function(be,Ee){pe.scale(be,Ee),this.__originalScale(be,Ee)},Se.transform=function(be,Ee,ke,Fe,Be,Ue){pe.transform(be,Ee,ke,Fe,Be,Ue),this.__originalTransform(be,Ee,ke,Fe,Be,Ue)},Se.setTransform=function(be,Ee,ke,Fe,Be,Ue){pe.setTransform(be,Ee,ke,Fe,Be,Ue),this.__originalSetTransform(be,Ee,ke,Fe,Be,Ue)},Se.resetTransform=function(){pe.resetTransform(),this.__originalResetTransform()},Se.rotate=function(be){pe.rotate(be),this.__originalRotate(be)},Se.clip=function(be){pe.clip(be),this.__originalClip(be)},Se.moveTo=function(me,be){pe.moveTo(me,be),this.__originalMoveTo(me,be)},Se.lineTo=function(me,be){pe.lineTo(me,be),this.__originalLineTo(me,be)},Se.bezierCurveTo=function(me,be,Ee,ke,Fe,Be){pe.bezierCurveTo(me,be,Ee,ke,Fe,Be),this.__originalBezierCurveTo(me,be,Ee,ke,Fe,Be)},Se.rect=function(me,be,Ee,ke){pe.rect(me,be,Ee,ke),this.__originalRect(me,be,Ee,ke)},Se.closePath=function(){pe.closePath(),this.__originalClosePath()},Se.beginPath=function(){pe.beginPath(),this.__originalBeginPath()}}class re{constructor(pe){this.canvasFactory=pe,this.cache=Object.create(null)}getCanvas(pe,me,be){let Ee;return this.cache[pe]!==void 0?(Ee=this.cache[pe],this.canvasFactory.reset(Ee,me,be)):(Ee=this.canvasFactory.create(me,be),this.cache[pe]=Ee),Ee}delete(pe){delete this.cache[pe]}clear(){for(const pe in this.cache){const me=this.cache[pe];this.canvasFactory.destroy(me),delete this.cache[pe]}}}function ie(Se,pe,me,be,Ee,ke,Fe,Be,Ue,nt){const[rt,_e,We,Xe,Te,Re]=(0,j.getCurrentTransform)(Se);if(_e===0&&We===0){const ot=Fe*rt+Te,$e=Math.round(ot),je=Be*Xe+Re,Ke=Math.round(je),Qe=(Fe+Ue)*rt+Te,dt=Math.abs(Math.round(Qe)-$e)||1,pt=(Be+nt)*Xe+Re,wt=Math.abs(Math.round(pt)-Ke)||1;return Se.setTransform(Math.sign(rt),0,0,Math.sign(Xe),$e,Ke),Se.drawImage(pe,me,be,Ee,ke,0,0,dt,wt),Se.setTransform(rt,_e,We,Xe,Te,Re),[dt,wt]}if(rt===0&&Xe===0){const ot=Be*We+Te,$e=Math.round(ot),je=Fe*_e+Re,Ke=Math.round(je),Qe=(Be+nt)*We+Te,dt=Math.abs(Math.round(Qe)-$e)||1,pt=(Fe+Ue)*_e+Re,wt=Math.abs(Math.round(pt)-Ke)||1;return Se.setTransform(0,Math.sign(_e),Math.sign(We),0,$e,Ke),Se.drawImage(pe,me,be,Ee,ke,0,0,wt,dt),Se.setTransform(rt,_e,We,Xe,Te,Re),[wt,dt]}Se.drawImage(pe,me,be,Ee,ke,Fe,Be,Ue,nt);const He=Math.hypot(rt,_e),Ze=Math.hypot(We,Xe);return[He*Ue,Ze*nt]}function se(Se){const{width:pe,height:me}=Se;if(pe>ee||me>ee)return null;const be=1e3,Ee=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),ke=pe+1;let Fe=new Uint8Array(ke*(me+1)),Be,Ue,nt;const rt=pe+7&-8;let _e=new Uint8Array(rt*me),We=0;for(const Ze of Se.data){let ot=128;for(;ot>0;)_e[We++]=Ze&ot?0:255,ot>>=1}let Xe=0;for(We=0,_e[We]!==0&&(Fe[0]=1,++Xe),Ue=1;Ue<pe;Ue++)_e[We]!==_e[We+1]&&(Fe[Ue]=_e[We]?2:1,++Xe),We++;for(_e[We]!==0&&(Fe[Ue]=2,++Xe),Be=1;Be<me;Be++){We=Be*rt,nt=Be*ke,_e[We-rt]!==_e[We]&&(Fe[nt]=_e[We]?1:8,++Xe);let Ze=(_e[We]?4:0)+(_e[We-rt]?8:0);for(Ue=1;Ue<pe;Ue++)Ze=(Ze>>2)+(_e[We+1]?4:0)+(_e[We-rt+1]?8:0),Ee[Ze]&&(Fe[nt+Ue]=Ee[Ze],++Xe),We++;if(_e[We-rt]!==_e[We]&&(Fe[nt+Ue]=_e[We]?2:4,++Xe),Xe>be)return null}for(We=rt*(me-1),nt=Be*ke,_e[We]!==0&&(Fe[nt]=8,++Xe),Ue=1;Ue<pe;Ue++)_e[We]!==_e[We+1]&&(Fe[nt+Ue]=_e[We]?4:8,++Xe),We++;if(_e[We]!==0&&(Fe[nt+Ue]=4,++Xe),Xe>be)return null;const Te=new Int32Array([0,ke,-1,0,-ke,0,0,0,1]),Re=new Path2D;for(Be=0;Xe&&Be<=me;Be++){let Ze=Be*ke;const ot=Ze+pe;for(;Ze<ot&&!Fe[Ze];)Ze++;if(Ze===ot)continue;Re.moveTo(Ze%ke,Be);const $e=Ze;let je=Fe[Ze];do{const Ke=Te[je];do Ze+=Ke;while(!Fe[Ze]);const Qe=Fe[Ze];Qe!==5&&Qe!==10?(je=Qe,Fe[Ze]=0):(je=Qe&51*je>>4,Fe[Ze]&=je>>2|je<<2),Re.lineTo(Ze%ke,Ze/ke|0),Fe[Ze]||--Xe}while($e!==Ze);--Be}return _e=null,Fe=null,function(Ze){Ze.save(),Ze.scale(1/pe,-1/me),Ze.translate(0,-me),Ze.fill(Re),Ze.beginPath(),Ze.restore()}}class le{constructor(pe,me){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=$.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=$.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=$.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,pe,me])}clone(){const pe=Object.create(this);return pe.clipBox=this.clipBox.slice(),pe}setCurrentPoint(pe,me){this.x=pe,this.y=me}updatePathMinMax(pe,me,be){[me,be]=$.Util.applyTransform([me,be],pe),this.minX=Math.min(this.minX,me),this.minY=Math.min(this.minY,be),this.maxX=Math.max(this.maxX,me),this.maxY=Math.max(this.maxY,be)}updateRectMinMax(pe,me){const be=$.Util.applyTransform(me,pe),Ee=$.Util.applyTransform(me.slice(2),pe);this.minX=Math.min(this.minX,be[0],Ee[0]),this.minY=Math.min(this.minY,be[1],Ee[1]),this.maxX=Math.max(this.maxX,be[0],Ee[0]),this.maxY=Math.max(this.maxY,be[1],Ee[1])}updateScalingPathMinMax(pe,me){$.Util.scaleMinMax(pe,me),this.minX=Math.min(this.minX,me[0]),this.maxX=Math.max(this.maxX,me[1]),this.minY=Math.min(this.minY,me[2]),this.maxY=Math.max(this.maxY,me[3])}updateCurvePathMinMax(pe,me,be,Ee,ke,Fe,Be,Ue,nt,rt){const _e=$.Util.bezierBoundingBox(me,be,Ee,ke,Fe,Be,Ue,nt);if(rt){rt[0]=Math.min(rt[0],_e[0],_e[2]),rt[1]=Math.max(rt[1],_e[0],_e[2]),rt[2]=Math.min(rt[2],_e[1],_e[3]),rt[3]=Math.max(rt[3],_e[1],_e[3]);return}this.updateRectMinMax(pe,_e)}getPathBoundingBox(pe=z.PathType.FILL,me=null){const be=[this.minX,this.minY,this.maxX,this.maxY];if(pe===z.PathType.STROKE){me||(0,$.unreachable)("Stroke bounding box must include transform.");const Ee=$.Util.singularValueDecompose2dScale(me),ke=Ee[0]*this.lineWidth/2,Fe=Ee[1]*this.lineWidth/2;be[0]-=ke,be[1]-=Fe,be[2]+=ke,be[3]+=Fe}return be}updateClipFromPath(){const pe=$.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(pe||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(pe){this.clipBox=pe,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(pe=z.PathType.FILL,me=null){return $.Util.intersect(this.clipBox,this.getPathBoundingBox(pe,me))}}function he(Se,pe){if(typeof ImageData<"u"&&pe instanceof ImageData){Se.putImageData(pe,0,0);return}const me=pe.height,be=pe.width,Ee=me%te,ke=(me-Ee)/te,Fe=Ee===0?ke:ke+1,Be=Se.createImageData(be,te);let Ue=0,nt;const rt=pe.data,_e=Be.data;let We,Xe,Te,Re;if(pe.kind===$.ImageKind.GRAYSCALE_1BPP){const He=rt.byteLength,Ze=new Uint32Array(_e.buffer,0,_e.byteLength>>2),ot=Ze.length,$e=be+7>>3,je=4294967295,Ke=$.FeatureTest.isLittleEndian?4278190080:255;for(We=0;We<Fe;We++){for(Te=We<ke?te:Ee,nt=0,Xe=0;Xe<Te;Xe++){const Qe=He-Ue;let dt=0;const pt=Qe>$e?be:Qe*8-7,wt=pt&-8;let St=0,Rt=0;for(;dt<wt;dt+=8)Rt=rt[Ue++],Ze[nt++]=Rt&128?je:Ke,Ze[nt++]=Rt&64?je:Ke,Ze[nt++]=Rt&32?je:Ke,Ze[nt++]=Rt&16?je:Ke,Ze[nt++]=Rt&8?je:Ke,Ze[nt++]=Rt&4?je:Ke,Ze[nt++]=Rt&2?je:Ke,Ze[nt++]=Rt&1?je:Ke;for(;dt<pt;dt++)St===0&&(Rt=rt[Ue++],St=128),Ze[nt++]=Rt&St?je:Ke,St>>=1}for(;nt<ot;)Ze[nt++]=0;Se.putImageData(Be,0,We*te)}}else if(pe.kind===$.ImageKind.RGBA_32BPP){for(Xe=0,Re=be*te*4,We=0;We<ke;We++)_e.set(rt.subarray(Ue,Ue+Re)),Ue+=Re,Se.putImageData(Be,0,Xe),Xe+=te;We<Fe&&(Re=be*Ee*4,_e.set(rt.subarray(Ue,Ue+Re)),Se.putImageData(Be,0,Xe))}else if(pe.kind===$.ImageKind.RGB_24BPP)for(Te=te,Re=be*Te,We=0;We<Fe;We++){for(We>=ke&&(Te=Ee,Re=be*Te),nt=0,Xe=Re;Xe--;)_e[nt++]=rt[Ue++],_e[nt++]=rt[Ue++],_e[nt++]=rt[Ue++],_e[nt++]=255;Se.putImageData(Be,0,We*te)}else throw new Error(`bad image kind: ${pe.kind}`)}function ce(Se,pe){if(pe.bitmap){Se.drawImage(pe.bitmap,0,0);return}const me=pe.height,be=pe.width,Ee=me%te,ke=(me-Ee)/te,Fe=Ee===0?ke:ke+1,Be=Se.createImageData(be,te);let Ue=0;const nt=pe.data,rt=Be.data;for(let _e=0;_e<Fe;_e++){const We=_e<ke?te:Ee;({srcPos:Ue}=(0,V.convertBlackAndWhiteToRGBA)({src:nt,srcPos:Ue,dest:rt,width:be,height:We,nonBlackColor:0})),Se.putImageData(Be,0,_e*te)}}function ae(Se,pe){const me=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const be of me)Se[be]!==void 0&&(pe[be]=Se[be]);Se.setLineDash!==void 0&&(pe.setLineDash(Se.getLineDash()),pe.lineDashOffset=Se.lineDashOffset)}function de(Se){if(Se.strokeStyle=Se.fillStyle="#000000",Se.fillRule="nonzero",Se.globalAlpha=1,Se.lineWidth=1,Se.lineCap="butt",Se.lineJoin="miter",Se.miterLimit=10,Se.globalCompositeOperation="source-over",Se.font="10px sans-serif",Se.setLineDash!==void 0&&(Se.setLineDash([]),Se.lineDashOffset=0),!$.isNodeJS){const{filter:pe}=Se;pe!=="none"&&pe!==""&&(Se.filter="none")}}function ge(Se,pe,me,be){const Ee=Se.length;for(let ke=3;ke<Ee;ke+=4){const Fe=Se[ke];if(Fe===0)Se[ke-3]=pe,Se[ke-2]=me,Se[ke-1]=be;else if(Fe<255){const Be=255-Fe;Se[ke-3]=Se[ke-3]*Fe+pe*Be>>8,Se[ke-2]=Se[ke-2]*Fe+me*Be>>8,Se[ke-1]=Se[ke-1]*Fe+be*Be>>8}}}function fe(Se,pe,me){const be=Se.length,Ee=1/255;for(let ke=3;ke<be;ke+=4){const Fe=me?me[Se[ke]]:Se[ke];pe[ke]=pe[ke]*Fe*Ee|0}}function oe(Se,pe,me){const be=Se.length;for(let Ee=3;Ee<be;Ee+=4){const ke=Se[Ee-3]*77+Se[Ee-2]*152+Se[Ee-1]*28;pe[Ee]=me?pe[Ee]*me[ke>>8]>>8:pe[Ee]*ke>>16}}function we(Se,pe,me,be,Ee,ke,Fe,Be,Ue,nt,rt){const _e=!!ke,We=_e?ke[0]:0,Xe=_e?ke[1]:0,Te=_e?ke[2]:0,Re=Ee==="Luminosity"?oe:fe,Ze=Math.min(be,Math.ceil(1048576/me));for(let ot=0;ot<be;ot+=Ze){const $e=Math.min(Ze,be-ot),je=Se.getImageData(Be-nt,ot+(Ue-rt),me,$e),Ke=pe.getImageData(Be,ot+Ue,me,$e);_e&&ge(je.data,We,Xe,Te),Re(je.data,Ke.data,Fe),pe.putImageData(Ke,Be,ot+Ue)}}function De(Se,pe,me,be){const Ee=be[0],ke=be[1],Fe=be[2]-Ee,Be=be[3]-ke;Fe===0||Be===0||(we(pe.context,me,Fe,Be,pe.subtype,pe.backdrop,pe.transferMap,Ee,ke,pe.offsetX,pe.offsetY),Se.save(),Se.globalAlpha=1,Se.globalCompositeOperation="source-over",Se.setTransform(1,0,0,1,0,0),Se.drawImage(me.canvas,0,0),Se.restore())}function ve(Se,pe){const me=$.Util.singularValueDecompose2dScale(Se);me[0]=Math.fround(me[0]),me[1]=Math.fround(me[1]);const be=Math.fround((globalThis.devicePixelRatio||1)*j.PixelsPerInch.PDF_TO_CSS_UNITS);return pe!==void 0?pe:me[0]<=be||me[1]<=be}const Ce=["butt","round","square"],ue=["miter","round","bevel"],Pe={},ze={},Oe=class Oe{constructor(pe,me,be,Ee,ke,{optionalContentConfig:Fe,markedContentStack:Be=null},Ue,nt){Ge(this,Me);Ge(this,Ye);this.ctx=pe,this.current=new le(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=me,this.objs=be,this.canvasFactory=Ee,this.filterFactory=ke,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=Be||[],this.optionalContentConfig=Fe,this.cachedCanvases=new re(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=Ue,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=nt,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(pe,me=null){return typeof pe=="string"?pe.startsWith("g_")?this.commonObjs.get(pe):this.objs.get(pe):me}beginDrawing({transform:pe,viewport:me,transparency:be=!1,background:Ee=null}){const ke=this.ctx.canvas.width,Fe=this.ctx.canvas.height,Be=this.ctx.fillStyle;if(this.ctx.fillStyle=Ee||"#ffffff",this.ctx.fillRect(0,0,ke,Fe),this.ctx.fillStyle=Be,be){const Ue=this.cachedCanvases.getCanvas("transparent",ke,Fe);this.compositeCtx=this.ctx,this.transparentCanvas=Ue.canvas,this.ctx=Ue.context,this.ctx.save(),this.ctx.transform(...(0,j.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),de(this.ctx),pe&&(this.ctx.transform(...pe),this.outputScaleX=pe[0],this.outputScaleY=pe[0]),this.ctx.transform(...me.transform),this.viewportScale=me.scale,this.baseTransform=(0,j.getCurrentTransform)(this.ctx)}executeOperatorList(pe,me,be,Ee){const ke=pe.argsArray,Fe=pe.fnArray;let Be=me||0;const Ue=ke.length;if(Ue===Be)return Be;const nt=Ue-Be>Z&&typeof be=="function",rt=nt?Date.now()+Q:0;let _e=0;const We=this.commonObjs,Xe=this.objs;let Te;for(;;){if(Ee!==void 0&&Be===Ee.nextBreakPoint)return Ee.breakIt(Be,be),Be;if(Te=Fe[Be],Te!==$.OPS.dependency)this[Te].apply(this,ke[Be]);else for(const Re of ke[Be]){const He=Re.startsWith("g_")?We:Xe;if(!He.has(Re))return He.get(Re,be),Be}if(Be++,Be===Ue)return Be;if(nt&&++_e>Z){if(Date.now()>rt)return be(),Be;_e=0}}}endDrawing(){it(this,Me,jn).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const pe of this._cachedBitmapsMap.values()){for(const me of pe.values())typeof HTMLCanvasElement<"u"&&me instanceof HTMLCanvasElement&&(me.width=me.height=0);pe.clear()}this._cachedBitmapsMap.clear(),it(this,Ye,zn).call(this)}_scaleImage(pe,me){const be=pe.width,Ee=pe.height;let ke=Math.max(Math.hypot(me[0],me[1]),1),Fe=Math.max(Math.hypot(me[2],me[3]),1),Be=be,Ue=Ee,nt="prescale1",rt,_e;for(;ke>2&&Be>1||Fe>2&&Ue>1;){let We=Be,Xe=Ue;ke>2&&Be>1&&(We=Be>=16384?Math.floor(Be/2)-1||1:Math.ceil(Be/2),ke/=Be/We),Fe>2&&Ue>1&&(Xe=Ue>=16384?Math.floor(Ue/2)-1||1:Math.ceil(Ue)/2,Fe/=Ue/Xe),rt=this.cachedCanvases.getCanvas(nt,We,Xe),_e=rt.context,_e.clearRect(0,0,We,Xe),_e.drawImage(pe,0,0,Be,Ue,0,0,We,Xe),pe=rt.canvas,Be=We,Ue=Xe,nt=nt==="prescale1"?"prescale2":"prescale1"}return{img:pe,paintWidth:Be,paintHeight:Ue}}_createMaskCanvas(pe){const me=this.ctx,{width:be,height:Ee}=pe,ke=this.current.fillColor,Fe=this.current.patternFill,Be=(0,j.getCurrentTransform)(me);let Ue,nt,rt,_e;if((pe.bitmap||pe.data)&&pe.count>1){const dt=pe.bitmap||pe.data.buffer;nt=JSON.stringify(Fe?Be:[Be.slice(0,4),ke]),Ue=this._cachedBitmapsMap.get(dt),Ue||(Ue=new Map,this._cachedBitmapsMap.set(dt,Ue));const pt=Ue.get(nt);if(pt&&!Fe){const wt=Math.round(Math.min(Be[0],Be[2])+Be[4]),St=Math.round(Math.min(Be[1],Be[3])+Be[5]);return{canvas:pt,offsetX:wt,offsetY:St}}rt=pt}rt||(_e=this.cachedCanvases.getCanvas("maskCanvas",be,Ee),ce(_e.context,pe));let We=$.Util.transform(Be,[1/be,0,0,-1/Ee,0,0]);We=$.Util.transform(We,[1,0,0,1,0,-Ee]);const Xe=$.Util.applyTransform([0,0],We),Te=$.Util.applyTransform([be,Ee],We),Re=$.Util.normalizeRect([Xe[0],Xe[1],Te[0],Te[1]]),He=Math.round(Re[2]-Re[0])||1,Ze=Math.round(Re[3]-Re[1])||1,ot=this.cachedCanvases.getCanvas("fillCanvas",He,Ze),$e=ot.context,je=Math.min(Xe[0],Te[0]),Ke=Math.min(Xe[1],Te[1]);$e.translate(-je,-Ke),$e.transform(...We),rt||(rt=this._scaleImage(_e.canvas,(0,j.getCurrentTransformInverse)($e)),rt=rt.img,Ue&&Fe&&Ue.set(nt,rt)),$e.imageSmoothingEnabled=ve((0,j.getCurrentTransform)($e),pe.interpolate),ie($e,rt,0,0,rt.width,rt.height,0,0,be,Ee),$e.globalCompositeOperation="source-in";const Qe=$.Util.transform((0,j.getCurrentTransformInverse)($e),[1,0,0,1,-je,-Ke]);return $e.fillStyle=Fe?ke.getPattern(me,this,Qe,z.PathType.FILL):ke,$e.fillRect(0,0,be,Ee),Ue&&!Fe&&(this.cachedCanvases.delete("fillCanvas"),Ue.set(nt,ot.canvas)),{canvas:ot.canvas,offsetX:Math.round(je),offsetY:Math.round(Ke)}}setLineWidth(pe){pe!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=pe,this.ctx.lineWidth=pe}setLineCap(pe){this.ctx.lineCap=Ce[pe]}setLineJoin(pe){this.ctx.lineJoin=ue[pe]}setMiterLimit(pe){this.ctx.miterLimit=pe}setDash(pe,me){const be=this.ctx;be.setLineDash!==void 0&&(be.setLineDash(pe),be.lineDashOffset=me)}setRenderingIntent(pe){}setFlatness(pe){}setGState(pe){for(const[me,be]of pe)switch(me){case"LW":this.setLineWidth(be);break;case"LC":this.setLineCap(be);break;case"LJ":this.setLineJoin(be);break;case"ML":this.setMiterLimit(be);break;case"D":this.setDash(be[0],be[1]);break;case"RI":this.setRenderingIntent(be);break;case"FL":this.setFlatness(be);break;case"Font":this.setFont(be[0],be[1]);break;case"CA":this.current.strokeAlpha=be;break;case"ca":this.current.fillAlpha=be,this.ctx.globalAlpha=be;break;case"BM":this.ctx.globalCompositeOperation=be;break;case"SMask":this.current.activeSMask=be?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(be);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const pe=this.inSMaskMode;this.current.activeSMask&&!pe?this.beginSMaskMode():!this.current.activeSMask&&pe&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const pe=this.ctx.canvas.width,me=this.ctx.canvas.height,be="smaskGroupAt"+this.groupLevel,Ee=this.cachedCanvases.getCanvas(be,pe,me);this.suspendedCtx=this.ctx,this.ctx=Ee.context;const ke=this.ctx;ke.setTransform(...(0,j.getCurrentTransform)(this.suspendedCtx)),ae(this.suspendedCtx,ke),ne(ke,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ae(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(pe){if(!this.current.activeSMask)return;pe?(pe[0]=Math.floor(pe[0]),pe[1]=Math.floor(pe[1]),pe[2]=Math.ceil(pe[2]),pe[3]=Math.ceil(pe[3])):pe=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const me=this.current.activeSMask,be=this.suspendedCtx;De(be,me,this.ctx,pe),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(ae(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const pe=this.current;this.stateStack.push(pe),this.current=pe.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),ae(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(pe,me,be,Ee,ke,Fe){this.ctx.transform(pe,me,be,Ee,ke,Fe),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(pe,me,be){const Ee=this.ctx,ke=this.current;let Fe=ke.x,Be=ke.y,Ue,nt;const rt=(0,j.getCurrentTransform)(Ee),_e=rt[0]===0&&rt[3]===0||rt[1]===0&&rt[2]===0,We=_e?be.slice(0):null;for(let Xe=0,Te=0,Re=pe.length;Xe<Re;Xe++)switch(pe[Xe]|0){case $.OPS.rectangle:Fe=me[Te++],Be=me[Te++];const He=me[Te++],Ze=me[Te++],ot=Fe+He,$e=Be+Ze;Ee.moveTo(Fe,Be),He===0||Ze===0?Ee.lineTo(ot,$e):(Ee.lineTo(ot,Be),Ee.lineTo(ot,$e),Ee.lineTo(Fe,$e)),_e||ke.updateRectMinMax(rt,[Fe,Be,ot,$e]),Ee.closePath();break;case $.OPS.moveTo:Fe=me[Te++],Be=me[Te++],Ee.moveTo(Fe,Be),_e||ke.updatePathMinMax(rt,Fe,Be);break;case $.OPS.lineTo:Fe=me[Te++],Be=me[Te++],Ee.lineTo(Fe,Be),_e||ke.updatePathMinMax(rt,Fe,Be);break;case $.OPS.curveTo:Ue=Fe,nt=Be,Fe=me[Te+4],Be=me[Te+5],Ee.bezierCurveTo(me[Te],me[Te+1],me[Te+2],me[Te+3],Fe,Be),ke.updateCurvePathMinMax(rt,Ue,nt,me[Te],me[Te+1],me[Te+2],me[Te+3],Fe,Be,We),Te+=6;break;case $.OPS.curveTo2:Ue=Fe,nt=Be,Ee.bezierCurveTo(Fe,Be,me[Te],me[Te+1],me[Te+2],me[Te+3]),ke.updateCurvePathMinMax(rt,Ue,nt,Fe,Be,me[Te],me[Te+1],me[Te+2],me[Te+3],We),Fe=me[Te+2],Be=me[Te+3],Te+=4;break;case $.OPS.curveTo3:Ue=Fe,nt=Be,Fe=me[Te+2],Be=me[Te+3],Ee.bezierCurveTo(me[Te],me[Te+1],Fe,Be,Fe,Be),ke.updateCurvePathMinMax(rt,Ue,nt,me[Te],me[Te+1],Fe,Be,Fe,Be,We),Te+=4;break;case $.OPS.closePath:Ee.closePath();break}_e&&ke.updateScalingPathMinMax(rt,We),ke.setCurrentPoint(Fe,Be)}closePath(){this.ctx.closePath()}stroke(pe=!0){const me=this.ctx,be=this.current.strokeColor;me.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof be=="object"&&(be!=null&&be.getPattern)?(me.save(),me.strokeStyle=be.getPattern(me,this,(0,j.getCurrentTransformInverse)(me),z.PathType.STROKE),this.rescaleAndStroke(!1),me.restore()):this.rescaleAndStroke(!0)),pe&&this.consumePath(this.current.getClippedPathBoundingBox()),me.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(pe=!0){const me=this.ctx,be=this.current.fillColor,Ee=this.current.patternFill;let ke=!1;Ee&&(me.save(),me.fillStyle=be.getPattern(me,this,(0,j.getCurrentTransformInverse)(me),z.PathType.FILL),ke=!0);const Fe=this.current.getClippedPathBoundingBox();this.contentVisible&&Fe!==null&&(this.pendingEOFill?(me.fill("evenodd"),this.pendingEOFill=!1):me.fill()),ke&&me.restore(),pe&&this.consumePath(Fe)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Pe}eoClip(){this.pendingClip=ze}beginText(){this.current.textMatrix=$.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const pe=this.pendingTextPaths,me=this.ctx;if(pe===void 0){me.beginPath();return}me.save(),me.beginPath();for(const be of pe)me.setTransform(...be.transform),me.translate(be.x,be.y),be.addToPath(me,be.fontSize);me.restore(),me.clip(),me.beginPath(),delete this.pendingTextPaths}setCharSpacing(pe){this.current.charSpacing=pe}setWordSpacing(pe){this.current.wordSpacing=pe}setHScale(pe){this.current.textHScale=pe/100}setLeading(pe){this.current.leading=-pe}setFont(pe,me){var rt;const be=this.commonObjs.get(pe),Ee=this.current;if(!be)throw new Error(`Can't find font for ${pe}`);if(Ee.fontMatrix=be.fontMatrix||$.FONT_IDENTITY_MATRIX,(Ee.fontMatrix[0]===0||Ee.fontMatrix[3]===0)&&(0,$.warn)("Invalid font matrix for font "+pe),me<0?(me=-me,Ee.fontDirection=-1):Ee.fontDirection=1,this.current.font=be,this.current.fontSize=me,be.isType3Font)return;const ke=be.loadedName||"sans-serif",Fe=((rt=be.systemFontInfo)==null?void 0:rt.css)||`"${ke}", ${be.fallbackName}`;let Be="normal";be.black?Be="900":be.bold&&(Be="bold");const Ue=be.italic?"italic":"normal";let nt=me;me<G?nt=G:me>X&&(nt=X),this.current.fontSizeScale=me/nt,this.ctx.font=`${Ue} ${Be} ${nt}px ${Fe}`}setTextRenderingMode(pe){this.current.textRenderingMode=pe}setTextRise(pe){this.current.textRise=pe}moveText(pe,me){this.current.x=this.current.lineX+=pe,this.current.y=this.current.lineY+=me}setLeadingMoveText(pe,me){this.setLeading(-me),this.moveText(pe,me)}setTextMatrix(pe,me,be,Ee,ke,Fe){this.current.textMatrix=[pe,me,be,Ee,ke,Fe],this.current.textMatrixScale=Math.hypot(pe,me),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(pe,me,be,Ee){const ke=this.ctx,Fe=this.current,Be=Fe.font,Ue=Fe.textRenderingMode,nt=Fe.fontSize/Fe.fontSizeScale,rt=Ue&$.TextRenderingMode.FILL_STROKE_MASK,_e=!!(Ue&$.TextRenderingMode.ADD_TO_PATH_FLAG),We=Fe.patternFill&&!Be.missingFile;let Xe;(Be.disableFontFace||_e||We)&&(Xe=Be.getPathGenerator(this.commonObjs,pe)),Be.disableFontFace||We?(ke.save(),ke.translate(me,be),ke.beginPath(),Xe(ke,nt),Ee&&ke.setTransform(...Ee),(rt===$.TextRenderingMode.FILL||rt===$.TextRenderingMode.FILL_STROKE)&&ke.fill(),(rt===$.TextRenderingMode.STROKE||rt===$.TextRenderingMode.FILL_STROKE)&&ke.stroke(),ke.restore()):((rt===$.TextRenderingMode.FILL||rt===$.TextRenderingMode.FILL_STROKE)&&ke.fillText(pe,me,be),(rt===$.TextRenderingMode.STROKE||rt===$.TextRenderingMode.FILL_STROKE)&&ke.strokeText(pe,me,be)),_e&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,j.getCurrentTransform)(ke),x:me,y:be,fontSize:nt,addToPath:Xe})}get isFontSubpixelAAEnabled(){const{context:pe}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);pe.scale(1.5,1),pe.fillText("I",0,10);const me=pe.getImageData(0,0,10,10).data;let be=!1;for(let Ee=3;Ee<me.length;Ee+=4)if(me[Ee]>0&&me[Ee]<255){be=!0;break}return(0,$.shadow)(this,"isFontSubpixelAAEnabled",be)}showText(pe){const me=this.current,be=me.font;if(be.isType3Font)return this.showType3Text(pe);const Ee=me.fontSize;if(Ee===0)return;const ke=this.ctx,Fe=me.fontSizeScale,Be=me.charSpacing,Ue=me.wordSpacing,nt=me.fontDirection,rt=me.textHScale*nt,_e=pe.length,We=be.vertical,Xe=We?1:-1,Te=be.defaultVMetrics,Re=Ee*me.fontMatrix[0],He=me.textRenderingMode===$.TextRenderingMode.FILL&&!be.disableFontFace&&!me.patternFill;ke.save(),ke.transform(...me.textMatrix),ke.translate(me.x,me.y+me.textRise),nt>0?ke.scale(rt,-1):ke.scale(rt,1);let Ze;if(me.patternFill){ke.save();const Qe=me.fillColor.getPattern(ke,this,(0,j.getCurrentTransformInverse)(ke),z.PathType.FILL);Ze=(0,j.getCurrentTransform)(ke),ke.restore(),ke.fillStyle=Qe}let ot=me.lineWidth;const $e=me.textMatrixScale;if($e===0||ot===0){const Qe=me.textRenderingMode&$.TextRenderingMode.FILL_STROKE_MASK;(Qe===$.TextRenderingMode.STROKE||Qe===$.TextRenderingMode.FILL_STROKE)&&(ot=this.getSinglePixelWidth())}else ot/=$e;if(Fe!==1&&(ke.scale(Fe,Fe),ot/=Fe),ke.lineWidth=ot,be.isInvalidPDFjsFont){const Qe=[];let dt=0;for(const pt of pe)Qe.push(pt.unicode),dt+=pt.width;ke.fillText(Qe.join(""),0,0),me.x+=dt*Re*rt,ke.restore(),this.compose();return}let je=0,Ke;for(Ke=0;Ke<_e;++Ke){const Qe=pe[Ke];if(typeof Qe=="number"){je+=Xe*Qe*Ee/1e3;continue}let dt=!1;const pt=(Qe.isSpace?Ue:0)+Be,wt=Qe.fontChar,St=Qe.accent;let Rt,xt,It=Qe.width;if(We){const ft=Qe.vmetric||Te,lt=-(Qe.vmetric?ft[1]:It*.5)*Re,et=ft[2]*Re;It=ft?-ft[0]:It,Rt=lt/Fe,xt=(je+et)/Fe}else Rt=je/Fe,xt=0;if(be.remeasure&&It>0){const ft=ke.measureText(wt).width*1e3/Ee*Fe;if(It<ft&&this.isFontSubpixelAAEnabled){const lt=It/ft;dt=!0,ke.save(),ke.scale(lt,1),Rt/=lt}else It!==ft&&(Rt+=(It-ft)/2e3*Ee/Fe)}if(this.contentVisible&&(Qe.isInFont||be.missingFile)){if(He&&!St)ke.fillText(wt,Rt,xt);else if(this.paintChar(wt,Rt,xt,Ze),St){const ft=Rt+Ee*St.offset.x/Fe,lt=xt-Ee*St.offset.y/Fe;this.paintChar(St.fontChar,ft,lt,Ze)}}const ht=We?It*Re-pt*nt:It*Re+pt*nt;je+=ht,dt&&ke.restore()}We?me.y-=je:me.x+=je*rt,ke.restore(),this.compose()}showType3Text(pe){const me=this.ctx,be=this.current,Ee=be.font,ke=be.fontSize,Fe=be.fontDirection,Be=Ee.vertical?1:-1,Ue=be.charSpacing,nt=be.wordSpacing,rt=be.textHScale*Fe,_e=be.fontMatrix||$.FONT_IDENTITY_MATRIX,We=pe.length,Xe=be.textRenderingMode===$.TextRenderingMode.INVISIBLE;let Te,Re,He,Ze;if(!(Xe||ke===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,me.save(),me.transform(...be.textMatrix),me.translate(be.x,be.y),me.scale(rt,Fe),Te=0;Te<We;++Te){if(Re=pe[Te],typeof Re=="number"){Ze=Be*Re*ke/1e3,this.ctx.translate(Ze,0),be.x+=Ze*rt;continue}const ot=(Re.isSpace?nt:0)+Ue,$e=Ee.charProcOperatorList[Re.operatorListId];if(!$e){(0,$.warn)(`Type3 character "${Re.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Re,this.save(),me.scale(ke,ke),me.transform(..._e),this.executeOperatorList($e),this.restore()),He=$.Util.applyTransform([Re.width,0],_e)[0]*ke+ot,me.translate(He,0),be.x+=He*rt}me.restore(),this.processingType3=null}}setCharWidth(pe,me){}setCharWidthAndBounds(pe,me,be,Ee,ke,Fe){this.ctx.rect(be,Ee,ke-be,Fe-Ee),this.ctx.clip(),this.endPath()}getColorN_Pattern(pe){let me;if(pe[0]==="TilingPattern"){const be=pe[1],Ee=this.baseTransform||(0,j.getCurrentTransform)(this.ctx),ke={createCanvasGraphics:Fe=>new Oe(Fe,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};me=new z.TilingPattern(pe,be,this.ctx,ke,Ee)}else me=this._getPattern(pe[1],pe[2]);return me}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(pe,me,be){const Ee=$.Util.makeHexColor(pe,me,be);this.ctx.strokeStyle=Ee,this.current.strokeColor=Ee}setFillRGBColor(pe,me,be){const Ee=$.Util.makeHexColor(pe,me,be);this.ctx.fillStyle=Ee,this.current.fillColor=Ee,this.current.patternFill=!1}_getPattern(pe,me=null){let be;return this.cachedPatterns.has(pe)?be=this.cachedPatterns.get(pe):(be=(0,z.getShadingPattern)(this.getObject(pe)),this.cachedPatterns.set(pe,be)),me&&(be.matrix=me),be}shadingFill(pe){if(!this.contentVisible)return;const me=this.ctx;this.save();const be=this._getPattern(pe);me.fillStyle=be.getPattern(me,this,(0,j.getCurrentTransformInverse)(me),z.PathType.SHADING);const Ee=(0,j.getCurrentTransformInverse)(me);if(Ee){const{width:ke,height:Fe}=me.canvas,[Be,Ue,nt,rt]=$.Util.getAxialAlignedBoundingBox([0,0,ke,Fe],Ee);this.ctx.fillRect(Be,Ue,nt-Be,rt-Ue)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,$.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,$.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(pe,me){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(pe)&&pe.length===6&&this.transform(...pe),this.baseTransform=(0,j.getCurrentTransform)(this.ctx),me)){const be=me[2]-me[0],Ee=me[3]-me[1];this.ctx.rect(me[0],me[1],be,Ee),this.current.updateRectMinMax((0,j.getCurrentTransform)(this.ctx),me),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(pe){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const me=this.ctx;pe.isolated||(0,$.info)("TODO: Support non-isolated groups."),pe.knockout&&(0,$.warn)("Knockout groups not supported.");const be=(0,j.getCurrentTransform)(me);if(pe.matrix&&me.transform(...pe.matrix),!pe.bbox)throw new Error("Bounding box is required.");let Ee=$.Util.getAxialAlignedBoundingBox(pe.bbox,(0,j.getCurrentTransform)(me));const ke=[0,0,me.canvas.width,me.canvas.height];Ee=$.Util.intersect(Ee,ke)||[0,0,0,0];const Fe=Math.floor(Ee[0]),Be=Math.floor(Ee[1]);let Ue=Math.max(Math.ceil(Ee[2])-Fe,1),nt=Math.max(Math.ceil(Ee[3])-Be,1),rt=1,_e=1;Ue>Y&&(rt=Ue/Y,Ue=Y),nt>Y&&(_e=nt/Y,nt=Y),this.current.startNewPathAndClipBox([0,0,Ue,nt]);let We="groupAt"+this.groupLevel;pe.smask&&(We+="_smask_"+this.smaskCounter++%2);const Xe=this.cachedCanvases.getCanvas(We,Ue,nt),Te=Xe.context;Te.scale(1/rt,1/_e),Te.translate(-Fe,-Be),Te.transform(...be),pe.smask?this.smaskStack.push({canvas:Xe.canvas,context:Te,offsetX:Fe,offsetY:Be,scaleX:rt,scaleY:_e,subtype:pe.smask.subtype,backdrop:pe.smask.backdrop,transferMap:pe.smask.transferMap||null,startTransformInverse:null}):(me.setTransform(1,0,0,1,0,0),me.translate(Fe,Be),me.scale(rt,_e),me.save()),ae(me,Te),this.ctx=Te,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(me),this.groupLevel++}endGroup(pe){if(!this.contentVisible)return;this.groupLevel--;const me=this.ctx,be=this.groupStack.pop();if(this.ctx=be,this.ctx.imageSmoothingEnabled=!1,pe.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const Ee=(0,j.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...Ee);const ke=$.Util.getAxialAlignedBoundingBox([0,0,me.canvas.width,me.canvas.height],Ee);this.ctx.drawImage(me.canvas,0,0),this.ctx.restore(),this.compose(ke)}}beginAnnotation(pe,me,be,Ee,ke){if(it(this,Me,jn).call(this),de(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(me)&&me.length===4){const Fe=me[2]-me[0],Be=me[3]-me[1];if(ke&&this.annotationCanvasMap){be=be.slice(),be[4]-=me[0],be[5]-=me[1],me=me.slice(),me[0]=me[1]=0,me[2]=Fe,me[3]=Be;const[Ue,nt]=$.Util.singularValueDecompose2dScale((0,j.getCurrentTransform)(this.ctx)),{viewportScale:rt}=this,_e=Math.ceil(Fe*this.outputScaleX*rt),We=Math.ceil(Be*this.outputScaleY*rt);this.annotationCanvas=this.canvasFactory.create(_e,We);const{canvas:Xe,context:Te}=this.annotationCanvas;this.annotationCanvasMap.set(pe,Xe),this.annotationCanvas.savedCtx=this.ctx,this.ctx=Te,this.ctx.save(),this.ctx.setTransform(Ue,0,0,-nt,0,Be*nt),de(this.ctx)}else de(this.ctx),this.ctx.rect(me[0],me[1],Fe,Be),this.ctx.clip(),this.endPath()}this.current=new le(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...be),this.transform(...Ee)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),it(this,Ye,zn).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(pe){if(!this.contentVisible)return;const me=pe.count;pe=this.getObject(pe.data,pe),pe.count=me;const be=this.ctx,Ee=this.processingType3;if(Ee&&(Ee.compiled===void 0&&(Ee.compiled=se(pe)),Ee.compiled)){Ee.compiled(be);return}const ke=this._createMaskCanvas(pe),Fe=ke.canvas;be.save(),be.setTransform(1,0,0,1,0,0),be.drawImage(Fe,ke.offsetX,ke.offsetY),be.restore(),this.compose()}paintImageMaskXObjectRepeat(pe,me,be=0,Ee=0,ke,Fe){if(!this.contentVisible)return;pe=this.getObject(pe.data,pe);const Be=this.ctx;Be.save();const Ue=(0,j.getCurrentTransform)(Be);Be.transform(me,be,Ee,ke,0,0);const nt=this._createMaskCanvas(pe);Be.setTransform(1,0,0,1,nt.offsetX-Ue[4],nt.offsetY-Ue[5]);for(let rt=0,_e=Fe.length;rt<_e;rt+=2){const We=$.Util.transform(Ue,[me,be,Ee,ke,Fe[rt],Fe[rt+1]]),[Xe,Te]=$.Util.applyTransform([0,0],We);Be.drawImage(nt.canvas,Xe,Te)}Be.restore(),this.compose()}paintImageMaskXObjectGroup(pe){if(!this.contentVisible)return;const me=this.ctx,be=this.current.fillColor,Ee=this.current.patternFill;for(const ke of pe){const{data:Fe,width:Be,height:Ue,transform:nt}=ke,rt=this.cachedCanvases.getCanvas("maskCanvas",Be,Ue),_e=rt.context;_e.save();const We=this.getObject(Fe,ke);ce(_e,We),_e.globalCompositeOperation="source-in",_e.fillStyle=Ee?be.getPattern(_e,this,(0,j.getCurrentTransformInverse)(me),z.PathType.FILL):be,_e.fillRect(0,0,Be,Ue),_e.restore(),me.save(),me.transform(...nt),me.scale(1,-1),ie(me,rt.canvas,0,0,Be,Ue,0,-1,1,1),me.restore()}this.compose()}paintImageXObject(pe){if(!this.contentVisible)return;const me=this.getObject(pe);if(!me){(0,$.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(me)}paintImageXObjectRepeat(pe,me,be,Ee){if(!this.contentVisible)return;const ke=this.getObject(pe);if(!ke){(0,$.warn)("Dependent image isn't ready yet");return}const Fe=ke.width,Be=ke.height,Ue=[];for(let nt=0,rt=Ee.length;nt<rt;nt+=2)Ue.push({transform:[me,0,0,be,Ee[nt],Ee[nt+1]],x:0,y:0,w:Fe,h:Be});this.paintInlineImageXObjectGroup(ke,Ue)}applyTransferMapsToCanvas(pe){return this.current.transferMaps!=="none"&&(pe.filter=this.current.transferMaps,pe.drawImage(pe.canvas,0,0),pe.filter="none"),pe.canvas}applyTransferMapsToBitmap(pe){if(this.current.transferMaps==="none")return pe.bitmap;const{bitmap:me,width:be,height:Ee}=pe,ke=this.cachedCanvases.getCanvas("inlineImage",be,Ee),Fe=ke.context;return Fe.filter=this.current.transferMaps,Fe.drawImage(me,0,0),Fe.filter="none",ke.canvas}paintInlineImageXObject(pe){if(!this.contentVisible)return;const me=pe.width,be=pe.height,Ee=this.ctx;if(this.save(),!$.isNodeJS){const{filter:Be}=Ee;Be!=="none"&&Be!==""&&(Ee.filter="none")}Ee.scale(1/me,-1/be);let ke;if(pe.bitmap)ke=this.applyTransferMapsToBitmap(pe);else if(typeof HTMLElement=="function"&&pe instanceof HTMLElement||!pe.data)ke=pe;else{const Ue=this.cachedCanvases.getCanvas("inlineImage",me,be).context;he(Ue,pe),ke=this.applyTransferMapsToCanvas(Ue)}const Fe=this._scaleImage(ke,(0,j.getCurrentTransformInverse)(Ee));Ee.imageSmoothingEnabled=ve((0,j.getCurrentTransform)(Ee),pe.interpolate),ie(Ee,Fe.img,0,0,Fe.paintWidth,Fe.paintHeight,0,-be,me,be),this.compose(),this.restore()}paintInlineImageXObjectGroup(pe,me){if(!this.contentVisible)return;const be=this.ctx;let Ee;if(pe.bitmap)Ee=pe.bitmap;else{const ke=pe.width,Fe=pe.height,Ue=this.cachedCanvases.getCanvas("inlineImage",ke,Fe).context;he(Ue,pe),Ee=this.applyTransferMapsToCanvas(Ue)}for(const ke of me)be.save(),be.transform(...ke.transform),be.scale(1,-1),ie(be,Ee,ke.x,ke.y,ke.w,ke.h,0,-1,1,1),be.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(pe){}markPointProps(pe,me){}beginMarkedContent(pe){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(pe,me){pe==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(me)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(pe){const me=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(pe);const be=this.ctx;this.pendingClip&&(me||(this.pendingClip===ze?be.clip("evenodd"):be.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),be.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const pe=(0,j.getCurrentTransform)(this.ctx);if(pe[1]===0&&pe[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(pe[0]),Math.abs(pe[3]));else{const me=Math.abs(pe[0]*pe[3]-pe[2]*pe[1]),be=Math.hypot(pe[0],pe[2]),Ee=Math.hypot(pe[1],pe[3]);this._cachedGetSinglePixelWidth=Math.max(be,Ee)/me}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:pe}=this.current,{a:me,b:be,c:Ee,d:ke}=this.ctx.getTransform();let Fe,Be;if(be===0&&Ee===0){const Ue=Math.abs(me),nt=Math.abs(ke);if(Ue===nt)if(pe===0)Fe=Be=1/Ue;else{const rt=Ue*pe;Fe=Be=rt<1?1/rt:1}else if(pe===0)Fe=1/Ue,Be=1/nt;else{const rt=Ue*pe,_e=nt*pe;Fe=rt<1?1/rt:1,Be=_e<1?1/_e:1}}else{const Ue=Math.abs(me*ke-be*Ee),nt=Math.hypot(me,be),rt=Math.hypot(Ee,ke);if(pe===0)Fe=rt/Ue,Be=nt/Ue;else{const _e=pe*Ue;Fe=rt>_e?rt/_e:1,Be=nt>_e?nt/_e:1}}this._cachedScaleForStroking[0]=Fe,this._cachedScaleForStroking[1]=Be}return this._cachedScaleForStroking}rescaleAndStroke(pe){const{ctx:me}=this,{lineWidth:be}=this.current,[Ee,ke]=this.getScaleForStroking();if(me.lineWidth=be||1,Ee===1&&ke===1){me.stroke();return}const Fe=me.getLineDash();if(pe&&me.save(),me.scale(Ee,ke),Fe.length>0){const Be=Math.max(Ee,ke);me.setLineDash(Fe.map(Ue=>Ue/Be)),me.lineDashOffset/=Be}me.stroke(),pe&&me.restore()}isContentVisible(){for(let pe=this.markedContentStack.length-1;pe>=0;pe--)if(!this.markedContentStack[pe].visible)return!1;return!0}};Me=new WeakSet,jn=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Ye=new WeakSet,zn=function(){if(this.pageColors){const pe=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(pe!=="none"){const me=this.ctx.filter;this.ctx.filter=pe,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=me}}};let Le=Oe;_.CanvasGraphics=Le;for(const Se in $.OPS)Le.prototype[Se]!==void 0&&(Le.prototype[$.OPS[Se]]=Le.prototype[Se])},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.TilingPattern=_.PathType=void 0,_.getShadingPattern=te;var $=M(1),j=M(6);const z={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};_.PathType=z;function V(se,le){if(!le)return;const he=le[2]-le[0],ce=le[3]-le[1],ae=new Path2D;ae.rect(le[0],le[1],he,ce),se.clip(ae)}class G{constructor(){this.constructor===G&&(0,$.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,$.unreachable)("Abstract method `getPattern` called.")}}class X extends G{constructor(le){super(),this._type=le[1],this._bbox=le[2],this._colorStops=le[3],this._p0=le[4],this._p1=le[5],this._r0=le[6],this._r1=le[7],this.matrix=null}_createGradient(le){let he;this._type==="axial"?he=le.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(he=le.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const ce of this._colorStops)he.addColorStop(ce[0],ce[1]);return he}getPattern(le,he,ce,ae){let de;if(ae===z.STROKE||ae===z.FILL){const ge=he.current.getClippedPathBoundingBox(ae,(0,j.getCurrentTransform)(le))||[0,0,0,0],fe=Math.ceil(ge[2]-ge[0])||1,oe=Math.ceil(ge[3]-ge[1])||1,we=he.cachedCanvases.getCanvas("pattern",fe,oe,!0),De=we.context;De.clearRect(0,0,De.canvas.width,De.canvas.height),De.beginPath(),De.rect(0,0,De.canvas.width,De.canvas.height),De.translate(-ge[0],-ge[1]),ce=$.Util.transform(ce,[1,0,0,1,ge[0],ge[1]]),De.transform(...he.baseTransform),this.matrix&&De.transform(...this.matrix),V(De,this._bbox),De.fillStyle=this._createGradient(De),De.fill(),de=le.createPattern(we.canvas,"no-repeat");const ve=new DOMMatrix(ce);de.setTransform(ve)}else V(le,this._bbox),de=this._createGradient(le);return de}}function Y(se,le,he,ce,ae,de,ge,fe){const oe=le.coords,we=le.colors,De=se.data,ve=se.width*4;let Ce;oe[he+1]>oe[ce+1]&&(Ce=he,he=ce,ce=Ce,Ce=de,de=ge,ge=Ce),oe[ce+1]>oe[ae+1]&&(Ce=ce,ce=ae,ae=Ce,Ce=ge,ge=fe,fe=Ce),oe[he+1]>oe[ce+1]&&(Ce=he,he=ce,ce=Ce,Ce=de,de=ge,ge=Ce);const ue=(oe[he]+le.offsetX)*le.scaleX,Pe=(oe[he+1]+le.offsetY)*le.scaleY,ze=(oe[ce]+le.offsetX)*le.scaleX,Le=(oe[ce+1]+le.offsetY)*le.scaleY,Me=(oe[ae]+le.offsetX)*le.scaleX,Ne=(oe[ae+1]+le.offsetY)*le.scaleY;if(Pe>=Ne)return;const Ye=we[de],Ie=we[de+1],Oe=we[de+2],Se=we[ge],pe=we[ge+1],me=we[ge+2],be=we[fe],Ee=we[fe+1],ke=we[fe+2],Fe=Math.round(Pe),Be=Math.round(Ne);let Ue,nt,rt,_e,We,Xe,Te,Re;for(let He=Fe;He<=Be;He++){if(He<Le){const Ke=He<Pe?0:(Pe-He)/(Pe-Le);Ue=ue-(ue-ze)*Ke,nt=Ye-(Ye-Se)*Ke,rt=Ie-(Ie-pe)*Ke,_e=Oe-(Oe-me)*Ke}else{let Ke;He>Ne?Ke=1:Le===Ne?Ke=0:Ke=(Le-He)/(Le-Ne),Ue=ze-(ze-Me)*Ke,nt=Se-(Se-be)*Ke,rt=pe-(pe-Ee)*Ke,_e=me-(me-ke)*Ke}let Ze;He<Pe?Ze=0:He>Ne?Ze=1:Ze=(Pe-He)/(Pe-Ne),We=ue-(ue-Me)*Ze,Xe=Ye-(Ye-be)*Ze,Te=Ie-(Ie-Ee)*Ze,Re=Oe-(Oe-ke)*Ze;const ot=Math.round(Math.min(Ue,We)),$e=Math.round(Math.max(Ue,We));let je=ve*He+ot*4;for(let Ke=ot;Ke<=$e;Ke++)Ze=(Ue-Ke)/(Ue-We),Ze<0?Ze=0:Ze>1&&(Ze=1),De[je++]=nt-(nt-Xe)*Ze|0,De[je++]=rt-(rt-Te)*Ze|0,De[je++]=_e-(_e-Re)*Ze|0,De[je++]=255}}function Q(se,le,he){const ce=le.coords,ae=le.colors;let de,ge;switch(le.type){case"lattice":const fe=le.verticesPerRow,oe=Math.floor(ce.length/fe)-1,we=fe-1;for(de=0;de<oe;de++){let De=de*fe;for(let ve=0;ve<we;ve++,De++)Y(se,he,ce[De],ce[De+1],ce[De+fe],ae[De],ae[De+1],ae[De+fe]),Y(se,he,ce[De+fe+1],ce[De+1],ce[De+fe],ae[De+fe+1],ae[De+1],ae[De+fe])}break;case"triangles":for(de=0,ge=ce.length;de<ge;de+=3)Y(se,he,ce[de],ce[de+1],ce[de+2],ae[de],ae[de+1],ae[de+2]);break;default:throw new Error("illegal figure")}}class Z extends G{constructor(le){super(),this._coords=le[2],this._colors=le[3],this._figures=le[4],this._bounds=le[5],this._bbox=le[7],this._background=le[8],this.matrix=null}_createMeshCanvas(le,he,ce){const fe=Math.floor(this._bounds[0]),oe=Math.floor(this._bounds[1]),we=Math.ceil(this._bounds[2])-fe,De=Math.ceil(this._bounds[3])-oe,ve=Math.min(Math.ceil(Math.abs(we*le[0]*1.1)),3e3),Ce=Math.min(Math.ceil(Math.abs(De*le[1]*1.1)),3e3),ue=we/ve,Pe=De/Ce,ze={coords:this._coords,colors:this._colors,offsetX:-fe,offsetY:-oe,scaleX:1/ue,scaleY:1/Pe},Le=ve+2*2,Me=Ce+2*2,Ne=ce.getCanvas("mesh",Le,Me,!1),Ye=Ne.context,Ie=Ye.createImageData(ve,Ce);if(he){const Se=Ie.data;for(let pe=0,me=Se.length;pe<me;pe+=4)Se[pe]=he[0],Se[pe+1]=he[1],Se[pe+2]=he[2],Se[pe+3]=255}for(const Se of this._figures)Q(Ie,Se,ze);return Ye.putImageData(Ie,2,2),{canvas:Ne.canvas,offsetX:fe-2*ue,offsetY:oe-2*Pe,scaleX:ue,scaleY:Pe}}getPattern(le,he,ce,ae){V(le,this._bbox);let de;if(ae===z.SHADING)de=$.Util.singularValueDecompose2dScale((0,j.getCurrentTransform)(le));else if(de=$.Util.singularValueDecompose2dScale(he.baseTransform),this.matrix){const fe=$.Util.singularValueDecompose2dScale(this.matrix);de=[de[0]*fe[0],de[1]*fe[1]]}const ge=this._createMeshCanvas(de,ae===z.SHADING?null:this._background,he.cachedCanvases);return ae!==z.SHADING&&(le.setTransform(...he.baseTransform),this.matrix&&le.transform(...this.matrix)),le.translate(ge.offsetX,ge.offsetY),le.scale(ge.scaleX,ge.scaleY),le.createPattern(ge.canvas,"no-repeat")}}class ee extends G{getPattern(){return"hotpink"}}function te(se){switch(se[0]){case"RadialAxial":return new X(se);case"Mesh":return new Z(se);case"Dummy":return new ee}throw new Error(`Unknown IR type: ${se[0]}`)}const ne={COLORED:1,UNCOLORED:2},ie=class ie{constructor(le,he,ce,ae,de){this.operatorList=le[2],this.matrix=le[3]||[1,0,0,1,0,0],this.bbox=le[4],this.xstep=le[5],this.ystep=le[6],this.paintType=le[7],this.tilingType=le[8],this.color=he,this.ctx=ce,this.canvasGraphicsFactory=ae,this.baseTransform=de}createPatternCanvas(le){const he=this.operatorList,ce=this.bbox,ae=this.xstep,de=this.ystep,ge=this.paintType,fe=this.tilingType,oe=this.color,we=this.canvasGraphicsFactory;(0,$.info)("TilingType: "+fe);const De=ce[0],ve=ce[1],Ce=ce[2],ue=ce[3],Pe=$.Util.singularValueDecompose2dScale(this.matrix),ze=$.Util.singularValueDecompose2dScale(this.baseTransform),Le=[Pe[0]*ze[0],Pe[1]*ze[1]],Me=this.getSizeAndScale(ae,this.ctx.canvas.width,Le[0]),Ne=this.getSizeAndScale(de,this.ctx.canvas.height,Le[1]),Ye=le.cachedCanvases.getCanvas("pattern",Me.size,Ne.size,!0),Ie=Ye.context,Oe=we.createCanvasGraphics(Ie);Oe.groupLevel=le.groupLevel,this.setFillAndStrokeStyleToContext(Oe,ge,oe);let Se=De,pe=ve,me=Ce,be=ue;return De<0&&(Se=0,me+=Math.abs(De)),ve<0&&(pe=0,be+=Math.abs(ve)),Ie.translate(-(Me.scale*Se),-(Ne.scale*pe)),Oe.transform(Me.scale,0,0,Ne.scale,0,0),Ie.save(),this.clipBbox(Oe,Se,pe,me,be),Oe.baseTransform=(0,j.getCurrentTransform)(Oe.ctx),Oe.executeOperatorList(he),Oe.endDrawing(),{canvas:Ye.canvas,scaleX:Me.scale,scaleY:Ne.scale,offsetX:Se,offsetY:pe}}getSizeAndScale(le,he,ce){le=Math.abs(le);const ae=Math.max(ie.MAX_PATTERN_SIZE,he);let de=Math.ceil(le*ce);return de>=ae?de=ae:ce=de/le,{scale:ce,size:de}}clipBbox(le,he,ce,ae,de){const ge=ae-he,fe=de-ce;le.ctx.rect(he,ce,ge,fe),le.current.updateRectMinMax((0,j.getCurrentTransform)(le.ctx),[he,ce,ae,de]),le.clip(),le.endPath()}setFillAndStrokeStyleToContext(le,he,ce){const ae=le.ctx,de=le.current;switch(he){case ne.COLORED:const ge=this.ctx;ae.fillStyle=ge.fillStyle,ae.strokeStyle=ge.strokeStyle,de.fillColor=ge.fillStyle,de.strokeColor=ge.strokeStyle;break;case ne.UNCOLORED:const fe=$.Util.makeHexColor(ce[0],ce[1],ce[2]);ae.fillStyle=fe,ae.strokeStyle=fe,de.fillColor=fe,de.strokeColor=fe;break;default:throw new $.FormatError(`Unsupported paint type: ${he}`)}}getPattern(le,he,ce,ae){let de=ce;ae!==z.SHADING&&(de=$.Util.transform(de,he.baseTransform),this.matrix&&(de=$.Util.transform(de,this.matrix)));const ge=this.createPatternCanvas(he);let fe=new DOMMatrix(de);fe=fe.translate(ge.offsetX,ge.offsetY),fe=fe.scale(1/ge.scaleX,1/ge.scaleY);const oe=le.createPattern(ge.canvas,"repeat");return oe.setTransform(fe),oe}};Ht(ie,"MAX_PATTERN_SIZE",3e3);let re=ie;_.TilingPattern=re},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.convertBlackAndWhiteToRGBA=z,_.convertToRGBA=j,_.grayToRGBA=G;var $=M(1);function j(X){switch(X.kind){case $.ImageKind.GRAYSCALE_1BPP:return z(X);case $.ImageKind.RGB_24BPP:return V(X)}return null}function z({src:X,srcPos:Y=0,dest:Q,width:Z,height:ee,nonBlackColor:te=4294967295,inverseDecode:ne=!1}){const re=$.FeatureTest.isLittleEndian?4278190080:255,[ie,se]=ne?[te,re]:[re,te],le=Z>>3,he=Z&7,ce=X.length;Q=new Uint32Array(Q.buffer);let ae=0;for(let de=0;de<ee;de++){for(const fe=Y+le;Y<fe;Y++){const oe=Y<ce?X[Y]:255;Q[ae++]=oe&128?se:ie,Q[ae++]=oe&64?se:ie,Q[ae++]=oe&32?se:ie,Q[ae++]=oe&16?se:ie,Q[ae++]=oe&8?se:ie,Q[ae++]=oe&4?se:ie,Q[ae++]=oe&2?se:ie,Q[ae++]=oe&1?se:ie}if(he===0)continue;const ge=Y<ce?X[Y++]:255;for(let fe=0;fe<he;fe++)Q[ae++]=ge&1<<7-fe?se:ie}return{srcPos:Y,destPos:ae}}function V({src:X,srcPos:Y=0,dest:Q,destPos:Z=0,width:ee,height:te}){let ne=0;const re=X.length>>2,ie=new Uint32Array(X.buffer,Y,re);if($.FeatureTest.isLittleEndian){for(;ne<re-2;ne+=3,Z+=4){const se=ie[ne],le=ie[ne+1],he=ie[ne+2];Q[Z]=se|4278190080,Q[Z+1]=se>>>24|le<<8|4278190080,Q[Z+2]=le>>>16|he<<16|4278190080,Q[Z+3]=he>>>8|4278190080}for(let se=ne*4,le=X.length;se<le;se+=3)Q[Z++]=X[se]|X[se+1]<<8|X[se+2]<<16|4278190080}else{for(;ne<re-2;ne+=3,Z+=4){const se=ie[ne],le=ie[ne+1],he=ie[ne+2];Q[Z]=se|255,Q[Z+1]=se<<24|le>>>8|255,Q[Z+2]=le<<16|he>>>16|255,Q[Z+3]=he<<8|255}for(let se=ne*4,le=X.length;se<le;se+=3)Q[Z++]=X[se]<<24|X[se+1]<<16|X[se+2]<<8|255}return{srcPos:Y,destPos:Z}}function G(X,Y){if($.FeatureTest.isLittleEndian)for(let Q=0,Z=X.length;Q<Z;Q++)Y[Q]=X[Q]*65793|4278190080;else for(let Q=0,Z=X.length;Q<Z;Q++)Y[Q]=X[Q]*16843008|255}},(q,_)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.GlobalWorkerOptions=void 0;const M=Object.create(null);_.GlobalWorkerOptions=M,M.workerPort=null,M.workerSrc=""},(q,_,M)=>{var X,gr,Q,br,ee,gn;Object.defineProperty(_,"__esModule",{value:!0}),_.MessageHandler=void 0;var $=M(1);const j={UNKNOWN:0,DATA:1,ERROR:2},z={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function V(ne){switch(ne instanceof Error||typeof ne=="object"&&ne!==null||(0,$.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),ne.name){case"AbortException":return new $.AbortException(ne.message);case"MissingPDFException":return new $.MissingPDFException(ne.message);case"PasswordException":return new $.PasswordException(ne.message,ne.code);case"UnexpectedResponseException":return new $.UnexpectedResponseException(ne.message,ne.status);case"UnknownErrorException":return new $.UnknownErrorException(ne.message,ne.details);default:return new $.UnknownErrorException(ne.message,ne.toString())}}class G{constructor(re,ie,se){Ge(this,X);Ge(this,Q);Ge(this,ee);this.sourceName=re,this.targetName=ie,this.comObj=se,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=le=>{const he=le.data;if(he.targetName!==this.sourceName)return;if(he.stream){it(this,Q,br).call(this,he);return}if(he.callback){const ae=he.callbackId,de=this.callbackCapabilities[ae];if(!de)throw new Error(`Cannot resolve callback ${ae}`);if(delete this.callbackCapabilities[ae],he.callback===j.DATA)de.resolve(he.data);else if(he.callback===j.ERROR)de.reject(V(he.reason));else throw new Error("Unexpected callback case");return}const ce=this.actionHandler[he.action];if(!ce)throw new Error(`Unknown action from worker: ${he.action}`);if(he.callbackId){const ae=this.sourceName,de=he.sourceName;new Promise(function(ge){ge(ce(he.data))}).then(function(ge){se.postMessage({sourceName:ae,targetName:de,callback:j.DATA,callbackId:he.callbackId,data:ge})},function(ge){se.postMessage({sourceName:ae,targetName:de,callback:j.ERROR,callbackId:he.callbackId,reason:V(ge)})});return}if(he.streamId){it(this,X,gr).call(this,he);return}ce(he.data)},se.addEventListener("message",this._onComObjOnMessage)}on(re,ie){const se=this.actionHandler;if(se[re])throw new Error(`There is already an actionName called "${re}"`);se[re]=ie}send(re,ie,se){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:re,data:ie},se)}sendWithPromise(re,ie,se){const le=this.callbackId++,he=new $.PromiseCapability;this.callbackCapabilities[le]=he;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:re,callbackId:le,data:ie},se)}catch(ce){he.reject(ce)}return he.promise}sendWithStream(re,ie,se,le){const he=this.streamId++,ce=this.sourceName,ae=this.targetName,de=this.comObj;return new ReadableStream({start:ge=>{const fe=new $.PromiseCapability;return this.streamControllers[he]={controller:ge,startCall:fe,pullCall:null,cancelCall:null,isClosed:!1},de.postMessage({sourceName:ce,targetName:ae,action:re,streamId:he,data:ie,desiredSize:ge.desiredSize},le),fe.promise},pull:ge=>{const fe=new $.PromiseCapability;return this.streamControllers[he].pullCall=fe,de.postMessage({sourceName:ce,targetName:ae,stream:z.PULL,streamId:he,desiredSize:ge.desiredSize}),fe.promise},cancel:ge=>{(0,$.assert)(ge instanceof Error,"cancel must have a valid reason");const fe=new $.PromiseCapability;return this.streamControllers[he].cancelCall=fe,this.streamControllers[he].isClosed=!0,de.postMessage({sourceName:ce,targetName:ae,stream:z.CANCEL,streamId:he,reason:V(ge)}),fe.promise}},se)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}X=new WeakSet,gr=function(re){const ie=re.streamId,se=this.sourceName,le=re.sourceName,he=this.comObj,ce=this,ae=this.actionHandler[re.action],de={enqueue(ge,fe=1,oe){if(this.isCancelled)return;const we=this.desiredSize;this.desiredSize-=fe,we>0&&this.desiredSize<=0&&(this.sinkCapability=new $.PromiseCapability,this.ready=this.sinkCapability.promise),he.postMessage({sourceName:se,targetName:le,stream:z.ENQUEUE,streamId:ie,chunk:ge},oe)},close(){this.isCancelled||(this.isCancelled=!0,he.postMessage({sourceName:se,targetName:le,stream:z.CLOSE,streamId:ie}),delete ce.streamSinks[ie])},error(ge){(0,$.assert)(ge instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,he.postMessage({sourceName:se,targetName:le,stream:z.ERROR,streamId:ie,reason:V(ge)}))},sinkCapability:new $.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:re.desiredSize,ready:null};de.sinkCapability.resolve(),de.ready=de.sinkCapability.promise,this.streamSinks[ie]=de,new Promise(function(ge){ge(ae(re.data,de))}).then(function(){he.postMessage({sourceName:se,targetName:le,stream:z.START_COMPLETE,streamId:ie,success:!0})},function(ge){he.postMessage({sourceName:se,targetName:le,stream:z.START_COMPLETE,streamId:ie,reason:V(ge)})})},Q=new WeakSet,br=function(re){const ie=re.streamId,se=this.sourceName,le=re.sourceName,he=this.comObj,ce=this.streamControllers[ie],ae=this.streamSinks[ie];switch(re.stream){case z.START_COMPLETE:re.success?ce.startCall.resolve():ce.startCall.reject(V(re.reason));break;case z.PULL_COMPLETE:re.success?ce.pullCall.resolve():ce.pullCall.reject(V(re.reason));break;case z.PULL:if(!ae){he.postMessage({sourceName:se,targetName:le,stream:z.PULL_COMPLETE,streamId:ie,success:!0});break}ae.desiredSize<=0&&re.desiredSize>0&&ae.sinkCapability.resolve(),ae.desiredSize=re.desiredSize,new Promise(function(de){var ge;de((ge=ae.onPull)==null?void 0:ge.call(ae))}).then(function(){he.postMessage({sourceName:se,targetName:le,stream:z.PULL_COMPLETE,streamId:ie,success:!0})},function(de){he.postMessage({sourceName:se,targetName:le,stream:z.PULL_COMPLETE,streamId:ie,reason:V(de)})});break;case z.ENQUEUE:if((0,$.assert)(ce,"enqueue should have stream controller"),ce.isClosed)break;ce.controller.enqueue(re.chunk);break;case z.CLOSE:if((0,$.assert)(ce,"close should have stream controller"),ce.isClosed)break;ce.isClosed=!0,ce.controller.close(),it(this,ee,gn).call(this,ce,ie);break;case z.ERROR:(0,$.assert)(ce,"error should have stream controller"),ce.controller.error(V(re.reason)),it(this,ee,gn).call(this,ce,ie);break;case z.CANCEL_COMPLETE:re.success?ce.cancelCall.resolve():ce.cancelCall.reject(V(re.reason)),it(this,ee,gn).call(this,ce,ie);break;case z.CANCEL:if(!ae)break;new Promise(function(de){var ge;de((ge=ae.onCancel)==null?void 0:ge.call(ae,V(re.reason)))}).then(function(){he.postMessage({sourceName:se,targetName:le,stream:z.CANCEL_COMPLETE,streamId:ie,success:!0})},function(de){he.postMessage({sourceName:se,targetName:le,stream:z.CANCEL_COMPLETE,streamId:ie,reason:V(de)})}),ae.sinkCapability.reject(V(re.reason)),ae.isCancelled=!0,delete this.streamSinks[ie];break;default:throw new Error("Unexpected stream case")}},ee=new WeakSet,gn=async function(re,ie){var se,le,he;await Promise.allSettled([(se=re.startCall)==null?void 0:se.promise,(le=re.pullCall)==null?void 0:le.promise,(he=re.cancelCall)==null?void 0:he.promise]),delete this.streamControllers[ie]},_.MessageHandler=G},(q,_,M)=>{var z,V;Object.defineProperty(_,"__esModule",{value:!0}),_.Metadata=void 0;var $=M(1);class j{constructor({parsedData:X,rawData:Y}){Ge(this,z,void 0);Ge(this,V,void 0);ut(this,z,X),ut(this,V,Y)}getRaw(){return ye(this,V)}get(X){return ye(this,z).get(X)??null}getAll(){return(0,$.objectFromMap)(ye(this,z))}has(X){return ye(this,z).has(X)}}z=new WeakMap,V=new WeakMap,_.Metadata=j},(q,_,M)=>{var X,Y,Q,Z,ee,te,Hn;Object.defineProperty(_,"__esModule",{value:!0}),_.OptionalContentConfig=void 0;var $=M(1),j=M(8);const z=Symbol("INTERNAL");class V{constructor(ie,se){Ge(this,X,!0);this.name=ie,this.intent=se}get visible(){return ye(this,X)}_setVisible(ie,se){ie!==z&&(0,$.unreachable)("Internal method `_setVisible` called."),ut(this,X,se)}}X=new WeakMap;class G{constructor(ie){Ge(this,te);Ge(this,Y,null);Ge(this,Q,new Map);Ge(this,Z,null);Ge(this,ee,null);if(this.name=null,this.creator=null,ie!==null){this.name=ie.name,this.creator=ie.creator,ut(this,ee,ie.order);for(const se of ie.groups)ye(this,Q).set(se.id,new V(se.name,se.intent));if(ie.baseState==="OFF")for(const se of ye(this,Q).values())se._setVisible(z,!1);for(const se of ie.on)ye(this,Q).get(se)._setVisible(z,!0);for(const se of ie.off)ye(this,Q).get(se)._setVisible(z,!1);ut(this,Z,this.getHash())}}isVisible(ie){if(ye(this,Q).size===0)return!0;if(!ie)return(0,$.warn)("Optional content group not defined."),!0;if(ie.type==="OCG")return ye(this,Q).has(ie.id)?ye(this,Q).get(ie.id).visible:((0,$.warn)(`Optional content group not found: ${ie.id}`),!0);if(ie.type==="OCMD"){if(ie.expression)return it(this,te,Hn).call(this,ie.expression);if(!ie.policy||ie.policy==="AnyOn"){for(const se of ie.ids){if(!ye(this,Q).has(se))return(0,$.warn)(`Optional content group not found: ${se}`),!0;if(ye(this,Q).get(se).visible)return!0}return!1}else if(ie.policy==="AllOn"){for(const se of ie.ids){if(!ye(this,Q).has(se))return(0,$.warn)(`Optional content group not found: ${se}`),!0;if(!ye(this,Q).get(se).visible)return!1}return!0}else if(ie.policy==="AnyOff"){for(const se of ie.ids){if(!ye(this,Q).has(se))return(0,$.warn)(`Optional content group not found: ${se}`),!0;if(!ye(this,Q).get(se).visible)return!0}return!1}else if(ie.policy==="AllOff"){for(const se of ie.ids){if(!ye(this,Q).has(se))return(0,$.warn)(`Optional content group not found: ${se}`),!0;if(ye(this,Q).get(se).visible)return!1}return!0}return(0,$.warn)(`Unknown optional content policy ${ie.policy}.`),!0}return(0,$.warn)(`Unknown group type ${ie.type}.`),!0}setVisibility(ie,se=!0){if(!ye(this,Q).has(ie)){(0,$.warn)(`Optional content group not found: ${ie}`);return}ye(this,Q).get(ie)._setVisible(z,!!se),ut(this,Y,null)}get hasInitialVisibility(){return ye(this,Z)===null||this.getHash()===ye(this,Z)}getOrder(){return ye(this,Q).size?ye(this,ee)?ye(this,ee).slice():[...ye(this,Q).keys()]:null}getGroups(){return ye(this,Q).size>0?(0,$.objectFromMap)(ye(this,Q)):null}getGroup(ie){return ye(this,Q).get(ie)||null}getHash(){if(ye(this,Y)!==null)return ye(this,Y);const ie=new j.MurmurHash3_64;for(const[se,le]of ye(this,Q))ie.update(`${se}:${le.visible}`);return ut(this,Y,ie.hexdigest())}}Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakSet,Hn=function(ie){const se=ie.length;if(se<2)return!0;const le=ie[0];for(let he=1;he<se;he++){const ce=ie[he];let ae;if(Array.isArray(ce))ae=it(this,te,Hn).call(this,ce);else if(ye(this,Q).has(ce))ae=ye(this,Q).get(ce).visible;else return(0,$.warn)(`Optional content group not found: ${ce}`),!0;switch(le){case"And":if(!ae)return!1;break;case"Or":if(ae)return!0;break;case"Not":return!ae;default:return!0}}return le==="And"},_.OptionalContentConfig=G},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.PDFDataTransportStream=void 0;var $=M(1),j=M(6);class z{constructor({length:Y,initialData:Q,progressiveDone:Z=!1,contentDispositionFilename:ee=null,disableRange:te=!1,disableStream:ne=!1},re){if((0,$.assert)(re,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=Z,this._contentDispositionFilename=ee,(Q==null?void 0:Q.length)>0){const ie=Q instanceof Uint8Array&&Q.byteLength===Q.buffer.byteLength?Q.buffer:new Uint8Array(Q).buffer;this._queuedChunks.push(ie)}this._pdfDataRangeTransport=re,this._isStreamingSupported=!ne,this._isRangeSupported=!te,this._contentLength=Y,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((ie,se)=>{this._onReceiveData({begin:ie,chunk:se})}),this._pdfDataRangeTransport.addProgressListener((ie,se)=>{this._onProgress({loaded:ie,total:se})}),this._pdfDataRangeTransport.addProgressiveReadListener(ie=>{this._onReceiveData({chunk:ie})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:Y,chunk:Q}){const Z=Q instanceof Uint8Array&&Q.byteLength===Q.buffer.byteLength?Q.buffer:new Uint8Array(Q).buffer;if(Y===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(Z):this._queuedChunks.push(Z);else{const ee=this._rangeReaders.some(function(te){return te._begin!==Y?!1:(te._enqueue(Z),!0)});(0,$.assert)(ee,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var Y;return((Y=this._fullRequestReader)==null?void 0:Y._loaded)??0}_onProgress(Y){var Q,Z,ee,te;Y.total===void 0?(Z=(Q=this._rangeReaders[0])==null?void 0:Q.onProgress)==null||Z.call(Q,{loaded:Y.loaded}):(te=(ee=this._fullRequestReader)==null?void 0:ee.onProgress)==null||te.call(ee,{loaded:Y.loaded,total:Y.total})}_onProgressiveDone(){var Y;(Y=this._fullRequestReader)==null||Y.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(Y){const Q=this._rangeReaders.indexOf(Y);Q>=0&&this._rangeReaders.splice(Q,1)}getFullReader(){(0,$.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const Y=this._queuedChunks;return this._queuedChunks=null,new V(this,Y,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(Y,Q){if(Q<=this._progressiveDataLength)return null;const Z=new G(this,Y,Q);return this._pdfDataRangeTransport.requestDataRange(Y,Q),this._rangeReaders.push(Z),Z}cancelAllRequests(Y){var Q;(Q=this._fullRequestReader)==null||Q.cancel(Y);for(const Z of this._rangeReaders.slice(0))Z.cancel(Y);this._pdfDataRangeTransport.abort()}}_.PDFDataTransportStream=z;class V{constructor(Y,Q,Z=!1,ee=null){this._stream=Y,this._done=Z||!1,this._filename=(0,j.isPdfFile)(ee)?ee:null,this._queuedChunks=Q||[],this._loaded=0;for(const te of this._queuedChunks)this._loaded+=te.byteLength;this._requests=[],this._headersReady=Promise.resolve(),Y._fullRequestReader=this,this.onProgress=null}_enqueue(Y){this._done||(this._requests.length>0?this._requests.shift().resolve({value:Y,done:!1}):this._queuedChunks.push(Y),this._loaded+=Y.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const Y=new $.PromiseCapability;return this._requests.push(Y),Y.promise}cancel(Y){this._done=!0;for(const Q of this._requests)Q.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class G{constructor(Y,Q,Z){this._stream=Y,this._begin=Q,this._end=Z,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(Y){if(!this._done){if(this._requests.length===0)this._queuedChunk=Y;else{this._requests.shift().resolve({value:Y,done:!1});for(const Z of this._requests)Z.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const Q=this._queuedChunk;return this._queuedChunk=null,{value:Q,done:!1}}if(this._done)return{value:void 0,done:!0};const Y=new $.PromiseCapability;return this._requests.push(Y),Y.promise}cancel(Y){this._done=!0;for(const Q of this._requests)Q.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.PDFFetchStream=void 0;var $=M(1),j=M(20);function z(Z,ee,te){return{method:"GET",headers:Z,signal:te.signal,mode:"cors",credentials:ee?"include":"same-origin",redirect:"follow"}}function V(Z){const ee=new Headers;for(const te in Z){const ne=Z[te];ne!==void 0&&ee.append(te,ne)}return ee}function G(Z){return Z instanceof Uint8Array?Z.buffer:Z instanceof ArrayBuffer?Z:((0,$.warn)(`getArrayBuffer - unexpected data format: ${Z}`),new Uint8Array(Z).buffer)}class X{constructor(ee){this.source=ee,this.isHttp=/^https?:/i.test(ee.url),this.httpHeaders=this.isHttp&&ee.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var ee;return((ee=this._fullRequestReader)==null?void 0:ee._loaded)??0}getFullReader(){return(0,$.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Y(this),this._fullRequestReader}getRangeReader(ee,te){if(te<=this._progressiveDataLength)return null;const ne=new Q(this,ee,te);return this._rangeRequestReaders.push(ne),ne}cancelAllRequests(ee){var te;(te=this._fullRequestReader)==null||te.cancel(ee);for(const ne of this._rangeRequestReaders.slice(0))ne.cancel(ee)}}_.PDFFetchStream=X;class Y{constructor(ee){this._stream=ee,this._reader=null,this._loaded=0,this._filename=null;const te=ee.source;this._withCredentials=te.withCredentials||!1,this._contentLength=te.length,this._headersCapability=new $.PromiseCapability,this._disableRange=te.disableRange||!1,this._rangeChunkSize=te.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!te.disableStream,this._isRangeSupported=!te.disableRange,this._headers=V(this._stream.httpHeaders);const ne=te.url;fetch(ne,z(this._headers,this._withCredentials,this._abortController)).then(re=>{if(!(0,j.validateResponseStatus)(re.status))throw(0,j.createResponseStatusError)(re.status,ne);this._reader=re.body.getReader(),this._headersCapability.resolve();const ie=he=>re.headers.get(he),{allowRangeRequests:se,suggestedLength:le}=(0,j.validateRangeRequestCapabilities)({getResponseHeader:ie,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=se,this._contentLength=le||this._contentLength,this._filename=(0,j.extractFilenameFromHeader)(ie),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new $.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var ne;await this._headersCapability.promise;const{value:ee,done:te}=await this._reader.read();return te?{value:ee,done:te}:(this._loaded+=ee.byteLength,(ne=this.onProgress)==null||ne.call(this,{loaded:this._loaded,total:this._contentLength}),{value:G(ee),done:!1})}cancel(ee){var te;(te=this._reader)==null||te.cancel(ee),this._abortController.abort()}}class Q{constructor(ee,te,ne){this._stream=ee,this._reader=null,this._loaded=0;const re=ee.source;this._withCredentials=re.withCredentials||!1,this._readCapability=new $.PromiseCapability,this._isStreamingSupported=!re.disableStream,this._abortController=new AbortController,this._headers=V(this._stream.httpHeaders),this._headers.append("Range",`bytes=${te}-${ne-1}`);const ie=re.url;fetch(ie,z(this._headers,this._withCredentials,this._abortController)).then(se=>{if(!(0,j.validateResponseStatus)(se.status))throw(0,j.createResponseStatusError)(se.status,ie);this._readCapability.resolve(),this._reader=se.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var ne;await this._readCapability.promise;const{value:ee,done:te}=await this._reader.read();return te?{value:ee,done:te}:(this._loaded+=ee.byteLength,(ne=this.onProgress)==null||ne.call(this,{loaded:this._loaded}),{value:G(ee),done:!1})}cancel(ee){var te;(te=this._reader)==null||te.cancel(ee),this._abortController.abort()}}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.createResponseStatusError=X,_.extractFilenameFromHeader=G,_.validateRangeRequestCapabilities=V,_.validateResponseStatus=Y;var $=M(1),j=M(21),z=M(6);function V({getResponseHeader:Q,isHttp:Z,rangeChunkSize:ee,disableRange:te}){const ne={allowRangeRequests:!1,suggestedLength:void 0},re=parseInt(Q("Content-Length"),10);return!Number.isInteger(re)||(ne.suggestedLength=re,re<=2*ee)||te||!Z||Q("Accept-Ranges")!=="bytes"||(Q("Content-Encoding")||"identity")!=="identity"||(ne.allowRangeRequests=!0),ne}function G(Q){const Z=Q("Content-Disposition");if(Z){let ee=(0,j.getFilenameFromContentDispositionHeader)(Z);if(ee.includes("%"))try{ee=decodeURIComponent(ee)}catch{}if((0,z.isPdfFile)(ee))return ee}return null}function X(Q,Z){return Q===404||Q===0&&Z.startsWith("file:")?new $.MissingPDFException('Missing PDF "'+Z+'".'):new $.UnexpectedResponseException(`Unexpected server response (${Q}) while retrieving PDF "${Z}".`,Q)}function Y(Q){return Q===200||Q===206}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.getFilenameFromContentDispositionHeader=j;var $=M(1);function j(z){let V=!0,G=X("filename\\*","i").exec(z);if(G){G=G[1];let re=ee(G);return re=unescape(re),re=te(re),re=ne(re),Q(re)}if(G=Z(z),G){const re=ne(G);return Q(re)}if(G=X("filename","i").exec(z),G){G=G[1];let re=ee(G);return re=ne(re),Q(re)}function X(re,ie){return new RegExp("(?:^|;)\\s*"+re+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',ie)}function Y(re,ie){if(re){if(!/^[\x00-\xFF]+$/.test(ie))return ie;try{const se=new TextDecoder(re,{fatal:!0}),le=(0,$.stringToBytes)(ie);ie=se.decode(le),V=!1}catch{}}return ie}function Q(re){return V&&/[\x80-\xff]/.test(re)&&(re=Y("utf-8",re),V&&(re=Y("iso-8859-1",re))),re}function Z(re){const ie=[];let se;const le=X("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(se=le.exec(re))!==null;){let[,ce,ae,de]=se;if(ce=parseInt(ce,10),ce in ie){if(ce===0)break;continue}ie[ce]=[ae,de]}const he=[];for(let ce=0;ce<ie.length&&ce in ie;++ce){let[ae,de]=ie[ce];de=ee(de),ae&&(de=unescape(de),ce===0&&(de=te(de))),he.push(de)}return he.join("")}function ee(re){if(re.startsWith('"')){const ie=re.slice(1).split('\\"');for(let se=0;se<ie.length;++se){const le=ie[se].indexOf('"');le!==-1&&(ie[se]=ie[se].slice(0,le),ie.length=se+1),ie[se]=ie[se].replaceAll(/\\(.)/g,"$1")}re=ie.join('"')}return re}function te(re){const ie=re.indexOf("'");if(ie===-1)return re;const se=re.slice(0,ie),he=re.slice(ie+1).replace(/^[^']*'/,"");return Y(se,he)}function ne(re){return!re.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(re)?re:re.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(ie,se,le,he){if(le==="q"||le==="Q")return he=he.replaceAll("_"," "),he=he.replaceAll(/=([0-9a-fA-F]{2})/g,function(ce,ae){return String.fromCharCode(parseInt(ae,16))}),Y(se,he);try{he=atob(he)}catch{}return Y(se,he)})}return""}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.PDFNetworkStream=void 0;var $=M(1),j=M(20);const z=200,V=206;function G(ee){const te=ee.response;return typeof te!="string"?te:(0,$.stringToBytes)(te).buffer}class X{constructor(te,ne={}){this.url=te,this.isHttp=/^https?:/i.test(te),this.httpHeaders=this.isHttp&&ne.httpHeaders||Object.create(null),this.withCredentials=ne.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(te,ne,re){const ie={begin:te,end:ne};for(const se in re)ie[se]=re[se];return this.request(ie)}requestFull(te){return this.request(te)}request(te){const ne=new XMLHttpRequest,re=this.currXhrId++,ie=this.pendingRequests[re]={xhr:ne};ne.open("GET",this.url),ne.withCredentials=this.withCredentials;for(const se in this.httpHeaders){const le=this.httpHeaders[se];le!==void 0&&ne.setRequestHeader(se,le)}return this.isHttp&&"begin"in te&&"end"in te?(ne.setRequestHeader("Range",`bytes=${te.begin}-${te.end-1}`),ie.expectedStatus=V):ie.expectedStatus=z,ne.responseType="arraybuffer",te.onError&&(ne.onerror=function(se){te.onError(ne.status)}),ne.onreadystatechange=this.onStateChange.bind(this,re),ne.onprogress=this.onProgress.bind(this,re),ie.onHeadersReceived=te.onHeadersReceived,ie.onDone=te.onDone,ie.onError=te.onError,ie.onProgress=te.onProgress,ne.send(null),re}onProgress(te,ne){var ie;const re=this.pendingRequests[te];re&&((ie=re.onProgress)==null||ie.call(re,ne))}onStateChange(te,ne){var ce,ae,de;const re=this.pendingRequests[te];if(!re)return;const ie=re.xhr;if(ie.readyState>=2&&re.onHeadersReceived&&(re.onHeadersReceived(),delete re.onHeadersReceived),ie.readyState!==4||!(te in this.pendingRequests))return;if(delete this.pendingRequests[te],ie.status===0&&this.isHttp){(ce=re.onError)==null||ce.call(re,ie.status);return}const se=ie.status||z;if(!(se===z&&re.expectedStatus===V)&&se!==re.expectedStatus){(ae=re.onError)==null||ae.call(re,ie.status);return}const he=G(ie);if(se===V){const ge=ie.getResponseHeader("Content-Range"),fe=/bytes (\d+)-(\d+)\/(\d+)/.exec(ge);re.onDone({begin:parseInt(fe[1],10),chunk:he})}else he?re.onDone({begin:0,chunk:he}):(de=re.onError)==null||de.call(re,ie.status)}getRequestXhr(te){return this.pendingRequests[te].xhr}isPendingRequest(te){return te in this.pendingRequests}abortRequest(te){const ne=this.pendingRequests[te].xhr;delete this.pendingRequests[te],ne.abort()}}class Y{constructor(te){this._source=te,this._manager=new X(te.url,{httpHeaders:te.httpHeaders,withCredentials:te.withCredentials}),this._rangeChunkSize=te.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(te){const ne=this._rangeRequestReaders.indexOf(te);ne>=0&&this._rangeRequestReaders.splice(ne,1)}getFullReader(){return(0,$.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Q(this._manager,this._source),this._fullRequestReader}getRangeReader(te,ne){const re=new Z(this._manager,te,ne);return re.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(re),re}cancelAllRequests(te){var ne;(ne=this._fullRequestReader)==null||ne.cancel(te);for(const re of this._rangeRequestReaders.slice(0))re.cancel(te)}}_.PDFNetworkStream=Y;class Q{constructor(te,ne){this._manager=te;const re={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=ne.url,this._fullRequestId=te.requestFull(re),this._headersReceivedCapability=new $.PromiseCapability,this._disableRange=ne.disableRange||!1,this._contentLength=ne.length,this._rangeChunkSize=ne.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const te=this._fullRequestId,ne=this._manager.getRequestXhr(te),re=le=>ne.getResponseHeader(le),{allowRangeRequests:ie,suggestedLength:se}=(0,j.validateRangeRequestCapabilities)({getResponseHeader:re,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});ie&&(this._isRangeSupported=!0),this._contentLength=se||this._contentLength,this._filename=(0,j.extractFilenameFromHeader)(re),this._isRangeSupported&&this._manager.abortRequest(te),this._headersReceivedCapability.resolve()}_onDone(te){if(te&&(this._requests.length>0?this._requests.shift().resolve({value:te.chunk,done:!1}):this._cachedChunks.push(te.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const ne of this._requests)ne.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(te){this._storedError=(0,j.createResponseStatusError)(te,this._url),this._headersReceivedCapability.reject(this._storedError);for(const ne of this._requests)ne.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(te){var ne;(ne=this.onProgress)==null||ne.call(this,{loaded:te.loaded,total:te.lengthComputable?te.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const te=new $.PromiseCapability;return this._requests.push(te),te.promise}cancel(te){this._done=!0,this._headersReceivedCapability.reject(te);for(const ne of this._requests)ne.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Z{constructor(te,ne,re){this._manager=te;const ie={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=te.url,this._requestId=te.requestRange(ne,re,ie),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var te;(te=this.onClosed)==null||te.call(this,this)}_onDone(te){const ne=te.chunk;this._requests.length>0?this._requests.shift().resolve({value:ne,done:!1}):this._queuedChunk=ne,this._done=!0;for(const re of this._requests)re.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(te){this._storedError=(0,j.createResponseStatusError)(te,this._url);for(const ne of this._requests)ne.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(te){var ne;this.isStreamingSupported||(ne=this.onProgress)==null||ne.call(this,{loaded:te.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const ne=this._queuedChunk;return this._queuedChunk=null,{value:ne,done:!1}}if(this._done)return{value:void 0,done:!0};const te=new $.PromiseCapability;return this._requests.push(te),te.promise}cancel(te){this._done=!0;for(const ne of this._requests)ne.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.PDFNodeStream=void 0;var $=M(1),j=M(20);const z=/^file:\/\/\/[a-zA-Z]:\//;function V(re){const ie=require$$5,se=ie.parse(re);return se.protocol==="file:"||se.host?se:/^[a-z]:[/\\]/i.test(re)?ie.parse(`file:///${re}`):(se.host||(se.protocol="file:"),se)}class G{constructor(ie){this.source=ie,this.url=V(ie.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&ie.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var ie;return((ie=this._fullRequestReader)==null?void 0:ie._loaded)??0}getFullReader(){return(0,$.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new te(this):new Z(this),this._fullRequestReader}getRangeReader(ie,se){if(se<=this._progressiveDataLength)return null;const le=this.isFsUrl?new ne(this,ie,se):new ee(this,ie,se);return this._rangeRequestReaders.push(le),le}cancelAllRequests(ie){var se;(se=this._fullRequestReader)==null||se.cancel(ie);for(const le of this._rangeRequestReaders.slice(0))le.cancel(ie)}}_.PDFNodeStream=G;class X{constructor(ie){this._url=ie.url,this._done=!1,this._storedError=null,this.onProgress=null;const se=ie.source;this._contentLength=se.length,this._loaded=0,this._filename=null,this._disableRange=se.disableRange||!1,this._rangeChunkSize=se.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!se.disableStream,this._isRangeSupported=!se.disableRange,this._readableStream=null,this._readCapability=new $.PromiseCapability,this._headersCapability=new $.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var le;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const ie=this._readableStream.read();return ie===null?(this._readCapability=new $.PromiseCapability,this.read()):(this._loaded+=ie.length,(le=this.onProgress)==null||le.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(ie).buffer,done:!1})}cancel(ie){if(!this._readableStream){this._error(ie);return}this._readableStream.destroy(ie)}_error(ie){this._storedError=ie,this._readCapability.resolve()}_setReadableStream(ie){this._readableStream=ie,ie.on("readable",()=>{this._readCapability.resolve()}),ie.on("end",()=>{ie.destroy(),this._done=!0,this._readCapability.resolve()}),ie.on("error",se=>{this._error(se)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new $.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Y{constructor(ie){this._url=ie.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new $.PromiseCapability;const se=ie.source;this._isStreamingSupported=!se.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var le;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const ie=this._readableStream.read();return ie===null?(this._readCapability=new $.PromiseCapability,this.read()):(this._loaded+=ie.length,(le=this.onProgress)==null||le.call(this,{loaded:this._loaded}),{value:new Uint8Array(ie).buffer,done:!1})}cancel(ie){if(!this._readableStream){this._error(ie);return}this._readableStream.destroy(ie)}_error(ie){this._storedError=ie,this._readCapability.resolve()}_setReadableStream(ie){this._readableStream=ie,ie.on("readable",()=>{this._readCapability.resolve()}),ie.on("end",()=>{ie.destroy(),this._done=!0,this._readCapability.resolve()}),ie.on("error",se=>{this._error(se)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function Q(re,ie){return{protocol:re.protocol,auth:re.auth,host:re.hostname,port:re.port,path:re.path,method:"GET",headers:ie}}class Z extends X{constructor(ie){super(ie);const se=le=>{if(le.statusCode===404){const de=new $.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=de,this._headersCapability.reject(de);return}this._headersCapability.resolve(),this._setReadableStream(le);const he=de=>this._readableStream.headers[de.toLowerCase()],{allowRangeRequests:ce,suggestedLength:ae}=(0,j.validateRangeRequestCapabilities)({getResponseHeader:he,isHttp:ie.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=ce,this._contentLength=ae||this._contentLength,this._filename=(0,j.extractFilenameFromHeader)(he)};if(this._request=null,this._url.protocol==="http:"){const le=require$$5;this._request=le.request(Q(this._url,ie.httpHeaders),se)}else{const le=require$$5;this._request=le.request(Q(this._url,ie.httpHeaders),se)}this._request.on("error",le=>{this._storedError=le,this._headersCapability.reject(le)}),this._request.end()}}class ee extends Y{constructor(ie,se,le){super(ie),this._httpHeaders={};for(const ce in ie.httpHeaders){const ae=ie.httpHeaders[ce];ae!==void 0&&(this._httpHeaders[ce]=ae)}this._httpHeaders.Range=`bytes=${se}-${le-1}`;const he=ce=>{if(ce.statusCode===404){const ae=new $.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=ae;return}this._setReadableStream(ce)};if(this._request=null,this._url.protocol==="http:"){const ce=require$$5;this._request=ce.request(Q(this._url,this._httpHeaders),he)}else{const ce=require$$5;this._request=ce.request(Q(this._url,this._httpHeaders),he)}this._request.on("error",ce=>{this._storedError=ce}),this._request.end()}}class te extends X{constructor(ie){super(ie);let se=decodeURIComponent(this._url.path);z.test(this._url.href)&&(se=se.replace(/^\//,""));const le=require$$5;le.lstat(se,(he,ce)=>{if(he){he.code==="ENOENT"&&(he=new $.MissingPDFException(`Missing PDF "${se}".`)),this._storedError=he,this._headersCapability.reject(he);return}this._contentLength=ce.size,this._setReadableStream(le.createReadStream(se)),this._headersCapability.resolve()})}}class ne extends Y{constructor(ie,se,le){super(ie);let he=decodeURIComponent(this._url.path);z.test(this._url.href)&&(he=he.replace(/^\//,""));const ce=require$$5;this._setReadableStream(ce.createReadStream(he,{start:se,end:le-1}))}}},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.SVGGraphics=void 0;var $=M(6),j=M(1);const z={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},V="http://www.w3.org/XML/1998/namespace",G="http://www.w3.org/1999/xlink",X=["butt","round","square"],Y=["miter","round","bevel"],Q=function(ce,ae="",de=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!de)return URL.createObjectURL(new Blob([ce],{type:ae}));const ge="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let fe=`data:${ae};base64,`;for(let oe=0,we=ce.length;oe<we;oe+=3){const De=ce[oe]&255,ve=ce[oe+1]&255,Ce=ce[oe+2]&255,ue=De>>2,Pe=(De&3)<<4|ve>>4,ze=oe+1<we?(ve&15)<<2|Ce>>6:64,Le=oe+2<we?Ce&63:64;fe+=ge[ue]+ge[Pe]+ge[ze]+ge[Le]}return fe},Z=function(){const ce=new Uint8Array([137,80,78,71,13,10,26,10]),ae=12,de=new Int32Array(256);for(let Ce=0;Ce<256;Ce++){let ue=Ce;for(let Pe=0;Pe<8;Pe++)ue=ue&1?3988292384^ue>>1&2147483647:ue>>1&2147483647;de[Ce]=ue}function ge(Ce,ue,Pe){let ze=-1;for(let Le=ue;Le<Pe;Le++){const Me=(ze^Ce[Le])&255,Ne=de[Me];ze=ze>>>8^Ne}return ze^-1}function fe(Ce,ue,Pe,ze){let Le=ze;const Me=ue.length;Pe[Le]=Me>>24&255,Pe[Le+1]=Me>>16&255,Pe[Le+2]=Me>>8&255,Pe[Le+3]=Me&255,Le+=4,Pe[Le]=Ce.charCodeAt(0)&255,Pe[Le+1]=Ce.charCodeAt(1)&255,Pe[Le+2]=Ce.charCodeAt(2)&255,Pe[Le+3]=Ce.charCodeAt(3)&255,Le+=4,Pe.set(ue,Le),Le+=ue.length;const Ne=ge(Pe,ze+4,Le);Pe[Le]=Ne>>24&255,Pe[Le+1]=Ne>>16&255,Pe[Le+2]=Ne>>8&255,Pe[Le+3]=Ne&255}function oe(Ce,ue,Pe){let ze=1,Le=0;for(let Me=ue;Me<Pe;++Me)ze=(ze+(Ce[Me]&255))%65521,Le=(Le+ze)%65521;return Le<<16|ze}function we(Ce){if(!j.isNodeJS)return De(Ce);try{const ue=parseInt(process.versions.node)>=8?Ce:Buffer.from(Ce),Pe=require$$5.deflateSync(ue,{level:9});return Pe instanceof Uint8Array?Pe:new Uint8Array(Pe)}catch(ue){(0,j.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+ue)}return De(Ce)}function De(Ce){let ue=Ce.length;const Pe=65535,ze=Math.ceil(ue/Pe),Le=new Uint8Array(2+ue+ze*5+4);let Me=0;Le[Me++]=120,Le[Me++]=156;let Ne=0;for(;ue>Pe;)Le[Me++]=0,Le[Me++]=255,Le[Me++]=255,Le[Me++]=0,Le[Me++]=0,Le.set(Ce.subarray(Ne,Ne+Pe),Me),Me+=Pe,Ne+=Pe,ue-=Pe;Le[Me++]=1,Le[Me++]=ue&255,Le[Me++]=ue>>8&255,Le[Me++]=~ue&65535&255,Le[Me++]=(~ue&65535)>>8&255,Le.set(Ce.subarray(Ne),Me),Me+=Ce.length-Ne;const Ye=oe(Ce,0,Ce.length);return Le[Me++]=Ye>>24&255,Le[Me++]=Ye>>16&255,Le[Me++]=Ye>>8&255,Le[Me++]=Ye&255,Le}function ve(Ce,ue,Pe,ze){const Le=Ce.width,Me=Ce.height;let Ne,Ye,Ie;const Oe=Ce.data;switch(ue){case j.ImageKind.GRAYSCALE_1BPP:Ye=0,Ne=1,Ie=Le+7>>3;break;case j.ImageKind.RGB_24BPP:Ye=2,Ne=8,Ie=Le*3;break;case j.ImageKind.RGBA_32BPP:Ye=6,Ne=8,Ie=Le*4;break;default:throw new Error("invalid format")}const Se=new Uint8Array((1+Ie)*Me);let pe=0,me=0;for(let Ue=0;Ue<Me;++Ue)Se[pe++]=0,Se.set(Oe.subarray(me,me+Ie),pe),me+=Ie,pe+=Ie;if(ue===j.ImageKind.GRAYSCALE_1BPP&&ze){pe=0;for(let Ue=0;Ue<Me;Ue++){pe++;for(let nt=0;nt<Ie;nt++)Se[pe++]^=255}}const be=new Uint8Array([Le>>24&255,Le>>16&255,Le>>8&255,Le&255,Me>>24&255,Me>>16&255,Me>>8&255,Me&255,Ne,Ye,0,0,0]),Ee=we(Se),ke=ce.length+ae*3+be.length+Ee.length,Fe=new Uint8Array(ke);let Be=0;return Fe.set(ce,Be),Be+=ce.length,fe("IHDR",be,Fe,Be),Be+=ae+be.length,fe("IDATA",Ee,Fe,Be),Be+=ae+Ee.length,fe("IEND",new Uint8Array(0),Fe,Be),Q(Fe,"image/png",Pe)}return function(ue,Pe,ze){const Le=ue.kind===void 0?j.ImageKind.GRAYSCALE_1BPP:ue.kind;return ve(ue,Le,Pe,ze)}}();class ee{constructor(){this.fontSizeScale=1,this.fontWeight=z.fontWeight,this.fontSize=0,this.textMatrix=j.IDENTITY_MATRIX,this.fontMatrix=j.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=j.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=z.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(ae,de){this.x=ae,this.y=de}}function te(ce){let ae=[];const de=[];for(const ge of ce){if(ge.fn==="save"){ae.push({fnId:92,fn:"group",items:[]}),de.push(ae),ae=ae.at(-1).items;continue}ge.fn==="restore"?ae=de.pop():ae.push(ge)}return ae}function ne(ce){if(Number.isInteger(ce))return ce.toString();const ae=ce.toFixed(10);let de=ae.length-1;if(ae[de]!=="0")return ae;do de--;while(ae[de]==="0");return ae.substring(0,ae[de]==="."?de:de+1)}function re(ce){if(ce[4]===0&&ce[5]===0){if(ce[1]===0&&ce[2]===0)return ce[0]===1&&ce[3]===1?"":`scale(${ne(ce[0])} ${ne(ce[3])})`;if(ce[0]===ce[3]&&ce[1]===-ce[2]){const ae=Math.acos(ce[0])*180/Math.PI;return`rotate(${ne(ae)})`}}else if(ce[0]===1&&ce[1]===0&&ce[2]===0&&ce[3]===1)return`translate(${ne(ce[4])} ${ne(ce[5])})`;return`matrix(${ne(ce[0])} ${ne(ce[1])} ${ne(ce[2])} ${ne(ce[3])} ${ne(ce[4])} ${ne(ce[5])})`}let ie=0,se=0,le=0;class he{constructor(ae,de,ge=!1){(0,$.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new $.DOMSVGFactory,this.current=new ee,this.transformMatrix=j.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=ae,this.objs=de,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!ge,this._operatorIdMapping=[];for(const fe in j.OPS)this._operatorIdMapping[j.OPS[fe]]=fe}getObject(ae,de=null){return typeof ae=="string"?ae.startsWith("g_")?this.commonObjs.get(ae):this.objs.get(ae):de}save(){this.transformStack.push(this.transformMatrix);const ae=this.current;this.extraStack.push(ae),this.current=ae.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(ae){this.save(),this.executeOpTree(ae),this.restore()}loadDependencies(ae){const de=ae.fnArray,ge=ae.argsArray;for(let fe=0,oe=de.length;fe<oe;fe++)if(de[fe]===j.OPS.dependency)for(const we of ge[fe]){const De=we.startsWith("g_")?this.commonObjs:this.objs,ve=new Promise(Ce=>{De.get(we,Ce)});this.current.dependencies.push(ve)}return Promise.all(this.current.dependencies)}transform(ae,de,ge,fe,oe,we){const De=[ae,de,ge,fe,oe,we];this.transformMatrix=j.Util.transform(this.transformMatrix,De),this.tgrp=null}getSVG(ae,de){this.viewport=de;const ge=this._initialize(de);return this.loadDependencies(ae).then(()=>(this.transformMatrix=j.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(ae)),ge))}convertOpList(ae){const de=this._operatorIdMapping,ge=ae.argsArray,fe=ae.fnArray,oe=[];for(let we=0,De=fe.length;we<De;we++){const ve=fe[we];oe.push({fnId:ve,fn:de[ve],args:ge[we]})}return te(oe)}executeOpTree(ae){for(const de of ae){const ge=de.fn,fe=de.fnId,oe=de.args;switch(fe|0){case j.OPS.beginText:this.beginText();break;case j.OPS.dependency:break;case j.OPS.setLeading:this.setLeading(oe);break;case j.OPS.setLeadingMoveText:this.setLeadingMoveText(oe[0],oe[1]);break;case j.OPS.setFont:this.setFont(oe);break;case j.OPS.showText:this.showText(oe[0]);break;case j.OPS.showSpacedText:this.showText(oe[0]);break;case j.OPS.endText:this.endText();break;case j.OPS.moveText:this.moveText(oe[0],oe[1]);break;case j.OPS.setCharSpacing:this.setCharSpacing(oe[0]);break;case j.OPS.setWordSpacing:this.setWordSpacing(oe[0]);break;case j.OPS.setHScale:this.setHScale(oe[0]);break;case j.OPS.setTextMatrix:this.setTextMatrix(oe[0],oe[1],oe[2],oe[3],oe[4],oe[5]);break;case j.OPS.setTextRise:this.setTextRise(oe[0]);break;case j.OPS.setTextRenderingMode:this.setTextRenderingMode(oe[0]);break;case j.OPS.setLineWidth:this.setLineWidth(oe[0]);break;case j.OPS.setLineJoin:this.setLineJoin(oe[0]);break;case j.OPS.setLineCap:this.setLineCap(oe[0]);break;case j.OPS.setMiterLimit:this.setMiterLimit(oe[0]);break;case j.OPS.setFillRGBColor:this.setFillRGBColor(oe[0],oe[1],oe[2]);break;case j.OPS.setStrokeRGBColor:this.setStrokeRGBColor(oe[0],oe[1],oe[2]);break;case j.OPS.setStrokeColorN:this.setStrokeColorN(oe);break;case j.OPS.setFillColorN:this.setFillColorN(oe);break;case j.OPS.shadingFill:this.shadingFill(oe[0]);break;case j.OPS.setDash:this.setDash(oe[0],oe[1]);break;case j.OPS.setRenderingIntent:this.setRenderingIntent(oe[0]);break;case j.OPS.setFlatness:this.setFlatness(oe[0]);break;case j.OPS.setGState:this.setGState(oe[0]);break;case j.OPS.fill:this.fill();break;case j.OPS.eoFill:this.eoFill();break;case j.OPS.stroke:this.stroke();break;case j.OPS.fillStroke:this.fillStroke();break;case j.OPS.eoFillStroke:this.eoFillStroke();break;case j.OPS.clip:this.clip("nonzero");break;case j.OPS.eoClip:this.clip("evenodd");break;case j.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case j.OPS.paintImageXObject:this.paintImageXObject(oe[0]);break;case j.OPS.paintInlineImageXObject:this.paintInlineImageXObject(oe[0]);break;case j.OPS.paintImageMaskXObject:this.paintImageMaskXObject(oe[0]);break;case j.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(oe[0],oe[1]);break;case j.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case j.OPS.closePath:this.closePath();break;case j.OPS.closeStroke:this.closeStroke();break;case j.OPS.closeFillStroke:this.closeFillStroke();break;case j.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case j.OPS.nextLine:this.nextLine();break;case j.OPS.transform:this.transform(oe[0],oe[1],oe[2],oe[3],oe[4],oe[5]);break;case j.OPS.constructPath:this.constructPath(oe[0],oe[1]);break;case j.OPS.endPath:this.endPath();break;case 92:this.group(de.items);break;default:(0,j.warn)(`Unimplemented operator ${ge}`);break}}}setWordSpacing(ae){this.current.wordSpacing=ae}setCharSpacing(ae){this.current.charSpacing=ae}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(ae,de,ge,fe,oe,we){const De=this.current;De.textMatrix=De.lineMatrix=[ae,de,ge,fe,oe,we],De.textMatrixScale=Math.hypot(ae,de),De.x=De.lineX=0,De.y=De.lineY=0,De.xcoords=[],De.ycoords=[],De.tspan=this.svgFactory.createElement("svg:tspan"),De.tspan.setAttributeNS(null,"font-family",De.fontFamily),De.tspan.setAttributeNS(null,"font-size",`${ne(De.fontSize)}px`),De.tspan.setAttributeNS(null,"y",ne(-De.y)),De.txtElement=this.svgFactory.createElement("svg:text"),De.txtElement.append(De.tspan)}beginText(){const ae=this.current;ae.x=ae.lineX=0,ae.y=ae.lineY=0,ae.textMatrix=j.IDENTITY_MATRIX,ae.lineMatrix=j.IDENTITY_MATRIX,ae.textMatrixScale=1,ae.tspan=this.svgFactory.createElement("svg:tspan"),ae.txtElement=this.svgFactory.createElement("svg:text"),ae.txtgrp=this.svgFactory.createElement("svg:g"),ae.xcoords=[],ae.ycoords=[]}moveText(ae,de){const ge=this.current;ge.x=ge.lineX+=ae,ge.y=ge.lineY+=de,ge.xcoords=[],ge.ycoords=[],ge.tspan=this.svgFactory.createElement("svg:tspan"),ge.tspan.setAttributeNS(null,"font-family",ge.fontFamily),ge.tspan.setAttributeNS(null,"font-size",`${ne(ge.fontSize)}px`),ge.tspan.setAttributeNS(null,"y",ne(-ge.y))}showText(ae){const de=this.current,ge=de.font,fe=de.fontSize;if(fe===0)return;const oe=de.fontSizeScale,we=de.charSpacing,De=de.wordSpacing,ve=de.fontDirection,Ce=de.textHScale*ve,ue=ge.vertical,Pe=ue?1:-1,ze=ge.defaultVMetrics,Le=fe*de.fontMatrix[0];let Me=0;for(const Ie of ae){if(Ie===null){Me+=ve*De;continue}else if(typeof Ie=="number"){Me+=Pe*Ie*fe/1e3;continue}const Oe=(Ie.isSpace?De:0)+we,Se=Ie.fontChar;let pe,me,be=Ie.width;if(ue){let ke;const Fe=Ie.vmetric||ze;ke=Ie.vmetric?Fe[1]:be*.5,ke=-ke*Le;const Be=Fe[2]*Le;be=Fe?-Fe[0]:be,pe=ke/oe,me=(Me+Be)/oe}else pe=Me/oe,me=0;(Ie.isInFont||ge.missingFile)&&(de.xcoords.push(de.x+pe),ue&&de.ycoords.push(-de.y+me),de.tspan.textContent+=Se);const Ee=ue?be*Le-Oe*ve:be*Le+Oe*ve;Me+=Ee}de.tspan.setAttributeNS(null,"x",de.xcoords.map(ne).join(" ")),ue?de.tspan.setAttributeNS(null,"y",de.ycoords.map(ne).join(" ")):de.tspan.setAttributeNS(null,"y",ne(-de.y)),ue?de.y-=Me:de.x+=Me*Ce,de.tspan.setAttributeNS(null,"font-family",de.fontFamily),de.tspan.setAttributeNS(null,"font-size",`${ne(de.fontSize)}px`),de.fontStyle!==z.fontStyle&&de.tspan.setAttributeNS(null,"font-style",de.fontStyle),de.fontWeight!==z.fontWeight&&de.tspan.setAttributeNS(null,"font-weight",de.fontWeight);const Ne=de.textRenderingMode&j.TextRenderingMode.FILL_STROKE_MASK;if(Ne===j.TextRenderingMode.FILL||Ne===j.TextRenderingMode.FILL_STROKE?(de.fillColor!==z.fillColor&&de.tspan.setAttributeNS(null,"fill",de.fillColor),de.fillAlpha<1&&de.tspan.setAttributeNS(null,"fill-opacity",de.fillAlpha)):de.textRenderingMode===j.TextRenderingMode.ADD_TO_PATH?de.tspan.setAttributeNS(null,"fill","transparent"):de.tspan.setAttributeNS(null,"fill","none"),Ne===j.TextRenderingMode.STROKE||Ne===j.TextRenderingMode.FILL_STROKE){const Ie=1/(de.textMatrixScale||1);this._setStrokeAttributes(de.tspan,Ie)}let Ye=de.textMatrix;de.textRise!==0&&(Ye=Ye.slice(),Ye[5]+=de.textRise),de.txtElement.setAttributeNS(null,"transform",`${re(Ye)} scale(${ne(Ce)}, -1)`),de.txtElement.setAttributeNS(V,"xml:space","preserve"),de.txtElement.append(de.tspan),de.txtgrp.append(de.txtElement),this._ensureTransformGroup().append(de.txtElement)}setLeadingMoveText(ae,de){this.setLeading(-de),this.moveText(ae,de)}addFontStyle(ae){if(!ae.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const de=Q(ae.data,ae.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${ae.loadedName}"; src: url(${de}); }
`}setFont(ae){const de=this.current,ge=this.commonObjs.get(ae[0]);let fe=ae[1];de.font=ge,this.embedFonts&&!ge.missingFile&&!this.embeddedFonts[ge.loadedName]&&(this.addFontStyle(ge),this.embeddedFonts[ge.loadedName]=ge),de.fontMatrix=ge.fontMatrix||j.FONT_IDENTITY_MATRIX;let oe="normal";ge.black?oe="900":ge.bold&&(oe="bold");const we=ge.italic?"italic":"normal";fe<0?(fe=-fe,de.fontDirection=-1):de.fontDirection=1,de.fontSize=fe,de.fontFamily=ge.loadedName,de.fontWeight=oe,de.fontStyle=we,de.tspan=this.svgFactory.createElement("svg:tspan"),de.tspan.setAttributeNS(null,"y",ne(-de.y)),de.xcoords=[],de.ycoords=[]}endText(){var de;const ae=this.current;ae.textRenderingMode&j.TextRenderingMode.ADD_TO_PATH_FLAG&&((de=ae.txtElement)!=null&&de.hasChildNodes())&&(ae.element=ae.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(ae){ae>0&&(this.current.lineWidth=ae)}setLineCap(ae){this.current.lineCap=X[ae]}setLineJoin(ae){this.current.lineJoin=Y[ae]}setMiterLimit(ae){this.current.miterLimit=ae}setStrokeAlpha(ae){this.current.strokeAlpha=ae}setStrokeRGBColor(ae,de,ge){this.current.strokeColor=j.Util.makeHexColor(ae,de,ge)}setFillAlpha(ae){this.current.fillAlpha=ae}setFillRGBColor(ae,de,ge){this.current.fillColor=j.Util.makeHexColor(ae,de,ge),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(ae){this.current.strokeColor=this._makeColorN_Pattern(ae)}setFillColorN(ae){this.current.fillColor=this._makeColorN_Pattern(ae)}shadingFill(ae){const{width:de,height:ge}=this.viewport,fe=j.Util.inverseTransform(this.transformMatrix),[oe,we,De,ve]=j.Util.getAxialAlignedBoundingBox([0,0,de,ge],fe),Ce=this.svgFactory.createElement("svg:rect");Ce.setAttributeNS(null,"x",oe),Ce.setAttributeNS(null,"y",we),Ce.setAttributeNS(null,"width",De-oe),Ce.setAttributeNS(null,"height",ve-we),Ce.setAttributeNS(null,"fill",this._makeShadingPattern(ae)),this.current.fillAlpha<1&&Ce.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Ce)}_makeColorN_Pattern(ae){return ae[0]==="TilingPattern"?this._makeTilingPattern(ae):this._makeShadingPattern(ae)}_makeTilingPattern(ae){const de=ae[1],ge=ae[2],fe=ae[3]||j.IDENTITY_MATRIX,[oe,we,De,ve]=ae[4],Ce=ae[5],ue=ae[6],Pe=ae[7],ze=`shading${le++}`,[Le,Me,Ne,Ye]=j.Util.normalizeRect([...j.Util.applyTransform([oe,we],fe),...j.Util.applyTransform([De,ve],fe)]),[Ie,Oe]=j.Util.singularValueDecompose2dScale(fe),Se=Ce*Ie,pe=ue*Oe,me=this.svgFactory.createElement("svg:pattern");me.setAttributeNS(null,"id",ze),me.setAttributeNS(null,"patternUnits","userSpaceOnUse"),me.setAttributeNS(null,"width",Se),me.setAttributeNS(null,"height",pe),me.setAttributeNS(null,"x",`${Le}`),me.setAttributeNS(null,"y",`${Me}`);const be=this.svg,Ee=this.transformMatrix,ke=this.current.fillColor,Fe=this.current.strokeColor,Be=this.svgFactory.create(Ne-Le,Ye-Me);if(this.svg=Be,this.transformMatrix=fe,Pe===2){const Ue=j.Util.makeHexColor(...de);this.current.fillColor=Ue,this.current.strokeColor=Ue}return this.executeOpTree(this.convertOpList(ge)),this.svg=be,this.transformMatrix=Ee,this.current.fillColor=ke,this.current.strokeColor=Fe,me.append(Be.childNodes[0]),this.defs.append(me),`url(#${ze})`}_makeShadingPattern(ae){switch(typeof ae=="string"&&(ae=this.objs.get(ae)),ae[0]){case"RadialAxial":const de=`shading${le++}`,ge=ae[3];let fe;switch(ae[1]){case"axial":const oe=ae[4],we=ae[5];fe=this.svgFactory.createElement("svg:linearGradient"),fe.setAttributeNS(null,"id",de),fe.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),fe.setAttributeNS(null,"x1",oe[0]),fe.setAttributeNS(null,"y1",oe[1]),fe.setAttributeNS(null,"x2",we[0]),fe.setAttributeNS(null,"y2",we[1]);break;case"radial":const De=ae[4],ve=ae[5],Ce=ae[6],ue=ae[7];fe=this.svgFactory.createElement("svg:radialGradient"),fe.setAttributeNS(null,"id",de),fe.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),fe.setAttributeNS(null,"cx",ve[0]),fe.setAttributeNS(null,"cy",ve[1]),fe.setAttributeNS(null,"r",ue),fe.setAttributeNS(null,"fx",De[0]),fe.setAttributeNS(null,"fy",De[1]),fe.setAttributeNS(null,"fr",Ce);break;default:throw new Error(`Unknown RadialAxial type: ${ae[1]}`)}for(const oe of ge){const we=this.svgFactory.createElement("svg:stop");we.setAttributeNS(null,"offset",oe[0]),we.setAttributeNS(null,"stop-color",oe[1]),fe.append(we)}return this.defs.append(fe),`url(#${de})`;case"Mesh":return(0,j.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${ae[0]}`)}}setDash(ae,de){this.current.dashArray=ae,this.current.dashPhase=de}constructPath(ae,de){const ge=this.current;let fe=ge.x,oe=ge.y,we=[],De=0;for(const ve of ae)switch(ve|0){case j.OPS.rectangle:fe=de[De++],oe=de[De++];const Ce=de[De++],ue=de[De++],Pe=fe+Ce,ze=oe+ue;we.push("M",ne(fe),ne(oe),"L",ne(Pe),ne(oe),"L",ne(Pe),ne(ze),"L",ne(fe),ne(ze),"Z");break;case j.OPS.moveTo:fe=de[De++],oe=de[De++],we.push("M",ne(fe),ne(oe));break;case j.OPS.lineTo:fe=de[De++],oe=de[De++],we.push("L",ne(fe),ne(oe));break;case j.OPS.curveTo:fe=de[De+4],oe=de[De+5],we.push("C",ne(de[De]),ne(de[De+1]),ne(de[De+2]),ne(de[De+3]),ne(fe),ne(oe)),De+=6;break;case j.OPS.curveTo2:we.push("C",ne(fe),ne(oe),ne(de[De]),ne(de[De+1]),ne(de[De+2]),ne(de[De+3])),fe=de[De+2],oe=de[De+3],De+=4;break;case j.OPS.curveTo3:fe=de[De+2],oe=de[De+3],we.push("C",ne(de[De]),ne(de[De+1]),ne(fe),ne(oe),ne(fe),ne(oe)),De+=4;break;case j.OPS.closePath:we.push("Z");break}we=we.join(" "),ge.path&&ae.length>0&&ae[0]!==j.OPS.rectangle&&ae[0]!==j.OPS.moveTo?we=ge.path.getAttributeNS(null,"d")+we:(ge.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(ge.path)),ge.path.setAttributeNS(null,"d",we),ge.path.setAttributeNS(null,"fill","none"),ge.element=ge.path,ge.setCurrentPoint(fe,oe)}endPath(){const ae=this.current;if(ae.path=null,!this.pendingClip)return;if(!ae.element){this.pendingClip=null;return}const de=`clippath${ie++}`,ge=this.svgFactory.createElement("svg:clipPath");ge.setAttributeNS(null,"id",de),ge.setAttributeNS(null,"transform",re(this.transformMatrix));const fe=ae.element.cloneNode(!0);if(this.pendingClip==="evenodd"?fe.setAttributeNS(null,"clip-rule","evenodd"):fe.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,ge.append(fe),this.defs.append(ge),ae.activeClipUrl){ae.clipGroup=null;for(const oe of this.extraStack)oe.clipGroup=null;ge.setAttributeNS(null,"clip-path",ae.activeClipUrl)}ae.activeClipUrl=`url(#${de})`,this.tgrp=null}clip(ae){this.pendingClip=ae}closePath(){const ae=this.current;if(ae.path){const de=`${ae.path.getAttributeNS(null,"d")}Z`;ae.path.setAttributeNS(null,"d",de)}}setLeading(ae){this.current.leading=-ae}setTextRise(ae){this.current.textRise=ae}setTextRenderingMode(ae){this.current.textRenderingMode=ae}setHScale(ae){this.current.textHScale=ae/100}setRenderingIntent(ae){}setFlatness(ae){}setGState(ae){for(const[de,ge]of ae)switch(de){case"LW":this.setLineWidth(ge);break;case"LC":this.setLineCap(ge);break;case"LJ":this.setLineJoin(ge);break;case"ML":this.setMiterLimit(ge);break;case"D":this.setDash(ge[0],ge[1]);break;case"RI":this.setRenderingIntent(ge);break;case"FL":this.setFlatness(ge);break;case"Font":this.setFont(ge);break;case"CA":this.setStrokeAlpha(ge);break;case"ca":this.setFillAlpha(ge);break;default:(0,j.warn)(`Unimplemented graphic state operator ${de}`);break}}fill(){const ae=this.current;ae.element&&(ae.element.setAttributeNS(null,"fill",ae.fillColor),ae.element.setAttributeNS(null,"fill-opacity",ae.fillAlpha),this.endPath())}stroke(){const ae=this.current;ae.element&&(this._setStrokeAttributes(ae.element),ae.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(ae,de=1){const ge=this.current;let fe=ge.dashArray;de!==1&&fe.length>0&&(fe=fe.map(function(oe){return de*oe})),ae.setAttributeNS(null,"stroke",ge.strokeColor),ae.setAttributeNS(null,"stroke-opacity",ge.strokeAlpha),ae.setAttributeNS(null,"stroke-miterlimit",ne(ge.miterLimit)),ae.setAttributeNS(null,"stroke-linecap",ge.lineCap),ae.setAttributeNS(null,"stroke-linejoin",ge.lineJoin),ae.setAttributeNS(null,"stroke-width",ne(de*ge.lineWidth)+"px"),ae.setAttributeNS(null,"stroke-dasharray",fe.map(ne).join(" ")),ae.setAttributeNS(null,"stroke-dashoffset",ne(de*ge.dashPhase)+"px")}eoFill(){var ae;(ae=this.current.element)==null||ae.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var ae;(ae=this.current.element)==null||ae.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const ae=this.svgFactory.createElement("svg:rect");ae.setAttributeNS(null,"x","0"),ae.setAttributeNS(null,"y","0"),ae.setAttributeNS(null,"width","1px"),ae.setAttributeNS(null,"height","1px"),ae.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(ae)}paintImageXObject(ae){const de=this.getObject(ae);if(!de){(0,j.warn)(`Dependent image with object ID ${ae} is not ready yet`);return}this.paintInlineImageXObject(de)}paintInlineImageXObject(ae,de){const ge=ae.width,fe=ae.height,oe=Z(ae,this.forceDataSchema,!!de),we=this.svgFactory.createElement("svg:rect");we.setAttributeNS(null,"x","0"),we.setAttributeNS(null,"y","0"),we.setAttributeNS(null,"width",ne(ge)),we.setAttributeNS(null,"height",ne(fe)),this.current.element=we,this.clip("nonzero");const De=this.svgFactory.createElement("svg:image");De.setAttributeNS(G,"xlink:href",oe),De.setAttributeNS(null,"x","0"),De.setAttributeNS(null,"y",ne(-fe)),De.setAttributeNS(null,"width",ne(ge)+"px"),De.setAttributeNS(null,"height",ne(fe)+"px"),De.setAttributeNS(null,"transform",`scale(${ne(1/ge)} ${ne(-1/fe)})`),de?de.append(De):this._ensureTransformGroup().append(De)}paintImageMaskXObject(ae){const de=this.getObject(ae.data,ae);if(de.bitmap){(0,j.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const ge=this.current,fe=de.width,oe=de.height,we=ge.fillColor;ge.maskId=`mask${se++}`;const De=this.svgFactory.createElement("svg:mask");De.setAttributeNS(null,"id",ge.maskId);const ve=this.svgFactory.createElement("svg:rect");ve.setAttributeNS(null,"x","0"),ve.setAttributeNS(null,"y","0"),ve.setAttributeNS(null,"width",ne(fe)),ve.setAttributeNS(null,"height",ne(oe)),ve.setAttributeNS(null,"fill",we),ve.setAttributeNS(null,"mask",`url(#${ge.maskId})`),this.defs.append(De),this._ensureTransformGroup().append(ve),this.paintInlineImageXObject(de,De)}paintFormXObjectBegin(ae,de){if(Array.isArray(ae)&&ae.length===6&&this.transform(ae[0],ae[1],ae[2],ae[3],ae[4],ae[5]),de){const ge=de[2]-de[0],fe=de[3]-de[1],oe=this.svgFactory.createElement("svg:rect");oe.setAttributeNS(null,"x",de[0]),oe.setAttributeNS(null,"y",de[1]),oe.setAttributeNS(null,"width",ne(ge)),oe.setAttributeNS(null,"height",ne(fe)),this.current.element=oe,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(ae){const de=this.svgFactory.create(ae.width,ae.height),ge=this.svgFactory.createElement("svg:defs");de.append(ge),this.defs=ge;const fe=this.svgFactory.createElement("svg:g");return fe.setAttributeNS(null,"transform",re(ae.transform)),de.append(fe),this.svg=fe,de}_ensureClipGroup(){if(!this.current.clipGroup){const ae=this.svgFactory.createElement("svg:g");ae.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(ae),this.current.clipGroup=ae}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",re(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}_.SVGGraphics=he},(q,_)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.XfaText=void 0;class M{static textContent(j){const z=[],V={items:z,styles:Object.create(null)};function G(X){var Z;if(!X)return;let Y=null;const Q=X.name;if(Q==="#text")Y=X.value;else if(M.shouldBuildText(Q))(Z=X==null?void 0:X.attributes)!=null&&Z.textContent?Y=X.attributes.textContent:X.value&&(Y=X.value);else return;if(Y!==null&&z.push({str:Y}),!!X.children)for(const ee of X.children)G(ee)}return G(j),V}static shouldBuildText(j){return!(j==="textarea"||j==="input"||j==="option"||j==="select")}}_.XfaText=M},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.TextLayerRenderTask=void 0,_.renderTextLayer=re,_.updateTextLayer=ie;var $=M(1),j=M(6);const z=1e5,V=30,G=.8,X=new Map;function Y(se,le){let he;if(le&&$.FeatureTest.isOffscreenCanvasSupported)he=new OffscreenCanvas(se,se).getContext("2d",{alpha:!1});else{const ce=document.createElement("canvas");ce.width=ce.height=se,he=ce.getContext("2d",{alpha:!1})}return he}function Q(se,le){const he=X.get(se);if(he)return he;const ce=Y(V,le);ce.font=`${V}px ${se}`;const ae=ce.measureText("");let de=ae.fontBoundingBoxAscent,ge=Math.abs(ae.fontBoundingBoxDescent);if(de){const oe=de/(de+ge);return X.set(se,oe),ce.canvas.width=ce.canvas.height=0,oe}ce.strokeStyle="red",ce.clearRect(0,0,V,V),ce.strokeText("g",0,0);let fe=ce.getImageData(0,0,V,V).data;ge=0;for(let oe=fe.length-1-3;oe>=0;oe-=4)if(fe[oe]>0){ge=Math.ceil(oe/4/V);break}ce.clearRect(0,0,V,V),ce.strokeText("A",0,V),fe=ce.getImageData(0,0,V,V).data,de=0;for(let oe=0,we=fe.length;oe<we;oe+=4)if(fe[oe]>0){de=V-Math.floor(oe/4/V);break}if(ce.canvas.width=ce.canvas.height=0,de){const oe=de/(de+ge);return X.set(se,oe),oe}return X.set(se,G),G}function Z(se,le,he){const ce=document.createElement("span"),ae={angle:0,canvasWidth:0,hasText:le.str!=="",hasEOL:le.hasEOL,fontSize:0};se._textDivs.push(ce);const de=$.Util.transform(se._transform,le.transform);let ge=Math.atan2(de[1],de[0]);const fe=he[le.fontName];fe.vertical&&(ge+=Math.PI/2);const oe=Math.hypot(de[2],de[3]),we=oe*Q(fe.fontFamily,se._isOffscreenCanvasSupported);let De,ve;ge===0?(De=de[4],ve=de[5]-we):(De=de[4]+we*Math.sin(ge),ve=de[5]-we*Math.cos(ge));const Ce="calc(var(--scale-factor)*",ue=ce.style;se._container===se._rootContainer?(ue.left=`${(100*De/se._pageWidth).toFixed(2)}%`,ue.top=`${(100*ve/se._pageHeight).toFixed(2)}%`):(ue.left=`${Ce}${De.toFixed(2)}px)`,ue.top=`${Ce}${ve.toFixed(2)}px)`),ue.fontSize=`${Ce}${oe.toFixed(2)}px)`,ue.fontFamily=fe.fontFamily,ae.fontSize=oe,ce.setAttribute("role","presentation"),ce.textContent=le.str,ce.dir=le.dir,se._fontInspectorEnabled&&(ce.dataset.fontName=le.fontName),ge!==0&&(ae.angle=ge*(180/Math.PI));let Pe=!1;if(le.str.length>1)Pe=!0;else if(le.str!==" "&&le.transform[0]!==le.transform[3]){const ze=Math.abs(le.transform[0]),Le=Math.abs(le.transform[3]);ze!==Le&&Math.max(ze,Le)/Math.min(ze,Le)>1.5&&(Pe=!0)}Pe&&(ae.canvasWidth=fe.vertical?le.height:le.width),se._textDivProperties.set(ce,ae),se._isReadableStream&&se._layoutText(ce)}function ee(se){const{div:le,scale:he,properties:ce,ctx:ae,prevFontSize:de,prevFontFamily:ge}=se,{style:fe}=le;let oe="";if(ce.canvasWidth!==0&&ce.hasText){const{fontFamily:we}=fe,{canvasWidth:De,fontSize:ve}=ce;(de!==ve||ge!==we)&&(ae.font=`${ve*he}px ${we}`,se.prevFontSize=ve,se.prevFontFamily=we);const{width:Ce}=ae.measureText(le.textContent);Ce>0&&(oe=`scaleX(${De*he/Ce})`)}ce.angle!==0&&(oe=`rotate(${ce.angle}deg) ${oe}`),oe.length>0&&(fe.transform=oe)}function te(se){if(se._canceled)return;const le=se._textDivs,he=se._capability;if(le.length>z){he.resolve();return}if(!se._isReadableStream)for(const ae of le)se._layoutText(ae);he.resolve()}class ne{constructor({textContentSource:le,container:he,viewport:ce,textDivs:ae,textDivProperties:de,textContentItemsStr:ge,isOffscreenCanvasSupported:fe}){var Ce;this._textContentSource=le,this._isReadableStream=le instanceof ReadableStream,this._container=this._rootContainer=he,this._textDivs=ae||[],this._textContentItemsStr=ge||[],this._isOffscreenCanvasSupported=fe,this._fontInspectorEnabled=!!((Ce=globalThis.FontInspector)!=null&&Ce.enabled),this._reader=null,this._textDivProperties=de||new WeakMap,this._canceled=!1,this._capability=new $.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:ce.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:Y(0,fe)};const{pageWidth:oe,pageHeight:we,pageX:De,pageY:ve}=ce.rawDims;this._transform=[1,0,0,-1,-De,ve+we],this._pageWidth=oe,this._pageHeight=we,(0,j.setLayerDimensions)(he,ce),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new $.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new $.AbortException("TextLayer task cancelled."))}_processItems(le,he){for(const ce of le){if(ce.str===void 0){if(ce.type==="beginMarkedContentProps"||ce.type==="beginMarkedContent"){const ae=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),ce.id!==null&&this._container.setAttribute("id",`${ce.id}`),ae.append(this._container)}else ce.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(ce.str),Z(this,ce,he)}}_layoutText(le){const he=this._layoutTextParams.properties=this._textDivProperties.get(le);if(this._layoutTextParams.div=le,ee(this._layoutTextParams),he.hasText&&this._container.append(le),he.hasEOL){const ce=document.createElement("br");ce.setAttribute("role","presentation"),this._container.append(ce)}}_render(){const le=new $.PromiseCapability;let he=Object.create(null);if(this._isReadableStream){const ce=()=>{this._reader.read().then(({value:ae,done:de})=>{if(de){le.resolve();return}Object.assign(he,ae.styles),this._processItems(ae.items,he),ce()},le.reject)};this._reader=this._textContentSource.getReader(),ce()}else if(this._textContentSource){const{items:ce,styles:ae}=this._textContentSource;this._processItems(ce,ae),le.resolve()}else throw new Error('No "textContentSource" parameter specified.');le.promise.then(()=>{he=null,te(this)},this._capability.reject)}}_.TextLayerRenderTask=ne;function re(se){!se.textContentSource&&(se.textContent||se.textContentStream)&&((0,j.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),se.textContentSource=se.textContent||se.textContentStream);const{container:le,viewport:he}=se,ce=getComputedStyle(le),ae=ce.getPropertyValue("visibility"),de=parseFloat(ce.getPropertyValue("--scale-factor"));ae==="visible"&&(!de||Math.abs(de-he.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const ge=new ne(se);return ge._render(),ge}function ie({container:se,viewport:le,textDivs:he,textDivProperties:ce,isOffscreenCanvasSupported:ae,mustRotate:de=!0,mustRescale:ge=!0}){if(de&&(0,j.setLayerDimensions)(se,{rotation:le.rotation}),ge){const fe=Y(0,ae),we={prevFontSize:null,prevFontFamily:null,div:null,scale:le.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:fe};for(const De of he)we.properties=ce.get(De),we.div=De,ee(we)}}},(q,_,M)=>{var Q,Z,ee,te,ne,re,ie,se,le,he,ce,Wn,de,bn,fe,qn,we,Vn;Object.defineProperty(_,"__esModule",{value:!0}),_.AnnotationEditorLayer=void 0;var $=M(1),j=M(4),z=M(28),V=M(33),G=M(6),X=M(34);const ve=class ve{constructor({uiManager:ue,pageIndex:Pe,div:ze,accessibilityManager:Le,annotationLayer:Me,viewport:Ne,l10n:Ye}){Ge(this,ce);Ge(this,de);Ge(this,fe);Ge(this,we);Ge(this,Q,void 0);Ge(this,Z,!1);Ge(this,ee,null);Ge(this,te,this.pointerup.bind(this));Ge(this,ne,this.pointerdown.bind(this));Ge(this,re,new Map);Ge(this,ie,!1);Ge(this,se,!1);Ge(this,le,!1);Ge(this,he,void 0);const Ie=[z.FreeTextEditor,V.InkEditor,X.StampEditor];if(!ve._initialized){ve._initialized=!0;for(const Oe of Ie)Oe.initialize(Ye)}ue.registerEditorTypes(Ie),ut(this,he,ue),this.pageIndex=Pe,this.div=ze,ut(this,Q,Le),ut(this,ee,Me),this.viewport=Ne,ye(this,he).addLayer(this)}get isEmpty(){return ye(this,re).size===0}updateToolbar(ue){ye(this,he).updateToolbar(ue)}updateMode(ue=ye(this,he).getMode()){it(this,we,Vn).call(this),ue===$.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),ue!==$.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",ue===$.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",ue===$.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",ue===$.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(ue){if(!ue&&ye(this,he).getMode()!==$.AnnotationEditorType.INK)return;if(!ue){for(const ze of ye(this,re).values())if(ze.isEmpty()){ze.setInBackground();return}}it(this,de,bn).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(ue){ye(this,he).setEditingState(ue)}addCommands(ue){ye(this,he).addCommands(ue)}enable(){this.div.style.pointerEvents="auto";const ue=new Set;for(const ze of ye(this,re).values())ze.enableEditing(),ze.annotationElementId&&ue.add(ze.annotationElementId);if(!ye(this,ee))return;const Pe=ye(this,ee).getEditableAnnotations();for(const ze of Pe){if(ze.hide(),ye(this,he).isDeletedAnnotationElement(ze.data.id)||ue.has(ze.data.id))continue;const Le=this.deserialize(ze);Le&&(this.addOrRebuild(Le),Le.enableEditing())}}disable(){var Pe;ut(this,le,!0),this.div.style.pointerEvents="none";const ue=new Set;for(const ze of ye(this,re).values()){if(ze.disableEditing(),!ze.annotationElementId||ze.serialize()!==null){ue.add(ze.annotationElementId);continue}(Pe=this.getEditableAnnotation(ze.annotationElementId))==null||Pe.show(),ze.remove()}if(ye(this,ee)){const ze=ye(this,ee).getEditableAnnotations();for(const Le of ze){const{id:Me}=Le.data;ue.has(Me)||ye(this,he).isDeletedAnnotationElement(Me)||Le.show()}}it(this,we,Vn).call(this),this.isEmpty&&(this.div.hidden=!0),ut(this,le,!1)}getEditableAnnotation(ue){var Pe;return((Pe=ye(this,ee))==null?void 0:Pe.getEditableAnnotation(ue))||null}setActiveEditor(ue){ye(this,he).getActive()!==ue&&ye(this,he).setActiveEditor(ue)}enableClick(){this.div.addEventListener("pointerdown",ye(this,ne)),this.div.addEventListener("pointerup",ye(this,te))}disableClick(){this.div.removeEventListener("pointerdown",ye(this,ne)),this.div.removeEventListener("pointerup",ye(this,te))}attach(ue){ye(this,re).set(ue.id,ue);const{annotationElementId:Pe}=ue;Pe&&ye(this,he).isDeletedAnnotationElement(Pe)&&ye(this,he).removeDeletedAnnotationElement(ue)}detach(ue){var Pe;ye(this,re).delete(ue.id),(Pe=ye(this,Q))==null||Pe.removePointerInTextLayer(ue.contentDiv),!ye(this,le)&&ue.annotationElementId&&ye(this,he).addDeletedAnnotationElement(ue)}remove(ue){this.detach(ue),ye(this,he).removeEditor(ue),ue.div.contains(document.activeElement)&&setTimeout(()=>{ye(this,he).focusMainContainer()},0),ue.div.remove(),ue.isAttachedToDOM=!1,ye(this,se)||this.addInkEditorIfNeeded(!1)}changeParent(ue){var Pe;ue.parent!==this&&(ue.annotationElementId&&(ye(this,he).addDeletedAnnotationElement(ue.annotationElementId),j.AnnotationEditor.deleteAnnotationElement(ue),ue.annotationElementId=null),this.attach(ue),(Pe=ue.parent)==null||Pe.detach(ue),ue.setParent(this),ue.div&&ue.isAttachedToDOM&&(ue.div.remove(),this.div.append(ue.div)))}add(ue){if(this.changeParent(ue),ye(this,he).addEditor(ue),this.attach(ue),!ue.isAttachedToDOM){const Pe=ue.render();this.div.append(Pe),ue.isAttachedToDOM=!0}ue.fixAndSetPosition(),ue.onceAdded(),ye(this,he).addToAnnotationStorage(ue)}moveEditorInDOM(ue){var ze;if(!ue.isAttachedToDOM)return;const{activeElement:Pe}=document;ue.div.contains(Pe)&&(ue._focusEventsAllowed=!1,setTimeout(()=>{ue.div.contains(document.activeElement)?ue._focusEventsAllowed=!0:(ue.div.addEventListener("focusin",()=>{ue._focusEventsAllowed=!0},{once:!0}),Pe.focus())},0)),ue._structTreeParentId=(ze=ye(this,Q))==null?void 0:ze.moveElementInDOM(this.div,ue.div,ue.contentDiv,!0)}addOrRebuild(ue){ue.needsToBeRebuilt()?ue.rebuild():this.add(ue)}addUndoableEditor(ue){const Pe=()=>ue._uiManager.rebuild(ue),ze=()=>{ue.remove()};this.addCommands({cmd:Pe,undo:ze,mustExec:!1})}getNextId(){return ye(this,he).getId()}pasteEditor(ue,Pe){ye(this,he).updateToolbar(ue),ye(this,he).updateMode(ue);const{offsetX:ze,offsetY:Le}=it(this,fe,qn).call(this),Me=this.getNextId(),Ne=it(this,ce,Wn).call(this,{parent:this,id:Me,x:ze,y:Le,uiManager:ye(this,he),isCentered:!0,...Pe});Ne&&this.add(Ne)}deserialize(ue){switch(ue.annotationType??ue.annotationEditorType){case $.AnnotationEditorType.FREETEXT:return z.FreeTextEditor.deserialize(ue,this,ye(this,he));case $.AnnotationEditorType.INK:return V.InkEditor.deserialize(ue,this,ye(this,he));case $.AnnotationEditorType.STAMP:return X.StampEditor.deserialize(ue,this,ye(this,he))}return null}addNewEditor(){it(this,de,bn).call(this,it(this,fe,qn).call(this),!0)}setSelected(ue){ye(this,he).setSelected(ue)}toggleSelected(ue){ye(this,he).toggleSelected(ue)}isSelected(ue){return ye(this,he).isSelected(ue)}unselect(ue){ye(this,he).unselect(ue)}pointerup(ue){const{isMac:Pe}=$.FeatureTest.platform;if(!(ue.button!==0||ue.ctrlKey&&Pe)&&ue.target===this.div&&ye(this,ie)){if(ut(this,ie,!1),!ye(this,Z)){ut(this,Z,!0);return}if(ye(this,he).getMode()===$.AnnotationEditorType.STAMP){ye(this,he).unselectAll();return}it(this,de,bn).call(this,ue,!1)}}pointerdown(ue){if(ye(this,ie)){ut(this,ie,!1);return}const{isMac:Pe}=$.FeatureTest.platform;if(ue.button!==0||ue.ctrlKey&&Pe||ue.target!==this.div)return;ut(this,ie,!0);const ze=ye(this,he).getActive();ut(this,Z,!ze||ze.isEmpty())}findNewParent(ue,Pe,ze){const Le=ye(this,he).findParent(Pe,ze);return Le===null||Le===this?!1:(Le.changeParent(ue),!0)}destroy(){var ue,Pe;((ue=ye(this,he).getActive())==null?void 0:ue.parent)===this&&(ye(this,he).commitOrRemove(),ye(this,he).setActiveEditor(null));for(const ze of ye(this,re).values())(Pe=ye(this,Q))==null||Pe.removePointerInTextLayer(ze.contentDiv),ze.setParent(null),ze.isAttachedToDOM=!1,ze.div.remove();this.div=null,ye(this,re).clear(),ye(this,he).removeLayer(this)}render({viewport:ue}){this.viewport=ue,(0,G.setLayerDimensions)(this.div,ue);for(const Pe of ye(this,he).getEditors(this.pageIndex))this.add(Pe);this.updateMode()}update({viewport:ue}){ye(this,he).commitOrRemove(),this.viewport=ue,(0,G.setLayerDimensions)(this.div,{rotation:ue.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:ue,pageHeight:Pe}=this.viewport.rawDims;return[ue,Pe]}};Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,re=new WeakMap,ie=new WeakMap,se=new WeakMap,le=new WeakMap,he=new WeakMap,ce=new WeakSet,Wn=function(ue){switch(ye(this,he).getMode()){case $.AnnotationEditorType.FREETEXT:return new z.FreeTextEditor(ue);case $.AnnotationEditorType.INK:return new V.InkEditor(ue);case $.AnnotationEditorType.STAMP:return new X.StampEditor(ue)}return null},de=new WeakSet,bn=function(ue,Pe){const ze=this.getNextId(),Le=it(this,ce,Wn).call(this,{parent:this,id:ze,x:ue.offsetX,y:ue.offsetY,uiManager:ye(this,he),isCentered:Pe});return Le&&this.add(Le),Le},fe=new WeakSet,qn=function(){const{x:ue,y:Pe,width:ze,height:Le}=this.div.getBoundingClientRect(),Me=Math.max(0,ue),Ne=Math.max(0,Pe),Ye=Math.min(window.innerWidth,ue+ze),Ie=Math.min(window.innerHeight,Pe+Le),Oe=(Me+Ye)/2-ue,Se=(Ne+Ie)/2-Pe,[pe,me]=this.viewport.rotation%180===0?[Oe,Se]:[Se,Oe];return{offsetX:pe,offsetY:me}},we=new WeakSet,Vn=function(){ut(this,se,!0);for(const ue of ye(this,re).values())ue.isEmpty()&&ue.remove();ut(this,se,!1)},Ht(ve,"_initialized",!1);let Y=ve;_.AnnotationEditorLayer=Y},(q,_,M)=>{var X,Y,Q,Z,ee,te,ne,re,ie,se,yr,he,wr,ae,vr,ge,un,oe,Gn,De,Ar,Ce,Xn;Object.defineProperty(_,"__esModule",{value:!0}),_.FreeTextEditor=void 0;var $=M(1),j=M(5),z=M(4),V=M(29);const Pe=class Pe extends z.AnnotationEditor{constructor(Me){super({...Me,name:"freeTextEditor"});Ge(this,se);Ge(this,he);Ge(this,ae);Ge(this,ge);Ge(this,oe);Ge(this,De);Ge(this,Ce);Ge(this,X,this.editorDivBlur.bind(this));Ge(this,Y,this.editorDivFocus.bind(this));Ge(this,Q,this.editorDivInput.bind(this));Ge(this,Z,this.editorDivKeydown.bind(this));Ge(this,ee,void 0);Ge(this,te,"");Ge(this,ne,`${this.id}-editor`);Ge(this,re,void 0);Ge(this,ie,null);ut(this,ee,Me.color||Pe._defaultColor||z.AnnotationEditor._defaultLineColor),ut(this,re,Me.fontSize||Pe._defaultFontSize)}static get _keyboardManager(){const Me=Pe.prototype,Ne=Oe=>Oe.isEmpty(),Ye=j.AnnotationEditorUIManager.TRANSLATE_SMALL,Ie=j.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,$.shadow)(this,"_keyboardManager",new j.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],Me.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],Me.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],Me._translateEmpty,{args:[-Ye,0],checker:Ne}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Me._translateEmpty,{args:[-Ie,0],checker:Ne}],[["ArrowRight","mac+ArrowRight"],Me._translateEmpty,{args:[Ye,0],checker:Ne}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Me._translateEmpty,{args:[Ie,0],checker:Ne}],[["ArrowUp","mac+ArrowUp"],Me._translateEmpty,{args:[0,-Ye],checker:Ne}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Me._translateEmpty,{args:[0,-Ie],checker:Ne}],[["ArrowDown","mac+ArrowDown"],Me._translateEmpty,{args:[0,Ye],checker:Ne}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Me._translateEmpty,{args:[0,Ie],checker:Ne}]]))}static initialize(Me){z.AnnotationEditor.initialize(Me,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const Ne=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(Ne.getPropertyValue("--freetext-padding"))}static updateDefaultParams(Me,Ne){switch(Me){case $.AnnotationEditorParamsType.FREETEXT_SIZE:Pe._defaultFontSize=Ne;break;case $.AnnotationEditorParamsType.FREETEXT_COLOR:Pe._defaultColor=Ne;break}}updateParams(Me,Ne){switch(Me){case $.AnnotationEditorParamsType.FREETEXT_SIZE:it(this,se,yr).call(this,Ne);break;case $.AnnotationEditorParamsType.FREETEXT_COLOR:it(this,he,wr).call(this,Ne);break}}static get defaultPropertiesToUpdate(){return[[$.AnnotationEditorParamsType.FREETEXT_SIZE,Pe._defaultFontSize],[$.AnnotationEditorParamsType.FREETEXT_COLOR,Pe._defaultColor||z.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[$.AnnotationEditorParamsType.FREETEXT_SIZE,ye(this,re)],[$.AnnotationEditorParamsType.FREETEXT_COLOR,ye(this,ee)]]}_translateEmpty(Me,Ne){this._uiManager.translateSelectedEditors(Me,Ne,!0)}getInitialTranslation(){const Me=this.parentScale;return[-Pe._internalPadding*Me,-(Pe._internalPadding+ye(this,re))*Me]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar($.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",ye(this,Z)),this.editorDiv.addEventListener("focus",ye(this,Y)),this.editorDiv.addEventListener("blur",ye(this,X)),this.editorDiv.addEventListener("input",ye(this,Q)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",ye(this,ne)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",ye(this,Z)),this.editorDiv.removeEventListener("focus",ye(this,Y)),this.editorDiv.removeEventListener("blur",ye(this,X)),this.editorDiv.removeEventListener("input",ye(this,Q)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(Me){this._focusEventsAllowed&&(super.focusin(Me),Me.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var Me;if(this.width){it(this,Ce,Xn).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(Me=this._initialOptions)!=null&&Me.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const Me=ye(this,te),Ne=ut(this,te,it(this,ae,vr).call(this).trimEnd());if(Me===Ne)return;const Ye=Ie=>{if(ut(this,te,Ie),!Ie){this.remove();return}it(this,oe,Gn).call(this),this._uiManager.rebuild(this),it(this,ge,un).call(this)};this.addCommands({cmd:()=>{Ye(Ne)},undo:()=>{Ye(Me)},mustExec:!1}),it(this,ge,un).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(Me){this.enterInEditMode()}keydown(Me){Me.target===this.div&&Me.key==="Enter"&&(this.enterInEditMode(),Me.preventDefault())}editorDivKeydown(Me){Pe._keyboardManager.exec(this,Me)}editorDivFocus(Me){this.isEditing=!0}editorDivBlur(Me){this.isEditing=!1}editorDivInput(Me){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let Me,Ne;this.width&&(Me=this.x,Ne=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",ye(this,ne)),this.enableEditing(),z.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(Ie=>{var Oe;return(Oe=this.editorDiv)==null?void 0:Oe.setAttribute("aria-label",Ie)}),z.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(Ie=>{var Oe;return(Oe=this.editorDiv)==null?void 0:Oe.setAttribute("default-content",Ie)}),this.editorDiv.contentEditable=!0;const{style:Ye}=this.editorDiv;if(Ye.fontSize=`calc(${ye(this,re)}px * var(--scale-factor))`,Ye.color=ye(this,ee),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,j.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Ie,Oe]=this.parentDimensions;if(this.annotationElementId){const{position:Se}=ye(this,ie);let[pe,me]=this.getInitialTranslation();[pe,me]=this.pageTranslationToScreen(pe,me);const[be,Ee]=this.pageDimensions,[ke,Fe]=this.pageTranslation;let Be,Ue;switch(this.rotation){case 0:Be=Me+(Se[0]-ke)/be,Ue=Ne+this.height-(Se[1]-Fe)/Ee;break;case 90:Be=Me+(Se[0]-ke)/be,Ue=Ne-(Se[1]-Fe)/Ee,[pe,me]=[me,-pe];break;case 180:Be=Me-this.width+(Se[0]-ke)/be,Ue=Ne-(Se[1]-Fe)/Ee,[pe,me]=[-pe,-me];break;case 270:Be=Me+(Se[0]-ke-this.height*Ee)/be,Ue=Ne+(Se[1]-Fe-this.width*be)/Ee,[pe,me]=[-me,pe];break}this.setAt(Be*Ie,Ue*Oe,pe,me)}else this.setAt(Me*Ie,Ne*Oe,this.width*Ie,this.height*Oe);it(this,oe,Gn).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(Me,Ne,Ye){let Ie=null;if(Me instanceof V.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:Se,fontColor:pe},rect:me,rotation:be,id:Ee},textContent:ke,textPosition:Fe,parent:{page:{pageNumber:Be}}}=Me;if(!ke||ke.length===0)return null;Ie=Me={annotationType:$.AnnotationEditorType.FREETEXT,color:Array.from(pe),fontSize:Se,value:ke.join(`
`),position:Fe,pageIndex:Be-1,rect:me,rotation:be,id:Ee,deleted:!1}}const Oe=super.deserialize(Me,Ne,Ye);return ut(Oe,re,Me.fontSize),ut(Oe,ee,$.Util.makeHexColor(...Me.color)),ut(Oe,te,Me.value),Oe.annotationElementId=Me.id||null,ut(Oe,ie,Ie),Oe}serialize(Me=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const Ne=Pe._internalPadding*this.parentScale,Ye=this.getRect(Ne,Ne),Ie=z.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:ye(this,ee)),Oe={annotationType:$.AnnotationEditorType.FREETEXT,color:Ie,fontSize:ye(this,re),value:ye(this,te),pageIndex:this.pageIndex,rect:Ye,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return Me?Oe:this.annotationElementId&&!it(this,De,Ar).call(this,Oe)?null:(Oe.id=this.annotationElementId,Oe)}};X=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,re=new WeakMap,ie=new WeakMap,se=new WeakSet,yr=function(Me){const Ne=Ie=>{this.editorDiv.style.fontSize=`calc(${Ie}px * var(--scale-factor))`,this.translate(0,-(Ie-ye(this,re))*this.parentScale),ut(this,re,Ie),it(this,ge,un).call(this)},Ye=ye(this,re);this.addCommands({cmd:()=>{Ne(Me)},undo:()=>{Ne(Ye)},mustExec:!0,type:$.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},he=new WeakSet,wr=function(Me){const Ne=ye(this,ee);this.addCommands({cmd:()=>{ut(this,ee,this.editorDiv.style.color=Me)},undo:()=>{ut(this,ee,this.editorDiv.style.color=Ne)},mustExec:!0,type:$.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},ae=new WeakSet,vr=function(){const Me=this.editorDiv.getElementsByTagName("div");if(Me.length===0)return this.editorDiv.innerText;const Ne=[];for(const Ye of Me)Ne.push(Ye.innerText.replace(/\r\n?|\n/,""));return Ne.join(`
`)},ge=new WeakSet,un=function(){const[Me,Ne]=this.parentDimensions;let Ye;if(this.isAttachedToDOM)Ye=this.div.getBoundingClientRect();else{const{currentLayer:Ie,div:Oe}=this,Se=Oe.style.display;Oe.style.display="hidden",Ie.div.append(this.div),Ye=Oe.getBoundingClientRect(),Oe.remove(),Oe.style.display=Se}this.rotation%180===this.parentRotation%180?(this.width=Ye.width/Me,this.height=Ye.height/Ne):(this.width=Ye.height/Me,this.height=Ye.width/Ne),this.fixAndSetPosition()},oe=new WeakSet,Gn=function(){if(this.editorDiv.replaceChildren(),!!ye(this,te))for(const Me of ye(this,te).split(`
`)){const Ne=document.createElement("div");Ne.append(Me?document.createTextNode(Me):document.createElement("br")),this.editorDiv.append(Ne)}},De=new WeakSet,Ar=function(Me){const{value:Ne,fontSize:Ye,color:Ie,rect:Oe,pageIndex:Se}=ye(this,ie);return Me.value!==Ne||Me.fontSize!==Ye||Me.rect.some((pe,me)=>Math.abs(pe-Oe[me])>=1)||Me.color.some((pe,me)=>pe!==Ie[me])||Me.pageIndex!==Se},Ce=new WeakSet,Xn=function(Me=!1){if(!this.annotationElementId)return;if(it(this,ge,un).call(this),!Me&&(this.width===0||this.height===0)){setTimeout(()=>it(this,Ce,Xn).call(this,!0),0);return}const Ne=Pe._internalPadding*this.parentScale;ye(this,ie).rect=this.getRect(Ne,Ne)},Ht(Pe,"_freeTextDefaultContent",""),Ht(Pe,"_internalPadding",0),Ht(Pe,"_defaultColor",null),Ht(Pe,"_defaultFontSize",10),Ht(Pe,"_type","freetext");let G=Pe;_.FreeTextEditor=G},(q,_,M)=>{var me,Ee,Qt,Fe,Dr,Ue,nt,rt,_e,We,Xe,Te,Re,He,Ze,ot,$e,je,Ke,Qe,dt,pt,wt,Er,Rt,yn,It,Kn,ft,Yn,et,tt,mt,gt,Ut,jt,at,Qn,Ft,vt,Tt,Pt,kr,bt,Zn;Object.defineProperty(_,"__esModule",{value:!0}),_.StampAnnotationElement=_.InkAnnotationElement=_.FreeTextAnnotationElement=_.AnnotationLayer=void 0;var $=M(1),j=M(6),z=M(3),V=M(30),G=M(31),X=M(32);const Y=1e3,Q=9,Z=new WeakSet;function ee(Ct){return{width:Ct[2]-Ct[0],height:Ct[3]-Ct[1]}}class te{static create(qe){switch(qe.data.annotationType){case $.AnnotationType.LINK:return new re(qe);case $.AnnotationType.TEXT:return new ie(qe);case $.AnnotationType.WIDGET:switch(qe.data.fieldType){case"Tx":return new le(qe);case"Btn":return qe.data.radioButton?new ae(qe):qe.data.checkBox?new ce(qe):new de(qe);case"Ch":return new ge(qe);case"Sig":return new he(qe)}return new se(qe);case $.AnnotationType.POPUP:return new fe(qe);case $.AnnotationType.FREETEXT:return new we(qe);case $.AnnotationType.LINE:return new De(qe);case $.AnnotationType.SQUARE:return new ve(qe);case $.AnnotationType.CIRCLE:return new Ce(qe);case $.AnnotationType.POLYLINE:return new ue(qe);case $.AnnotationType.CARET:return new ze(qe);case $.AnnotationType.INK:return new Le(qe);case $.AnnotationType.POLYGON:return new Pe(qe);case $.AnnotationType.HIGHLIGHT:return new Me(qe);case $.AnnotationType.UNDERLINE:return new Ne(qe);case $.AnnotationType.SQUIGGLY:return new Ye(qe);case $.AnnotationType.STRIKEOUT:return new Ie(qe);case $.AnnotationType.STAMP:return new Oe(qe);case $.AnnotationType.FILEATTACHMENT:return new Se(qe);default:return new ne(qe)}}}const be=class be{constructor(qe,{isRenderable:Ae=!1,ignoreBorder:xe=!1,createQuadrilaterals:Ve=!1}={}){Ge(this,me,!1);this.isRenderable=Ae,this.data=qe.data,this.layer=qe.layer,this.linkService=qe.linkService,this.downloadManager=qe.downloadManager,this.imageResourcesPath=qe.imageResourcesPath,this.renderForms=qe.renderForms,this.svgFactory=qe.svgFactory,this.annotationStorage=qe.annotationStorage,this.enableScripting=qe.enableScripting,this.hasJSActions=qe.hasJSActions,this._fieldObjects=qe.fieldObjects,this.parent=qe.parent,Ae&&(this.container=this._createContainer(xe)),Ve&&this._createQuadrilaterals()}static _hasPopupData({titleObj:qe,contentsObj:Ae,richText:xe}){return!!(qe!=null&&qe.str||Ae!=null&&Ae.str||xe!=null&&xe.str)}get hasPopupData(){return be._hasPopupData(this.data)}_createContainer(qe){const{data:Ae,parent:{page:xe,viewport:Ve}}=this,Je=document.createElement("section");Je.setAttribute("data-annotation-id",Ae.id),this instanceof se||(Je.tabIndex=Y),Je.style.zIndex=this.parent.zIndex++,this.data.popupRef&&Je.setAttribute("aria-haspopup","dialog"),Ae.noRotate&&Je.classList.add("norotate");const{pageWidth:st,pageHeight:ct,pageX:_t,pageY:Dt}=Ve.rawDims;if(!Ae.rect||this instanceof fe){const{rotation:Bt}=Ae;return!Ae.hasOwnCanvas&&Bt!==0&&this.setRotation(Bt,Je),Je}const{width:At,height:Mt}=ee(Ae.rect),Et=$.Util.normalizeRect([Ae.rect[0],xe.view[3]-Ae.rect[1]+xe.view[1],Ae.rect[2],xe.view[3]-Ae.rect[3]+xe.view[1]]);if(!qe&&Ae.borderStyle.width>0){Je.style.borderWidth=`${Ae.borderStyle.width}px`;const Bt=Ae.borderStyle.horizontalCornerRadius,Ot=Ae.borderStyle.verticalCornerRadius;if(Bt>0||Ot>0){const zt=`calc(${Bt}px * var(--scale-factor)) / calc(${Ot}px * var(--scale-factor))`;Je.style.borderRadius=zt}else if(this instanceof ae){const zt=`calc(${At}px * var(--scale-factor)) / calc(${Mt}px * var(--scale-factor))`;Je.style.borderRadius=zt}switch(Ae.borderStyle.style){case $.AnnotationBorderStyleType.SOLID:Je.style.borderStyle="solid";break;case $.AnnotationBorderStyleType.DASHED:Je.style.borderStyle="dashed";break;case $.AnnotationBorderStyleType.BEVELED:(0,$.warn)("Unimplemented border style: beveled");break;case $.AnnotationBorderStyleType.INSET:(0,$.warn)("Unimplemented border style: inset");break;case $.AnnotationBorderStyleType.UNDERLINE:Je.style.borderBottomStyle="solid";break}const Nt=Ae.borderColor||null;Nt?(ut(this,me,!0),Je.style.borderColor=$.Util.makeHexColor(Nt[0]|0,Nt[1]|0,Nt[2]|0)):Je.style.borderWidth=0}Je.style.left=`${100*(Et[0]-_t)/st}%`,Je.style.top=`${100*(Et[1]-Dt)/ct}%`;const{rotation:kt}=Ae;return Ae.hasOwnCanvas||kt===0?(Je.style.width=`${100*At/st}%`,Je.style.height=`${100*Mt/ct}%`):this.setRotation(kt,Je),Je}setRotation(qe,Ae=this.container){if(!this.data.rect)return;const{pageWidth:xe,pageHeight:Ve}=this.parent.viewport.rawDims,{width:Je,height:st}=ee(this.data.rect);let ct,_t;qe%180===0?(ct=100*Je/xe,_t=100*st/Ve):(ct=100*st/xe,_t=100*Je/Ve),Ae.style.width=`${ct}%`,Ae.style.height=`${_t}%`,Ae.setAttribute("data-main-rotation",(360-qe)%360)}get _commonActions(){const qe=(Ae,xe,Ve)=>{const Je=Ve.detail[Ae],st=Je[0],ct=Je.slice(1);Ve.target.style[xe]=V.ColorConverters[`${st}_HTML`](ct),this.annotationStorage.setValue(this.data.id,{[xe]:V.ColorConverters[`${st}_rgb`](ct)})};return(0,$.shadow)(this,"_commonActions",{display:Ae=>{const{display:xe}=Ae.detail,Ve=xe%2===1;this.container.style.visibility=Ve?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:Ve,noPrint:xe===1||xe===2})},print:Ae=>{this.annotationStorage.setValue(this.data.id,{noPrint:!Ae.detail.print})},hidden:Ae=>{const{hidden:xe}=Ae.detail;this.container.style.visibility=xe?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:xe,noView:xe})},focus:Ae=>{setTimeout(()=>Ae.target.focus({preventScroll:!1}),0)},userName:Ae=>{Ae.target.title=Ae.detail.userName},readonly:Ae=>{Ae.target.disabled=Ae.detail.readonly},required:Ae=>{this._setRequired(Ae.target,Ae.detail.required)},bgColor:Ae=>{qe("bgColor","backgroundColor",Ae)},fillColor:Ae=>{qe("fillColor","backgroundColor",Ae)},fgColor:Ae=>{qe("fgColor","color",Ae)},textColor:Ae=>{qe("textColor","color",Ae)},borderColor:Ae=>{qe("borderColor","borderColor",Ae)},strokeColor:Ae=>{qe("strokeColor","borderColor",Ae)},rotation:Ae=>{const xe=Ae.detail.rotation;this.setRotation(xe),this.annotationStorage.setValue(this.data.id,{rotation:xe})}})}_dispatchEventFromSandbox(qe,Ae){const xe=this._commonActions;for(const Ve of Object.keys(Ae.detail)){const Je=qe[Ve]||xe[Ve];Je==null||Je(Ae)}}_setDefaultPropertiesFromJS(qe){if(!this.enableScripting)return;const Ae=this.annotationStorage.getRawValue(this.data.id);if(!Ae)return;const xe=this._commonActions;for(const[Ve,Je]of Object.entries(Ae)){const st=xe[Ve];if(st){const ct={detail:{[Ve]:Je},target:qe};st(ct),delete Ae[Ve]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:qe}=this.data;if(!qe)return;const[Ae,xe,Ve,Je]=this.data.rect;if(qe.length===1){const[,{x:Ot,y:Nt},{x:zt,y:qt}]=qe[0];if(Ve===Ot&&Je===Nt&&Ae===zt&&xe===qt)return}const{style:st}=this.container;let ct;if(ye(this,me)){const{borderColor:Ot,borderWidth:Nt}=st;st.borderWidth=0,ct=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${Ot}" stroke-width="${Nt}">`],this.container.classList.add("hasBorder")}const _t=Ve-Ae,Dt=Je-xe,{svgFactory:At}=this,Mt=At.createElement("svg");Mt.classList.add("quadrilateralsContainer"),Mt.setAttribute("width",0),Mt.setAttribute("height",0);const Et=At.createElement("defs");Mt.append(Et);const kt=At.createElement("clipPath"),Bt=`clippath_${this.data.id}`;kt.setAttribute("id",Bt),kt.setAttribute("clipPathUnits","objectBoundingBox"),Et.append(kt);for(const[,{x:Ot,y:Nt},{x:zt,y:qt}]of qe){const Wt=At.createElement("rect"),Vt=(zt-Ae)/_t,Kt=(Je-Nt)/Dt,Yt=(Ot-zt)/_t,or=(Nt-qt)/Dt;Wt.setAttribute("x",Vt),Wt.setAttribute("y",Kt),Wt.setAttribute("width",Yt),Wt.setAttribute("height",or),kt.append(Wt),ct==null||ct.push(`<rect vector-effect="non-scaling-stroke" x="${Vt}" y="${Kt}" width="${Yt}" height="${or}"/>`)}ye(this,me)&&(ct.push("</g></svg>')"),st.backgroundImage=ct.join("")),this.container.append(Mt),this.container.style.clipPath=`url(#${Bt})`}_createPopup(){const{container:qe,data:Ae}=this;qe.setAttribute("aria-haspopup","dialog");const xe=new fe({data:{color:Ae.color,titleObj:Ae.titleObj,modificationDate:Ae.modificationDate,contentsObj:Ae.contentsObj,richText:Ae.richText,parentRect:Ae.rect,borderStyle:0,id:`popup_${Ae.id}`,rotation:Ae.rotation},parent:this.parent,elements:[this]});this.parent.div.append(xe.render())}render(){(0,$.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(qe,Ae=null){const xe=[];if(this._fieldObjects){const Ve=this._fieldObjects[qe];if(Ve)for(const{page:Je,id:st,exportValues:ct}of Ve){if(Je===-1||st===Ae)continue;const _t=typeof ct=="string"?ct:null,Dt=document.querySelector(`[data-element-id="${st}"]`);if(Dt&&!Z.has(Dt)){(0,$.warn)(`_getElementsByName - element not allowed: ${st}`);continue}xe.push({id:st,exportValue:_t,domElement:Dt})}return xe}for(const Ve of document.getElementsByName(qe)){const{exportValue:Je}=Ve,st=Ve.getAttribute("data-element-id");st!==Ae&&Z.has(Ve)&&xe.push({id:st,exportValue:Je,domElement:Ve})}return xe}show(){var qe;this.container&&(this.container.hidden=!1),(qe=this.popup)==null||qe.maybeShow()}hide(){var qe;this.container&&(this.container.hidden=!0),(qe=this.popup)==null||qe.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const qe=this.getElementsToTriggerPopup();if(Array.isArray(qe))for(const Ae of qe)Ae.classList.add("highlightArea");else qe.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:qe,data:{id:Ae}}=this;this.container.addEventListener("dblclick",()=>{var xe;(xe=this.linkService.eventBus)==null||xe.dispatch("switchannotationeditormode",{source:this,mode:qe,editId:Ae})})}};me=new WeakMap;let ne=be;class re extends ne{constructor(Ae,xe=null){super(Ae,{isRenderable:!0,ignoreBorder:!!(xe!=null&&xe.ignoreBorder),createQuadrilaterals:!0});Ge(this,Ee);Ge(this,Fe);this.isTooltipOnly=Ae.data.isTooltipOnly}render(){const{data:Ae,linkService:xe}=this,Ve=document.createElement("a");Ve.setAttribute("data-element-id",Ae.id);let Je=!1;return Ae.url?(xe.addLinkAttributes(Ve,Ae.url,Ae.newWindow),Je=!0):Ae.action?(this._bindNamedAction(Ve,Ae.action),Je=!0):Ae.attachment?(this._bindAttachment(Ve,Ae.attachment),Je=!0):Ae.setOCGState?(it(this,Fe,Dr).call(this,Ve,Ae.setOCGState),Je=!0):Ae.dest?(this._bindLink(Ve,Ae.dest),Je=!0):(Ae.actions&&(Ae.actions.Action||Ae.actions["Mouse Up"]||Ae.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(Ve,Ae),Je=!0),Ae.resetForm?(this._bindResetFormAction(Ve,Ae.resetForm),Je=!0):this.isTooltipOnly&&!Je&&(this._bindLink(Ve,""),Je=!0)),this.container.classList.add("linkAnnotation"),Je&&this.container.append(Ve),this.container}_bindLink(Ae,xe){Ae.href=this.linkService.getDestinationHash(xe),Ae.onclick=()=>(xe&&this.linkService.goToDestination(xe),!1),(xe||xe==="")&&it(this,Ee,Qt).call(this)}_bindNamedAction(Ae,xe){Ae.href=this.linkService.getAnchorUrl(""),Ae.onclick=()=>(this.linkService.executeNamedAction(xe),!1),it(this,Ee,Qt).call(this)}_bindAttachment(Ae,xe){Ae.href=this.linkService.getAnchorUrl(""),Ae.onclick=()=>{var Ve;return(Ve=this.downloadManager)==null||Ve.openOrDownloadData(this.container,xe.content,xe.filename),!1},it(this,Ee,Qt).call(this)}_bindJSAction(Ae,xe){Ae.href=this.linkService.getAnchorUrl("");const Ve=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const Je of Object.keys(xe.actions)){const st=Ve.get(Je);st&&(Ae[st]=()=>{var ct;return(ct=this.linkService.eventBus)==null||ct.dispatch("dispatcheventinsandbox",{source:this,detail:{id:xe.id,name:Je}}),!1})}Ae.onclick||(Ae.onclick=()=>!1),it(this,Ee,Qt).call(this)}_bindResetFormAction(Ae,xe){const Ve=Ae.onclick;if(Ve||(Ae.href=this.linkService.getAnchorUrl("")),it(this,Ee,Qt).call(this),!this._fieldObjects){(0,$.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),Ve||(Ae.onclick=()=>!1);return}Ae.onclick=()=>{var Mt;Ve==null||Ve();const{fields:Je,refs:st,include:ct}=xe,_t=[];if(Je.length!==0||st.length!==0){const Et=new Set(st);for(const kt of Je){const Bt=this._fieldObjects[kt]||[];for(const{id:Ot}of Bt)Et.add(Ot)}for(const kt of Object.values(this._fieldObjects))for(const Bt of kt)Et.has(Bt.id)===ct&&_t.push(Bt)}else for(const Et of Object.values(this._fieldObjects))_t.push(...Et);const Dt=this.annotationStorage,At=[];for(const Et of _t){const{id:kt}=Et;switch(At.push(kt),Et.type){case"text":{const Ot=Et.defaultValue||"";Dt.setValue(kt,{value:Ot});break}case"checkbox":case"radiobutton":{const Ot=Et.defaultValue===Et.exportValues;Dt.setValue(kt,{value:Ot});break}case"combobox":case"listbox":{const Ot=Et.defaultValue||"";Dt.setValue(kt,{value:Ot});break}default:continue}const Bt=document.querySelector(`[data-element-id="${kt}"]`);if(Bt){if(!Z.has(Bt)){(0,$.warn)(`_bindResetFormAction - element not allowed: ${kt}`);continue}}else continue;Bt.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((Mt=this.linkService.eventBus)==null||Mt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:At,name:"ResetForm"}})),!1}}}Ee=new WeakSet,Qt=function(){this.container.setAttribute("data-internal-link","")},Fe=new WeakSet,Dr=function(Ae,xe){Ae.href=this.linkService.getAnchorUrl(""),Ae.onclick=()=>(this.linkService.executeSetOCGState(xe),!1),it(this,Ee,Qt).call(this)};class ie extends ne{constructor(qe){super(qe,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const qe=document.createElement("img");return qe.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",qe.alt="[{{type}} Annotation]",qe.dataset.l10nId="text_annotation_type",qe.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(qe),this.container}}class se extends ne{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(qe){var Ae;this.data.hasOwnCanvas&&(((Ae=qe.previousSibling)==null?void 0:Ae.nodeName)==="CANVAS"&&(qe.previousSibling.hidden=!0),qe.hidden=!1)}_getKeyModifier(qe){const{isWin:Ae,isMac:xe}=$.FeatureTest.platform;return Ae&&qe.ctrlKey||xe&&qe.metaKey}_setEventListener(qe,Ae,xe,Ve,Je){xe.includes("mouse")?qe.addEventListener(xe,st=>{var ct;(ct=this.linkService.eventBus)==null||ct.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Ve,value:Je(st),shift:st.shiftKey,modifier:this._getKeyModifier(st)}})}):qe.addEventListener(xe,st=>{var ct;if(xe==="blur"){if(!Ae.focused||!st.relatedTarget)return;Ae.focused=!1}else if(xe==="focus"){if(Ae.focused)return;Ae.focused=!0}Je&&((ct=this.linkService.eventBus)==null||ct.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Ve,value:Je(st)}}))})}_setEventListeners(qe,Ae,xe,Ve){var Je,st,ct;for(const[_t,Dt]of xe)(Dt==="Action"||(Je=this.data.actions)!=null&&Je[Dt])&&((Dt==="Focus"||Dt==="Blur")&&(Ae||(Ae={focused:!1})),this._setEventListener(qe,Ae,_t,Dt,Ve),Dt==="Focus"&&!((st=this.data.actions)!=null&&st.Blur)?this._setEventListener(qe,Ae,"blur","Blur",null):Dt==="Blur"&&!((ct=this.data.actions)!=null&&ct.Focus)&&this._setEventListener(qe,Ae,"focus","Focus",null))}_setBackgroundColor(qe){const Ae=this.data.backgroundColor||null;qe.style.backgroundColor=Ae===null?"transparent":$.Util.makeHexColor(Ae[0],Ae[1],Ae[2])}_setTextStyle(qe){const Ae=["left","center","right"],{fontColor:xe}=this.data.defaultAppearanceData,Ve=this.data.defaultAppearanceData.fontSize||Q,Je=qe.style;let st;const ct=2,_t=Dt=>Math.round(10*Dt)/10;if(this.data.multiLine){const Dt=Math.abs(this.data.rect[3]-this.data.rect[1]-ct),At=Math.round(Dt/($.LINE_FACTOR*Ve))||1,Mt=Dt/At;st=Math.min(Ve,_t(Mt/$.LINE_FACTOR))}else{const Dt=Math.abs(this.data.rect[3]-this.data.rect[1]-ct);st=Math.min(Ve,_t(Dt/$.LINE_FACTOR))}Je.fontSize=`calc(${st}px * var(--scale-factor))`,Je.color=$.Util.makeHexColor(xe[0],xe[1],xe[2]),this.data.textAlignment!==null&&(Je.textAlign=Ae[this.data.textAlignment])}_setRequired(qe,Ae){Ae?qe.setAttribute("required",!0):qe.removeAttribute("required"),qe.setAttribute("aria-required",Ae)}}class le extends se{constructor(qe){const Ae=qe.renderForms||!qe.data.hasAppearance&&!!qe.data.fieldValue;super(qe,{isRenderable:Ae})}setPropertyOnSiblings(qe,Ae,xe,Ve){const Je=this.annotationStorage;for(const st of this._getElementsByName(qe.name,qe.id))st.domElement&&(st.domElement[Ae]=xe),Je.setValue(st.id,{[Ve]:xe})}render(){var Ve,Je;const qe=this.annotationStorage,Ae=this.data.id;this.container.classList.add("textWidgetAnnotation");let xe=null;if(this.renderForms){const st=qe.getValue(Ae,{value:this.data.fieldValue});let ct=st.value||"";const _t=qe.getValue(Ae,{charLimit:this.data.maxLen}).charLimit;_t&&ct.length>_t&&(ct=ct.slice(0,_t));let Dt=st.formattedValue||((Ve=this.data.textContent)==null?void 0:Ve.join(`
`))||null;Dt&&this.data.comb&&(Dt=Dt.replaceAll(/\s+/g,""));const At={userValue:ct,formattedValue:Dt,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(xe=document.createElement("textarea"),xe.textContent=Dt??ct,this.data.doNotScroll&&(xe.style.overflowY="hidden")):(xe=document.createElement("input"),xe.type="text",xe.setAttribute("value",Dt??ct),this.data.doNotScroll&&(xe.style.overflowX="hidden")),this.data.hasOwnCanvas&&(xe.hidden=!0),Z.add(xe),xe.setAttribute("data-element-id",Ae),xe.disabled=this.data.readOnly,xe.name=this.data.fieldName,xe.tabIndex=Y,this._setRequired(xe,this.data.required),_t&&(xe.maxLength=_t),xe.addEventListener("input",Et=>{qe.setValue(Ae,{value:Et.target.value}),this.setPropertyOnSiblings(xe,"value",Et.target.value,"value"),At.formattedValue=null}),xe.addEventListener("resetform",Et=>{const kt=this.data.defaultFieldValue??"";xe.value=At.userValue=kt,At.formattedValue=null});let Mt=Et=>{const{formattedValue:kt}=At;kt!=null&&(Et.target.value=kt),Et.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){xe.addEventListener("focus",kt=>{if(At.focused)return;const{target:Bt}=kt;At.userValue&&(Bt.value=At.userValue),At.lastCommittedValue=Bt.value,At.commitKey=1,At.focused=!0}),xe.addEventListener("updatefromsandbox",kt=>{this.showElementAndHideCanvas(kt.target);const Bt={value(Ot){At.userValue=Ot.detail.value??"",qe.setValue(Ae,{value:At.userValue.toString()}),Ot.target.value=At.userValue},formattedValue(Ot){const{formattedValue:Nt}=Ot.detail;At.formattedValue=Nt,Nt!=null&&Ot.target!==document.activeElement&&(Ot.target.value=Nt),qe.setValue(Ae,{formattedValue:Nt})},selRange(Ot){Ot.target.setSelectionRange(...Ot.detail.selRange)},charLimit:Ot=>{var Wt;const{charLimit:Nt}=Ot.detail,{target:zt}=Ot;if(Nt===0){zt.removeAttribute("maxLength");return}zt.setAttribute("maxLength",Nt);let qt=At.userValue;!qt||qt.length<=Nt||(qt=qt.slice(0,Nt),zt.value=At.userValue=qt,qe.setValue(Ae,{value:qt}),(Wt=this.linkService.eventBus)==null||Wt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Ae,name:"Keystroke",value:qt,willCommit:!0,commitKey:1,selStart:zt.selectionStart,selEnd:zt.selectionEnd}}))}};this._dispatchEventFromSandbox(Bt,kt)}),xe.addEventListener("keydown",kt=>{var Nt;At.commitKey=1;let Bt=-1;if(kt.key==="Escape"?Bt=0:kt.key==="Enter"&&!this.data.multiLine?Bt=2:kt.key==="Tab"&&(At.commitKey=3),Bt===-1)return;const{value:Ot}=kt.target;At.lastCommittedValue!==Ot&&(At.lastCommittedValue=Ot,At.userValue=Ot,(Nt=this.linkService.eventBus)==null||Nt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Ae,name:"Keystroke",value:Ot,willCommit:!0,commitKey:Bt,selStart:kt.target.selectionStart,selEnd:kt.target.selectionEnd}}))});const Et=Mt;Mt=null,xe.addEventListener("blur",kt=>{var Ot;if(!At.focused||!kt.relatedTarget)return;At.focused=!1;const{value:Bt}=kt.target;At.userValue=Bt,At.lastCommittedValue!==Bt&&((Ot=this.linkService.eventBus)==null||Ot.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Ae,name:"Keystroke",value:Bt,willCommit:!0,commitKey:At.commitKey,selStart:kt.target.selectionStart,selEnd:kt.target.selectionEnd}})),Et(kt)}),(Je=this.data.actions)!=null&&Je.Keystroke&&xe.addEventListener("beforeinput",kt=>{var Kt;At.lastCommittedValue=null;const{data:Bt,target:Ot}=kt,{value:Nt,selectionStart:zt,selectionEnd:qt}=Ot;let Wt=zt,Vt=qt;switch(kt.inputType){case"deleteWordBackward":{const Yt=Nt.substring(0,zt).match(/\w*[^\w]*$/);Yt&&(Wt-=Yt[0].length);break}case"deleteWordForward":{const Yt=Nt.substring(zt).match(/^[^\w]*\w*/);Yt&&(Vt+=Yt[0].length);break}case"deleteContentBackward":zt===qt&&(Wt-=1);break;case"deleteContentForward":zt===qt&&(Vt+=1);break}kt.preventDefault(),(Kt=this.linkService.eventBus)==null||Kt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Ae,name:"Keystroke",value:Nt,change:Bt||"",willCommit:!1,selStart:Wt,selEnd:Vt}})}),this._setEventListeners(xe,At,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],kt=>kt.target.value)}if(Mt&&xe.addEventListener("blur",Mt),this.data.comb){const kt=(this.data.rect[2]-this.data.rect[0])/_t;xe.classList.add("comb"),xe.style.letterSpacing=`calc(${kt}px * var(--scale-factor) - 1ch)`}}else xe=document.createElement("div"),xe.textContent=this.data.fieldValue,xe.style.verticalAlign="middle",xe.style.display="table-cell";return this._setTextStyle(xe),this._setBackgroundColor(xe),this._setDefaultPropertiesFromJS(xe),this.container.append(xe),this.container}}class he extends se{constructor(qe){super(qe,{isRenderable:!!qe.data.hasOwnCanvas})}}class ce extends se{constructor(qe){super(qe,{isRenderable:qe.renderForms})}render(){const qe=this.annotationStorage,Ae=this.data,xe=Ae.id;let Ve=qe.getValue(xe,{value:Ae.exportValue===Ae.fieldValue}).value;typeof Ve=="string"&&(Ve=Ve!=="Off",qe.setValue(xe,{value:Ve})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const Je=document.createElement("input");return Z.add(Je),Je.setAttribute("data-element-id",xe),Je.disabled=Ae.readOnly,this._setRequired(Je,this.data.required),Je.type="checkbox",Je.name=Ae.fieldName,Ve&&Je.setAttribute("checked",!0),Je.setAttribute("exportValue",Ae.exportValue),Je.tabIndex=Y,Je.addEventListener("change",st=>{const{name:ct,checked:_t}=st.target;for(const Dt of this._getElementsByName(ct,xe)){const At=_t&&Dt.exportValue===Ae.exportValue;Dt.domElement&&(Dt.domElement.checked=At),qe.setValue(Dt.id,{value:At})}qe.setValue(xe,{value:_t})}),Je.addEventListener("resetform",st=>{const ct=Ae.defaultFieldValue||"Off";st.target.checked=ct===Ae.exportValue}),this.enableScripting&&this.hasJSActions&&(Je.addEventListener("updatefromsandbox",st=>{const ct={value(_t){_t.target.checked=_t.detail.value!=="Off",qe.setValue(xe,{value:_t.target.checked})}};this._dispatchEventFromSandbox(ct,st)}),this._setEventListeners(Je,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],st=>st.target.checked)),this._setBackgroundColor(Je),this._setDefaultPropertiesFromJS(Je),this.container.append(Je),this.container}}class ae extends se{constructor(qe){super(qe,{isRenderable:qe.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const qe=this.annotationStorage,Ae=this.data,xe=Ae.id;let Ve=qe.getValue(xe,{value:Ae.fieldValue===Ae.buttonValue}).value;typeof Ve=="string"&&(Ve=Ve!==Ae.buttonValue,qe.setValue(xe,{value:Ve}));const Je=document.createElement("input");if(Z.add(Je),Je.setAttribute("data-element-id",xe),Je.disabled=Ae.readOnly,this._setRequired(Je,this.data.required),Je.type="radio",Je.name=Ae.fieldName,Ve&&Je.setAttribute("checked",!0),Je.tabIndex=Y,Je.addEventListener("change",st=>{const{name:ct,checked:_t}=st.target;for(const Dt of this._getElementsByName(ct,xe))qe.setValue(Dt.id,{value:!1});qe.setValue(xe,{value:_t})}),Je.addEventListener("resetform",st=>{const ct=Ae.defaultFieldValue;st.target.checked=ct!=null&&ct===Ae.buttonValue}),this.enableScripting&&this.hasJSActions){const st=Ae.buttonValue;Je.addEventListener("updatefromsandbox",ct=>{const _t={value:Dt=>{const At=st===Dt.detail.value;for(const Mt of this._getElementsByName(Dt.target.name)){const Et=At&&Mt.id===xe;Mt.domElement&&(Mt.domElement.checked=Et),qe.setValue(Mt.id,{value:Et})}}};this._dispatchEventFromSandbox(_t,ct)}),this._setEventListeners(Je,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ct=>ct.target.checked)}return this._setBackgroundColor(Je),this._setDefaultPropertiesFromJS(Je),this.container.append(Je),this.container}}class de extends re{constructor(qe){super(qe,{ignoreBorder:qe.data.hasAppearance})}render(){const qe=super.render();qe.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(qe.title=this.data.alternativeText);const Ae=qe.lastChild;return this.enableScripting&&this.hasJSActions&&Ae&&(this._setDefaultPropertiesFromJS(Ae),Ae.addEventListener("updatefromsandbox",xe=>{this._dispatchEventFromSandbox({},xe)})),qe}}class ge extends se{constructor(qe){super(qe,{isRenderable:qe.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const qe=this.annotationStorage,Ae=this.data.id,xe=qe.getValue(Ae,{value:this.data.fieldValue}),Ve=document.createElement("select");Z.add(Ve),Ve.setAttribute("data-element-id",Ae),Ve.disabled=this.data.readOnly,this._setRequired(Ve,this.data.required),Ve.name=this.data.fieldName,Ve.tabIndex=Y;let Je=this.data.combo&&this.data.options.length>0;this.data.combo||(Ve.size=this.data.options.length,this.data.multiSelect&&(Ve.multiple=!0)),Ve.addEventListener("resetform",At=>{const Mt=this.data.defaultFieldValue;for(const Et of Ve.options)Et.selected=Et.value===Mt});for(const At of this.data.options){const Mt=document.createElement("option");Mt.textContent=At.displayValue,Mt.value=At.exportValue,xe.value.includes(At.exportValue)&&(Mt.setAttribute("selected",!0),Je=!1),Ve.append(Mt)}let st=null;if(Je){const At=document.createElement("option");At.value=" ",At.setAttribute("hidden",!0),At.setAttribute("selected",!0),Ve.prepend(At),st=()=>{At.remove(),Ve.removeEventListener("input",st),st=null},Ve.addEventListener("input",st)}const ct=At=>{const Mt=At?"value":"textContent",{options:Et,multiple:kt}=Ve;return kt?Array.prototype.filter.call(Et,Bt=>Bt.selected).map(Bt=>Bt[Mt]):Et.selectedIndex===-1?null:Et[Et.selectedIndex][Mt]};let _t=ct(!1);const Dt=At=>{const Mt=At.target.options;return Array.prototype.map.call(Mt,Et=>({displayValue:Et.textContent,exportValue:Et.value}))};return this.enableScripting&&this.hasJSActions?(Ve.addEventListener("updatefromsandbox",At=>{const Mt={value(Et){st==null||st();const kt=Et.detail.value,Bt=new Set(Array.isArray(kt)?kt:[kt]);for(const Ot of Ve.options)Ot.selected=Bt.has(Ot.value);qe.setValue(Ae,{value:ct(!0)}),_t=ct(!1)},multipleSelection(Et){Ve.multiple=!0},remove(Et){const kt=Ve.options,Bt=Et.detail.remove;kt[Bt].selected=!1,Ve.remove(Bt),kt.length>0&&Array.prototype.findIndex.call(kt,Nt=>Nt.selected)===-1&&(kt[0].selected=!0),qe.setValue(Ae,{value:ct(!0),items:Dt(Et)}),_t=ct(!1)},clear(Et){for(;Ve.length!==0;)Ve.remove(0);qe.setValue(Ae,{value:null,items:[]}),_t=ct(!1)},insert(Et){const{index:kt,displayValue:Bt,exportValue:Ot}=Et.detail.insert,Nt=Ve.children[kt],zt=document.createElement("option");zt.textContent=Bt,zt.value=Ot,Nt?Nt.before(zt):Ve.append(zt),qe.setValue(Ae,{value:ct(!0),items:Dt(Et)}),_t=ct(!1)},items(Et){const{items:kt}=Et.detail;for(;Ve.length!==0;)Ve.remove(0);for(const Bt of kt){const{displayValue:Ot,exportValue:Nt}=Bt,zt=document.createElement("option");zt.textContent=Ot,zt.value=Nt,Ve.append(zt)}Ve.options.length>0&&(Ve.options[0].selected=!0),qe.setValue(Ae,{value:ct(!0),items:Dt(Et)}),_t=ct(!1)},indices(Et){const kt=new Set(Et.detail.indices);for(const Bt of Et.target.options)Bt.selected=kt.has(Bt.index);qe.setValue(Ae,{value:ct(!0)}),_t=ct(!1)},editable(Et){Et.target.disabled=!Et.detail.editable}};this._dispatchEventFromSandbox(Mt,At)}),Ve.addEventListener("input",At=>{var Et;const Mt=ct(!0);qe.setValue(Ae,{value:Mt}),At.preventDefault(),(Et=this.linkService.eventBus)==null||Et.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Ae,name:"Keystroke",value:_t,changeEx:Mt,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(Ve,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],At=>At.target.value)):Ve.addEventListener("input",function(At){qe.setValue(Ae,{value:ct(!0)})}),this.data.combo&&this._setTextStyle(Ve),this._setBackgroundColor(Ve),this._setDefaultPropertiesFromJS(Ve),this.container.append(Ve),this.container}}class fe extends ne{constructor(qe){const{data:Ae,elements:xe}=qe;super(qe,{isRenderable:ne._hasPopupData(Ae)}),this.elements=xe}render(){this.container.classList.add("popupAnnotation");const qe=new oe({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),Ae=[];for(const xe of this.elements)xe.popup=qe,Ae.push(xe.data.id),xe.addHighlightArea();return this.container.setAttribute("aria-controls",Ae.map(xe=>`${$.AnnotationPrefix}${xe}`).join(",")),this.container}}class oe{constructor({container:qe,color:Ae,elements:xe,titleObj:Ve,modificationDate:Je,contentsObj:st,richText:ct,parent:_t,rect:Dt,parentRect:At,open:Mt}){Ge(this,wt);Ge(this,Rt);Ge(this,It);Ge(this,ft);Ge(this,Ue,null);Ge(this,nt,it(this,wt,Er).bind(this));Ge(this,rt,it(this,ft,Yn).bind(this));Ge(this,_e,it(this,It,Kn).bind(this));Ge(this,We,it(this,Rt,yn).bind(this));Ge(this,Xe,null);Ge(this,Te,null);Ge(this,Re,null);Ge(this,He,null);Ge(this,Ze,null);Ge(this,ot,null);Ge(this,$e,!1);Ge(this,je,null);Ge(this,Ke,null);Ge(this,Qe,null);Ge(this,dt,null);Ge(this,pt,!1);var kt;ut(this,Te,qe),ut(this,dt,Ve),ut(this,Re,st),ut(this,Qe,ct),ut(this,Ze,_t),ut(this,Xe,Ae),ut(this,Ke,Dt),ut(this,ot,At),ut(this,He,xe);const Et=j.PDFDateString.toDateObject(Je);Et&&ut(this,Ue,_t.l10n.get("annotation_date_string",{date:Et.toLocaleDateString(),time:Et.toLocaleTimeString()})),this.trigger=xe.flatMap(Bt=>Bt.getElementsToTriggerPopup());for(const Bt of this.trigger)Bt.addEventListener("click",ye(this,We)),Bt.addEventListener("mouseenter",ye(this,_e)),Bt.addEventListener("mouseleave",ye(this,rt)),Bt.classList.add("popupTriggerArea");for(const Bt of xe)(kt=Bt.container)==null||kt.addEventListener("keydown",ye(this,nt));ye(this,Te).hidden=!0,Mt&&it(this,Rt,yn).call(this)}render(){if(ye(this,je))return;const{page:{view:qe},viewport:{rawDims:{pageWidth:Ae,pageHeight:xe,pageX:Ve,pageY:Je}}}=ye(this,Ze),st=ut(this,je,document.createElement("div"));if(st.className="popup",ye(this,Xe)){const Wt=st.style.outlineColor=$.Util.makeHexColor(...ye(this,Xe));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?st.style.backgroundColor=`color-mix(in srgb, ${Wt} 30%, white)`:st.style.backgroundColor=$.Util.makeHexColor(...ye(this,Xe).map(Kt=>Math.floor(.7*(255-Kt)+Kt)))}const ct=document.createElement("span");ct.className="header";const _t=document.createElement("h1");if(ct.append(_t),{dir:_t.dir,str:_t.textContent}=ye(this,dt),st.append(ct),ye(this,Ue)){const Wt=document.createElement("span");Wt.classList.add("popupDate"),ye(this,Ue).then(Vt=>{Wt.textContent=Vt}),ct.append(Wt)}const Dt=ye(this,Re),At=ye(this,Qe);if(At!=null&&At.str&&(!(Dt!=null&&Dt.str)||Dt.str===At.str))X.XfaLayer.render({xfaHtml:At.html,intent:"richText",div:st}),st.lastChild.classList.add("richText","popupContent");else{const Wt=this._formatContents(Dt);st.append(Wt)}let Mt=!!ye(this,ot),Et=Mt?ye(this,ot):ye(this,Ke);for(const Wt of ye(this,He))if(!Et||$.Util.intersect(Wt.data.rect,Et)!==null){Et=Wt.data.rect,Mt=!0;break}const kt=$.Util.normalizeRect([Et[0],qe[3]-Et[1]+qe[1],Et[2],qe[3]-Et[3]+qe[1]]),Bt=5,Ot=Mt?Et[2]-Et[0]+Bt:0,Nt=kt[0]+Ot,zt=kt[1],{style:qt}=ye(this,Te);qt.left=`${100*(Nt-Ve)/Ae}%`,qt.top=`${100*(zt-Je)/xe}%`,ye(this,Te).append(st)}_formatContents({str:qe,dir:Ae}){const xe=document.createElement("p");xe.classList.add("popupContent"),xe.dir=Ae;const Ve=qe.split(/(?:\r\n?|\n)/);for(let Je=0,st=Ve.length;Je<st;++Je){const ct=Ve[Je];xe.append(document.createTextNode(ct)),Je<st-1&&xe.append(document.createElement("br"))}return xe}forceHide(){ut(this,pt,this.isVisible),ye(this,pt)&&(ye(this,Te).hidden=!0)}maybeShow(){ye(this,pt)&&(ut(this,pt,!1),ye(this,Te).hidden=!1)}get isVisible(){return ye(this,Te).hidden===!1}}Ue=new WeakMap,nt=new WeakMap,rt=new WeakMap,_e=new WeakMap,We=new WeakMap,Xe=new WeakMap,Te=new WeakMap,Re=new WeakMap,He=new WeakMap,Ze=new WeakMap,ot=new WeakMap,$e=new WeakMap,je=new WeakMap,Ke=new WeakMap,Qe=new WeakMap,dt=new WeakMap,pt=new WeakMap,wt=new WeakSet,Er=function(qe){qe.altKey||qe.shiftKey||qe.ctrlKey||qe.metaKey||(qe.key==="Enter"||qe.key==="Escape"&&ye(this,$e))&&it(this,Rt,yn).call(this)},Rt=new WeakSet,yn=function(){ut(this,$e,!ye(this,$e)),ye(this,$e)?(it(this,It,Kn).call(this),ye(this,Te).addEventListener("click",ye(this,We)),ye(this,Te).addEventListener("keydown",ye(this,nt))):(it(this,ft,Yn).call(this),ye(this,Te).removeEventListener("click",ye(this,We)),ye(this,Te).removeEventListener("keydown",ye(this,nt)))},It=new WeakSet,Kn=function(){ye(this,je)||this.render(),this.isVisible?ye(this,$e)&&ye(this,Te).classList.add("focused"):(ye(this,Te).hidden=!1,ye(this,Te).style.zIndex=parseInt(ye(this,Te).style.zIndex)+1e3)},ft=new WeakSet,Yn=function(){ye(this,Te).classList.remove("focused"),!(ye(this,$e)||!this.isVisible)&&(ye(this,Te).hidden=!0,ye(this,Te).style.zIndex=parseInt(ye(this,Te).style.zIndex)-1e3)};class we extends ne{constructor(qe){super(qe,{isRenderable:!0,ignoreBorder:!0}),this.textContent=qe.data.textContent,this.textPosition=qe.data.textPosition,this.annotationEditorType=$.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const qe=document.createElement("div");qe.classList.add("annotationTextContent"),qe.setAttribute("role","comment");for(const Ae of this.textContent){const xe=document.createElement("span");xe.textContent=Ae,qe.append(xe)}this.container.append(qe)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}_.FreeTextAnnotationElement=we;class De extends ne{constructor(Ae){super(Ae,{isRenderable:!0,ignoreBorder:!0});Ge(this,et,null)}render(){this.container.classList.add("lineAnnotation");const Ae=this.data,{width:xe,height:Ve}=ee(Ae.rect),Je=this.svgFactory.create(xe,Ve,!0),st=ut(this,et,this.svgFactory.createElement("svg:line"));return st.setAttribute("x1",Ae.rect[2]-Ae.lineCoordinates[0]),st.setAttribute("y1",Ae.rect[3]-Ae.lineCoordinates[1]),st.setAttribute("x2",Ae.rect[2]-Ae.lineCoordinates[2]),st.setAttribute("y2",Ae.rect[3]-Ae.lineCoordinates[3]),st.setAttribute("stroke-width",Ae.borderStyle.width||1),st.setAttribute("stroke","transparent"),st.setAttribute("fill","transparent"),Je.append(st),this.container.append(Je),!Ae.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return ye(this,et)}addHighlightArea(){this.container.classList.add("highlightArea")}}et=new WeakMap;class ve extends ne{constructor(Ae){super(Ae,{isRenderable:!0,ignoreBorder:!0});Ge(this,tt,null)}render(){this.container.classList.add("squareAnnotation");const Ae=this.data,{width:xe,height:Ve}=ee(Ae.rect),Je=this.svgFactory.create(xe,Ve,!0),st=Ae.borderStyle.width,ct=ut(this,tt,this.svgFactory.createElement("svg:rect"));return ct.setAttribute("x",st/2),ct.setAttribute("y",st/2),ct.setAttribute("width",xe-st),ct.setAttribute("height",Ve-st),ct.setAttribute("stroke-width",st||1),ct.setAttribute("stroke","transparent"),ct.setAttribute("fill","transparent"),Je.append(ct),this.container.append(Je),!Ae.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return ye(this,tt)}addHighlightArea(){this.container.classList.add("highlightArea")}}tt=new WeakMap;class Ce extends ne{constructor(Ae){super(Ae,{isRenderable:!0,ignoreBorder:!0});Ge(this,mt,null)}render(){this.container.classList.add("circleAnnotation");const Ae=this.data,{width:xe,height:Ve}=ee(Ae.rect),Je=this.svgFactory.create(xe,Ve,!0),st=Ae.borderStyle.width,ct=ut(this,mt,this.svgFactory.createElement("svg:ellipse"));return ct.setAttribute("cx",xe/2),ct.setAttribute("cy",Ve/2),ct.setAttribute("rx",xe/2-st/2),ct.setAttribute("ry",Ve/2-st/2),ct.setAttribute("stroke-width",st||1),ct.setAttribute("stroke","transparent"),ct.setAttribute("fill","transparent"),Je.append(ct),this.container.append(Je),!Ae.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return ye(this,mt)}addHighlightArea(){this.container.classList.add("highlightArea")}}mt=new WeakMap;class ue extends ne{constructor(Ae){super(Ae,{isRenderable:!0,ignoreBorder:!0});Ge(this,gt,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const Ae=this.data,{width:xe,height:Ve}=ee(Ae.rect),Je=this.svgFactory.create(xe,Ve,!0);let st=[];for(const _t of Ae.vertices){const Dt=_t.x-Ae.rect[0],At=Ae.rect[3]-_t.y;st.push(Dt+","+At)}st=st.join(" ");const ct=ut(this,gt,this.svgFactory.createElement(this.svgElementName));return ct.setAttribute("points",st),ct.setAttribute("stroke-width",Ae.borderStyle.width||1),ct.setAttribute("stroke","transparent"),ct.setAttribute("fill","transparent"),Je.append(ct),this.container.append(Je),!Ae.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return ye(this,gt)}addHighlightArea(){this.container.classList.add("highlightArea")}}gt=new WeakMap;class Pe extends ue{constructor(qe){super(qe),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class ze extends ne{constructor(qe){super(qe,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Le extends ne{constructor(Ae){super(Ae,{isRenderable:!0,ignoreBorder:!0});Ge(this,Ut,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=$.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const Ae=this.data,{width:xe,height:Ve}=ee(Ae.rect),Je=this.svgFactory.create(xe,Ve,!0);for(const st of Ae.inkLists){let ct=[];for(const Dt of st){const At=Dt.x-Ae.rect[0],Mt=Ae.rect[3]-Dt.y;ct.push(`${At},${Mt}`)}ct=ct.join(" ");const _t=this.svgFactory.createElement(this.svgElementName);ye(this,Ut).push(_t),_t.setAttribute("points",ct),_t.setAttribute("stroke-width",Ae.borderStyle.width||1),_t.setAttribute("stroke","transparent"),_t.setAttribute("fill","transparent"),!Ae.popupRef&&this.hasPopupData&&this._createPopup(),Je.append(_t)}return this.container.append(Je),this.container}getElementsToTriggerPopup(){return ye(this,Ut)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ut=new WeakMap,_.InkAnnotationElement=Le;class Me extends ne{constructor(qe){super(qe,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class Ne extends ne{constructor(qe){super(qe,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Ye extends ne{constructor(qe){super(qe,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Ie extends ne{constructor(qe){super(qe,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Oe extends ne{constructor(qe){super(qe,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}_.StampAnnotationElement=Oe;class Se extends ne{constructor(Ae){var Je;super(Ae,{isRenderable:!0});Ge(this,at);Ge(this,jt,null);const{filename:xe,content:Ve}=this.data.file;this.filename=(0,j.getFilenameFromUrl)(xe,!0),this.content=Ve,(Je=this.linkService.eventBus)==null||Je.dispatch("fileattachmentannotation",{source:this,filename:xe,content:Ve})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:Ae,data:xe}=this;let Ve;xe.hasAppearance||xe.fillAlpha===0?Ve=document.createElement("div"):(Ve=document.createElement("img"),Ve.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(xe.name)?"paperclip":"pushpin"}.svg`,xe.fillAlpha&&xe.fillAlpha<1&&(Ve.style=`filter: opacity(${Math.round(xe.fillAlpha*100)}%);`)),Ve.addEventListener("dblclick",it(this,at,Qn).bind(this)),ut(this,jt,Ve);const{isMac:Je}=$.FeatureTest.platform;return Ae.addEventListener("keydown",st=>{st.key==="Enter"&&(Je?st.metaKey:st.ctrlKey)&&it(this,at,Qn).call(this)}),!xe.popupRef&&this.hasPopupData?this._createPopup():Ve.classList.add("popupTriggerArea"),Ae.append(Ve),Ae}getElementsToTriggerPopup(){return ye(this,jt)}addHighlightArea(){this.container.classList.add("highlightArea")}}jt=new WeakMap,at=new WeakSet,Qn=function(){var Ae;(Ae=this.downloadManager)==null||Ae.openOrDownloadData(this.container,this.content,this.filename)};class pe{constructor({div:qe,accessibilityManager:Ae,annotationCanvasMap:xe,l10n:Ve,page:Je,viewport:st}){Ge(this,Pt);Ge(this,bt);Ge(this,Ft,null);Ge(this,vt,null);Ge(this,Tt,new Map);this.div=qe,ut(this,Ft,Ae),ut(this,vt,xe),this.l10n=Ve,this.page=Je,this.viewport=st,this.zIndex=0,this.l10n||(this.l10n=G.NullL10n)}async render(qe){const{annotations:Ae}=qe,xe=this.div;(0,j.setLayerDimensions)(xe,this.viewport);const Ve=new Map,Je={data:null,layer:xe,linkService:qe.linkService,downloadManager:qe.downloadManager,imageResourcesPath:qe.imageResourcesPath||"",renderForms:qe.renderForms!==!1,svgFactory:new j.DOMSVGFactory,annotationStorage:qe.annotationStorage||new z.AnnotationStorage,enableScripting:qe.enableScripting===!0,hasJSActions:qe.hasJSActions,fieldObjects:qe.fieldObjects,parent:this,elements:null};for(const st of Ae){if(st.noHTML)continue;const ct=st.annotationType===$.AnnotationType.POPUP;if(ct){const At=Ve.get(st.id);if(!At)continue;Je.elements=At}else{const{width:At,height:Mt}=ee(st.rect);if(At<=0||Mt<=0)continue}Je.data=st;const _t=te.create(Je);if(!_t.isRenderable)continue;if(!ct&&st.popupRef){const At=Ve.get(st.popupRef);At?At.push(_t):Ve.set(st.popupRef,[_t])}_t.annotationEditorType>0&&ye(this,Tt).set(_t.data.id,_t);const Dt=_t.render();st.hidden&&(Dt.style.visibility="hidden"),it(this,Pt,kr).call(this,Dt,st.id)}it(this,bt,Zn).call(this),await this.l10n.translate(xe)}update({viewport:qe}){const Ae=this.div;this.viewport=qe,(0,j.setLayerDimensions)(Ae,{rotation:qe.rotation}),it(this,bt,Zn).call(this),Ae.hidden=!1}getEditableAnnotations(){return Array.from(ye(this,Tt).values())}getEditableAnnotation(qe){return ye(this,Tt).get(qe)}}Ft=new WeakMap,vt=new WeakMap,Tt=new WeakMap,Pt=new WeakSet,kr=function(qe,Ae){var Ve;const xe=qe.firstChild||qe;xe.id=`${$.AnnotationPrefix}${Ae}`,this.div.append(qe),(Ve=ye(this,Ft))==null||Ve.moveElementInDOM(this.div,qe,xe,!1)},bt=new WeakSet,Zn=function(){if(!ye(this,vt))return;const qe=this.div;for(const[Ae,xe]of ye(this,vt)){const Ve=qe.querySelector(`[data-annotation-id="${Ae}"]`);if(!Ve)continue;const{firstChild:Je}=Ve;Je?Je.nodeName==="CANVAS"?Je.replaceWith(xe):Je.before(xe):Ve.append(xe)}ye(this,vt).clear()},_.AnnotationLayer=pe},(q,_)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.ColorConverters=void 0;function M(z){return Math.floor(Math.max(0,Math.min(1,z))*255).toString(16).padStart(2,"0")}function $(z){return Math.max(0,Math.min(255,255*z))}class j{static CMYK_G([V,G,X,Y]){return["G",1-Math.min(1,.3*V+.59*X+.11*G+Y)]}static G_CMYK([V]){return["CMYK",0,0,0,1-V]}static G_RGB([V]){return["RGB",V,V,V]}static G_rgb([V]){return V=$(V),[V,V,V]}static G_HTML([V]){const G=M(V);return`#${G}${G}${G}`}static RGB_G([V,G,X]){return["G",.3*V+.59*G+.11*X]}static RGB_rgb(V){return V.map($)}static RGB_HTML(V){return`#${V.map(M).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([V,G,X,Y]){return["RGB",1-Math.min(1,V+Y),1-Math.min(1,X+Y),1-Math.min(1,G+Y)]}static CMYK_rgb([V,G,X,Y]){return[$(1-Math.min(1,V+Y)),$(1-Math.min(1,X+Y)),$(1-Math.min(1,G+Y))]}static CMYK_HTML(V){const G=this.CMYK_RGB(V).slice(1);return this.RGB_HTML(G)}static RGB_CMYK([V,G,X]){const Y=1-V,Q=1-G,Z=1-X,ee=Math.min(Y,Q,Z);return["CMYK",Y,Q,Z,ee]}}_.ColorConverters=j},(q,_)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.NullL10n=void 0,_.getL10nFallback=$;const M={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};M.print_progress_percent="{{progress}}%";function $(V,G){switch(V){case"find_match_count":V=`find_match_count[${G.total===1?"one":"other"}]`;break;case"find_match_count_limit":V=`find_match_count_limit[${G.limit===1?"one":"other"}]`;break}return M[V]||""}function j(V,G){return G?V.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(X,Y)=>Y in G?G[Y]:"{{"+Y+"}}"):V}const z={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(V,G=null,X=$(V,G)){return j(X,G)},async translate(V){}};_.NullL10n=z},(q,_,M)=>{Object.defineProperty(_,"__esModule",{value:!0}),_.XfaLayer=void 0;var $=M(25);class j{static setupStorage(V,G,X,Y,Q){const Z=Y.getValue(G,{value:null});switch(X.name){case"textarea":if(Z.value!==null&&(V.textContent=Z.value),Q==="print")break;V.addEventListener("input",ee=>{Y.setValue(G,{value:ee.target.value})});break;case"input":if(X.attributes.type==="radio"||X.attributes.type==="checkbox"){if(Z.value===X.attributes.xfaOn?V.setAttribute("checked",!0):Z.value===X.attributes.xfaOff&&V.removeAttribute("checked"),Q==="print")break;V.addEventListener("change",ee=>{Y.setValue(G,{value:ee.target.checked?ee.target.getAttribute("xfaOn"):ee.target.getAttribute("xfaOff")})})}else{if(Z.value!==null&&V.setAttribute("value",Z.value),Q==="print")break;V.addEventListener("input",ee=>{Y.setValue(G,{value:ee.target.value})})}break;case"select":if(Z.value!==null){V.setAttribute("value",Z.value);for(const ee of X.children)ee.attributes.value===Z.value?ee.attributes.selected=!0:ee.attributes.hasOwnProperty("selected")&&delete ee.attributes.selected}V.addEventListener("input",ee=>{const te=ee.target.options,ne=te.selectedIndex===-1?"":te[te.selectedIndex].value;Y.setValue(G,{value:ne})});break}}static setAttributes({html:V,element:G,storage:X=null,intent:Y,linkService:Q}){const{attributes:Z}=G,ee=V instanceof HTMLAnchorElement;Z.type==="radio"&&(Z.name=`${Z.name}-${Y}`);for(const[te,ne]of Object.entries(Z))if(ne!=null)switch(te){case"class":ne.length&&V.setAttribute(te,ne.join(" "));break;case"dataId":break;case"id":V.setAttribute("data-element-id",ne);break;case"style":Object.assign(V.style,ne);break;case"textContent":V.textContent=ne;break;default:(!ee||te!=="href"&&te!=="newWindow")&&V.setAttribute(te,ne)}ee&&Q.addLinkAttributes(V,Z.href,Z.newWindow),X&&Z.dataId&&this.setupStorage(V,Z.dataId,G,X)}static render(V){var re;const G=V.annotationStorage,X=V.linkService,Y=V.xfaHtml,Q=V.intent||"display",Z=document.createElement(Y.name);Y.attributes&&this.setAttributes({html:Z,element:Y,intent:Q,linkService:X});const ee=[[Y,-1,Z]],te=V.div;if(te.append(Z),V.viewport){const ie=`matrix(${V.viewport.transform.join(",")})`;te.style.transform=ie}Q!=="richText"&&te.setAttribute("class","xfaLayer xfaFont");const ne=[];for(;ee.length>0;){const[ie,se,le]=ee.at(-1);if(se+1===ie.children.length){ee.pop();continue}const he=ie.children[++ee.at(-1)[1]];if(he===null)continue;const{name:ce}=he;if(ce==="#text"){const de=document.createTextNode(he.value);ne.push(de),le.append(de);continue}const ae=(re=he==null?void 0:he.attributes)!=null&&re.xmlns?document.createElementNS(he.attributes.xmlns,ce):document.createElement(ce);if(le.append(ae),he.attributes&&this.setAttributes({html:ae,element:he,storage:G,intent:Q,linkService:X}),he.children&&he.children.length>0)ee.push([he,-1,ae]);else if(he.value){const de=document.createTextNode(he.value);$.XfaText.shouldBuildText(ce)&&ne.push(de),ae.append(de)}}for(const ie of te.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))ie.setAttribute("readOnly",!0);return{textDivs:ne}}static update(V){const G=`matrix(${V.viewport.transform.join(",")})`;V.div.style.transform=G,V.div.hidden=!1}}_.XfaLayer=j},(q,_,M)=>{var Y,Q,Z,ee,te,ne,re,ie,se,le,he,ce,ae,de,ge,Cr,oe,Sr,De,Fr,Ce,Tr,Pe,Jn,Le,Pr,Ne,er,Ie,Rr,Se,xr,me,Ir,Ee,Mr,Fe,Or,Ue,Xt,rt,tr,We,wn,Te,vn,He,tn,ot,nr,je,An,Qe,Lr,pt,rr,St,Nr,xt,$r,ht,ir,lt,Dn,tt,nn;Object.defineProperty(_,"__esModule",{value:!0}),_.InkEditor=void 0;var $=M(1),j=M(4),z=M(29),V=M(6),G=M(5);const gt=class gt extends j.AnnotationEditor{constructor(at){super({...at,name:"inkEditor"});Ge(this,ge);Ge(this,oe);Ge(this,De);Ge(this,Ce);Ge(this,Pe);Ge(this,Le);Ge(this,Ne);Ge(this,Ie);Ge(this,Se);Ge(this,me);Ge(this,Ee);Ge(this,Fe);Ge(this,Ue);Ge(this,rt);Ge(this,We);Ge(this,Te);Ge(this,He);Ge(this,ot);Ge(this,je);Ge(this,xt);Ge(this,ht);Ge(this,lt);Ge(this,tt);Ge(this,Y,0);Ge(this,Q,0);Ge(this,Z,this.canvasPointermove.bind(this));Ge(this,ee,this.canvasPointerleave.bind(this));Ge(this,te,this.canvasPointerup.bind(this));Ge(this,ne,this.canvasPointerdown.bind(this));Ge(this,re,new Path2D);Ge(this,ie,!1);Ge(this,se,!1);Ge(this,le,!1);Ge(this,he,null);Ge(this,ce,0);Ge(this,ae,0);Ge(this,de,null);this.color=at.color||null,this.thickness=at.thickness||null,this.opacity=at.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(at){j.AnnotationEditor.initialize(at,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(at,yt){switch(at){case $.AnnotationEditorParamsType.INK_THICKNESS:gt._defaultThickness=yt;break;case $.AnnotationEditorParamsType.INK_COLOR:gt._defaultColor=yt;break;case $.AnnotationEditorParamsType.INK_OPACITY:gt._defaultOpacity=yt/100;break}}updateParams(at,yt){switch(at){case $.AnnotationEditorParamsType.INK_THICKNESS:it(this,ge,Cr).call(this,yt);break;case $.AnnotationEditorParamsType.INK_COLOR:it(this,oe,Sr).call(this,yt);break;case $.AnnotationEditorParamsType.INK_OPACITY:it(this,De,Fr).call(this,yt);break}}static get defaultPropertiesToUpdate(){return[[$.AnnotationEditorParamsType.INK_THICKNESS,gt._defaultThickness],[$.AnnotationEditorParamsType.INK_COLOR,gt._defaultColor||j.AnnotationEditor._defaultLineColor],[$.AnnotationEditorParamsType.INK_OPACITY,Math.round(gt._defaultOpacity*100)]]}get propertiesToUpdate(){return[[$.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||gt._defaultThickness],[$.AnnotationEditorParamsType.INK_COLOR,this.color||gt._defaultColor||j.AnnotationEditor._defaultLineColor],[$.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??gt._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(it(this,We,wn).call(this),it(this,Te,vn).call(this)),this.isAttachedToDOM||(this.parent.add(this),it(this,He,tn).call(this)),it(this,tt,nn).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,ye(this,he).disconnect(),ut(this,he,null),super.remove())}setParent(at){!this.parent&&at?this._uiManager.removeShouldRescale(this):this.parent&&at===null&&this._uiManager.addShouldRescale(this),super.setParent(at)}onScaleChanging(){const[at,yt]=this.parentDimensions,Ft=this.width*at,vt=this.height*yt;this.setDimensions(Ft,vt)}enableEditMode(){ye(this,ie)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",ye(this,ne)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",ye(this,ne)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){ye(this,ie)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),ut(this,ie,!0),this.div.classList.add("disabled"),it(this,tt,nn).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(at){this._focusEventsAllowed&&(super.focusin(at),this.enableEditMode())}canvasPointerdown(at){at.button!==0||!this.isInEditMode()||ye(this,ie)||(this.setInForeground(),at.preventDefault(),at.type!=="mouse"&&this.div.focus(),it(this,Le,Pr).call(this,at.offsetX,at.offsetY))}canvasPointermove(at){at.preventDefault(),it(this,Ne,er).call(this,at.offsetX,at.offsetY)}canvasPointerup(at){at.preventDefault(),it(this,rt,tr).call(this,at)}canvasPointerleave(at){it(this,rt,tr).call(this,at)}get isResizable(){return!this.isEmpty()&&ye(this,ie)}render(){if(this.div)return this.div;let at,yt;this.width&&(at=this.x,yt=this.y),super.render(),j.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then($t=>{var bt;return(bt=this.div)==null?void 0:bt.setAttribute("aria-label",$t)});const[Ft,vt,Tt,Pt]=it(this,Ce,Tr).call(this);if(this.setAt(Ft,vt,0,0),this.setDims(Tt,Pt),it(this,We,wn).call(this),this.width){const[$t,bt]=this.parentDimensions;this.setAspectRatio(this.width*$t,this.height*bt),this.setAt(at*$t,yt*bt,this.width*$t,this.height*bt),ut(this,le,!0),it(this,He,tn).call(this),this.setDims(this.width*$t,this.height*bt),it(this,Ue,Xt).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return it(this,Te,vn).call(this),this.div}setDimensions(at,yt){const Ft=Math.round(at),vt=Math.round(yt);if(ye(this,ce)===Ft&&ye(this,ae)===vt)return;ut(this,ce,Ft),ut(this,ae,vt),this.canvas.style.visibility="hidden";const[Tt,Pt]=this.parentDimensions;this.width=at/Tt,this.height=yt/Pt,this.fixAndSetPosition(),ye(this,ie)&&it(this,ot,nr).call(this,at,yt),it(this,He,tn).call(this),it(this,Ue,Xt).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(at,yt,Ft){var Je,st,ct;if(at instanceof z.InkAnnotationElement)return null;const vt=super.deserialize(at,yt,Ft);vt.thickness=at.thickness,vt.color=$.Util.makeHexColor(...at.color),vt.opacity=at.opacity;const[Tt,Pt]=vt.pageDimensions,$t=vt.width*Tt,bt=vt.height*Pt,Lt=vt.parentScale,Ct=at.thickness/2;ut(vt,ie,!0),ut(vt,ce,Math.round($t)),ut(vt,ae,Math.round(bt));const{paths:qe,rect:Ae,rotation:xe}=at;for(let{bezier:_t}of qe){_t=it(Je=gt,St,Nr).call(Je,_t,Ae,xe);const Dt=[];vt.paths.push(Dt);let At=Lt*(_t[0]-Ct),Mt=Lt*(_t[1]-Ct);for(let kt=2,Bt=_t.length;kt<Bt;kt+=6){const Ot=Lt*(_t[kt]-Ct),Nt=Lt*(_t[kt+1]-Ct),zt=Lt*(_t[kt+2]-Ct),qt=Lt*(_t[kt+3]-Ct),Wt=Lt*(_t[kt+4]-Ct),Vt=Lt*(_t[kt+5]-Ct);Dt.push([[At,Mt],[Ot,Nt],[zt,qt],[Wt,Vt]]),At=Wt,Mt=Vt}const Et=it(this,Qe,Lr).call(this,Dt);vt.bezierPath2D.push(Et)}const Ve=it(st=vt,ht,ir).call(st);return ut(vt,Q,Math.max(j.AnnotationEditor.MIN_SIZE,Ve[2]-Ve[0])),ut(vt,Y,Math.max(j.AnnotationEditor.MIN_SIZE,Ve[3]-Ve[1])),it(ct=vt,ot,nr).call(ct,$t,bt),vt}serialize(){if(this.isEmpty())return null;const at=this.getRect(0,0),yt=j.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:$.AnnotationEditorType.INK,color:yt,thickness:this.thickness,opacity:this.opacity,paths:it(this,xt,$r).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,at),pageIndex:this.pageIndex,rect:at,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,re=new WeakMap,ie=new WeakMap,se=new WeakMap,le=new WeakMap,he=new WeakMap,ce=new WeakMap,ae=new WeakMap,de=new WeakMap,ge=new WeakSet,Cr=function(at){const yt=this.thickness;this.addCommands({cmd:()=>{this.thickness=at,it(this,tt,nn).call(this)},undo:()=>{this.thickness=yt,it(this,tt,nn).call(this)},mustExec:!0,type:$.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},oe=new WeakSet,Sr=function(at){const yt=this.color;this.addCommands({cmd:()=>{this.color=at,it(this,Ue,Xt).call(this)},undo:()=>{this.color=yt,it(this,Ue,Xt).call(this)},mustExec:!0,type:$.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},De=new WeakSet,Fr=function(at){at/=100;const yt=this.opacity;this.addCommands({cmd:()=>{this.opacity=at,it(this,Ue,Xt).call(this)},undo:()=>{this.opacity=yt,it(this,Ue,Xt).call(this)},mustExec:!0,type:$.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},Ce=new WeakSet,Tr=function(){const{parentRotation:at,parentDimensions:[yt,Ft]}=this;switch(at){case 90:return[0,Ft,Ft,yt];case 180:return[yt,Ft,yt,Ft];case 270:return[yt,0,Ft,yt];default:return[0,0,yt,Ft]}},Pe=new WeakSet,Jn=function(){const{ctx:at,color:yt,opacity:Ft,thickness:vt,parentScale:Tt,scaleFactor:Pt}=this;at.lineWidth=vt*Tt/Pt,at.lineCap="round",at.lineJoin="round",at.miterLimit=10,at.strokeStyle=`${yt}${(0,G.opacityToHex)(Ft)}`},Le=new WeakSet,Pr=function(at,yt){this.canvas.addEventListener("contextmenu",V.noContextMenu),this.canvas.addEventListener("pointerleave",ye(this,ee)),this.canvas.addEventListener("pointermove",ye(this,Z)),this.canvas.addEventListener("pointerup",ye(this,te)),this.canvas.removeEventListener("pointerdown",ye(this,ne)),this.isEditing=!0,ye(this,le)||(ut(this,le,!0),it(this,He,tn).call(this),this.thickness||(this.thickness=gt._defaultThickness),this.color||(this.color=gt._defaultColor||j.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=gt._defaultOpacity)),this.currentPath.push([at,yt]),ut(this,se,!1),it(this,Pe,Jn).call(this),ut(this,de,()=>{it(this,me,Ir).call(this),ye(this,de)&&window.requestAnimationFrame(ye(this,de))}),window.requestAnimationFrame(ye(this,de))},Ne=new WeakSet,er=function(at,yt){const[Ft,vt]=this.currentPath.at(-1);if(this.currentPath.length>1&&at===Ft&&yt===vt)return;const Tt=this.currentPath;let Pt=ye(this,re);if(Tt.push([at,yt]),ut(this,se,!0),Tt.length<=2){Pt.moveTo(...Tt[0]),Pt.lineTo(at,yt);return}Tt.length===3&&(ut(this,re,Pt=new Path2D),Pt.moveTo(...Tt[0])),it(this,Ee,Mr).call(this,Pt,...Tt.at(-3),...Tt.at(-2),at,yt)},Ie=new WeakSet,Rr=function(){if(this.currentPath.length===0)return;const at=this.currentPath.at(-1);ye(this,re).lineTo(...at)},Se=new WeakSet,xr=function(at,yt){ut(this,de,null),at=Math.min(Math.max(at,0),this.canvas.width),yt=Math.min(Math.max(yt,0),this.canvas.height),it(this,Ne,er).call(this,at,yt),it(this,Ie,Rr).call(this);let Ft;if(this.currentPath.length!==1)Ft=it(this,Fe,Or).call(this);else{const bt=[at,yt];Ft=[[bt,bt.slice(),bt.slice(),bt]]}const vt=ye(this,re),Tt=this.currentPath;this.currentPath=[],ut(this,re,new Path2D);const Pt=()=>{this.allRawPaths.push(Tt),this.paths.push(Ft),this.bezierPath2D.push(vt),this.rebuild()},$t=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(it(this,We,wn).call(this),it(this,Te,vn).call(this)),it(this,tt,nn).call(this))};this.addCommands({cmd:Pt,undo:$t,mustExec:!0})},me=new WeakSet,Ir=function(){if(!ye(this,se))return;ut(this,se,!1);const at=Math.ceil(this.thickness*this.parentScale),yt=this.currentPath.slice(-3),Ft=yt.map(Pt=>Pt[0]),vt=yt.map(Pt=>Pt[1]);Math.min(...Ft)-at,Math.max(...Ft)+at,Math.min(...vt)-at,Math.max(...vt)+at;const{ctx:Tt}=this;Tt.save(),Tt.clearRect(0,0,this.canvas.width,this.canvas.height);for(const Pt of this.bezierPath2D)Tt.stroke(Pt);Tt.stroke(ye(this,re)),Tt.restore()},Ee=new WeakSet,Mr=function(at,yt,Ft,vt,Tt,Pt,$t){const bt=(yt+vt)/2,Lt=(Ft+Tt)/2,Ct=(vt+Pt)/2,qe=(Tt+$t)/2;at.bezierCurveTo(bt+2*(vt-bt)/3,Lt+2*(Tt-Lt)/3,Ct+2*(vt-Ct)/3,qe+2*(Tt-qe)/3,Ct,qe)},Fe=new WeakSet,Or=function(){const at=this.currentPath;if(at.length<=2)return[[at[0],at[0],at.at(-1),at.at(-1)]];const yt=[];let Ft,[vt,Tt]=at[0];for(Ft=1;Ft<at.length-2;Ft++){const[Ae,xe]=at[Ft],[Ve,Je]=at[Ft+1],st=(Ae+Ve)/2,ct=(xe+Je)/2,_t=[vt+2*(Ae-vt)/3,Tt+2*(xe-Tt)/3],Dt=[st+2*(Ae-st)/3,ct+2*(xe-ct)/3];yt.push([[vt,Tt],_t,Dt,[st,ct]]),[vt,Tt]=[st,ct]}const[Pt,$t]=at[Ft],[bt,Lt]=at[Ft+1],Ct=[vt+2*(Pt-vt)/3,Tt+2*($t-Tt)/3],qe=[bt+2*(Pt-bt)/3,Lt+2*($t-Lt)/3];return yt.push([[vt,Tt],Ct,qe,[bt,Lt]]),yt},Ue=new WeakSet,Xt=function(){if(this.isEmpty()){it(this,je,An).call(this);return}it(this,Pe,Jn).call(this);const{canvas:at,ctx:yt}=this;yt.setTransform(1,0,0,1,0,0),yt.clearRect(0,0,at.width,at.height),it(this,je,An).call(this);for(const Ft of this.bezierPath2D)yt.stroke(Ft)},rt=new WeakSet,tr=function(at){this.canvas.removeEventListener("pointerleave",ye(this,ee)),this.canvas.removeEventListener("pointermove",ye(this,Z)),this.canvas.removeEventListener("pointerup",ye(this,te)),this.canvas.addEventListener("pointerdown",ye(this,ne)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",V.noContextMenu)},10),it(this,Se,xr).call(this,at.offsetX,at.offsetY),this.addToAnnotationStorage(),this.setInBackground()},We=new WeakSet,wn=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",j.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(at=>{var yt;return(yt=this.canvas)==null?void 0:yt.setAttribute("aria-label",at)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Te=new WeakSet,vn=function(){ut(this,he,new ResizeObserver(at=>{const yt=at[0].contentRect;yt.width&&yt.height&&this.setDimensions(yt.width,yt.height)})),ye(this,he).observe(this.div)},He=new WeakSet,tn=function(){if(!ye(this,le))return;const[at,yt]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*at),this.canvas.height=Math.ceil(this.height*yt),it(this,je,An).call(this)},ot=new WeakSet,nr=function(at,yt){const Ft=it(this,lt,Dn).call(this),vt=(at-Ft)/ye(this,Q),Tt=(yt-Ft)/ye(this,Y);this.scaleFactor=Math.min(vt,Tt)},je=new WeakSet,An=function(){const at=it(this,lt,Dn).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+at,this.translationY*this.scaleFactor+at)},Qe=new WeakSet,Lr=function(at){const yt=new Path2D;for(let Ft=0,vt=at.length;Ft<vt;Ft++){const[Tt,Pt,$t,bt]=at[Ft];Ft===0&&yt.moveTo(...Tt),yt.bezierCurveTo(Pt[0],Pt[1],$t[0],$t[1],bt[0],bt[1])}return yt},pt=new WeakSet,rr=function(at,yt,Ft){const[vt,Tt,Pt,$t]=yt;switch(Ft){case 0:for(let bt=0,Lt=at.length;bt<Lt;bt+=2)at[bt]+=vt,at[bt+1]=$t-at[bt+1];break;case 90:for(let bt=0,Lt=at.length;bt<Lt;bt+=2){const Ct=at[bt];at[bt]=at[bt+1]+vt,at[bt+1]=Ct+Tt}break;case 180:for(let bt=0,Lt=at.length;bt<Lt;bt+=2)at[bt]=Pt-at[bt],at[bt+1]+=Tt;break;case 270:for(let bt=0,Lt=at.length;bt<Lt;bt+=2){const Ct=at[bt];at[bt]=Pt-at[bt+1],at[bt+1]=$t-Ct}break;default:throw new Error("Invalid rotation")}return at},St=new WeakSet,Nr=function(at,yt,Ft){const[vt,Tt,Pt,$t]=yt;switch(Ft){case 0:for(let bt=0,Lt=at.length;bt<Lt;bt+=2)at[bt]-=vt,at[bt+1]=$t-at[bt+1];break;case 90:for(let bt=0,Lt=at.length;bt<Lt;bt+=2){const Ct=at[bt];at[bt]=at[bt+1]-Tt,at[bt+1]=Ct-vt}break;case 180:for(let bt=0,Lt=at.length;bt<Lt;bt+=2)at[bt]=Pt-at[bt],at[bt+1]-=Tt;break;case 270:for(let bt=0,Lt=at.length;bt<Lt;bt+=2){const Ct=at[bt];at[bt]=$t-at[bt+1],at[bt+1]=Pt-Ct}break;default:throw new Error("Invalid rotation")}return at},xt=new WeakSet,$r=function(at,yt,Ft,vt){var Lt,Ct;const Tt=[],Pt=this.thickness/2,$t=at*yt+Pt,bt=at*Ft+Pt;for(const qe of this.paths){const Ae=[],xe=[];for(let Ve=0,Je=qe.length;Ve<Je;Ve++){const[st,ct,_t,Dt]=qe[Ve],At=at*st[0]+$t,Mt=at*st[1]+bt,Et=at*ct[0]+$t,kt=at*ct[1]+bt,Bt=at*_t[0]+$t,Ot=at*_t[1]+bt,Nt=at*Dt[0]+$t,zt=at*Dt[1]+bt;Ve===0&&(Ae.push(At,Mt),xe.push(At,Mt)),Ae.push(Et,kt,Bt,Ot,Nt,zt),xe.push(Et,kt),Ve===Je-1&&xe.push(Nt,zt)}Tt.push({bezier:it(Lt=gt,pt,rr).call(Lt,Ae,vt,this.rotation),points:it(Ct=gt,pt,rr).call(Ct,xe,vt,this.rotation)})}return Tt},ht=new WeakSet,ir=function(){let at=1/0,yt=-1/0,Ft=1/0,vt=-1/0;for(const Tt of this.paths)for(const[Pt,$t,bt,Lt]of Tt){const Ct=$.Util.bezierBoundingBox(...Pt,...$t,...bt,...Lt);at=Math.min(at,Ct[0]),Ft=Math.min(Ft,Ct[1]),yt=Math.max(yt,Ct[2]),vt=Math.max(vt,Ct[3])}return[at,Ft,yt,vt]},lt=new WeakSet,Dn=function(){return ye(this,ie)?Math.ceil(this.thickness*this.parentScale):0},tt=new WeakSet,nn=function(at=!1){if(this.isEmpty())return;if(!ye(this,ie)){it(this,Ue,Xt).call(this);return}const yt=it(this,ht,ir).call(this),Ft=it(this,lt,Dn).call(this);ut(this,Q,Math.max(j.AnnotationEditor.MIN_SIZE,yt[2]-yt[0])),ut(this,Y,Math.max(j.AnnotationEditor.MIN_SIZE,yt[3]-yt[1]));const vt=Math.ceil(Ft+ye(this,Q)*this.scaleFactor),Tt=Math.ceil(Ft+ye(this,Y)*this.scaleFactor),[Pt,$t]=this.parentDimensions;this.width=vt/Pt,this.height=Tt/$t,this.setAspectRatio(vt,Tt);const bt=this.translationX,Lt=this.translationY;this.translationX=-yt[0],this.translationY=-yt[1],it(this,He,tn).call(this),it(this,Ue,Xt).call(this),ut(this,ce,vt),ut(this,ae,Tt),this.setDims(vt,Tt);const Ct=at?Ft/this.scaleFactor/2:0;this.translate(bt-this.translationX-Ct,Lt-this.translationY-Ct)},Ge(gt,Qe),Ge(gt,pt),Ge(gt,St),Ht(gt,"_defaultColor",null),Ht(gt,"_defaultOpacity",1),Ht(gt,"_defaultThickness",1),Ht(gt,"_type","ink");let X=gt;_.InkEditor=X},(q,_,M)=>{var X,Y,Q,Z,ee,te,ne,re,ie,se,le,cn,ce,dn,de,En,fe,sr,we,Ur,ve,jr,ue,ar,ze,kn,Me,zr;Object.defineProperty(_,"__esModule",{value:!0}),_.StampEditor=void 0;var $=M(1),j=M(4),z=M(6),V=M(29);const Ye=class Ye extends j.AnnotationEditor{constructor(Se){super({...Se,name:"stampEditor"});Ge(this,le);Ge(this,ce);Ge(this,de);Ge(this,fe);Ge(this,we);Ge(this,ve);Ge(this,ue);Ge(this,ze);Ge(this,Me);Ge(this,X,null);Ge(this,Y,null);Ge(this,Q,null);Ge(this,Z,null);Ge(this,ee,null);Ge(this,te,null);Ge(this,ne,null);Ge(this,re,null);Ge(this,ie,!1);Ge(this,se,!1);ut(this,Z,Se.bitmapUrl),ut(this,ee,Se.bitmapFile)}static initialize(Se){j.AnnotationEditor.initialize(Se)}static get supportedTypes(){const Se=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,$.shadow)(this,"supportedTypes",Se.map(pe=>`image/${pe}`))}static get supportedTypesStr(){return(0,$.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(Se){return this.supportedTypes.includes(Se)}static paste(Se,pe){pe.pasteEditor($.AnnotationEditorType.STAMP,{bitmapFile:Se.getAsFile()})}remove(){var Se,pe;ye(this,Y)&&(ut(this,X,null),this._uiManager.imageManager.deleteId(ye(this,Y)),(Se=ye(this,te))==null||Se.remove(),ut(this,te,null),(pe=ye(this,ne))==null||pe.disconnect(),ut(this,ne,null)),super.remove()}rebuild(){if(!this.parent){ye(this,Y)&&it(this,de,En).call(this);return}super.rebuild(),this.div!==null&&(ye(this,Y)&&it(this,de,En).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(ye(this,Q)||ye(this,X)||ye(this,Z)||ye(this,ee))}get isResizable(){return!0}render(){if(this.div)return this.div;let Se,pe;if(this.width&&(Se=this.x,pe=this.y),super.render(),this.div.hidden=!0,ye(this,X)?it(this,fe,sr).call(this):it(this,de,En).call(this),this.width){const[me,be]=this.parentDimensions;this.setAt(Se*me,pe*be,this.width*me,this.height*be)}return this.div}static deserialize(Se,pe,me){if(Se instanceof V.StampAnnotationElement)return null;const be=super.deserialize(Se,pe,me),{rect:Ee,bitmapUrl:ke,bitmapId:Fe,isSvg:Be,accessibilityData:Ue}=Se;Fe&&me.imageManager.isValidId(Fe)?ut(be,Y,Fe):ut(be,Z,ke),ut(be,ie,Be);const[nt,rt]=be.pageDimensions;return be.width=(Ee[2]-Ee[0])/nt,be.height=(Ee[3]-Ee[1])/rt,Ue&&(be.altTextData=Ue),be}serialize(Se=!1,pe=null){if(this.isEmpty())return null;const me={annotationType:$.AnnotationEditorType.STAMP,bitmapId:ye(this,Y),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:ye(this,ie),structTreeParentId:this._structTreeParentId};if(Se)return me.bitmapUrl=it(this,ze,kn).call(this,!0),me.accessibilityData=this.altTextData,me;const{decorative:be,altText:Ee}=this.altTextData;if(!be&&Ee&&(me.accessibilityData={type:"Figure",alt:Ee}),pe===null)return me;pe.stamps||(pe.stamps=new Map);const ke=ye(this,ie)?(me.rect[2]-me.rect[0])*(me.rect[3]-me.rect[1]):null;if(!pe.stamps.has(ye(this,Y)))pe.stamps.set(ye(this,Y),{area:ke,serialized:me}),me.bitmap=it(this,ze,kn).call(this,!1);else if(ye(this,ie)){const Fe=pe.stamps.get(ye(this,Y));ke>Fe.area&&(Fe.area=ke,Fe.serialized.bitmap.close(),Fe.serialized.bitmap=it(this,ze,kn).call(this,!1))}return me}};X=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,re=new WeakMap,ie=new WeakMap,se=new WeakMap,le=new WeakSet,cn=function(Se,pe=!1){if(!Se){this.remove();return}ut(this,X,Se.bitmap),pe||(ut(this,Y,Se.id),ut(this,ie,Se.isSvg)),it(this,fe,sr).call(this)},ce=new WeakSet,dn=function(){ut(this,Q,null),this._uiManager.enableWaiting(!1),ye(this,te)&&this.div.focus()},de=new WeakSet,En=function(){if(ye(this,Y)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(ye(this,Y)).then(pe=>it(this,le,cn).call(this,pe,!0)).finally(()=>it(this,ce,dn).call(this));return}if(ye(this,Z)){const pe=ye(this,Z);ut(this,Z,null),this._uiManager.enableWaiting(!0),ut(this,Q,this._uiManager.imageManager.getFromUrl(pe).then(me=>it(this,le,cn).call(this,me)).finally(()=>it(this,ce,dn).call(this)));return}if(ye(this,ee)){const pe=ye(this,ee);ut(this,ee,null),this._uiManager.enableWaiting(!0),ut(this,Q,this._uiManager.imageManager.getFromFile(pe).then(me=>it(this,le,cn).call(this,me)).finally(()=>it(this,ce,dn).call(this)));return}const Se=document.createElement("input");Se.type="file",Se.accept=Ye.supportedTypesStr,ut(this,Q,new Promise(pe=>{Se.addEventListener("change",async()=>{if(!Se.files||Se.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const me=await this._uiManager.imageManager.getFromFile(Se.files[0]);it(this,le,cn).call(this,me)}pe()}),Se.addEventListener("cancel",()=>{this.remove(),pe()})}).finally(()=>it(this,ce,dn).call(this))),Se.click()},fe=new WeakSet,sr=function(){const{div:Se}=this;let{width:pe,height:me}=ye(this,X);const[be,Ee]=this.pageDimensions,ke=.75;if(this.width)pe=this.width*be,me=this.height*Ee;else if(pe>ke*be||me>ke*Ee){const nt=Math.min(ke*be/pe,ke*Ee/me);pe*=nt,me*=nt}const[Fe,Be]=this.parentDimensions;this.setDims(pe*Fe/be,me*Be/Ee),this._uiManager.enableWaiting(!1);const Ue=ut(this,te,document.createElement("canvas"));Se.append(Ue),Se.hidden=!1,it(this,ue,ar).call(this,pe,me),it(this,Me,zr).call(this),ye(this,se)||(this.parent.addUndoableEditor(this),ut(this,se,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},we=new WeakSet,Ur=function(Se,pe){var ke;const[me,be]=this.parentDimensions;this.width=Se/me,this.height=pe/be,this.setDims(Se,pe),(ke=this._initialOptions)!=null&&ke.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,ye(this,re)!==null&&clearTimeout(ye(this,re)),ut(this,re,setTimeout(()=>{ut(this,re,null),it(this,ue,ar).call(this,Se,pe)},200))},ve=new WeakSet,jr=function(Se,pe){const{width:me,height:be}=ye(this,X);let Ee=me,ke=be,Fe=ye(this,X);for(;Ee>2*Se||ke>2*pe;){const Be=Ee,Ue=ke;Ee>2*Se&&(Ee=Ee>=16384?Math.floor(Ee/2)-1:Math.ceil(Ee/2)),ke>2*pe&&(ke=ke>=16384?Math.floor(ke/2)-1:Math.ceil(ke/2));const nt=new OffscreenCanvas(Ee,ke);nt.getContext("2d").drawImage(Fe,0,0,Be,Ue,0,0,Ee,ke),Fe=nt.transferToImageBitmap()}return Fe},ue=new WeakSet,ar=function(Se,pe){Se=Math.ceil(Se),pe=Math.ceil(pe);const me=ye(this,te);if(!me||me.width===Se&&me.height===pe)return;me.width=Se,me.height=pe;const be=ye(this,ie)?ye(this,X):it(this,ve,jr).call(this,Se,pe),Ee=me.getContext("2d");Ee.filter=this._uiManager.hcmFilter,Ee.drawImage(be,0,0,be.width,be.height,0,0,Se,pe)},ze=new WeakSet,kn=function(Se){if(Se){if(ye(this,ie)){const be=this._uiManager.imageManager.getSvgUrl(ye(this,Y));if(be)return be}const pe=document.createElement("canvas");return{width:pe.width,height:pe.height}=ye(this,X),pe.getContext("2d").drawImage(ye(this,X),0,0),pe.toDataURL()}if(ye(this,ie)){const[pe,me]=this.pageDimensions,be=Math.round(this.width*pe*z.PixelsPerInch.PDF_TO_CSS_UNITS),Ee=Math.round(this.height*me*z.PixelsPerInch.PDF_TO_CSS_UNITS),ke=new OffscreenCanvas(be,Ee);return ke.getContext("2d").drawImage(ye(this,X),0,0,ye(this,X).width,ye(this,X).height,0,0,be,Ee),ke.transferToImageBitmap()}return structuredClone(ye(this,X))},Me=new WeakSet,zr=function(){ut(this,ne,new ResizeObserver(Se=>{const pe=Se[0].contentRect;pe.width&&pe.height&&it(this,we,Ur).call(this,pe.width,pe.height)})),ye(this,ne).observe(this.div)},Ht(Ye,"_type","stamp");let G=Ye;_.StampEditor=G}],__webpack_module_cache__={};function __w_pdfjs_require__(q){var _=__webpack_module_cache__[q];if(_!==void 0)return _.exports;var M=__webpack_module_cache__[q]={exports:{}};return __webpack_modules__[q](M,M.exports,__w_pdfjs_require__),M.exports}var __webpack_exports__={};return(()=>{var q=__webpack_exports__;Object.defineProperty(q,"__esModule",{value:!0}),Object.defineProperty(q,"AbortException",{enumerable:!0,get:function(){return _.AbortException}}),Object.defineProperty(q,"AnnotationEditorLayer",{enumerable:!0,get:function(){return z.AnnotationEditorLayer}}),Object.defineProperty(q,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return _.AnnotationEditorParamsType}}),Object.defineProperty(q,"AnnotationEditorType",{enumerable:!0,get:function(){return _.AnnotationEditorType}}),Object.defineProperty(q,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return V.AnnotationEditorUIManager}}),Object.defineProperty(q,"AnnotationLayer",{enumerable:!0,get:function(){return G.AnnotationLayer}}),Object.defineProperty(q,"AnnotationMode",{enumerable:!0,get:function(){return _.AnnotationMode}}),Object.defineProperty(q,"CMapCompressionType",{enumerable:!0,get:function(){return _.CMapCompressionType}}),Object.defineProperty(q,"DOMSVGFactory",{enumerable:!0,get:function(){return $.DOMSVGFactory}}),Object.defineProperty(q,"FeatureTest",{enumerable:!0,get:function(){return _.FeatureTest}}),Object.defineProperty(q,"GlobalWorkerOptions",{enumerable:!0,get:function(){return X.GlobalWorkerOptions}}),Object.defineProperty(q,"ImageKind",{enumerable:!0,get:function(){return _.ImageKind}}),Object.defineProperty(q,"InvalidPDFException",{enumerable:!0,get:function(){return _.InvalidPDFException}}),Object.defineProperty(q,"MissingPDFException",{enumerable:!0,get:function(){return _.MissingPDFException}}),Object.defineProperty(q,"OPS",{enumerable:!0,get:function(){return _.OPS}}),Object.defineProperty(q,"PDFDataRangeTransport",{enumerable:!0,get:function(){return M.PDFDataRangeTransport}}),Object.defineProperty(q,"PDFDateString",{enumerable:!0,get:function(){return $.PDFDateString}}),Object.defineProperty(q,"PDFWorker",{enumerable:!0,get:function(){return M.PDFWorker}}),Object.defineProperty(q,"PasswordResponses",{enumerable:!0,get:function(){return _.PasswordResponses}}),Object.defineProperty(q,"PermissionFlag",{enumerable:!0,get:function(){return _.PermissionFlag}}),Object.defineProperty(q,"PixelsPerInch",{enumerable:!0,get:function(){return $.PixelsPerInch}}),Object.defineProperty(q,"PromiseCapability",{enumerable:!0,get:function(){return _.PromiseCapability}}),Object.defineProperty(q,"RenderingCancelledException",{enumerable:!0,get:function(){return $.RenderingCancelledException}}),Object.defineProperty(q,"SVGGraphics",{enumerable:!0,get:function(){return M.SVGGraphics}}),Object.defineProperty(q,"UnexpectedResponseException",{enumerable:!0,get:function(){return _.UnexpectedResponseException}}),Object.defineProperty(q,"Util",{enumerable:!0,get:function(){return _.Util}}),Object.defineProperty(q,"VerbosityLevel",{enumerable:!0,get:function(){return _.VerbosityLevel}}),Object.defineProperty(q,"XfaLayer",{enumerable:!0,get:function(){return Y.XfaLayer}}),Object.defineProperty(q,"build",{enumerable:!0,get:function(){return M.build}}),Object.defineProperty(q,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return _.createValidAbsoluteUrl}}),Object.defineProperty(q,"getDocument",{enumerable:!0,get:function(){return M.getDocument}}),Object.defineProperty(q,"getFilenameFromUrl",{enumerable:!0,get:function(){return $.getFilenameFromUrl}}),Object.defineProperty(q,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return $.getPdfFilenameFromUrl}}),Object.defineProperty(q,"getXfaPageViewport",{enumerable:!0,get:function(){return $.getXfaPageViewport}}),Object.defineProperty(q,"isDataScheme",{enumerable:!0,get:function(){return $.isDataScheme}}),Object.defineProperty(q,"isPdfFile",{enumerable:!0,get:function(){return $.isPdfFile}}),Object.defineProperty(q,"loadScript",{enumerable:!0,get:function(){return $.loadScript}}),Object.defineProperty(q,"noContextMenu",{enumerable:!0,get:function(){return $.noContextMenu}}),Object.defineProperty(q,"normalizeUnicode",{enumerable:!0,get:function(){return _.normalizeUnicode}}),Object.defineProperty(q,"renderTextLayer",{enumerable:!0,get:function(){return j.renderTextLayer}}),Object.defineProperty(q,"setLayerDimensions",{enumerable:!0,get:function(){return $.setLayerDimensions}}),Object.defineProperty(q,"shadow",{enumerable:!0,get:function(){return _.shadow}}),Object.defineProperty(q,"updateTextLayer",{enumerable:!0,get:function(){return j.updateTextLayer}}),Object.defineProperty(q,"version",{enumerable:!0,get:function(){return M.version}});var _=__w_pdfjs_require__(1),M=__w_pdfjs_require__(2),$=__w_pdfjs_require__(6),j=__w_pdfjs_require__(26),z=__w_pdfjs_require__(27),V=__w_pdfjs_require__(5),G=__w_pdfjs_require__(29),X=__w_pdfjs_require__(14),Y=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;const onPrint=q=>{let _;_||(_=document.createElement("iframe"),document.body.appendChild(_),_.style.display="none",_.onload=function(){setTimeout(function(){_.focus(),_.contentWindow.print()},1)}),_.src=q},calcRT=q=>{let M=q.split(" ").length;if(M>0)return Math.ceil(M/200)},getPageText=(q,_)=>new Promise(function(M,$){_.getPage(q).then(function(j){j.getTextContent().then(function(z){for(var V=z.items,G="",X=0;X<V.length;X++){var Y=V[X];G+=Y.str+" "}M(G)})})}),savePDF=async({fileUrl:q,data:_,name:M="download.pdf"})=>{const $=document.createElement("a");$.download=M,$.rel="noopener",q||(q=`data:application/pdf;base64,${btoa(_)}`);let j=await fetch(q).then(V=>V.blob());(!j||!(j instanceof Blob))&&console.log("Invalid blob object passed to URL.createObjectURL()"),typeof URL.createObjectURL>"u"&&console.log("Your browser does not support URL.createObjectURL()");const z=URL.createObjectURL(j);$.href=z,$.click(),URL.revokeObjectURL($.href)};class ClassBuilder{constructor(_,M){this.defaults=typeof _=="function"?_(M):_,this.classes=this.defaults}flush(){return this.classes=this.defaults,this}extend(..._){return this}get(){return this.classes}replace(_,M=!0){return M&&_&&(this.classes=Object.keys(_).reduce(($,j)=>$.replace(new RegExp(j,"g"),_[j]),this.classes)),this}remove(_,M=!0){return M&&_&&(this.classes=_.split(" ").reduce(($,j)=>$.replace(new RegExp(j,"g"),""),this.classes)),this}add(_,M=!0,$){if(!M||!_)return this;switch(typeof _){case"string":default:return this.classes+=` ${_} `,this;case"function":return this.classes+=` ${_($||this.classes)} `,this}}}const Tooltip_svelte_svelte_type_style_lang$1="",get_activator_slot_changes=q=>({}),get_activator_slot_context=q=>({});function create_if_block$v(q){let _,M,$,j,z;const V=q[8].default,G=create_slot(V,q,q[7],null);return{c(){_=element("div"),G&&G.c(),attr(_,"class",M=null_to_empty(q[1])+" svelte-10lk5cm")},m(X,Y){insert(X,_,Y),G&&G.m(_,null),z=!0},p(X,Y){G&&G.p&&(!z||Y&128)&&update_slot_base(G,V,X,X[7],z?get_slot_changes(V,X[7],Y,null):get_all_dirty_from_scope(X[7]),null),(!z||Y&2&&M!==(M=null_to_empty(X[1])+" svelte-10lk5cm"))&&attr(_,"class",M)},i(X){z||(transition_in(G,X),add_render_callback(()=>{z&&(j&&j.end(1),$=create_in_transition(_,scale,{duration:150}),$.start())}),z=!0)},o(X){transition_out(G,X),$&&$.invalidate(),j=create_out_transition(_,scale,{duration:150,delay:100}),z=!1},d(X){X&&detach(_),G&&G.d(X),X&&j&&j.end()}}}function create_fragment$C(q){let _,M,$,j,z,V;const G=q[8].activator,X=create_slot(G,q,q[7],get_activator_slot_context);let Y=q[0]&&create_if_block$v(q);return{c(){_=element("div"),M=element("div"),X&&X.c(),$=space(),Y&&Y.c(),attr(_,"class","activator svelte-10lk5cm")},m(Q,Z){insert(Q,_,Z),append(_,M),X&&X.m(M,null),append(_,$),Y&&Y.m(_,null),j=!0,z||(V=[listen(M,"mouseenter",debounce(q[2],100)),listen(M,"mouseleave",debounce(q[3],500)),listen(M,"mouseenter",q[9]),listen(M,"mouseleave",q[10]),listen(M,"focus",q[11]),listen(M,"blur",q[12])],z=!0)},p(Q,[Z]){X&&X.p&&(!j||Z&128)&&update_slot_base(X,G,Q,Q[7],j?get_slot_changes(G,Q[7],Z,get_activator_slot_changes):get_all_dirty_from_scope(Q[7]),get_activator_slot_context),Q[0]?Y?(Y.p(Q,Z),Z&1&&transition_in(Y,1)):(Y=create_if_block$v(Q),Y.c(),transition_in(Y,1),Y.m(_,null)):Y&&(group_outros(),transition_out(Y,1,1,()=>{Y=null}),check_outros())},i(Q){j||(transition_in(X,Q),transition_in(Y),j=!0)},o(Q){transition_out(X,Q),transition_out(Y),j=!1},d(Q){Q&&detach(_),X&&X.d(Q),Y&&Y.d(),z=!1,run_all(V)}}}const classesDefault="tooltip";function debounce(q,_,M){let $;return function(){let j=this,z=arguments,V=function(){$=null,M||q.apply(j,z)},G=M&&!$;clearTimeout($),$=setTimeout(V,_),G&&q.apply(j,z)}}function instance$B(q,_,M){let $,{$$slots:j={},$$scope:z}=_,{class:V=""}=_,{classes:G=classesDefault}=_,{show:X=!1}=_,{timeout:Y=null}=_;const Q=new ClassBuilder(G,classesDefault);function Z(){X||(M(0,X=!0),Y&&M(4,Y=setTimeout(()=>{M(0,X=!1)},Y)))}function ee(){X&&(M(0,X=!1),clearTimeout(Y))}function te(se){bubble.call(this,q,se)}function ne(se){bubble.call(this,q,se)}function re(se){bubble.call(this,q,se)}function ie(se){bubble.call(this,q,se)}return q.$$set=se=>{"class"in se&&M(5,V=se.class),"classes"in se&&M(6,G=se.classes),"show"in se&&M(0,X=se.show),"timeout"in se&&M(4,Y=se.timeout),"$$scope"in se&&M(7,z=se.$$scope)},q.$$.update=()=>{q.$$.dirty&96&&M(1,$=Q.flush().add(G,!0,classesDefault).add(V).get())},[X,$,Z,ee,Y,V,G,z,j,te,ne,re,ie]}let Tooltip$1=class extends SvelteComponent{constructor(_){super(),init(this,_,instance$B,create_fragment$C,safe_not_equal,{class:5,classes:6,show:0,timeout:4})}};const PdfViewer_svelte_svelte_type_style_lang="",{window:window_1}=globals;function create_else_block_1$3(q){let _,M,$;return{c(){_=element("div"),M=element("canvas"),attr(M,"class","svelte-19h83wp"),attr(_,"class",$=null_to_empty(q[6]===!0?"viewer":"null")+" svelte-19h83wp")},m(j,z){insert(j,_,z),append(_,M),q[54](M)},p(j,z){z[0]&64&&$!==($=null_to_empty(j[6]===!0?"viewer":"null")+" svelte-19h83wp")&&attr(_,"class",$)},i:noop,o:noop,d(j){j&&detach(_),q[54](null)}}}function create_if_block_1$p(q){let _,M,$=q[5].includes("navigation"),j,z=q[5].includes("zoom"),V,G=q[5].includes("print"),X,Y=q[5].includes("rotate"),Q,Z=q[5].includes("download"),ee,te=q[5].includes("autoflip"),ne,re,ie,se,le,he,ce,ae,de,ge,fe,oe,we,De,ve,Ce,ue,Pe,ze,Le,Me,Ne,Ye,Ie,Oe,Se=$&&create_if_block_8$2(q),pe=z&&create_if_block_7$3(q),me=G&&create_if_block_6$4(q),be=Y&&create_if_block_5$5(q),Ee=Z&&create_if_block_4$8(q),ke=te&&create_if_block_2$k(q);return{c(){_=element("div"),M=element("div"),Se&&Se.c(),j=space(),pe&&pe.c(),V=space(),me&&me.c(),X=space(),be&&be.c(),Q=space(),Ee&&Ee.c(),ee=space(),ke&&ke.c(),ne=space(),re=element("span"),ie=svg_element("svg"),se=svg_element("path"),le=space(),he=element("span"),ce=text(q[10]),ae=text(" min read"),ge=space(),fe=element("span"),oe=svg_element("svg"),we=svg_element("path"),De=space(),ve=element("div"),Ce=text(`Page :
              `),ue=element("span"),Pe=text(`
              /
              `),ze=element("span"),Me=space(),Ne=element("div"),Ye=element("canvas"),attr(se,"d",`M16.32 7.1A8 8 0 1 1 9 4.06V2h2v2.06c1.46.18 2.8.76 3.9
                1.62l1.46-1.46 1.42 1.42-1.46 1.45zM10 18a6 6 0 1 0 0-12 6 6 0 0
                0 0 12zM7 0h6v2H7V0zm5.12 8.46l1.42 1.42L10 13.4 8.59
                12l3.53-3.54z`),attr(ie,"class","icon svelte-19h83wp"),attr(ie,"xmlns","http://www.w3.org/2000/svg"),attr(ie,"viewBox","0 0 20 20"),attr(he,"class","text svelte-19h83wp"),attr(re,"class","page-info svelte-19h83wp"),attr(re,"style",de=q[5].includes("timeInfo")?"":"display: none;"),attr(we,"d",`M16 2h4v15a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V0h16v2zm0 2v13a1 1 0
                0 0 1 1 1 1 0 0 0 1-1V4h-2zM2 2v15a1 1 0 0 0 1 1h11.17a2.98 2.98
                0 0 1-.17-1V2H2zm2 8h8v2H4v-2zm0 4h8v2H4v-2zM4 4h8v4H4V4z`),attr(oe,"class","icon svelte-19h83wp"),attr(oe,"xmlns","http://www.w3.org/2000/svg"),attr(oe,"viewBox","0 0 20 20"),attr(ve,"class","text svelte-19h83wp"),attr(fe,"class","page-info svelte-19h83wp"),attr(fe,"style",Le=q[5].includes("pageInfo")?"":"display: none;"),attr(M,"class","line svelte-19h83wp"),attr(Ye,"width",q[16]),attr(Ye,"height",q[17]),attr(Ye,"class","svelte-19h83wp"),attr(Ne,"class",Ie=null_to_empty(q[6]===!0?"viewer":"null")+" svelte-19h83wp"),attr(_,"class","control-start svelte-19h83wp")},m(Fe,Be){insert(Fe,_,Be),append(_,M),Se&&Se.m(M,null),append(M,j),pe&&pe.m(M,null),append(M,V),me&&me.m(M,null),append(M,X),be&&be.m(M,null),append(M,Q),Ee&&Ee.m(M,null),append(M,ee),ke&&ke.m(M,null),append(M,ne),append(M,re),append(re,ie),append(ie,se),append(re,le),append(re,he),append(he,ce),append(he,ae),append(M,ge),append(M,fe),append(fe,oe),append(oe,we),append(fe,De),append(fe,ve),append(ve,Ce),append(ve,ue),q[51](ue),append(ve,Pe),append(ve,ze),q[52](ze),append(_,Me),append(_,Ne),append(Ne,Ye),q[53](Ye),Oe=!0},p(Fe,Be){Be[0]&32&&($=Fe[5].includes("navigation")),$?Se?(Se.p(Fe,Be),Be[0]&32&&transition_in(Se,1)):(Se=create_if_block_8$2(Fe),Se.c(),transition_in(Se,1),Se.m(M,j)):Se&&(group_outros(),transition_out(Se,1,1,()=>{Se=null}),check_outros()),Be[0]&32&&(z=Fe[5].includes("zoom")),z?pe?(pe.p(Fe,Be),Be[0]&32&&transition_in(pe,1)):(pe=create_if_block_7$3(Fe),pe.c(),transition_in(pe,1),pe.m(M,V)):pe&&(group_outros(),transition_out(pe,1,1,()=>{pe=null}),check_outros()),Be[0]&32&&(G=Fe[5].includes("print")),G?me?(me.p(Fe,Be),Be[0]&32&&transition_in(me,1)):(me=create_if_block_6$4(Fe),me.c(),transition_in(me,1),me.m(M,X)):me&&(group_outros(),transition_out(me,1,1,()=>{me=null}),check_outros()),Be[0]&32&&(Y=Fe[5].includes("rotate")),Y?be?(be.p(Fe,Be),Be[0]&32&&transition_in(be,1)):(be=create_if_block_5$5(Fe),be.c(),transition_in(be,1),be.m(M,Q)):be&&(group_outros(),transition_out(be,1,1,()=>{be=null}),check_outros()),Be[0]&32&&(Z=Fe[5].includes("download")),Z?Ee?(Ee.p(Fe,Be),Be[0]&32&&transition_in(Ee,1)):(Ee=create_if_block_4$8(Fe),Ee.c(),transition_in(Ee,1),Ee.m(M,ee)):Ee&&(group_outros(),transition_out(Ee,1,1,()=>{Ee=null}),check_outros()),Be[0]&32&&(te=Fe[5].includes("autoflip")),te?ke?(ke.p(Fe,Be),Be[0]&32&&transition_in(ke,1)):(ke=create_if_block_2$k(Fe),ke.c(),transition_in(ke,1),ke.m(M,ne)):ke&&(group_outros(),transition_out(ke,1,1,()=>{ke=null}),check_outros()),(!Oe||Be[0]&1024)&&set_data(ce,Fe[10]),(!Oe||Be[0]&32&&de!==(de=Fe[5].includes("timeInfo")?"":"display: none;"))&&attr(re,"style",de),(!Oe||Be[0]&32&&Le!==(Le=Fe[5].includes("pageInfo")?"":"display: none;"))&&attr(fe,"style",Le),(!Oe||Be[0]&65536)&&attr(Ye,"width",Fe[16]),(!Oe||Be[0]&131072)&&attr(Ye,"height",Fe[17]),(!Oe||Be[0]&64&&Ie!==(Ie=null_to_empty(Fe[6]===!0?"viewer":"null")+" svelte-19h83wp"))&&attr(Ne,"class",Ie)},i(Fe){Oe||(transition_in(Se),transition_in(pe),transition_in(me),transition_in(be),transition_in(Ee),transition_in(ke),Oe=!0)},o(Fe){transition_out(Se),transition_out(pe),transition_out(me),transition_out(be),transition_out(Ee),transition_out(ke),Oe=!1},d(Fe){Fe&&detach(_),Se&&Se.d(),pe&&pe.d(),me&&me.d(),be&&be.d(),Ee&&Ee.d(),ke&&ke.d(),q[51](null),q[52](null),q[53](null)}}}function create_if_block$u(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee;return{c(){_=element("div"),M=element("p"),M.textContent="This document requires a password to open:",$=space(),j=element("p"),z=text(q[15]),V=space(),G=element("div"),X=element("input"),Y=space(),Q=element("button"),Q.textContent="Submit",attr(j,"class","password-message svelte-19h83wp"),attr(X,"type","password"),attr(X,"class","password-input svelte-19h83wp"),attr(Q,"class","password-button svelte-19h83wp"),attr(G,"class","password-container svelte-19h83wp"),attr(_,"class","password-viewer svelte-19h83wp")},m(te,ne){insert(te,_,ne),append(_,M),append(_,$),append(_,j),append(j,z),append(_,V),append(_,G),append(G,X),set_input_value(X,q[13]),append(G,Y),append(G,Q),Z||(ee=[listen(X,"input",q[41]),listen(Q,"click",q[25])],Z=!0)},p(te,ne){ne[0]&32768&&set_data(z,te[15]),ne[0]&8192&&X.value!==te[13]&&set_input_value(X,te[13])},i:noop,o:noop,d(te){te&&detach(_),Z=!1,run_all(ee)}}}function create_if_block_8$2(q){let _,M,$,j;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_8],default:[create_default_slot_8]},$$scope:{ctx:q}}}),$=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_7],default:[create_default_slot_7]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment),M=space(),create_component($.$$.fragment)},m(z,V){mount_component(_,z,V),insert(z,M,V),mount_component($,z,V),j=!0},p(z,V){const G={};V[0]&1|V[2]&64&&(G.$$scope={dirty:V,ctx:z}),_.$set(G);const X={};V[0]&5|V[2]&64&&(X.$$scope={dirty:V,ctx:z}),$.$set(X)},i(z){j||(transition_in(_.$$.fragment,z),transition_in($.$$.fragment,z),j=!0)},o(z){transition_out(_.$$.fragment,z),transition_out($.$$.fragment,z),j=!1},d(z){destroy_component(_,z),z&&detach(M),destroy_component($,z)}}}function create_default_slot_8(q){let _;return{c(){_=text("Previous")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_8(q){let _,M,$,j,z,V;return{c(){_=element("span"),M=svg_element("svg"),$=svg_element("polygon"),attr($,"points",`3.828 9 9.899 2.929 8.485 1.515 0 10 .707 10.707 8.485
                  18.485 9.899 17.071 3.828 11 20 11 20 9 3.828 9`),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class",j="button-control "+(q[0]<=1?"disabled":null)+" svelte-19h83wp")},m(G,X){insert(G,_,X),append(_,M),append(M,$),z||(V=[listen(_,"click",q[42]),listen(_,"keydown",q[39])],z=!0)},p(G,X){X[0]&1&&j!==(j="button-control "+(G[0]<=1?"disabled":null)+" svelte-19h83wp")&&attr(_,"class",j)},d(G){G&&detach(_),z=!1,run_all(V)}}}function create_default_slot_7(q){let _;return{c(){_=text("Next")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_7(q){let _,M,$,j,z,V;return{c(){_=element("span"),M=svg_element("svg"),$=svg_element("polygon"),attr($,"points",`16.172 9 10.101 2.929 11.515 1.515 20 10 19.293 10.707
                  11.515 18.485 10.101 17.071 16.172 11 0 11 0 9`),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class",j="button-control "+(q[0]>=q[2]?"disabled":null)+" svelte-19h83wp")},m(G,X){insert(G,_,X),append(_,M),append(M,$),z||(V=[listen(_,"click",q[43]),listen(_,"keydown",q[38])],z=!0)},p(G,X){X[0]&5&&j!==(j="button-control "+(G[0]>=G[2]?"disabled":null)+" svelte-19h83wp")&&attr(_,"class",j)},d(G){G&&detach(_),z=!1,run_all(V)}}}function create_if_block_7$3(q){let _,M,$,j;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_6],default:[create_default_slot_6]},$$scope:{ctx:q}}}),$=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_5],default:[create_default_slot_5]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment),M=space(),create_component($.$$.fragment)},m(z,V){mount_component(_,z,V),insert(z,M,V),mount_component($,z,V),j=!0},p(z,V){const G={};V[0]&2|V[2]&64&&(G.$$scope={dirty:V,ctx:z}),_.$set(G);const X={};V[0]&2|V[2]&64&&(X.$$scope={dirty:V,ctx:z}),$.$set(X)},i(z){j||(transition_in(_.$$.fragment,z),transition_in($.$$.fragment,z),j=!0)},o(z){transition_out(_.$$.fragment,z),transition_out($.$$.fragment,z),j=!1},d(z){destroy_component(_,z),z&&detach(M),destroy_component($,z)}}}function create_default_slot_6(q){let _;return{c(){_=text("Zoom In")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_6(q){let _,M,$,j,z,V;return{c(){_=element("span"),M=svg_element("svg"),$=svg_element("path"),attr($,"fill-rule","evenodd"),attr($,"d",`M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42
                  1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12zM7
                  7V5h2v2h2v2H9v2H7V9H5V7h2z`),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class",j="button-control "+(q[1]>=maxScale?"disabled":null)+" svelte-19h83wp")},m(G,X){insert(G,_,X),append(_,M),append(M,$),z||(V=[listen(_,"click",q[44]),listen(_,"keydown",q[37])],z=!0)},p(G,X){X[0]&2&&j!==(j="button-control "+(G[1]>=maxScale?"disabled":null)+" svelte-19h83wp")&&attr(_,"class",j)},d(G){G&&detach(_),z=!1,run_all(V)}}}function create_default_slot_5(q){let _;return{c(){_=text("Zoom Out")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_5(q){let _,M,$,j,z,V;return{c(){_=element("span"),M=svg_element("svg"),$=svg_element("path"),attr($,"fill-rule","evenodd"),attr($,"d",`M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42
                  1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12zM5
                  7h6v2H5V7z`),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class",j="button-control "+(q[1]<=minScale?"disabled":null)+" svelte-19h83wp")},m(G,X){insert(G,_,X),append(_,M),append(M,$),z||(V=[listen(_,"click",q[45]),listen(_,"keydown",q[36])],z=!0)},p(G,X){X[0]&2&&j!==(j="button-control "+(G[1]<=minScale?"disabled":null)+" svelte-19h83wp")&&attr(_,"class",j)},d(G){G&&detach(_),z=!1,run_all(V)}}}function create_if_block_6$4(q){let _,M;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_4],default:[create_default_slot_4]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j[0]&8|j[2]&64&&(z.$$scope={dirty:j,ctx:$}),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot_4(q){let _;return{c(){_=text("Print")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_4(q){let _,M,$;return{c(){_=element("span"),_.innerHTML=`<svg class="icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M4 16H0V6h20v10h-4v4H4v-4zm2-4v6h8v-6H6zM4 0h12v5H4V0zM2
                  8v2h2V8H2zm4 0v2h2V8H6z"></path></svg>`,attr(_,"slot","activator"),attr(_,"class","button-control svelte-19h83wp")},m(j,z){insert(j,_,z),M||($=[listen(_,"click",q[46]),listen(_,"keydown",q[35])],M=!0)},p:noop,d(j){j&&detach(_),M=!1,run_all($)}}}function create_if_block_5$5(q){let _,M,$,j;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_3],default:[create_default_slot_3]},$$scope:{ctx:q}}}),$=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_2],default:[create_default_slot_2]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment),M=space(),create_component($.$$.fragment)},m(z,V){mount_component(_,z,V),insert(z,M,V),mount_component($,z,V),j=!0},p(z,V){const G={};V[2]&64&&(G.$$scope={dirty:V,ctx:z}),_.$set(G);const X={};V[2]&64&&(X.$$scope={dirty:V,ctx:z}),$.$set(X)},i(z){j||(transition_in(_.$$.fragment,z),transition_in($.$$.fragment,z),j=!0)},o(z){transition_out(_.$$.fragment,z),transition_out($.$$.fragment,z),j=!1},d(z){destroy_component(_,z),z&&detach(M),destroy_component($,z)}}}function create_default_slot_3(q){let _;return{c(){_=text("Anti-Clockwise")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_3(q){let _,M,$;return{c(){_=element("span"),_.innerHTML=`<svg class="icon rot-icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M14.66 15.66A8 8 0 1 1 17 10h-2a6 6 0 1 0-1.76 4.24l1.42
                  1.42zM12 10h8l-4 4-4-4z"></path></svg>`,attr(_,"slot","activator"),attr(_,"class","button-control svelte-19h83wp")},m(j,z){insert(j,_,z),M||($=[listen(_,"click",q[47]),listen(_,"keydown",q[34])],M=!0)},p:noop,d(j){j&&detach(_),M=!1,run_all($)}}}function create_default_slot_2(q){let _;return{c(){_=text("Clockwise")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_2(q){let _,M,$;return{c(){_=element("span"),_.innerHTML=`<svg class="icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M14.66 15.66A8 8 0 1 1 17 10h-2a6 6 0 1 0-1.76 4.24l1.42
                  1.42zM12 10h8l-4 4-4-4z"></path></svg>`,attr(_,"slot","activator"),attr(_,"class","button-control svelte-19h83wp")},m(j,z){insert(j,_,z),M||($=[listen(_,"click",q[48]),listen(_,"keydown",q[33])],M=!0)},p:noop,d(j){j&&detach(_),M=!1,run_all($)}}}function create_if_block_4$8(q){let _,M;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot_1],default:[create_default_slot_1]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j[0]&24|j[2]&64&&(z.$$scope={dirty:j,ctx:$}),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot_1(q){let _;return{c(){_=text("Download")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot_1(q){let _,M,$;return{c(){_=element("span"),_.innerHTML='<svg class="icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"></path></svg>',attr(_,"slot","activator"),attr(_,"class","button-control svelte-19h83wp")},m(j,z){insert(j,_,z),M||($=[listen(_,"click",q[49]),listen(_,"keydown",q[32])],M=!0)},p:noop,d(j){j&&detach(_),M=!1,run_all($)}}}function create_if_block_2$k(q){let _,M;return _=new Tooltip$1({props:{$$slots:{activator:[create_activator_slot],default:[create_default_slot$5]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j[0]&6144|j[2]&64&&(z.$$scope={dirty:j,ctx:$}),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot$5(q){let _=(q[11]===!0?q[12]:"Auto Turn Page")+"",M;return{c(){M=text(_)},m($,j){insert($,M,j)},p($,j){j[0]&6144&&_!==(_=($[11]===!0?$[12]:"Auto Turn Page")+"")&&set_data(M,_)},d($){$&&detach(M)}}}function create_else_block$c(q){let _;return{c(){_=svg_element("path"),attr(_,"d",`M9.896,3.838L0.792,1.562v14.794l9.104,2.276L19,16.356V1.562L9.896,3.838z
                    M9.327,17.332L1.93,15.219V3.27 l7.397,1.585V17.332z
                    M17.862,15.219l-7.397,2.113V4.855l7.397-1.585V15.219z`)},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_3$a(q){let _;return{c(){_=svg_element("path"),attr(_,"d","M4 18h12V6h-4V2H4v16zm-2 1V0h12l4 4v16H2v-1z")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_activator_slot(q){let _,M,$,j;function z(X,Y){return X[11]===!0?create_if_block_3$a:create_else_block$c}let V=z(q),G=V(q);return{c(){_=element("span"),M=svg_element("svg"),G.c(),attr(M,"class","icon svelte-19h83wp"),attr(M,"xmlns","http://www.w3.org/2000/svg"),attr(M,"viewBox","0 0 20 20"),attr(_,"slot","activator"),attr(_,"class","page-info button-control svelte-19h83wp")},m(X,Y){insert(X,_,Y),append(_,M),G.m(M,null),$||(j=[listen(_,"click",q[50]),listen(_,"keydown",q[31])],$=!0)},p(X,Y){V!==(V=z(X))&&(G.d(1),G=V(X),G&&(G.c(),G.m(M,null)))},d(X){X&&detach(_),G.d(),$=!1,run_all(j)}}}function create_fragment$B(q){let _,M,$,j,z,V,G,X,Y,Q;add_render_callback(q[40]);const Z=[create_if_block$u,create_if_block_1$p,create_else_block_1$3],ee=[];function te(ne,re){return ne[14]===!0?0:ne[5].length?1:2}return $=te(q),j=ee[$]=Z[$](q),{c(){_=element("div"),M=element("div"),j.c(),V=space(),G=element("button"),G.innerHTML='<svg class="icon svelte-19h83wp" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M7 10v8h6v-8h5l-8-8-8 8h5z"></path></svg>',attr(M,"class",z=null_to_empty(q[6]===!0?"control":"null")+" svelte-19h83wp"),attr(G,"id","topBtn"),attr(G,"class","svelte-19h83wp"),attr(_,"class","parent svelte-19h83wp")},m(ne,re){insert(ne,_,re),append(_,M),ee[$].m(M,null),append(_,V),append(_,G),X=!0,Y||(Q=[listen(window_1,"resize",q[40]),listen(G,"click",q[55])],Y=!0)},p(ne,re){let ie=$;$=te(ne),$===ie?ee[$].p(ne,re):(group_outros(),transition_out(ee[ie],1,1,()=>{ee[ie]=null}),check_outros(),j=ee[$],j?j.p(ne,re):(j=ee[$]=Z[$](ne),j.c()),transition_in(j,1),j.m(M,null)),(!X||re[0]&64&&z!==(z=null_to_empty(ne[6]===!0?"control":"null")+" svelte-19h83wp"))&&attr(M,"class",z)},i(ne){X||(transition_in(j),X=!0)},o(ne){transition_out(j),X=!1},d(ne){ne&&detach(_),ee[$].d(),Y=!1,run_all(Q)}}}const minScale=1,maxScale=2.3;function instance$A(q,_,M){let{url:$}=_,{data:j}=_,{scale:z=1.8}=_,{pageNum:V=1}=_,{flipTime:G=120}=_,{showButtons:X=["navigation","zoom","print","rotate","download","autoflip","timeInfo","pageInfo"]}=_,{showBorder:Y=!0}=_,{totalPage:Q=0}=_,{downloadFileName:Z=""}=_;pdfExports.GlobalWorkerOptions.workerSrc=new URL("/restructuring-futures-f1/assets/pdf.worker-e3f005b2.js",self.location);let ee,te=0,ne=0,re=null,ie=!1,se=null,le=0,he="",ce=0,ae=!1,de,ge,fe=G,oe=[],we="",De=!1,ve="",Ce=!1;const ue=ft=>{ie=!0,re.getPage(ft).then(function(lt){let et=lt.getViewport({scale:z,rotation:le});const tt=ee.getContext("2d");M(7,ee.height=et.height,ee),M(7,ee.width=et.width,ee);let mt={canvasContext:tt,viewport:et};lt.render(mt).promise.then(function(){if(ie=!1,se!==null){if(V<re.totalPage)oe[V]=ee,M(0,V++,V),re.getPage(V).then(ue);else for(let Ut=1;Ut<oe.length;Ut++)ee.appendChild(oe[Ut]);se=null}})}),X.length&&M(8,te.textContent=ft,te)},Pe=ft=>{ie?se=ft:ue(ft)},ze=()=>{V<=1||(M(0,V--,V),Pe(V))},Le=()=>{V>=re.numPages||(M(0,V++,V),Pe(V))},Me=()=>{z<=maxScale&&(M(1,z=z+.1),Pe(V))},Ne=()=>{z>=minScale&&(M(1,z=z-.1),Pe(V))},Ye=ft=>{onPrint(ft)},Ie=()=>{le=le+90,Pe(V)},Oe=()=>{le=le-90,Pe(V)},Se=()=>{pe()},pe=async()=>{pdfExports.getDocument({...$&&{url:$},...j&&{data:j},...we&&{password:we}}).promise.then(async function(lt){if(re=lt,M(14,De=!1),await tick(),X.length&&M(9,ne.textContent=re.numPages,ne),M(2,Q=re.numPages),X.length)for(let et=1;et<=Q;et++)getPageText(et,re).then(function(tt){he=he.concat(tt),M(10,ce=calcRT(he))});M(30,Ce=!0)}).catch(function(lt){M(14,De=!0),M(15,ve=lt.message)})};pe();const me=()=>{M(11,ae=!ae),ae===!1&&(clearInterval(de),clearInterval(ge)),ae===!0&&V<=Q&&(ge=setInterval(()=>{M(12,fe=fe-1)},1e3),de=setInterval(()=>{M(12,fe=G),Le()},G*1e3))},be=({url:ft,data:lt})=>{let et=Z||ft&&ft.substring(ft.lastIndexOf("/")+1);savePDF({fileURL:ft,data:lt,name:et})};onDestroy(()=>{clearInterval(de),clearInterval(ge)});let Ee,ke;function Fe(ft){bubble.call(this,q,ft)}function Be(ft){bubble.call(this,q,ft)}function Ue(ft){bubble.call(this,q,ft)}function nt(ft){bubble.call(this,q,ft)}function rt(ft){bubble.call(this,q,ft)}function _e(ft){bubble.call(this,q,ft)}function We(ft){bubble.call(this,q,ft)}function Xe(ft){bubble.call(this,q,ft)}function Te(ft){bubble.call(this,q,ft)}function Re(){M(16,Ee=window_1.innerWidth),M(17,ke=window_1.innerHeight)}function He(){we=this.value,M(13,we)}const Ze=()=>ze(),ot=()=>Le(),$e=()=>Me(),je=()=>Ne(),Ke=()=>Ye($),Qe=()=>Oe(),dt=()=>Ie(),pt=()=>be({url:$,data:j}),wt=()=>me();function St(ft){binding_callbacks[ft?"unshift":"push"](()=>{te=ft,M(8,te)})}function Rt(ft){binding_callbacks[ft?"unshift":"push"](()=>{ne=ft,M(9,ne)})}function xt(ft){binding_callbacks[ft?"unshift":"push"](()=>{ee=ft,M(7,ee)})}function It(ft){binding_callbacks[ft?"unshift":"push"](()=>{ee=ft,M(7,ee)})}const ht=()=>window.scrollTo(0,0);return q.$$set=ft=>{"url"in ft&&M(3,$=ft.url),"data"in ft&&M(4,j=ft.data),"scale"in ft&&M(1,z=ft.scale),"pageNum"in ft&&M(0,V=ft.pageNum),"flipTime"in ft&&M(28,G=ft.flipTime),"showButtons"in ft&&M(5,X=ft.showButtons),"showBorder"in ft&&M(6,Y=ft.showBorder),"totalPage"in ft&&M(2,Q=ft.totalPage),"downloadFileName"in ft&&M(29,Z=ft.downloadFileName)},q.$$.update=()=>{q.$$.dirty[0]&1073741825&&Ce&&Pe(V)},[V,z,Q,$,j,X,Y,ee,te,ne,ce,ae,fe,we,De,ve,Ee,ke,ze,Le,Me,Ne,Ye,Ie,Oe,Se,me,be,G,Z,Ce,Fe,Be,Ue,nt,rt,_e,We,Xe,Te,Re,He,Ze,ot,$e,je,Ke,Qe,dt,pt,wt,St,Rt,xt,It,ht]}class PdfViewer extends SvelteComponent{constructor(_){super(),init(this,_,instance$A,create_fragment$B,safe_not_equal,{url:3,data:4,scale:1,pageNum:0,flipTime:28,showButtons:5,showBorder:6,totalPage:2,downloadFileName:29},null,[-1,-1,-1])}}const GetAttachment_svelte_svelte_type_style_lang="";function create_if_block$t(q){let _,M,$,j={ctx:q,current:null,token:null,hasCatch:!1,pending:create_pending_block$1,then:create_then_block$1,catch:create_catch_block$1,value:13,blocks:[,,,]};return handle_promise(M=q[4],j),{c(){_=empty(),j.block.c()},m(z,V){insert(z,_,V),j.block.m(z,j.anchor=V),j.mount=()=>_.parentNode,j.anchor=_,$=!0},p(z,V){q=z,j.ctx=q,V&16&&M!==(M=q[4])&&handle_promise(M,j)||update_await_block_branch(j,q,V)},i(z){$||(transition_in(j.block),$=!0)},o(z){for(let V=0;V<3;V+=1){const G=j.blocks[V];transition_out(G)}$=!1},d(z){z&&detach(_),j.block.d(z),j.token=null,j=null}}}function create_catch_block$1(q){return{c:noop,m:noop,p:noop,i:noop,o:noop,d:noop}}function create_then_block$1(q){let _,M,$,j,z=!q[2]&&create_if_block_3$9(q),V=!q[5]&&create_if_block_1$o(q);return{c(){_=element("div"),z&&z.c(),M=space(),V&&V.c(),attr(_,"class",$="flex flex-row "+(q[1]?"mr-4 pr-4 w-full":"mb-16 w-auto")+" flex-wrap")},m(G,X){insert(G,_,X),z&&z.m(_,null),append(_,M),V&&V.m(_,null),j=!0},p(G,X){G[2]?z&&(group_outros(),transition_out(z,1,1,()=>{z=null}),check_outros()):z?(z.p(G,X),X&4&&transition_in(z,1)):(z=create_if_block_3$9(G),z.c(),transition_in(z,1),z.m(_,M)),G[5]?V&&(V.d(1),V=null):V?V.p(G,X):(V=create_if_block_1$o(G),V.c(),V.m(_,null)),(!j||X&2&&$!==($="flex flex-row "+(G[1]?"mr-4 pr-4 w-full":"mb-16 w-auto")+" flex-wrap"))&&attr(_,"class",$)},i(G){j||(transition_in(z),j=!0)},o(G){transition_out(z),j=!1},d(G){G&&detach(_),z&&z.d(),V&&V.d()}}}function create_if_block_3$9(q){let _,M,$,j,z,V;const G=[create_if_block_4$7,create_if_block_5$4,create_if_block_6$3,create_if_block_7$2,create_if_block_8$1,create_else_block$b],X=[];function Y(Q,Z){return Q[6]=="image"?0:Q[6]=="text"?1:Q[6]=="audio"?2:Q[6]=="markdown"?3:Q[6]=="pdf"?4:5}return $=Y(q),j=X[$]=G[$](q),{c(){_=element("div"),M=element("div"),j.c(),attr(M,"class",z=q[1]===!0?"":"mt-4"),attr(_,"class","flex flex-col justify-between w-4/5 h-auto")},m(Q,Z){insert(Q,_,Z),append(_,M),X[$].m(M,null),V=!0},p(Q,Z){let ee=$;$=Y(Q),$===ee?X[$].p(Q,Z):(group_outros(),transition_out(X[ee],1,1,()=>{X[ee]=null}),check_outros(),j=X[$],j?j.p(Q,Z):(j=X[$]=G[$](Q),j.c()),transition_in(j,1),j.m(M,null)),(!V||Z&2&&z!==(z=Q[1]===!0?"":"mt-4"))&&attr(M,"class",z)},i(Q){V||(transition_in(j),V=!0)},o(Q){transition_out(j),V=!1},d(Q){Q&&detach(_),X[$].d()}}}function create_else_block$b(q){let _;return{c(){_=element("p"),_.textContent="Attachment type not supported"},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}function create_if_block_8$1(q){let _,M,$;return M=new PdfViewer({props:{url:q[13],showButtons:["navigation","pageInfo"],showBorder:!1}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","pdfViewer svelte-1dq0dzk")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&16&&(V.url=j[13]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_7$2(q){let _,M,$;return M=new SvelteMarkdown({props:{source:q[13]}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","markdown text-3xl w-auto svelte-1dq0dzk")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&16&&(V.source=j[13]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_6$3(q){let _,M,$;return{c(){_=element("div"),M=element("audio"),src_url_equal(M.src,$=q[13])||attr(M,"src",$),M.controls=!0,attr(M,"class","svelte-1dq0dzk"),attr(_,"class","w-full")},m(j,z){insert(j,_,z),append(_,M)},p(j,z){z&16&&!src_url_equal(M.src,$=j[13])&&attr(M,"src",$)},i:noop,o:noop,d(j){j&&detach(_)}}}function create_if_block_5$4(q){let _,M=q[13]+"";return{c(){_=element("p"),attr(_,"class","my-6 textbox svelte-1dq0dzk")},m($,j){insert($,_,j),_.innerHTML=M},p($,j){j&16&&M!==(M=$[13]+"")&&(_.innerHTML=M)},i:noop,o:noop,d($){$&&detach(_)}}}function create_if_block_4$7(q){let _,M,$,j;return{c(){_=element("div"),M=element("img"),src_url_equal(M.src,$=q[13])||attr(M,"src",$),attr(M,"alt",j=q[0].text),attr(M,"class","svelte-1dq0dzk"),attr(_,"class","w-auto h-auto")},m(z,V){insert(z,_,V),append(_,M)},p(z,V){V&16&&!src_url_equal(M.src,$=z[13])&&attr(M,"src",$),V&1&&j!==(j=z[0].text)&&attr(M,"alt",j)},i:noop,o:noop,d(z){z&&detach(_)}}}function create_if_block_1$o(q){let _,M=q[3]!==void 0&&q[1]!=="true"&&create_if_block_2$j(q);return{c(){M&&M.c(),_=empty()},m($,j){M&&M.m($,j),insert($,_,j)},p($,j){$[3]!==void 0&&$[1]!=="true"?M?M.p($,j):(M=create_if_block_2$j($),M.c(),M.m(_.parentNode,_)):M&&(M.d(1),M=null)},d($){M&&M.d($),$&&detach(_)}}}function create_if_block_2$j(q){let _,M,$,j,z;return{c(){_=element("div"),M=element("p"),$=element("button"),$.textContent="Get attachment",attr($,"class","svelte-1dq0dzk"),attr(M,"class","mx-4"),attr(_,"class","flex flex-row mb-4 items-end pb-8")},m(V,G){insert(V,_,G),append(_,M),append(M,$),j||(z=listen($,"click",function(){is_function(q[7](q[0]))&&q[7](q[0]).apply(this,arguments)}),j=!0)},p(V,G){q=V},d(V){V&&detach(_),j=!1,z()}}}function create_pending_block$1(q){let _;return{c(){_=text("Loading attachment...")},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}function create_fragment$A(q){let _,M,$=create_if_block$t(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,[z]){$.p(j,z)},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function instance$z(q,_,M){let $;component_subscribe(q,replicaDetails,ne=>M(10,$=ne));let{doc:j}=_,{replies:z=!1}=_,V,G,X=!1,Y=!0,Q,Z;async function ee(ne){const re=await $.replica.getAttachment(ne);let ie=ne.path.split(".").pop();if(re!==void 0){const he=await re.bytes();let ce=new Uint8Array(he.length);for(var se=0;se<he.length;se++)ce[se]=he[se];if(ie==="md"){M(6,Q="markdown");var le=new TextDecoder("utf-8");M(3,V=le.decode(new Uint8Array(he)))}else if(["mp3","ogg","webm"].includes(ie))M(6,Q="audio"),Z="audio/"+ie,M(3,V=URL.createObjectURL(new Blob([ce],{type:Z})));else if(ie==="txt"){M(6,Q="text");var le=new TextDecoder("utf-8");M(3,V=le.decode(Uint8Array.from(ce)))}else["png","gif","jpeg"].includes(ie)?(M(6,Q="image"),Z="image/"+ie,M(3,V=URL.createObjectURL(new Blob([ce],{type:Z})))):ie==="pdf"?(M(6,Q="pdf"),M(3,V=URL.createObjectURL(new Blob([ce],{type:"application/pdf"})))):(M(6,Q="other"),M(3,V=URL.createObjectURL(new Blob([ce],{type:"application/octet-stream"}))));return V}}function te(ne){M(4,G=ee(ne)),M(5,X=!0),M(2,Y=!1)}return q.$$set=ne=>{"doc"in ne&&M(0,j=ne.doc),"replies"in ne&&M(1,z=ne.replies)},q.$$.update=()=>{q.$$.dirty&1&&j&&(M(4,G=ee(j)),M(5,X=!0),M(2,Y=!1)),q.$$.dirty&4},[j,z,Y,V,G,X,Q,te]}class GetAttachment extends SvelteComponent{constructor(_){super(),init(this,_,instance$z,create_fragment$A,safe_not_equal,{doc:0,replies:1})}}const SingleReply_svelte_svelte_type_style_lang="";function create_if_block$s(q){let _,M,$,j,z,V,G=q[5]!==void 0&&create_if_block_2$i(q),X=q[2]&&create_if_block_1$n(q);return{c(){_=element("div"),M=new HtmlTag(!1),$=space(),G&&G.c(),j=space(),X&&X.c(),z=empty(),M.a=$,attr(_,"class","flex flex-col w-full items-start svelte-1lrxbus")},m(Y,Q){insert(Y,_,Q),M.m(q[0],_),append(_,$),G&&G.m(_,null),insert(Y,j,Q),X&&X.m(Y,Q),insert(Y,z,Q),V=!0},p(Y,Q){(!V||Q&1)&&M.p(Y[0]),Y[5]!==void 0?G?G.p(Y,Q):(G=create_if_block_2$i(Y),G.c(),G.m(_,null)):G&&(G.d(1),G=null),Y[2]?X?(X.p(Y,Q),Q&4&&transition_in(X,1)):(X=create_if_block_1$n(Y),X.c(),transition_in(X,1),X.m(z.parentNode,z)):X&&(group_outros(),transition_out(X,1,1,()=>{X=null}),check_outros())},i(Y){V||(transition_in(X),V=!0)},o(Y){transition_out(X),V=!1},d(Y){Y&&detach(_),G&&G.d(),Y&&detach(j),X&&X.d(Y),Y&&detach(z)}}}function create_if_block_2$i(q){let _,M,$;return{c(){_=element("p"),M=text(q[5]),attr(_,"class",$="text-2xl w-11/12 text-left "+(q[3]?"":"truncate ...")+" svelte-1lrxbus")},m(j,z){insert(j,_,z),append(_,M)},p(j,z){z&32&&set_data(M,j[5]),z&8&&$!==($="text-2xl w-11/12 text-left "+(j[3]?"":"truncate ...")+" svelte-1lrxbus")&&attr(_,"class",$)},d(j){j&&detach(_)}}}function create_if_block_1$n(q){let _,M;return _=new GetAttachment({props:{doc:q[1],replies:q[4]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.doc=$[1]),j&16&&(z.replies=$[4]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_fragment$z(q){let _,M,$=q[0]!==void 0&&create_if_block$s(q);return{c(){_=element("div"),$&&$.c(),attr(_,"class","flex flex-col items-start svelte-1lrxbus"),toggle_class(_,"replies",q[4]===!0)},m(j,z){insert(j,_,z),$&&$.m(_,null),M=!0},p(j,[z]){j[0]!==void 0?$?($.p(j,z),z&1&&transition_in($,1)):($=create_if_block$s(j),$.c(),transition_in($,1),$.m(_,null)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros()),(!M||z&16)&&toggle_class(_,"replies",j[4]===!0)},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){j&&detach(_),$&&$.d()}}}function instance$y(q,_,M){let{doc:$}=_,{attachment:j=!0}=_,{expanded:z=!1}=_,{title:V=void 0}=_,{isReply:G=!0}=_,X=new Date($.timestamp/1e3),Y;X!==void 0&&(Y=new Intl.DateTimeFormat("en-US").format(X)),$.deleteAfter&&$.deleteAfter;let Q,Z,ee;return q.$$set=te=>{"doc"in te&&M(1,$=te.doc),"attachment"in te&&M(2,j=te.attachment),"expanded"in te&&M(3,z=te.expanded),"title"in te&&M(0,V=te.title),"isReply"in te&&M(4,G=te.isReply)},q.$$.update=()=>{if(q.$$.dirty&451){if(V!==void 0&&V.includes("<br>")){M(7,Q=V.split("<br>"));let te=Q[1].split("Shared ");M(8,Z=te[1].split(",")),M(0,V=Q.shift()),M(0,V=V+Z[0])}else if(V!==void 0&&!V.includes("voice")){M(7,Q=$.text);let te=Q.split(": ");M(0,V=te[0]+" on "+Y),M(5,ee=te[1])}}},[V,$,j,z,G,ee,Y,Q,Z]}class SingleReply extends SvelteComponent{constructor(_){super(),init(this,_,instance$y,create_fragment$z,safe_not_equal,{doc:1,attachment:2,expanded:3,title:0,isReply:4})}}const ShowReply_svelte_svelte_type_style_lang="";function get_each_context$a(q,_,M){const $=q.slice();return $[0]=_[M],$}function create_if_block_2$h(q){let _,M=[],$=new Map,j,z=q[1];const V=G=>G[0].signature;for(let G=0;G<z.length;G+=1){let X=get_each_context$a(q,z,G),Y=V(X);$.set(Y,M[G]=create_each_block$a(Y,X))}return{c(){_=element("div");for(let G=0;G<M.length;G+=1)M[G].c();attr(_,"class","flex flex-col svelte-1t6yb8o")},m(G,X){insert(G,_,X);for(let Y=0;Y<M.length;Y+=1)M[Y]&&M[Y].m(_,null);j=!0},p(G,X){X&178&&(z=G[1],group_outros(),M=update_keyed_each(M,X,V,1,G,z,$,_,outro_and_destroy_block,create_each_block$a,null,get_each_context$a),check_outros())},i(G){if(!j){for(let X=0;X<z.length;X+=1)transition_in(M[X]);j=!0}},o(G){for(let X=0;X<M.length;X+=1)transition_out(M[X]);j=!1},d(G){G&&detach(_);for(let X=0;X<M.length;X+=1)M[X].d()}}}function create_if_block_1$m(q){let _=q[6]()+"",M;return{c(){M=text(_)},m($,j){insert($,M,j)},p:noop,i:noop,o:noop,d($){$&&detach(M)}}}function create_else_block$a(q){let _,M;return _=new SingleReply({props:{isReply:!0,title:q[0].text,doc:q[0],attachment:!1,expanded:q[4]===q[0].textHash}}),_.$on("click",q[7]),_.$on("update",q[7]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.title=$[0].text),j&2&&(z.doc=$[0]),j&18&&(z.expanded=$[4]===$[0].textHash),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_3$8(q){let _,M;return _=new SingleReply({props:{isReply:!0,title:q[0].text,doc:q[0],attachment:!0}}),_.$on("click",q[7]),_.$on("update",q[7]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.title=$[0].text),j&2&&(z.doc=$[0]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_each_block$a(q,_){let M,$,j,z,V,G,X,Y,Q,Z,ee;const te=[create_if_block_3$8,create_else_block$a],ne=[];function re(le,he){return he&2&&(j=null),j==null&&(j=!!le[0].text.includes("replied with voice")),j?0:1}z=re(_,-1),V=ne[z]=te[z](_);function ie(){return _[8](_[0])}function se(...le){return _[9](_[0],...le)}return{key:q,first:null,c(){M=element("div"),$=element("button"),V.c(),G=space(),attr($,"class","w-full svelte-1t6yb8o"),attr(M,"id",X=_[0].textHash),attr(M,"class",Y=null_to_empty(_[4]===_[0].textHash?"expanded":"")+" svelte-1t6yb8o"),this.first=M},m(le,he){insert(le,M,he),append(M,$),ne[z].m($,null),append(M,G),Q=!0,Z||(ee=[listen($,"click",ie),listen($,"keydown",se)],Z=!0)},p(le,he){_=le;let ce=z;z=re(_,he),z===ce?ne[z].p(_,he):(group_outros(),transition_out(ne[ce],1,1,()=>{ne[ce]=null}),check_outros(),V=ne[z],V?V.p(_,he):(V=ne[z]=te[z](_),V.c()),transition_in(V,1),V.m($,null)),(!Q||he&2&&X!==(X=_[0].textHash))&&attr(M,"id",X),(!Q||he&18&&Y!==(Y=null_to_empty(_[4]===_[0].textHash?"expanded":"")+" svelte-1t6yb8o"))&&attr(M,"class",Y)},i(le){Q||(transition_in(V),Q=!0)},o(le){transition_out(V),Q=!1},d(le){le&&detach(M),ne[z].d(),Z=!1,run_all(ee)}}}function create_if_block$r(q){let _;return{c(){_=element("div"),_.innerHTML='<div class="left-line svelte-1t6yb8o">There are no replies yet.</div>',attr(_,"class","flex flex-col items-start svelte-1t6yb8o")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_fragment$y(q){let _,M,$,j,z,V;const G=[create_if_block_1$m,create_if_block_2$h],X=[];function Y(Z,ee){return Z[1]===void 0?0:Z[2]?1:-1}~(M=Y(q))&&($=X[M]=G[M](q));let Q=q[3]&&create_if_block$r();return{c(){_=element("div"),$&&$.c(),j=space(),Q&&Q.c(),z=empty(),attr(_,"class","svelte-1t6yb8o")},m(Z,ee){insert(Z,_,ee),~M&&X[M].m(_,null),insert(Z,j,ee),Q&&Q.m(Z,ee),insert(Z,z,ee),V=!0},p(Z,[ee]){let te=M;M=Y(Z),M===te?~M&&X[M].p(Z,ee):($&&(group_outros(),transition_out(X[te],1,1,()=>{X[te]=null}),check_outros()),~M?($=X[M],$?$.p(Z,ee):($=X[M]=G[M](Z),$.c()),transition_in($,1),$.m(_,null)):$=null),Z[3]?Q||(Q=create_if_block$r(),Q.c(),Q.m(z.parentNode,z)):Q&&(Q.d(1),Q=null)},i(Z){V||(transition_in($),V=!0)},o(Z){transition_out($),V=!1},d(Z){Z&&detach(_),~M&&X[M].d(),Z&&detach(j),Q&&Q.d(Z),Z&&detach(z)}}}function instance$x(q,_,M){let $;component_subscribe(q,cacheDetails,re=>M(11,$=re));let{doc:j}=_,z=[],V=[],G=!0,X=!1,Y=null;function Q(re){Y===re?M(4,Y=null):M(4,Y=re)}const Z=async()=>{let re;if(j.path.includes("!"))re=j.path.split("!")[0];else{let ie=j.path.match(/(\/documents\/(page\d+\/)?\d+\/\d+\/\d+)/);if(ie&&ie[1])re=ie[1];else throw new Error("Invalid path format")}V=await $.queryDocs({filter:{pathStartsWith:re}}),re.includes("/page")?M(1,z=V.filter(ie=>ie.path.split("/").length>7)):M(1,z=V.filter(ie=>ie.path.split("/").length>6)),M(2,G=!0)};$.onCacheUpdated(()=>{Z(),M(1,z)});function ee(){setTimeout(()=>{Z()},1e3)}onMount(()=>{Z()});const te=re=>Q(re.textHash),ne=(re,ie)=>(ie.key==="Enter"||ie.key===" ")&&Q(re.textHash);return q.$$set=re=>{"doc"in re&&M(0,j=re.doc)},q.$$.update=()=>{q.$$.dirty&2&&M(1,z),q.$$.dirty&2&&(z.length>=1?(M(2,G=!0),M(3,X=!1)):M(3,X=!0))},[j,z,G,X,Y,Q,Z,ee,te,ne]}class ShowReply extends SvelteComponent{constructor(_){super(),init(this,_,instance$x,create_fragment$y,safe_not_equal,{doc:0})}}const Voice_svelte_svelte_type_style_lang="";function create_else_block$9(q){let _,M,$,j,z,V,G,X=q[0]!=="reply"&&create_if_block_3$7();function Y(ee,te){return ee[2]?create_if_block_2$g:create_else_block_1$2}let Q=Y(q),Z=Q(q);return{c(){_=element("div"),M=element("div"),X&&X.c(),$=space(),j=element("div"),z=element("button"),Z.c(),attr(z,"class","phase1 mt-6 svelte-16jchvz"),attr(j,"class","mt-6 svelte-16jchvz"),attr(M,"class","svelte-16jchvz"),attr(_,"class","text-left svelte-16jchvz")},m(ee,te){insert(ee,_,te),append(_,M),X&&X.m(M,null),append(M,$),append(M,j),append(j,z),Z.m(z,null),V||(G=[listen(z,"click",q[10]),listen(z,"keypress",q[11])],V=!0)},p(ee,te){ee[0]!=="reply"?X||(X=create_if_block_3$7(),X.c(),X.m(M,$)):X&&(X.d(1),X=null),Q!==(Q=Y(ee))&&(Z.d(1),Z=Q(ee),Z&&(Z.c(),Z.m(z,null)))},d(ee){ee&&detach(_),X&&X.d(),Z.d(),V=!1,run_all(G)}}}function create_if_block$q(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee,te,ne,re,ie,se=!q[1]&&create_if_block_1$l();return{c(){_=element("div"),M=element("h5"),M.textContent="Review your recording",$=space(),j=element("audio"),z=element("source"),G=text(`
            Your browser does not support the audio element.`),X=space(),se&&se.c(),Y=space(),Q=element("button"),Q.textContent="Record again",Z=space(),ee=element("button"),te=text("Upload"),attr(M,"class","m-2 svelte-16jchvz"),src_url_equal(z.src,V=q[3])||attr(z,"src",V),attr(z,"type","audio/webm"),j.controls=!0,attr(j,"class","my-6 mx-2 svelte-16jchvz"),attr(Q,"class","svelte-16jchvz"),ee.disabled=ne=!q[1],attr(ee,"class","svelte-16jchvz"),attr(_,"class","text-left m-2 svelte-16jchvz")},m(le,he){insert(le,_,he),append(_,M),append(_,$),append(_,j),append(j,z),append(j,G),append(_,X),se&&se.m(_,null),append(_,Y),append(_,Q),append(_,Z),append(_,ee),append(ee,te),re||(ie=[listen(Q,"click",q[6]),listen(ee,"click",q[5])],re=!0)},p(le,he){he&8&&!src_url_equal(z.src,V=le[3])&&attr(z,"src",V),le[1]?se&&(se.d(1),se=null):se||(se=create_if_block_1$l(),se.c(),se.m(_,Y)),he&2&&ne!==(ne=!le[1])&&(ee.disabled=ne)},d(le){le&&detach(_),se&&se.d(),re=!1,run_all(ie)}}}function create_if_block_3$7(q){let _,M,$;return{c(){_=element("h5"),_.textContent="Record your voice note",M=space(),$=element("div"),$.textContent="Click the button below to start recording. Click again to stop.",attr(_,"class","m-2 svelte-16jchvz"),attr($,"class","svelte-16jchvz")},m(j,z){insert(j,_,z),insert(j,M,z),insert(j,$,z)},d(j){j&&detach(_),j&&detach(M),j&&detach($)}}}function create_else_block_1$2(q){let _;return{c(){_=text("Record audio")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_2$g(q){let _;return{c(){_=text("Stop recording")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_1$l(q){let _;return{c(){_=element("div"),_.textContent="The upload button is disabled because a title is required.",attr(_,"class","svelte-16jchvz")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_fragment$x(q){let _;function M(z,V){return z[3]?create_if_block$q:create_else_block$9}let $=M(q),j=$(q);return{c(){j.c(),_=empty()},m(z,V){j.m(z,V),insert(z,_,V)},p(z,[V]){$===($=M(z))&&j?j.p(z,V):(j.d(1),j=$(z),j&&(j.c(),j.m(_.parentNode,_)))},i:noop,o:noop,d(z){j.d(z),z&&detach(_)}}}function readBlobAsArrayBuffer(q){return new Promise((_,M)=>{const $=new FileReader;$.onloadend=()=>_($.result),$.onerror=M,$.readAsArrayBuffer(q)})}function instance$w(q,_,M){let $,j,z;component_subscribe(q,authorKeypair,fe=>M(16,$=fe)),component_subscribe(q,replicaDetails,fe=>M(17,j=fe)),component_subscribe(q,shareKeypair,fe=>M(18,z=fe));const V=createEventDispatcher();let G,X=[],Y=null,Q=!1,Z=null,ee=null,te=$.address.slice(1,5),{xy:ne=void 0}=_,{doc:re=void 0}=_,{title:ie=void 0}=_,{notes:se=void 0}=_,{isValid:le=!0}=_;async function he(){if(Q){Y.stop();let fe=Y.mimeType;fe===""&&(fe="audio/webm"),console.log("mediaRecorder",Y),console.log("mediaRecorder mime",Y.mimeType),M(2,Q=!1),Y.ondataavailable=oe=>X.push(oe.data),await new Promise(oe=>{Y.onstop=function(){ee=new Blob(X,{type:fe}),M(3,Z=URL.createObjectURL(ee)),console.log("blob",ee),oe()}})}else{const fe=await navigator.mediaDevices.getUserMedia({audio:!0}),oe={mimeType:"audio/webm"};Y=new MediaRecorder(fe,oe),Y.start(),console.log("mediaRecorder",Y),console.log("mediaRecorder mime",Y.mimeType),console.log("recording"),M(2,Q=!0)}}async function ce(){let fe;se&&ie?fe=`#Title: ${ie}#Notes: ${se}`:ie?fe=`#Title: ${ie}`:fe="";let oe=Date.now(),we=new Date,De=new Intl.DateTimeFormat("en-US").format(we),ve=(Date.now()+25488e5)*1e3,Ce=Y.mimeType||"audio/webm",Pe=Ce.split(";")[0].split("/")[1];Pe==="webm"&&(Pe="webm");const ze=await readBlobAsArrayBuffer(ee),Le=new Uint8Array(ze);console.log("mime",Ce);let Me={text:`Voice note shared by ${te} on ${De} ${fe}`,attachment:Le};if(ne=="reply"){console.log("og doc path:",re.path);const Ye=re.path.substring(0,re.path.lastIndexOf("/"));console.log("replypathparts",Ye),Me.path=`${Ye}/${oe}/!reply-by-${te}.${Pe}`,console.log("if reply docPath:",Me.path),Me.text=`${te} replied with voice <br>Shared on ${De}`}else ne.length>=3&&ne[2]>1?G=`/documents/page${ne[2]}/${ne[0]}/${ne[1]}/${oe}/!voice-note-by-${te}.${Pe}`:G=`/documents/${ne[0]}/${ne[1]}/${oe}/!voice-note-by-${te}.${Pe}`,Me.path=G;console.log("shareKeypair",z),z.shareAddress.includes("commons")?ne=="reply"?Me.deleteAfter=re.deleteAfter:(Me.deleteAfter=ve,console.log("added deleteAfter to doc")):(G.includes("!")?Me.path=G.replace("!",""):Me.path=G,console.log("removed ! from path")),console.log("voiceDoc path",Me.path);const Ne=await j.replica.set($,Me);return console.log("Upload Result: ",Ne),V(ne=="reply"?"success":"upload"),X=[],Ne}async function ae(){M(3,Z=null),X=[],await he()}const de=async()=>{he()},ge=async()=>{he()};return q.$$set=fe=>{"xy"in fe&&M(0,ne=fe.xy),"doc"in fe&&M(7,re=fe.doc),"title"in fe&&M(8,ie=fe.title),"notes"in fe&&M(9,se=fe.notes),"isValid"in fe&&M(1,le=fe.isValid)},q.$$.update=()=>{q.$$.dirty&768&&ie&&se&&console.log("title and note",ie,se)},[ne,le,Q,Z,he,ce,ae,re,ie,se,de,ge]}class Voice extends SvelteComponent{constructor(_){super(),init(this,_,instance$w,create_fragment$x,safe_not_equal,{xy:0,doc:7,title:8,notes:9,isValid:1})}}function create_if_block_2$f(q){let _,M,$,j,z,V,G,X,Y;return{c(){_=element("div"),M=element("p"),$=element("textarea"),j=space(),z=element("button"),V=text("send reply"),attr($,"class","my-1"),attr($,"placeholder",q[4]),set_style($,"width","100%"),z.disabled=G=q[5](q[1]),attr(_,"class","flex flex-col mx-2w-11/12")},m(Q,Z){insert(Q,_,Z),append(_,M),append(M,$),set_input_value($,q[1]),append(_,j),append(_,z),append(z,V),X||(Y=[listen($,"input",q[12]),listen(z,"click",q[7])],X=!0)},p(Q,Z){Z&16&&attr($,"placeholder",Q[4]),Z&2&&set_input_value($,Q[1]),Z&2&&G!==(G=Q[5](Q[1]))&&(z.disabled=G)},d(Q){Q&&detach(_),X=!1,run_all(Y)}}}function create_if_block_1$k(q){let _,M;return _=new Voice({props:{xy:"reply",doc:q[0]}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&1&&(z.doc=$[0]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block$p(q){let _;return{c(){_=element("span"),_.textContent=`${q[6].kind}`},m(M,$){insert(M,_,$)},p:noop,d(M){M&&detach(_)}}}function create_fragment$w(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee,te=q[2]&&create_if_block_2$f(q),ne=q[3]&&create_if_block_1$k(q),re=q[6]&&create_if_block$p(q);return{c(){_=element("div"),M=element("div"),$=element("button"),$.textContent="text reply",j=space(),z=element("button"),z.textContent="voice reply",V=space(),te&&te.c(),G=space(),ne&&ne.c(),X=space(),Y=element("p"),re&&re.c(),attr($,"class","mb-2 mx-2 phase1"),attr(z,"class","mb-2 mx-2 phase1"),attr(M,"class","flex flex-row")},m(ie,se){insert(ie,_,se),append(_,M),append(M,$),append(M,j),append(M,z),insert(ie,V,se),te&&te.m(ie,se),insert(ie,G,se),ne&&ne.m(ie,se),insert(ie,X,se),insert(ie,Y,se),re&&re.m(Y,null),Q=!0,Z||(ee=[listen($,"click",q[8]),listen(z,"click",q[9])],Z=!0)},p(ie,[se]){ie[2]?te?te.p(ie,se):(te=create_if_block_2$f(ie),te.c(),te.m(G.parentNode,G)):te&&(te.d(1),te=null),ie[3]?ne?(ne.p(ie,se),se&8&&transition_in(ne,1)):(ne=create_if_block_1$k(ie),ne.c(),transition_in(ne,1),ne.m(X.parentNode,X)):ne&&(group_outros(),transition_out(ne,1,1,()=>{ne=null}),check_outros()),ie[6]&&re.p(ie,se)},i(ie){Q||(transition_in(ne),Q=!0)},o(ie){transition_out(ne),Q=!1},d(ie){ie&&detach(_),ie&&detach(V),te&&te.d(ie),ie&&detach(G),ne&&ne.d(ie),ie&&detach(X),ie&&detach(Y),re&&re.d(),Z=!1,run_all(ee)}}}function instance$v(q,_,M){let $,j;component_subscribe(q,authorKeypair,ae=>M(16,$=ae)),component_subscribe(q,replicaDetails,ae=>M(17,j=ae));const z=createEventDispatcher();function V(ae){return ae==ee}let{doc:G}=_,X,Y=!1,Q=!1,Z="",ee="Type your reply here";Z.length;let te,ne,re={},ie=get_store_value(shareKeypair).shareAddress;shareKeypair.subscribe(ae=>{M(11,ie=ae.shareAddress)});async function se(){let ae=$.address.slice(1,5),de=Date.now(),ge=G.path,fe,oe;if(ne)fe=ge.split("!")[0],oe="!";else{let Ce=ge.match(/(\/documents\/(page\d+\/)?\d+\/\d+\/\d+)/);if(Ce&&Ce[1])fe=Ce[1];else throw new Error("Invalid path format for studio");oe=""}let we;ne?(we=fe+de+"/"+oe+"reply-by-"+ae,re.deleteAfter=G.deleteAfter):we=fe+"/"+de+"/reply-by-"+ae;let De=ae+" replied: "+Z;re.text=De,re.path=we;const ve=await j.replica.set($,re);return z("success"),M(1,Z=""),ve}function le(){M(2,Y=!Y),M(3,Q=!1)}function he(){M(2,Y=!1),M(3,Q=!Q)}function ce(){Z=this.value,M(1,Z),M(6,X)}return q.$$set=ae=>{"doc"in ae&&M(0,G=ae.doc)},q.$$.update=()=>{q.$$.dirty&3072&&(M(10,te=ie.split("+")[1].split(".")[0]),ne=te.includes("commons")),q.$$.dirty&2&&Z!==void 0&&Z.length},[G,Z,Y,Q,ee,V,X,se,le,he,te,ie,ce]}class SendReply extends SvelteComponent{constructor(_){super(),init(this,_,instance$v,create_fragment$w,safe_not_equal,{doc:0})}}const Reply_svelte_svelte_type_style_lang="";function create_if_block$o(q){let _,M,$,j,z,V,G,X,Y,Q;return G=new ShowReply({props:{doc:q[0]}}),G.$on("success",q[2]),Y=new SendReply({props:{doc:q[0]}}),Y.$on("success",q[3]),{c(){_=element("div"),M=element("h5"),$=text("Artefact: "),j=text(q[1]),z=space(),V=element("div"),create_component(G.$$.fragment),X=space(),create_component(Y.$$.fragment),attr(M,"class","mx-4 px-8 text-left svelte-va0czc"),attr(V,"class","replies svelte-va0czc"),attr(_,"class","w-auto")},m(Z,ee){insert(Z,_,ee),append(_,M),append(M,$),append(M,j),append(_,z),append(_,V),mount_component(G,V,null),append(_,X),mount_component(Y,_,null),Q=!0},p(Z,ee){(!Q||ee&2)&&set_data(j,Z[1]);const te={};ee&1&&(te.doc=Z[0]),G.$set(te);const ne={};ee&1&&(ne.doc=Z[0]),Y.$set(ne)},i(Z){Q||(transition_in(G.$$.fragment,Z),transition_in(Y.$$.fragment,Z),Q=!0)},o(Z){transition_out(G.$$.fragment,Z),transition_out(Y.$$.fragment,Z),Q=!1},d(Z){Z&&detach(_),destroy_component(G),destroy_component(Y)}}}function create_fragment$v(q){let _,M,$=create_if_block$o(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,[z]){$.p(j,z)},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function instance$u(q,_,M){let{doc:$}=_,{title:j}=_;function z(G){bubble.call(this,q,G)}function V(G){bubble.call(this,q,G)}return q.$$set=G=>{"doc"in G&&M(0,$=G.doc),"title"in G&&M(1,j=G.title)},[$,j,z,V]}class Reply extends SvelteComponent{constructor(_){super(),init(this,_,instance$u,create_fragment$v,safe_not_equal,{doc:0,title:1})}}const View_svelte_svelte_type_style_lang="";function create_if_block_2$e(q){let _,M,$;return{c(){_=element("div"),M=element("h4"),$=text(q[3]),attr(M,"class","mt-4 p-2"),attr(_,"class","flex flex-row text-left w-full")},m(j,z){insert(j,_,z),append(_,M),append(M,$)},p(j,z){z&8&&set_data($,j[3])},d(j){j&&detach(_)}}}function create_if_block_1$j(q){let _,M,$;return M=new GetAttachment({props:{doc:q[0],replies:!1}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","attachmentbox pr-12 w-2/3 overflow-y-scroll")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&1&&(V.doc=j[0]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block$n(q){let _,M,$;return M=new Reply({props:{doc:q[0],title:q[3]}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","ml-6 mr-2 pr-8n w-1/3")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&1&&(V.doc=j[0]),z&8&&(V.title=j[3]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_fragment$u(q){let _,M,$,j,z,V,G,X,Y,Q=q[3]&&create_if_block_2$e(q),Z=q[1]&&create_if_block_1$j(q),ee=q[2]&&create_if_block$n(q);return{c(){_=element("div"),Q&&Q.c(),M=space(),$=element("div"),Z&&Z.c(),j=space(),ee&&ee.c(),z=space(),V=element("button"),V.textContent="exit artefact",attr($,"class","flex flex-row justify-between w-full h-4/5"),attr(_,"class","w-full h-full flex flex-col ml-4 mr-8 pr-4"),set_style(V,"text-decoration","underline"),attr(V,"class","top-right svelte-19snrg1")},m(te,ne){insert(te,_,ne),Q&&Q.m(_,null),append(_,M),append(_,$),Z&&Z.m($,null),append($,j),ee&&ee.m($,null),insert(te,z,ne),insert(te,V,ne),G=!0,X||(Y=listen(V,"click",q[4]),X=!0)},p(te,[ne]){te[3]?Q?Q.p(te,ne):(Q=create_if_block_2$e(te),Q.c(),Q.m(_,M)):Q&&(Q.d(1),Q=null),te[1]?Z?(Z.p(te,ne),ne&2&&transition_in(Z,1)):(Z=create_if_block_1$j(te),Z.c(),transition_in(Z,1),Z.m($,j)):Z&&(group_outros(),transition_out(Z,1,1,()=>{Z=null}),check_outros()),te[2]?ee?(ee.p(te,ne),ne&4&&transition_in(ee,1)):(ee=create_if_block$n(te),ee.c(),transition_in(ee,1),ee.m($,null)):ee&&(group_outros(),transition_out(ee,1,1,()=>{ee=null}),check_outros())},i(te){G||(transition_in(Z),transition_in(ee),G=!0)},o(te){transition_out(Z),transition_out(ee),G=!1},d(te){te&&detach(_),Q&&Q.d(),Z&&Z.d(),ee&&ee.d(),te&&detach(z),te&&detach(V),X=!1,Y()}}}function instance$t(q,_,M){const $=createEventDispatcher();let{selectedDocument:j}=_,{attachment:z=!0}=_,{reply:V=!0}=_,G;function X(){$("close")}return q.$$set=Y=>{"selectedDocument"in Y&&M(0,j=Y.selectedDocument),"attachment"in Y&&M(1,z=Y.attachment),"reply"in Y&&M(2,V=Y.reply)},q.$$.update=()=>{q.$$.dirty&1&&j&&(j.text.includes("#Title:")&&j.text.includes("#Notes:")?M(3,G=j.text.split("#Title:")[1].split("#Notes:")[0].trim()):j.text.includes("#Title:")&&!j.text.includes("#Notes:")?M(3,G=j.text.split("#Title:")[1].trim()):M(3,G=""))},[j,z,V,G,X]}class View extends SvelteComponent{constructor(_){super(),init(this,_,instance$t,create_fragment$u,safe_not_equal,{selectedDocument:0,attachment:1,reply:2})}}function splitTitleAndNotes(q){let _="",M="";const $=q.split("#Title:");if($[1]!==void 0){const j=$[1].split("#Notes:");_=j[0].trim(),j[1]!==void 0&&(M=j[1].trim())}return{preface:$[0].trim(),title:_,notes:M}}const flowers=["icons/flower-phase-0-02.png","icons/flower-phase-1-02.png","icons/flower-phase-2-02.png","icons/flower-phase-3-02.png","icons/flower-phase-4-02.png","icons/flower-phase-5-02.png","icons/flower-phase-6-02.png","icons/flower-phase-7-02.png","icons/flower-phase-8-02.png","icons/flower-phase-9-02.png"],mountains=["icons/mountain-phase-0-02.png","icons/mountain-phase-1-02.png","icons/mountain-phase-2-02.png","icons/mountain-phase-3-02.png","icons/mountain-phase-4-02.png","icons/mountain-phase-5-02.png","icons/mountain-phase-6-02.png","icons/mountain-phase-7-02.png","icons/mountain-phase-8-02.png"],planets=["icons/phaseplanet-1.png","icons/phaseplanet-2.png","icons/phaseplanet-3.png","icons/phaseplanet-4.png","icons/phaseplanet-5.png","icons/phaseplanet-6.png","icons/phaseplanet-7.png","icons/phaseplanet-8.png"],rivers=["icons/phaseriver-1.png","icons/phaseriver-2.png","icons/phaseriver-3.png","icons/phaseriver-4.png","icons/phaseriver-5.png","icons/phaseriver-6.png","icons/phaseriver-7.png","icons/phaseriver-8.png"],wishbones=["icons/phasewishbone-8.png","icons/phasewishbone-1.png","icons/phasewishbone-2.png","icons/phasewishbone-3.png","icons/phasewishbone-4.png","icons/phasewishbone-5.png","icons/phasewishbone-6.png","icons/phasewishbone-7.png"],Icon_svelte_svelte_type_style_lang="";function create_else_block$8(q){let _,M,$,j,z,V,G,X,Y,Q,Z=!q[3]&&create_if_block_1$i(q);return{c(){_=element("div"),M=element("img"),G=space(),Z&&Z.c(),src_url_equal(M.src,$=q[4][q[4].length-1-q[14]])||attr(M,"src",$),attr(M,"alt",j="a "+q[8]+" made of "+q[7]+" is in phase #"+(q[2]+1)),attr(M,"data-path",z=q[0].path),attr(M,"class",V=null_to_empty(q[3]?"small-icon":"")+" svelte-19do6s9"),attr(_,"class",X="icon-container "+(q[5]&&!q[3]?"hovered":"")+" "+(q[3]?"small-icon":"")+" svelte-19do6s9")},m(ee,te){insert(ee,_,te),append(_,M),append(_,G),Z&&Z.m(_,null),Y||(Q=[listen(_,"click",q[13]),listen(_,"keypress",q[13]),listen(_,"mouseenter",q[11]),listen(_,"mouseleave",q[12])],Y=!0)},p(ee,te){te&16&&!src_url_equal(M.src,$=ee[4][ee[4].length-1-ee[14]])&&attr(M,"src",$),te&388&&j!==(j="a "+ee[8]+" made of "+ee[7]+" is in phase #"+(ee[2]+1))&&attr(M,"alt",j),te&1&&z!==(z=ee[0].path)&&attr(M,"data-path",z),te&8&&V!==(V=null_to_empty(ee[3]?"small-icon":"")+" svelte-19do6s9")&&attr(M,"class",V),ee[3]?Z&&(Z.d(1),Z=null):Z?Z.p(ee,te):(Z=create_if_block_1$i(ee),Z.c(),Z.m(_,null)),te&40&&X!==(X="icon-container "+(ee[5]&&!ee[3]?"hovered":"")+" "+(ee[3]?"small-icon":"")+" svelte-19do6s9")&&attr(_,"class",X)},d(ee){ee&&detach(_),Z&&Z.d(),Y=!1,run_all(Q)}}}function create_if_block$m(q){let _,M,$,j,z,V;return{c(){_=element("div"),M=element("img"),src_url_equal(M.src,$=q[4][q[14]])||attr(M,"src",$),attr(M,"alt",j="a blurry "+q[8]+" made of "+q[7]+" is in phase #"+(q[2]+1)),attr(M,"data-path",z=q[0].path),attr(M,"class",V="blurred "+(q[3]?"small-icon":"")+" "+("blurPhase"+q[14])+" svelte-19do6s9"),attr(_,"class","icon-container h-full no-event svelte-19do6s9")},m(G,X){insert(G,_,X),append(_,M)},p(G,X){X&16&&!src_url_equal(M.src,$=G[4][G[14]])&&attr(M,"src",$),X&388&&j!==(j="a blurry "+G[8]+" made of "+G[7]+" is in phase #"+(G[2]+1))&&attr(M,"alt",j),X&1&&z!==(z=G[0].path)&&attr(M,"data-path",z),X&8&&V!==(V="blurred "+(G[3]?"small-icon":"")+" "+("blurPhase"+G[14])+" svelte-19do6s9")&&attr(M,"class",V)},d(G){G&&detach(_)}}}function create_if_block_1$i(q){let _,M,$,j,z,V,G,X=q[5]&&create_if_block_2$d(q);return{c(){_=element("div"),M=element("p"),$=text(q[6]),j=text("."),z=text(q[10]),V=space(),X&&X.c(),G=empty(),attr(_,"class","w-full details flex flex-row items-center justify-center svelte-19do6s9")},m(Y,Q){insert(Y,_,Q),append(_,M),append(M,$),append(M,j),append(M,z),insert(Y,V,Q),X&&X.m(Y,Q),insert(Y,G,Q)},p(Y,Q){Q&64&&set_data($,Y[6]),Y[5]?X?X.p(Y,Q):(X=create_if_block_2$d(Y),X.c(),X.m(G.parentNode,G)):X&&(X.d(1),X=null)},d(Y){Y&&detach(_),Y&&detach(V),X&&X.d(Y),Y&&detach(G)}}}function create_if_block_2$d(q){let _,M;return{c(){_=element("div"),M=element("p"),M.textContent=`${q[9][0]}, ${q[9][1]}`,attr(_,"class","coordinates svelte-19do6s9")},m($,j){insert($,_,j),append(_,M)},p:noop,d($){$&&detach(_)}}}function create_fragment$t(q){let _;function M(z,V){return z[1]?create_if_block$m:create_else_block$8}let $=M(q),j=$(q);return{c(){j.c(),_=empty()},m(z,V){j.m(z,V),insert(z,_,V)},p(z,[V]){$===($=M(z))&&j?j.p(z,V):(j.d(1),j=$(z),j&&(j.c(),j.m(_.parentNode,_)))},i:noop,o:noop,d(z){j.d(z),z&&detach(_)}}}function instance$s(q,_,M){let $;component_subscribe(q,shareKeypair,de=>M(17,$=de));const j=createEventDispatcher();let{doc:z}=_,{disabled:V=!1}=_,{phase:G}=_,{replies:X=!1}=_,Y,Q=z.deleteAfter,Z=!1,ee,te,ne,re,ie=pathToXY(z.path),se=z.path.split(".").pop();function le(){V||M(5,Z=!0)}function he(){V||M(5,Z=!1)}function ce(de){j("click",de)}z.path.endsWith(".md")?(Y=mountains,ne="text",re="mountain"):["png","gif","jpeg"].includes(se)?(Y=flowers,ne="image",re="flower"):["mp3","ogg","webm"].includes(se)?(Y=rivers,ne="audio",re="river"):se==="pdf"?(Y=wishbones,ne="pdf",re="wishbone"):(Y=planets,ne="unknown",re="planet");let ae=$.shareAddress.includes("commons")?Math.floor((Q-Date.now())/(25488e8/Y.length))%Y.length:1;return q.$$set=de=>{"doc"in de&&M(0,z=de.doc),"disabled"in de&&M(1,V=de.disabled),"phase"in de&&M(2,G=de.phase),"replies"in de&&M(3,X=de.replies)},q.$$.update=()=>{q.$$.dirty&32769&&z.text!==void 0&&(M(15,ee=splitTitleAndNotes(z.text)),M(6,te=ee.title),ee.note)},[z,V,G,X,Y,Z,te,ne,re,ie,se,le,he,ce,ae,ee]}class Icon extends SvelteComponent{constructor(_){super(),init(this,_,instance$s,create_fragment$t,safe_not_equal,{doc:0,disabled:1,phase:2,replies:3})}}function isValidPath(q){let _="";if(q.length<2||q.length>512)return _="Path length must be between 2 and 512 characters.",{isValid:!1,errorMessage:_};if(q.includes(" "))return _="Spaces are not allowed in paths.",{isValid:!1,errorMessage:_};if(!q.startsWith("/"))return _="Path must start with a '/'.",{isValid:!1,errorMessage:_};if(q.endsWith("/"))return _="Path can not end with a '/'.",{isValid:!1,errorMessage:_};if(q.startsWith("/@"))return _="Path can not begin with a '/@'.",{isValid:!1,errorMessage:_};if(q.includes("//"))return _="Double slashes are not allowed in paths.",{isValid:!1,errorMessage:_};const $="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"+"/'()-._~!$&+,:=@%";for(let z of q)if(!$.includes(z))return _=`Character '${z}' is not allowed in the path.`,{isValid:!1,errorMessage:_};const j=q.split("/");for(let z of j);return{isValid:!0,errorMessage:""}}const File_svelte_svelte_type_style_lang="";function create_if_block_2$c(q){let _,M;return{c(){_=element("div"),M=text(q[3]),attr(_,"class","error svelte-13zxng9")},m($,j){insert($,_,j),append(_,M)},p($,j){j&8&&set_data(M,$[3])},d($){$&&detach(_)}}}function create_if_block_1$h(q){let _;return{c(){_=element("div"),_.textContent="The upload button is disabled because a title and a file in a supported format are required.",attr(_,"class","svelte-13zxng9")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block$l(q){let _,M,$=q[1].kind+"",j;return{c(){_=element("p"),M=element("strong"),j=text($)},m(z,V){insert(z,_,V),append(_,M),append(M,j)},p(z,V){V&2&&$!==($=z[1].kind+"")&&set_data(j,$)},d(z){z&&detach(_)}}}function create_fragment$s(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee,te,ne,re,ie,se,le,he,ce,ae,de,ge,fe=q[3]&&create_if_block_2$c(q),oe=!(q[0]&&q[4])&&create_if_block_1$h(),we=q[1]&&create_if_block$l(q);return{c(){_=element("div"),M=element("div"),$=element("h5"),$.textContent="Upload a file",j=space(),z=element("div"),z.textContent="Select the file and enter a title.",V=space(),G=element("div"),G.textContent=`Supported file formats: ${q[5].join(", ")}`,X=space(),Y=element("div"),Y.textContent="You can also add a note.",Q=space(),fe&&fe.c(),Z=space(),oe&&oe.c(),ee=space(),te=element("div"),ne=element("button"),ne.textContent="select file",re=space(),ie=element("input"),se=space(),le=element("button"),he=text("upload"),ae=space(),we&&we.c(),attr($,"class","m-2"),attr(z,"class","svelte-13zxng9"),attr(G,"class","svelte-13zxng9"),attr(Y,"class","svelte-13zxng9"),attr(ne,"class","phase1 m-2 svelte-13zxng9"),set_style(ie,"display","none"),attr(ie,"type","file"),attr(ie,"accept",q[6]),attr(le,"class","phase1 m-2 svelte-13zxng9"),le.disabled=ce=!(q[0]&&q[4]),attr(te,"class","flex flex-row w-full space-between svelte-13zxng9"),attr(M,"class","text-left svelte-13zxng9"),attr(_,"class","svelte-13zxng9")},m(De,ve){insert(De,_,ve),append(_,M),append(M,$),append(M,j),append(M,z),append(M,V),append(M,G),append(M,X),append(M,Y),append(M,Q),fe&&fe.m(M,null),append(M,Z),oe&&oe.m(M,null),append(M,ee),append(M,te),append(te,ne),append(te,re),append(te,ie),q[14](ie),append(te,se),append(te,le),append(le,he),append(_,ae),we&&we.m(_,null),de||(ge=[listen(ne,"click",q[12]),listen(ne,"keypress",q[13]),listen(ie,"change",q[7]),listen(le,"click",q[8])],de=!0)},p(De,[ve]){De[3]?fe?fe.p(De,ve):(fe=create_if_block_2$c(De),fe.c(),fe.m(M,Z)):fe&&(fe.d(1),fe=null),De[0]&&De[4]?oe&&(oe.d(1),oe=null):oe||(oe=create_if_block_1$h(),oe.c(),oe.m(M,ee)),ve&17&&ce!==(ce=!(De[0]&&De[4]))&&(le.disabled=ce),De[1]?we?we.p(De,ve):(we=create_if_block$l(De),we.c(),we.m(_,null)):we&&(we.d(1),we=null)},i:noop,o:noop,d(De){De&&detach(_),fe&&fe.d(),oe&&oe.d(),q[14](null),we&&we.d(),de=!1,run_all(ge)}}}function readFileAsync(q){return new Promise((_,M)=>{let $=new FileReader;$.onload=()=>{_($.result),console.log("typeof",$.result)},$.onerror=M,$.readAsArrayBuffer(q)})}function instance$r(q,_,M){let $,j,z;component_subscribe(q,authorKeypair,oe=>M(17,$=oe)),component_subscribe(q,replicaDetails,oe=>M(18,j=oe)),component_subscribe(q,shareKeypair,oe=>M(19,z=oe));const V=createEventDispatcher();let{xy:G=[0,0]}=_,{title:X=void 0}=_,{notes:Y=void 0}=_,{isValid:Q=!1}=_,Z,ee,te,ne,re="",ie,se=["JPG","jpg","jpeg","JPEG","PNG","png","GIF","gif","MP3","mp3","OGG","ogg","WEBM","webm"],le=Array.from(new Set(se.map(oe=>oe.toLowerCase()))),he=se.join(", .");async function ce(oe){let we=new Date,De=new Intl.DateTimeFormat("en-US").format(we),ve=oe.target.files[0],ue=ve.name.replace(/\s+/g,"_").replace(/[@·,\/#!$%\^&\*;:{}=\-`~()]/g,""),Pe=ue.split(".").pop();if(!le.includes(Pe.toLowerCase())){M(3,re=`Unsupported file format. Supported formats are: ${le.join(", ")}`);return}let ze=ue.split(".")[ue.split(".").length-2],Le;(Pe==="JPG"||Pe==="jpg")&&(Pe="jpeg"),Le=ze+"."+Pe;let Me=Date.now(),Ne=await readFileAsync(ve),Ye=(Date.now()+25488e5)*1e3,Ie=new Uint8Array(Ne);G.length>=3&&G[2]>1?te=`/documents/page${G[2]}/${G[0]}/${G[1]}/${Me}/!${Le}`:te=`/documents/${G[0]}/${G[1]}/${Me}/!${Le}`;const Oe=isValidPath(te);if(!Oe.isValid){M(3,re=Oe.errorMessage);return}let Se="Shared by "+$.address.slice(1,5)+" on "+De,pe={path:te,text:Se,attachment:Ie};z.shareAddress.includes("commons")?(pe.deleteAfter=Ye,console.log("added deleteAfter to doc")):te.includes("!")?pe.path=te.replace("!",""):pe.path=te,M(4,ie=pe)}async function ae(){Y&&X?ne="#Title: "+X+"#Notes: "+Y:X?ne="#Title: "+X:ne="",M(4,ie.text+=" "+ne,ie),M(1,ee=await j.replica.set($,ie)),console.log("Result: ",ee),isErr(ee)?(console.error(ee),M(3,re=ee.message)):(console.log("Success!"),V("upload"))}const de=()=>{Z.click()},ge=()=>{Z.click()};function fe(oe){binding_callbacks[oe?"unshift":"push"](()=>{Z=oe,M(2,Z)})}return q.$$set=oe=>{"xy"in oe&&M(9,G=oe.xy),"title"in oe&&M(10,X=oe.title),"notes"in oe&&M(11,Y=oe.notes),"isValid"in oe&&M(0,Q=oe.isValid)},q.$$.update=()=>{q.$$.dirty&2&&M(1,ee)},[Q,ee,Z,re,ie,le,he,ce,ae,G,X,Y,de,ge,fe]}class File extends SvelteComponent{constructor(_){super(),init(this,_,instance$r,create_fragment$s,safe_not_equal,{xy:9,title:10,notes:11,isValid:0})}}const Upload_svelte_svelte_type_style_lang="";function create_if_block_4$6(q){let _,M;return _=new File({props:{xy:q[1],title:q[2],notes:q[5],isValid:q[3]}}),_.$on("upload",q[8]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.xy=$[1]),j&4&&(z.title=$[2]),j&32&&(z.notes=$[5]),j&8&&(z.isValid=$[3]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_3$6(q){let _,M;return _=new Voice({props:{xy:q[1],title:q[2],notes:q[5],isValid:q[3]}}),_.$on("upload",q[8]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.xy=$[1]),j&4&&(z.title=$[2]),j&32&&(z.notes=$[5]),j&8&&(z.isValid=$[3]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_2$b(q){let _,M,$;return{c(){_=element("textarea"),attr(_,"id","mainInput"),attr(_,"placeholder","Enter text"),attr(_,"class","svelte-xye4z5")},m(j,z){insert(j,_,z),set_input_value(_,q[4]),M||($=listen(_,"input",q[11]),M=!0)},p(j,z){z&16&&set_input_value(_,j[4])},i:noop,o:noop,d(j){j&&detach(_),M=!1,$()}}}function create_if_block$k(q){let _,M,$,j,z,V,G=!q[3]&&create_if_block_1$g();return{c(){G&&G.c(),_=space(),M=element("button"),$=text("Submit"),attr(M,"class","phase1 svelte-xye4z5"),M.disabled=j=!q[3]},m(X,Y){G&&G.m(X,Y),insert(X,_,Y),insert(X,M,Y),append(M,$),z||(V=listen(M,"click",q[7]),z=!0)},p(X,Y){X[3]?G&&(G.d(1),G=null):G||(G=create_if_block_1$g(),G.c(),G.m(_.parentNode,_)),Y&8&&j!==(j=!X[3])&&(M.disabled=j)},d(X){G&&G.d(X),X&&detach(_),X&&detach(M),z=!1,V()}}}function create_if_block_1$g(q){let _;return{c(){_=element("div"),_.textContent="Title is required."},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_fragment$r(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee,te,ne,re,ie,se,le,he,ce,ae,de,ge,fe;const oe=[create_if_block_2$b,create_if_block_3$6,create_if_block_4$6],we=[];function De(Ce,ue){return Ce[0]==="text"?0:Ce[0]==="audio"?1:Ce[0]==="file"?2:-1}~(ee=De(q))&&(te=we[ee]=oe[ee](q));let ve=q[0]==="text"&&create_if_block$k(q);return{c(){_=element("div"),M=element("div"),$=element("div"),j=element("div"),z=element("button"),z.textContent="Close",V=space(),G=element("div"),X=element("input"),Y=space(),Q=element("div"),Z=element("div"),te&&te.c(),ne=space(),re=element("div"),ie=element("h5"),ie.textContent="Notes",se=space(),le=element("input"),he=space(),ce=element("div"),ae=element("div"),ve&&ve.c(),attr(z,"class","close-button svelte-xye4z5"),attr(X,"id","titleInput"),attr(X,"class","align-left my-2 svelte-xye4z5"),attr(X,"type","text"),attr(X,"placeholder","Enter a title (required)"),attr(G,"class","flex flex-row justify-start"),attr(Z,"class","flex flex-col w-[50vw] items-start"),attr(ie,"class","text-left"),attr(le,"type","text"),attr(le,"placeholder","Enter optional notes"),attr(re,"class","pr-6"),attr(Q,"class","flex flex-row justify-between"),attr(ae,"class","flex flex-col"),attr(ce,"class","flex flex-row justify-end my-6"),attr(j,"class","p-6 w-full h-full bg-white"),attr($,"class","h-[80vh] w-full"),set_style(M,"position","relative"),set_style(M,"z-index","52"),set_style(_,"position","fixed"),set_style(_,"width","79vw")},m(Ce,ue){insert(Ce,_,ue),append(_,M),append(M,$),append($,j),append(j,z),append(j,V),append(j,G),append(G,X),set_input_value(X,q[2]),append(j,Y),append(j,Q),append(Q,Z),~ee&&we[ee].m(Z,null),append(Q,ne),append(Q,re),append(re,ie),append(re,se),append(re,le),set_input_value(le,q[5]),append(j,he),append(j,ce),append(ce,ae),ve&&ve.m(ae,null),de=!0,ge||(fe=[listen(z,"click",q[9]),listen(X,"input",q[10]),listen(le,"input",q[12])],ge=!0)},p(Ce,[ue]){ue&4&&X.value!==Ce[2]&&set_input_value(X,Ce[2]);let Pe=ee;ee=De(Ce),ee===Pe?~ee&&we[ee].p(Ce,ue):(te&&(group_outros(),transition_out(we[Pe],1,1,()=>{we[Pe]=null}),check_outros()),~ee?(te=we[ee],te?te.p(Ce,ue):(te=we[ee]=oe[ee](Ce),te.c()),transition_in(te,1),te.m(Z,null)):te=null),ue&32&&le.value!==Ce[5]&&set_input_value(le,Ce[5]),Ce[0]==="text"?ve?ve.p(Ce,ue):(ve=create_if_block$k(Ce),ve.c(),ve.m(ae,null)):ve&&(ve.d(1),ve=null)},i(Ce){de||(transition_in(te),de=!0)},o(Ce){transition_out(te),de=!1},d(Ce){Ce&&detach(_),~ee&&we[ee].d(),ve&&ve.d(),ge=!1,run_all(fe)}}}function instance$q(q,_,M){let $,j,z;component_subscribe(q,authorKeypair,fe=>M(16,$=fe)),component_subscribe(q,replicaDetails,fe=>M(17,j=fe)),component_subscribe(q,shareKeypair,fe=>M(18,z=fe));let{filetype:V}=_,{xy:G=[0,0]}=_,X,Y="",Q="",Z,ee,te,ne=!0,re=Date.now(),ie=(Date.now()+25488e5)*1e3;const se=createEventDispatcher();async function le(){console.log("xy is: ",[G]);let fe=new Date,oe=new Intl.DateTimeFormat("en-US").format(fe),De=await new Blob([X],{type:"text/markdown"}).arrayBuffer(),ve=new Uint8Array(De),Ce=$.address.slice(1,5);Q?Z="#Title: "+Y+"#Notes: "+Q:Z="#Title: "+Y,G.length>=3&&G[2]>1?ee=`/documents/page${G[2]}/${G[0]}/${G[1]}/${re}/!text-input-by-${Ce}.md`:ee=`/documents/${G[0]}/${G[1]}/${re}/!text-input-by-${Ce}.md`;let ue="Text input by "+$.address.slice(1,5)+" on "+oe+Z,Pe={path:ee,text:ue,attachment:ve};return z.shareAddress.includes("commons")?(Pe.deleteAfter=ie,console.log("added deleteAfter to doc")):ee.includes("!")?Pe.path=ee.replace("!",""):Pe.path=ee,te=await j.replica.set($,Pe),console.log("Result: ",te),isErr(te)&&console.error(te),se("success"),te}function he(fe){console.log("event in Upload.svelte",fe),se("success")}const ce=()=>se("close");function ae(){Y=this.value,M(2,Y)}function de(){X=this.value,M(4,X)}function ge(){Q=this.value,M(5,Q)}return q.$$set=fe=>{"filetype"in fe&&M(0,V=fe.filetype),"xy"in fe&&M(1,G=fe.xy)},q.$$.update=()=>{q.$$.dirty&4&&(Y&&Y.trim()!==""?M(3,ne=!0):M(3,ne=!1)),q.$$.dirty&8&&console.log("isValid",ne),q.$$.dirty&1&&console.log("filetype in Upload.svelte",V),q.$$.dirty&1&&console.log("filetype in Upload.svelte",V)},[V,G,Y,ne,X,Q,se,le,he,ce,ae,de,ge]}class Upload extends SvelteComponent{constructor(_){super(),init(this,_,instance$q,create_fragment$r,safe_not_equal,{filetype:0,xy:1})}}const QUARTER_CYCLE=63936e7,PHASE_DURATION=[QUARTER_CYCLE*3,QUARTER_CYCLE*2,QUARTER_CYCLE*1,0];function calculateLunarPhase(q){let _=0,M=0;q.forEach(j=>{const z=parseInt(j.path.split("/")[2]),V=parseInt(j.path.split("/")[3]);_=Math.max(_,z),M=Math.max(M,V)});let $=Array(M+1);for(let j=0;j<M+1;j++)$[j]=Array(_+1).fill().map(()=>[]);return q.forEach(j=>{const z=parseInt(j.path.split("/")[2]),V=parseInt(j.path.split("/")[3]),G=j.deleteAfter,X=Date.now()*1e3,Y=G-X;let Q;Y>PHASE_DURATION[0]?Q=0:Y>PHASE_DURATION[1]?Q=1:Y>PHASE_DURATION[2]?Q=2:Q=3,$[V][z].push({doc:j,lunarPhase:Q})}),$}function countArtefactsInEachPhase(q){let _=0,M=0,$=0,j=0;return q.forEach(z=>{z.forEach(V=>{V.forEach(G=>{switch(G.lunarPhase){case 0:_++;break;case 1:M++;break;case 2:$++;break;case 3:j++;break}})})}),{artefactsInPhase0:_,artefactsInPhase1:M,artefactsInPhase2:$,artefactsInPhase3:j}}function calculateSingleDocLunarPhase(q){const _=q.deleteAfter,M=Date.now()*1e3,$=_-M;let j;return $>PHASE_DURATION[0]?j=0:$>PHASE_DURATION[1]?j=1:$>PHASE_DURATION[2]?j=2:j=3,{lunarPhase:j,timeToDeletion:$}}function calculateTimeToNextPhase(q,_){return q===3?_:q===2?_-PHASE_DURATION[2]:q===1?_-PHASE_DURATION[1]:_-PHASE_DURATION[0]}const LUNAR_PHASE=[191808e7,127872e7,63936e7,0],COLOR_CYCLE=["#fff5d9","#d3e3d9","#F9DFDD","#CCE9F0"],PHASE_NAME=["spores","emergence","epic","fizz"];function create_if_block$j(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee,te,ne,re,ie,se=q[0].path.split(".")[q[0].path.split(".").length-1]+"",le,he,ce,ae,de,ge=q[0].attachmentSize/1e3+"",fe,oe,we,De,ve,Ce,ue=q[0].path+"",Pe,ze,Le,Me,Ne=q[2]&&create_if_block_2$a(q),Ye=q[5]!==""&&create_if_block_1$f(q);return{c(){_=element("h6"),_.textContent="Artefact metadata",M=space(),$=element("div"),j=element("b"),j.textContent="Title:",z=space(),V=text(q[4]),G=space(),X=element("div"),Y=element("b"),Y.textContent="Location:",Q=space(),Z=text(q[7]),ee=space(),Ne&&Ne.c(),te=space(),ne=element("div"),re=element("b"),re.textContent="File type:",ie=space(),le=text(se),he=space(),ce=element("div"),ae=element("b"),ae.textContent="File size:",de=space(),fe=text(ge),oe=text(" kb"),we=space(),De=element("div"),ve=element("b"),ve.textContent="Path:",Ce=space(),Pe=text(ue),ze=space(),Ye&&Ye.c(),Le=space(),Me=element("div"),attr(_,"class","mb-4"),attr($,"class","pt-2"),attr(X,"class",""),attr(ne,"class",""),attr(ce,"class",""),attr(De,"class","break-words"),attr(Me,"class","py-2")},m(Ie,Oe){insert(Ie,_,Oe),insert(Ie,M,Oe),insert(Ie,$,Oe),append($,j),append($,z),append($,V),insert(Ie,G,Oe),insert(Ie,X,Oe),append(X,Y),append(X,Q),append(X,Z),insert(Ie,ee,Oe),Ne&&Ne.m(Ie,Oe),insert(Ie,te,Oe),insert(Ie,ne,Oe),append(ne,re),append(ne,ie),append(ne,le),insert(Ie,he,Oe),insert(Ie,ce,Oe),append(ce,ae),append(ce,de),append(ce,fe),append(ce,oe),insert(Ie,we,Oe),insert(Ie,De,Oe),append(De,ve),append(De,Ce),append(De,Pe),insert(Ie,ze,Oe),Ye&&Ye.m(Ie,Oe),insert(Ie,Le,Oe),insert(Ie,Me,Oe),Me.innerHTML=q[6]},p(Ie,Oe){Oe&16&&set_data(V,Ie[4]),Oe&128&&set_data(Z,Ie[7]),Ie[2]?Ne?Ne.p(Ie,Oe):(Ne=create_if_block_2$a(Ie),Ne.c(),Ne.m(te.parentNode,te)):Ne&&(Ne.d(1),Ne=null),Oe&1&&se!==(se=Ie[0].path.split(".")[Ie[0].path.split(".").length-1]+"")&&set_data(le,se),Oe&1&&ge!==(ge=Ie[0].attachmentSize/1e3+"")&&set_data(fe,ge),Oe&1&&ue!==(ue=Ie[0].path+"")&&set_data(Pe,ue),Ie[5]!==""?Ye?Ye.p(Ie,Oe):(Ye=create_if_block_1$f(Ie),Ye.c(),Ye.m(Le.parentNode,Le)):Ye&&(Ye.d(1),Ye=null),Oe&64&&(Me.innerHTML=Ie[6])},d(Ie){Ie&&detach(_),Ie&&detach(M),Ie&&detach($),Ie&&detach(G),Ie&&detach(X),Ie&&detach(ee),Ne&&Ne.d(Ie),Ie&&detach(te),Ie&&detach(ne),Ie&&detach(he),Ie&&detach(ce),Ie&&detach(we),Ie&&detach(De),Ie&&detach(ze),Ye&&Ye.d(Ie),Ie&&detach(Le),Ie&&detach(Me)}}}function create_if_block_2$a(q){let _,M,$,j=PHASE_NAME[q[3]]+"",z,V,G,X,Y,Q,Z,ee,te,ne=q[9].days>0&&create_if_block_4$5(q),re=q[9].hours>0&&create_if_block_3$5(q);return{c(){_=element("div"),M=element("b"),M.textContent="Phase:",$=space(),z=text(j),V=space(),G=element("div"),X=element("b"),Y=text("Time to "),Q=text(q[8]),Z=text(":"),ee=space(),ne&&ne.c(),te=space(),re&&re.c(),attr(_,"class","")},m(ie,se){insert(ie,_,se),append(_,M),append(_,$),append(_,z),insert(ie,V,se),insert(ie,G,se),append(G,X),append(X,Y),append(X,Q),append(X,Z),append(G,ee),ne&&ne.m(G,null),append(G,te),re&&re.m(G,null)},p(ie,se){se&8&&j!==(j=PHASE_NAME[ie[3]]+"")&&set_data(z,j),se&256&&set_data(Q,ie[8]),ie[9].days>0?ne?ne.p(ie,se):(ne=create_if_block_4$5(ie),ne.c(),ne.m(G,te)):ne&&(ne.d(1),ne=null),ie[9].hours>0?re?re.p(ie,se):(re=create_if_block_3$5(ie),re.c(),re.m(G,null)):re&&(re.d(1),re=null)},d(ie){ie&&detach(_),ie&&detach(V),ie&&detach(G),ne&&ne.d(),re&&re.d()}}}function create_if_block_4$5(q){let _=q[9].days+"",M,$,j=q[9].days>1?"days":"day",z,V,G,X=q[9].hours>0&&create_if_block_5$3();return{c(){M=text(_),$=space(),z=text(j),V=space(),X&&X.c(),G=empty()},m(Y,Q){insert(Y,M,Q),insert(Y,$,Q),insert(Y,z,Q),insert(Y,V,Q),X&&X.m(Y,Q),insert(Y,G,Q)},p(Y,Q){Q&512&&_!==(_=Y[9].days+"")&&set_data(M,_),Q&512&&j!==(j=Y[9].days>1?"days":"day")&&set_data(z,j),Y[9].hours>0?X||(X=create_if_block_5$3(),X.c(),X.m(G.parentNode,G)):X&&(X.d(1),X=null)},d(Y){Y&&detach(M),Y&&detach($),Y&&detach(z),Y&&detach(V),X&&X.d(Y),Y&&detach(G)}}}function create_if_block_5$3(q){let _;return{c(){_=text("and")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_3$5(q){let _=q[9].hours+"",M,$,j=q[9].hours>1?"hours":"hour",z;return{c(){M=text(_),$=space(),z=text(j)},m(V,G){insert(V,M,G),insert(V,$,G),insert(V,z,G)},p(V,G){G&512&&_!==(_=V[9].hours+"")&&set_data(M,_),G&512&&j!==(j=V[9].hours>1?"hours":"hour")&&set_data(z,j)},d(V){V&&detach(M),V&&detach($),V&&detach(z)}}}function create_if_block_1$f(q){let _,M,$,j;return{c(){_=element("div"),M=element("b"),M.textContent="Note:",$=space(),j=new HtmlTag(!1),j.a=null,attr(_,"class","py-2")},m(z,V){insert(z,_,V),append(_,M),append(_,$),j.m(q[5],_)},p(z,V){V&32&&j.p(z[5])},d(z){z&&detach(_)}}}function create_fragment$q(q){let _,M,$=q[1]&&create_if_block$j(q);return{c(){_=element("div"),M=element("div"),$&&$.c(),attr(_,"class","my-4 text-left")},m(j,z){insert(j,_,z),append(_,M),$&&$.m(M,null)},p(j,[z]){j[1]?$?$.p(j,z):($=create_if_block$j(j),$.c(),$.m(M,null)):$&&($.d(1),$=null)},i:noop,o:noop,d(j){j&&detach(_),$&&$.d()}}}function formatDuration(q){const _=q/1e6,M=Math.floor(_/(3600*24)),$=Math.floor((_-M*3600*24)/3600);return{days:M,hours:$}}function instance$p(q,_,M){let{doc:$}=_,{attachment:j=!0}=_,{isCommons:z=!0}=_,V,G,X,Y,Q,Z,ee,te,ne;onMount(()=>{});let re;return q.$$set=ie=>{"doc"in ie&&M(0,$=ie.doc),"attachment"in ie&&M(1,j=ie.attachment),"isCommons"in ie&&M(2,z=ie.isCommons)},q.$$.update=()=>{if(q.$$.dirty&3081&&$.text!==void 0){M(10,Y=splitTitleAndNotes($.text)),M(4,V=Y.title),M(5,G=Y.notes),M(6,X=Y.preface),M(7,Q=pathToXY($.path));const ie=calculateSingleDocLunarPhase($);M(3,Z=ie.lunarPhase),M(11,ee=ie.timeToDeletion),M(12,te=calculateTimeToNextPhase(Z,ee))}q.$$.dirty&4104&&(M(9,re=formatDuration(te)),M(8,ne=Z===3?"deletion":PHASE_NAME[Z+1]))},[$,j,z,Z,V,G,X,Q,ne,re,Y,ee,te]}class DocDetails extends SvelteComponent{constructor(_){super(),init(this,_,instance$p,create_fragment$q,safe_not_equal,{doc:0,attachment:1,isCommons:2})}}const OrbitingIcons_svelte_svelte_type_style_lang="";function create_fragment$p(q){let _,M,$;return M=new Icon({props:{doc:q[0],phase:q[1]%9,replies:replies$1}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","icon-container svelte-1p6jdr4")},m(j,z){insert(j,_,z),mount_component(M,_,null),q[5](_),$=!0},p(j,[z]){const V={};z&1&&(V.doc=j[0]),z&2&&(V.phase=j[1]%9),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M),q[5](null)}}}let replies$1=!0;function instance$o(q,_,M){let{doc:$}=_,{index:j}=_,{orbitDiameter:z}=_,{disabled:V=!1}=_,G;onMount(()=>{let Y=Math.random()*360;const Q=1.2;function Z(){if(G){Y+=Q;const ee=Y*Math.PI/180,te=z/4-j*19,ne=Math.cos(ee)*te,re=Math.sin(ee)*te;M(2,G.style.transform=`translate(${ne}px, ${re}px)`,G),requestAnimationFrame(Z)}}Z()});function X(Y){binding_callbacks[Y?"unshift":"push"](()=>{G=Y,M(2,G)})}return q.$$set=Y=>{"doc"in Y&&M(0,$=Y.doc),"index"in Y&&M(1,j=Y.index),"orbitDiameter"in Y&&M(3,z=Y.orbitDiameter),"disabled"in Y&&M(4,V=Y.disabled)},[$,j,G,z,V,X]}class OrbitingIcons extends SvelteComponent{constructor(_){super(),init(this,_,instance$o,create_fragment$p,safe_not_equal,{doc:0,index:1,orbitDiameter:3,disabled:4})}}const OrbitingReplies_svelte_svelte_type_style_lang="";function get_each_context$9(q,_,M){const $=q.slice();return $[5]=_[M],$[7]=M,$}function create_each_block$9(q,_){let M,$,j;return $=new OrbitingIcons({props:{doc:_[0],index:_[7],orbitDiameter,disabled:_[1]}}),{key:q,first:null,c(){M=empty(),create_component($.$$.fragment),this.first=M},m(z,V){insert(z,M,V),mount_component($,z,V),j=!0},p(z,V){_=z;const G={};V&1&&(G.doc=_[0]),V&4&&(G.index=_[7]),V&2&&(G.disabled=_[1]),$.$set(G)},i(z){j||(transition_in($.$$.fragment,z),j=!0)},o(z){transition_out($.$$.fragment,z),j=!1},d(z){z&&detach(M),destroy_component($,z)}}}function create_fragment$o(q){let _,M=[],$=new Map,j,z=q[2];const V=G=>G[5].textHash+G[5].timestamp;for(let G=0;G<z.length;G+=1){let X=get_each_context$9(q,z,G),Y=V(X);$.set(Y,M[G]=create_each_block$9(Y,X))}return{c(){_=element("div");for(let G=0;G<M.length;G+=1)M[G].c();attr(_,"id","circle-orbit-container"),set_style(_,"height",orbitDiameter+"px"),set_style(_,"width",orbitDiameter+"px"),attr(_,"class","svelte-10tbmvf"),toggle_class(_,"disabled",q[1])},m(G,X){insert(G,_,X);for(let Y=0;Y<M.length;Y+=1)M[Y]&&M[Y].m(_,null);j=!0},p(G,[X]){X&7&&(z=G[2],group_outros(),M=update_keyed_each(M,X,V,1,G,z,$,_,outro_and_destroy_block,create_each_block$9,null,get_each_context$9),check_outros()),(!j||X&2)&&toggle_class(_,"disabled",G[1])},i(G){if(!j){for(let X=0;X<z.length;X+=1)transition_in(M[X]);j=!0}},o(G){for(let X=0;X<M.length;X+=1)transition_out(M[X]);j=!1},d(G){G&&detach(_);for(let X=0;X<M.length;X+=1)M[X].d()}}}const orbitDiameter=160;function instance$n(q,_,M){let $;component_subscribe(q,cacheDetails,X=>M(3,$=X));let{doc:j=null}=_,{disabled:z=!1}=_,V=[];const G=async()=>{const X=j.path.split("/");X.pop();const Y=X.join("/");let Q=await $.queryDocs({filter:{pathStartsWith:Y}});M(2,V=Q.slice(1))};return onMount(G),q.$$set=X=>{"doc"in X&&M(0,j=X.doc),"disabled"in X&&M(1,z=X.disabled)},q.$$.update=()=>{q.$$.dirty&1&&j&&G()},[j,z,V]}class OrbitingReplies extends SvelteComponent{constructor(_){super(),init(this,_,instance$n,create_fragment$o,safe_not_equal,{doc:0,disabled:1})}}const Tooltip_svelte_svelte_type_style_lang="";function create_if_block$i(q){let _,M;return{c(){_=element("div"),M=text(q[0]),attr(_,"class","tooltiptext svelte-mu2ez3")},m($,j){insert($,_,j),append(_,M)},p($,j){j&1&&set_data(M,$[0])},d($){$&&detach(_)}}}function create_fragment$n(q){let _,M,$,j=q[2]&&create_if_block$i(q);const z=q[4].default,V=create_slot(z,q,q[3],null);return{c(){_=element("div"),j&&j.c(),M=space(),V&&V.c(),attr(_,"class","tooltip svelte-mu2ez3")},m(G,X){insert(G,_,X),j&&j.m(_,null),append(_,M),V&&V.m(_,null),q[5](_),$=!0},p(G,[X]){G[2]?j?j.p(G,X):(j=create_if_block$i(G),j.c(),j.m(_,M)):j&&(j.d(1),j=null),V&&V.p&&(!$||X&8)&&update_slot_base(V,z,G,G[3],$?get_slot_changes(z,G[3],X,null):get_all_dirty_from_scope(G[3]),null)},i(G){$||(transition_in(V,G),$=!0)},o(G){transition_out(V,G),$=!1},d(G){G&&detach(_),j&&j.d(),V&&V.d(G),q[5](null)}}}function instance$m(q,_,M){let{$$slots:$={},$$scope:j}=_,z,{text:V=""}=_,G=!1;onMount(()=>{z.addEventListener("mouseover",()=>{M(2,G=!0)}),z.addEventListener("mouseout",()=>{M(2,G=!1)})});function X(Y){binding_callbacks[Y?"unshift":"push"](()=>{z=Y,M(1,z)})}return q.$$set=Y=>{"text"in Y&&M(0,V=Y.text),"$$scope"in Y&&M(3,j=Y.$$scope)},[V,z,G,j,$,X]}class Tooltip extends SvelteComponent{constructor(_){super(),init(this,_,instance$m,create_fragment$n,safe_not_equal,{text:0})}}const StudioPortal_svelte_svelte_type_style_lang="";function get_each_context$8(q,_,M){const $=q.slice();return $[13]=_[M],$}function create_if_block$h(q){let _,M,$,j,z,V,G=[],X=new Map,Y,Q,Z,ee=q[2]?"commons":"studio",te,ne,re,ie,se,le,he,ce,ae=!q[1]&&create_if_block_3$4(q),de=!q[0]&&create_if_block_1$e(q),ge=q[4];const fe=oe=>oe[13];for(let oe=0;oe<ge.length;oe+=1){let we=get_each_context$8(q,ge,oe),De=fe(we);X.set(De,G[oe]=create_each_block$8(De,we))}return{c(){_=element("div"),M=element("div"),ae&&ae.c(),$=space(),j=element("div"),de&&de.c(),z=space(),V=element("select");for(let oe=0;oe<G.length;oe+=1)G[oe].c();Y=space(),Q=element("button"),Z=text("enter "),te=text(ee),attr(V,"id","share-switcher"),attr(V,"class","form-control truncate ... svelte-z2zcfx"),q[3]===void 0&&add_render_callback(()=>q[9].call(V)),attr(Q,"class",ne="phase1 my-2 "+(q[1]?"w-4/5 ml-4":"w-auto mb-24")),attr(j,"class",re="flex "+(q[1]?"flex-row pb-4":"flex-col w-full pt-8")+" items-start "+(q[0]?"":"items-center justify-center mx-auto")),attr(M,"class",ie="flex "+(q[1]?"flex-row":"flex-col")+" "+(q[0]?"":"items-center justify-center mx-auto")+" max-w-4xl w-full"),attr(_,"class",se="flex "+(q[1]?"flex-row":"flex-col")+" "+(q[0]?"ml-8":"items-center justify-center mt-2 mb-8"))},m(oe,we){insert(oe,_,we),append(_,M),ae&&ae.m(M,null),append(M,$),append(M,j),de&&de.m(j,null),append(j,z),append(j,V);for(let De=0;De<G.length;De+=1)G[De]&&G[De].m(V,null);select_option(V,q[3],!0),append(j,Y),append(j,Q),append(Q,Z),append(Q,te),le=!0,he||(ce=[listen(V,"change",q[9]),listen(V,"change",q[10]),listen(Q,"click",q[6])],he=!0)},p(oe,we){oe[1]?ae&&(group_outros(),transition_out(ae,1,1,()=>{ae=null}),check_outros()):ae?(ae.p(oe,we),we&2&&transition_in(ae,1)):(ae=create_if_block_3$4(oe),ae.c(),transition_in(ae,1),ae.m(M,$)),oe[0]?de&&(de.d(1),de=null):de?de.p(oe,we):(de=create_if_block_1$e(oe),de.c(),de.m(j,z)),we&16&&(ge=oe[4],G=update_keyed_each(G,we,fe,1,oe,ge,X,V,destroy_block,create_each_block$8,null,get_each_context$8)),we&24&&select_option(V,oe[3]),(!le||we&4)&&ee!==(ee=oe[2]?"commons":"studio")&&set_data(te,ee),(!le||we&2&&ne!==(ne="phase1 my-2 "+(oe[1]?"w-4/5 ml-4":"w-auto mb-24")))&&attr(Q,"class",ne),(!le||we&3&&re!==(re="flex "+(oe[1]?"flex-row pb-4":"flex-col w-full pt-8")+" items-start "+(oe[0]?"":"items-center justify-center mx-auto")))&&attr(j,"class",re),(!le||we&3&&ie!==(ie="flex "+(oe[1]?"flex-row":"flex-col")+" "+(oe[0]?"":"items-center justify-center mx-auto")+" max-w-4xl w-full"))&&attr(M,"class",ie),(!le||we&3&&se!==(se="flex "+(oe[1]?"flex-row":"flex-col")+" "+(oe[0]?"ml-8":"items-center justify-center mt-2 mb-8")))&&attr(_,"class",se)},i(oe){le||(transition_in(ae),le=!0)},o(oe){transition_out(ae),le=!1},d(oe){oe&&detach(_),ae&&ae.d(),de&&de.d();for(let we=0;we<G.length;we+=1)G[we].d();he=!1,run_all(ce)}}}function create_if_block_3$4(q){let _,M;return _=new Tooltip({props:{text:"You can choose from any studio you saved in your settings. Settings can be accessed in the server customization in the top left corner and then under 'workspace settings'.",$$slots:{default:[create_default_slot$4]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&65537&&(z.$$scope={dirty:j,ctx:$}),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_else_block_1$1(q){let _;return{c(){_=element("p"),_.textContent="proceed to the studio to place your artefact.",attr(_,"class","text-left my-4 svelte-z2zcfx")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_4$4(q){let _;return{c(){_=element("p"),_.textContent="You have reached the Beginning of Studio portals.",attr(_,"class","mt-8 svelte-z2zcfx")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_default_slot$4(q){let _;function M(z,V){return z[0]?create_else_block_1$1:create_if_block_4$4}let $=M(q),j=$(q);return{c(){j.c(),_=empty()},m(z,V){j.m(z,V),insert(z,_,V)},p(z,V){$!==($=M(z))&&(j.d(1),j=$(z),j&&(j.c(),j.m(_.parentNode,_)))},d(z){j.d(z),z&&detach(_)}}}function create_if_block_1$e(q){let _,M;function $(V,G){return V[2]?create_if_block_2$9:create_else_block$7}let j=$(q),z=j(q);return{c(){_=element("label"),z.c(),attr(_,"for","share-switcher"),attr(_,"class",M="text-left "+(q[1]?"w-full":"w-auto mb-4")+" svelte-z2zcfx")},m(V,G){insert(V,_,G),z.m(_,null)},p(V,G){j!==(j=$(V))&&(z.d(1),z=j(V),z&&(z.c(),z.m(_,null))),G&2&&M!==(M="text-left "+(V[1]?"w-full":"w-auto mb-4")+" svelte-z2zcfx")&&attr(_,"class",M)},d(V){V&&detach(_),z.d()}}}function create_else_block$7(q){let _;return{c(){_=element("p"),_.textContent="Choose the Studio you want to enter:",attr(_,"class","svelte-z2zcfx")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_2$9(q){let _;return{c(){_=element("p"),_.textContent="You can travel to an alternative commons",attr(_,"class","svelte-z2zcfx")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_each_block$8(q,_){let M,$=_[13]+"",j,z;return{key:q,first:null,c(){M=element("option"),j=text($),M.__value=z=_[13],M.value=M.__value,this.first=M},m(V,G){insert(V,M,G),append(M,j)},p(V,G){_=V,G&16&&$!==($=_[13]+"")&&set_data(j,$),G&16&&z!==(z=_[13])&&(M.__value=z,M.value=M.__value)},d(V){V&&detach(M)}}}function create_fragment$m(q){let _,M,$=q[5]&&create_if_block$h(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,[z]){j[5]?$?($.p(j,z),z&32&&transition_in($,1)):($=create_if_block$h(j),$.c(),transition_in($,1),$.m(_.parentNode,_)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros())},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function instance$l(q,_,M){const $=createEventDispatcher();let j;const z="+commons.buxxyxhoa3uxpanzrb6ki7btpzvkm5cf7brjptev3bmim3rk77hbq";let{noArtefacts:V=!1}=_,{topOfCommons:G=!1}=_,{commons:X=!1}=_;function Y(){const ie=j,se=settings.shareSecrets[ie];shareKeypair.set({shareAddress:ie,secret:se}),$("shareUpdated")}let Q=[],Z=[],ee=[],te=!0;studioShares.subscribe(ie=>{M(7,Q=[...ie])}),commonsShares.subscribe(ie=>{M(8,Z=[...ie]),X&&(Z.length>1||Z.length===1&&Z[0]!==z?M(5,te=!0):M(5,te=!1))}),onMount(()=>{ee.length>0&&M(3,j=ee[0])});function ne(){j=select_value(this),M(3,j),M(4,ee),M(2,X),M(8,Z),M(7,Q)}const re=ie=>{M(3,j=ie.target.value)};return q.$$set=ie=>{"noArtefacts"in ie&&M(0,V=ie.noArtefacts),"topOfCommons"in ie&&M(1,G=ie.topOfCommons),"commons"in ie&&M(2,X=ie.commons)},q.$$.update=()=>{q.$$.dirty&388&&(X?M(4,ee=Z):M(4,ee=Q))},[V,G,X,j,ee,te,Y,Q,Z,ne,re]}class StudioPortal extends SvelteComponent{constructor(_){super(),init(this,_,instance$l,create_fragment$m,safe_not_equal,{noArtefacts:0,topOfCommons:1,commons:2})}}function get_each_context$7(q,_,M){const $=q.slice();return $[2]=_[M],$[4]=M,$}function create_if_block$g(q){let _,M=q[1].length,$,j=create_key_block$1(q);return{c(){_=element("div"),j.c()},m(z,V){insert(z,_,V),j.m(_,null),$=!0},p(z,V){V&2&&safe_not_equal(M,M=z[1].length)?(group_outros(),transition_out(j,1,1,noop),check_outros(),j=create_key_block$1(z),j.c(),transition_in(j,1),j.m(_,null)):j.p(z,V)},i(z){$||(transition_in(j),$=!0)},o(z){transition_out(j),$=!1},d(z){z&&detach(_),j.d(z)}}}function create_else_block$6(q){let _,M=q[2]+"",$;return{c(){_=element("p"),$=text(M)},m(j,z){insert(j,_,z),append(_,$)},p(j,z){z&2&&M!==(M=j[2]+"")&&set_data($,M)},i:noop,o:noop,d(j){j&&detach(_)}}}function create_if_block_1$d(q){let _,M;return _=new Tooltip({props:{text:q[2],$$slots:{default:[create_default_slot$3]},$$scope:{ctx:q}}}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j&2&&(z.text=$[2]),j&34&&(z.$$scope={dirty:j,ctx:$}),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_default_slot$3(q){let _,M=q[2]+"",$;return{c(){_=element("p"),$=text(M),attr(_,"class","truncate ... w-full")},m(j,z){insert(j,_,z),append(_,$)},p(j,z){z&2&&M!==(M=j[2]+"")&&set_data($,M)},d(j){j&&detach(_)}}}function create_each_block$7(q,_){let M,$,j,z,V;const G=[create_if_block_1$d,create_else_block$6],X=[];function Y(Q,Z){return Q[0]?0:1}return $=Y(_),j=X[$]=G[$](_),{key:q,first:null,c(){M=element("div"),j.c(),z=space(),attr(M,"class","text-left"),this.first=M},m(Q,Z){insert(Q,M,Z),X[$].m(M,null),append(M,z),V=!0},p(Q,Z){_=Q;let ee=$;$=Y(_),$===ee?X[$].p(_,Z):(group_outros(),transition_out(X[ee],1,1,()=>{X[ee]=null}),check_outros(),j=X[$],j?j.p(_,Z):(j=X[$]=G[$](_),j.c()),transition_in(j,1),j.m(M,z))},i(Q){V||(transition_in(j),V=!0)},o(Q){transition_out(j),V=!1},d(Q){Q&&detach(M),X[$].d()}}}function create_key_block$1(q){let _,M=[],$=new Map,j,z=q[1];const V=G=>G[4];for(let G=0;G<z.length;G+=1){let X=get_each_context$7(q,z,G),Y=V(X);$.set(Y,M[G]=create_each_block$7(Y,X))}return{c(){_=element("div");for(let G=0;G<M.length;G+=1)M[G].c();attr(_,"class","ml-0")},m(G,X){insert(G,_,X);for(let Y=0;Y<M.length;Y+=1)M[Y]&&M[Y].m(_,null);j=!0},p(G,X){X&3&&(z=G[1],group_outros(),M=update_keyed_each(M,X,V,1,G,z,$,_,outro_and_destroy_block,create_each_block$7,null,get_each_context$7),check_outros())},i(G){if(!j){for(let X=0;X<z.length;X+=1)transition_in(M[X]);j=!0}},o(G){for(let X=0;X<M.length;X+=1)transition_out(M[X]);j=!1},d(G){G&&detach(_);for(let X=0;X<M.length;X+=1)M[X].d()}}}function create_fragment$l(q){let _,M,$=q[1].length>0&&create_if_block$g(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,[z]){j[1].length>0?$?($.p(j,z),z&2&&transition_in($,1)):($=create_if_block$g(j),$.c(),transition_in($,1),$.m(_.parentNode,_)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros())},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function instance$k(q,_,M){let $;component_subscribe(q,servers,z=>M(1,$=z));let{truncate:j=!1}=_;return q.$$set=z=>{"truncate"in z&&M(0,j=z.truncate)},[j,$]}class ServerList extends SvelteComponent{constructor(_){super(),init(this,_,instance$k,create_fragment$l,safe_not_equal,{truncate:0})}}var jszip_min={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(q,_){(function(M){q.exports=M()})(function(){return function M($,j,z){function V(Y,Q){if(!j[Y]){if(!$[Y]){var Z=typeof commonjsRequire=="function"&&commonjsRequire;if(!Q&&Z)return Z(Y,!0);if(G)return G(Y,!0);var ee=new Error("Cannot find module '"+Y+"'");throw ee.code="MODULE_NOT_FOUND",ee}var te=j[Y]={exports:{}};$[Y][0].call(te.exports,function(ne){var re=$[Y][1][ne];return V(re||ne)},te,te.exports,M,$,j,z)}return j[Y].exports}for(var G=typeof commonjsRequire=="function"&&commonjsRequire,X=0;X<z.length;X++)V(z[X]);return V}({1:[function(M,$,j){var z=M("./utils"),V=M("./support"),G="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";j.encode=function(X){for(var Y,Q,Z,ee,te,ne,re,ie=[],se=0,le=X.length,he=le,ce=z.getTypeOf(X)!=="string";se<X.length;)he=le-se,Z=ce?(Y=X[se++],Q=se<le?X[se++]:0,se<le?X[se++]:0):(Y=X.charCodeAt(se++),Q=se<le?X.charCodeAt(se++):0,se<le?X.charCodeAt(se++):0),ee=Y>>2,te=(3&Y)<<4|Q>>4,ne=1<he?(15&Q)<<2|Z>>6:64,re=2<he?63&Z:64,ie.push(G.charAt(ee)+G.charAt(te)+G.charAt(ne)+G.charAt(re));return ie.join("")},j.decode=function(X){var Y,Q,Z,ee,te,ne,re=0,ie=0,se="data:";if(X.substr(0,se.length)===se)throw new Error("Invalid base64 input, it looks like a data url.");var le,he=3*(X=X.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(X.charAt(X.length-1)===G.charAt(64)&&he--,X.charAt(X.length-2)===G.charAt(64)&&he--,he%1!=0)throw new Error("Invalid base64 input, bad content length.");for(le=V.uint8array?new Uint8Array(0|he):new Array(0|he);re<X.length;)Y=G.indexOf(X.charAt(re++))<<2|(ee=G.indexOf(X.charAt(re++)))>>4,Q=(15&ee)<<4|(te=G.indexOf(X.charAt(re++)))>>2,Z=(3&te)<<6|(ne=G.indexOf(X.charAt(re++))),le[ie++]=Y,te!==64&&(le[ie++]=Q),ne!==64&&(le[ie++]=Z);return le}},{"./support":30,"./utils":32}],2:[function(M,$,j){var z=M("./external"),V=M("./stream/DataWorker"),G=M("./stream/Crc32Probe"),X=M("./stream/DataLengthProbe");function Y(Q,Z,ee,te,ne){this.compressedSize=Q,this.uncompressedSize=Z,this.crc32=ee,this.compression=te,this.compressedContent=ne}Y.prototype={getContentWorker:function(){var Q=new V(z.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new X("data_length")),Z=this;return Q.on("end",function(){if(this.streamInfo.data_length!==Z.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),Q},getCompressedWorker:function(){return new V(z.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},Y.createWorkerFrom=function(Q,Z,ee){return Q.pipe(new G).pipe(new X("uncompressedSize")).pipe(Z.compressWorker(ee)).pipe(new X("compressedSize")).withStreamInfo("compression",Z)},$.exports=Y},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(M,$,j){var z=M("./stream/GenericWorker");j.STORE={magic:"\0\0",compressWorker:function(){return new z("STORE compression")},uncompressWorker:function(){return new z("STORE decompression")}},j.DEFLATE=M("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(M,$,j){var z=M("./utils"),V=function(){for(var G,X=[],Y=0;Y<256;Y++){G=Y;for(var Q=0;Q<8;Q++)G=1&G?3988292384^G>>>1:G>>>1;X[Y]=G}return X}();$.exports=function(G,X){return G!==void 0&&G.length?z.getTypeOf(G)!=="string"?function(Y,Q,Z,ee){var te=V,ne=ee+Z;Y^=-1;for(var re=ee;re<ne;re++)Y=Y>>>8^te[255&(Y^Q[re])];return-1^Y}(0|X,G,G.length,0):function(Y,Q,Z,ee){var te=V,ne=ee+Z;Y^=-1;for(var re=ee;re<ne;re++)Y=Y>>>8^te[255&(Y^Q.charCodeAt(re))];return-1^Y}(0|X,G,G.length,0):0}},{"./utils":32}],5:[function(M,$,j){j.base64=!1,j.binary=!1,j.dir=!1,j.createFolders=!0,j.date=null,j.compression=null,j.compressionOptions=null,j.comment=null,j.unixPermissions=null,j.dosPermissions=null},{}],6:[function(M,$,j){var z=null;z=typeof Promise<"u"?Promise:M("lie"),$.exports={Promise:z}},{lie:37}],7:[function(M,$,j){var z=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",V=M("pako"),G=M("./utils"),X=M("./stream/GenericWorker"),Y=z?"uint8array":"array";function Q(Z,ee){X.call(this,"FlateWorker/"+Z),this._pako=null,this._pakoAction=Z,this._pakoOptions=ee,this.meta={}}j.magic="\b\0",G.inherits(Q,X),Q.prototype.processChunk=function(Z){this.meta=Z.meta,this._pako===null&&this._createPako(),this._pako.push(G.transformTo(Y,Z.data),!1)},Q.prototype.flush=function(){X.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},Q.prototype.cleanUp=function(){X.prototype.cleanUp.call(this),this._pako=null},Q.prototype._createPako=function(){this._pako=new V[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var Z=this;this._pako.onData=function(ee){Z.push({data:ee,meta:Z.meta})}},j.compressWorker=function(Z){return new Q("Deflate",Z)},j.uncompressWorker=function(){return new Q("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(M,$,j){function z(te,ne){var re,ie="";for(re=0;re<ne;re++)ie+=String.fromCharCode(255&te),te>>>=8;return ie}function V(te,ne,re,ie,se,le){var he,ce,ae=te.file,de=te.compression,ge=le!==Y.utf8encode,fe=G.transformTo("string",le(ae.name)),oe=G.transformTo("string",Y.utf8encode(ae.name)),we=ae.comment,De=G.transformTo("string",le(we)),ve=G.transformTo("string",Y.utf8encode(we)),Ce=oe.length!==ae.name.length,ue=ve.length!==we.length,Pe="",ze="",Le="",Me=ae.dir,Ne=ae.date,Ye={crc32:0,compressedSize:0,uncompressedSize:0};ne&&!re||(Ye.crc32=te.crc32,Ye.compressedSize=te.compressedSize,Ye.uncompressedSize=te.uncompressedSize);var Ie=0;ne&&(Ie|=8),ge||!Ce&&!ue||(Ie|=2048);var Oe=0,Se=0;Me&&(Oe|=16),se==="UNIX"?(Se=798,Oe|=function(me,be){var Ee=me;return me||(Ee=be?16893:33204),(65535&Ee)<<16}(ae.unixPermissions,Me)):(Se=20,Oe|=function(me){return 63&(me||0)}(ae.dosPermissions)),he=Ne.getUTCHours(),he<<=6,he|=Ne.getUTCMinutes(),he<<=5,he|=Ne.getUTCSeconds()/2,ce=Ne.getUTCFullYear()-1980,ce<<=4,ce|=Ne.getUTCMonth()+1,ce<<=5,ce|=Ne.getUTCDate(),Ce&&(ze=z(1,1)+z(Q(fe),4)+oe,Pe+="up"+z(ze.length,2)+ze),ue&&(Le=z(1,1)+z(Q(De),4)+ve,Pe+="uc"+z(Le.length,2)+Le);var pe="";return pe+=`
\0`,pe+=z(Ie,2),pe+=de.magic,pe+=z(he,2),pe+=z(ce,2),pe+=z(Ye.crc32,4),pe+=z(Ye.compressedSize,4),pe+=z(Ye.uncompressedSize,4),pe+=z(fe.length,2),pe+=z(Pe.length,2),{fileRecord:Z.LOCAL_FILE_HEADER+pe+fe+Pe,dirRecord:Z.CENTRAL_FILE_HEADER+z(Se,2)+pe+z(De.length,2)+"\0\0\0\0"+z(Oe,4)+z(ie,4)+fe+Pe+De}}var G=M("../utils"),X=M("../stream/GenericWorker"),Y=M("../utf8"),Q=M("../crc32"),Z=M("../signature");function ee(te,ne,re,ie){X.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=ne,this.zipPlatform=re,this.encodeFileName=ie,this.streamFiles=te,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}G.inherits(ee,X),ee.prototype.push=function(te){var ne=te.meta.percent||0,re=this.entriesCount,ie=this._sources.length;this.accumulate?this.contentBuffer.push(te):(this.bytesWritten+=te.data.length,X.prototype.push.call(this,{data:te.data,meta:{currentFile:this.currentFile,percent:re?(ne+100*(re-ie-1))/re:100}}))},ee.prototype.openedSource=function(te){this.currentSourceOffset=this.bytesWritten,this.currentFile=te.file.name;var ne=this.streamFiles&&!te.file.dir;if(ne){var re=V(te,ne,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:re.fileRecord,meta:{percent:0}})}else this.accumulate=!0},ee.prototype.closedSource=function(te){this.accumulate=!1;var ne=this.streamFiles&&!te.file.dir,re=V(te,ne,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(re.dirRecord),ne)this.push({data:function(ie){return Z.DATA_DESCRIPTOR+z(ie.crc32,4)+z(ie.compressedSize,4)+z(ie.uncompressedSize,4)}(te),meta:{percent:100}});else for(this.push({data:re.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},ee.prototype.flush=function(){for(var te=this.bytesWritten,ne=0;ne<this.dirRecords.length;ne++)this.push({data:this.dirRecords[ne],meta:{percent:100}});var re=this.bytesWritten-te,ie=function(se,le,he,ce,ae){var de=G.transformTo("string",ae(ce));return Z.CENTRAL_DIRECTORY_END+"\0\0\0\0"+z(se,2)+z(se,2)+z(le,4)+z(he,4)+z(de.length,2)+de}(this.dirRecords.length,re,te,this.zipComment,this.encodeFileName);this.push({data:ie,meta:{percent:100}})},ee.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},ee.prototype.registerPrevious=function(te){this._sources.push(te);var ne=this;return te.on("data",function(re){ne.processChunk(re)}),te.on("end",function(){ne.closedSource(ne.previous.streamInfo),ne._sources.length?ne.prepareNextSource():ne.end()}),te.on("error",function(re){ne.error(re)}),this},ee.prototype.resume=function(){return!!X.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},ee.prototype.error=function(te){var ne=this._sources;if(!X.prototype.error.call(this,te))return!1;for(var re=0;re<ne.length;re++)try{ne[re].error(te)}catch{}return!0},ee.prototype.lock=function(){X.prototype.lock.call(this);for(var te=this._sources,ne=0;ne<te.length;ne++)te[ne].lock()},$.exports=ee},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(M,$,j){var z=M("../compressions"),V=M("./ZipFileWorker");j.generateWorker=function(G,X,Y){var Q=new V(X.streamFiles,Y,X.platform,X.encodeFileName),Z=0;try{G.forEach(function(ee,te){Z++;var ne=function(le,he){var ce=le||he,ae=z[ce];if(!ae)throw new Error(ce+" is not a valid compression method !");return ae}(te.options.compression,X.compression),re=te.options.compressionOptions||X.compressionOptions||{},ie=te.dir,se=te.date;te._compressWorker(ne,re).withStreamInfo("file",{name:ee,dir:ie,date:se,comment:te.comment||"",unixPermissions:te.unixPermissions,dosPermissions:te.dosPermissions}).pipe(Q)}),Q.entriesCount=Z}catch(ee){Q.error(ee)}return Q}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(M,$,j){function z(){if(!(this instanceof z))return new z;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var V=new z;for(var G in this)typeof this[G]!="function"&&(V[G]=this[G]);return V}}(z.prototype=M("./object")).loadAsync=M("./load"),z.support=M("./support"),z.defaults=M("./defaults"),z.version="3.10.1",z.loadAsync=function(V,G){return new z().loadAsync(V,G)},z.external=M("./external"),$.exports=z},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(M,$,j){var z=M("./utils"),V=M("./external"),G=M("./utf8"),X=M("./zipEntries"),Y=M("./stream/Crc32Probe"),Q=M("./nodejsUtils");function Z(ee){return new V.Promise(function(te,ne){var re=ee.decompressed.getContentWorker().pipe(new Y);re.on("error",function(ie){ne(ie)}).on("end",function(){re.streamInfo.crc32!==ee.decompressed.crc32?ne(new Error("Corrupted zip : CRC32 mismatch")):te()}).resume()})}$.exports=function(ee,te){var ne=this;return te=z.extend(te||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:G.utf8decode}),Q.isNode&&Q.isStream(ee)?V.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):z.prepareContent("the loaded zip file",ee,!0,te.optimizedBinaryString,te.base64).then(function(re){var ie=new X(te);return ie.load(re),ie}).then(function(re){var ie=[V.Promise.resolve(re)],se=re.files;if(te.checkCRC32)for(var le=0;le<se.length;le++)ie.push(Z(se[le]));return V.Promise.all(ie)}).then(function(re){for(var ie=re.shift(),se=ie.files,le=0;le<se.length;le++){var he=se[le],ce=he.fileNameStr,ae=z.resolve(he.fileNameStr);ne.file(ae,he.decompressed,{binary:!0,optimizedBinaryString:!0,date:he.date,dir:he.dir,comment:he.fileCommentStr.length?he.fileCommentStr:null,unixPermissions:he.unixPermissions,dosPermissions:he.dosPermissions,createFolders:te.createFolders}),he.dir||(ne.file(ae).unsafeOriginalName=ce)}return ie.zipComment.length&&(ne.comment=ie.zipComment),ne})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(M,$,j){var z=M("../utils"),V=M("../stream/GenericWorker");function G(X,Y){V.call(this,"Nodejs stream input adapter for "+X),this._upstreamEnded=!1,this._bindStream(Y)}z.inherits(G,V),G.prototype._bindStream=function(X){var Y=this;(this._stream=X).pause(),X.on("data",function(Q){Y.push({data:Q,meta:{percent:0}})}).on("error",function(Q){Y.isPaused?this.generatedError=Q:Y.error(Q)}).on("end",function(){Y.isPaused?Y._upstreamEnded=!0:Y.end()})},G.prototype.pause=function(){return!!V.prototype.pause.call(this)&&(this._stream.pause(),!0)},G.prototype.resume=function(){return!!V.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},$.exports=G},{"../stream/GenericWorker":28,"../utils":32}],13:[function(M,$,j){var z=M("readable-stream").Readable;function V(G,X,Y){z.call(this,X),this._helper=G;var Q=this;G.on("data",function(Z,ee){Q.push(Z)||Q._helper.pause(),Y&&Y(ee)}).on("error",function(Z){Q.emit("error",Z)}).on("end",function(){Q.push(null)})}M("../utils").inherits(V,z),V.prototype._read=function(){this._helper.resume()},$.exports=V},{"../utils":32,"readable-stream":16}],14:[function(M,$,j){$.exports={isNode:typeof Buffer<"u",newBufferFrom:function(z,V){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(z,V);if(typeof z=="number")throw new Error('The "data" argument must not be a number');return new Buffer(z,V)},allocBuffer:function(z){if(Buffer.alloc)return Buffer.alloc(z);var V=new Buffer(z);return V.fill(0),V},isBuffer:function(z){return Buffer.isBuffer(z)},isStream:function(z){return z&&typeof z.on=="function"&&typeof z.pause=="function"&&typeof z.resume=="function"}}},{}],15:[function(M,$,j){function z(ae,de,ge){var fe,oe=G.getTypeOf(de),we=G.extend(ge||{},Q);we.date=we.date||new Date,we.compression!==null&&(we.compression=we.compression.toUpperCase()),typeof we.unixPermissions=="string"&&(we.unixPermissions=parseInt(we.unixPermissions,8)),we.unixPermissions&&16384&we.unixPermissions&&(we.dir=!0),we.dosPermissions&&16&we.dosPermissions&&(we.dir=!0),we.dir&&(ae=se(ae)),we.createFolders&&(fe=ie(ae))&&le.call(this,fe,!0);var De=oe==="string"&&we.binary===!1&&we.base64===!1;ge&&ge.binary!==void 0||(we.binary=!De),(de instanceof Z&&de.uncompressedSize===0||we.dir||!de||de.length===0)&&(we.base64=!1,we.binary=!0,de="",we.compression="STORE",oe="string");var ve=null;ve=de instanceof Z||de instanceof X?de:ne.isNode&&ne.isStream(de)?new re(ae,de):G.prepareContent(ae,de,we.binary,we.optimizedBinaryString,we.base64);var Ce=new ee(ae,ve,we);this.files[ae]=Ce}var V=M("./utf8"),G=M("./utils"),X=M("./stream/GenericWorker"),Y=M("./stream/StreamHelper"),Q=M("./defaults"),Z=M("./compressedObject"),ee=M("./zipObject"),te=M("./generate"),ne=M("./nodejsUtils"),re=M("./nodejs/NodejsStreamInputAdapter"),ie=function(ae){ae.slice(-1)==="/"&&(ae=ae.substring(0,ae.length-1));var de=ae.lastIndexOf("/");return 0<de?ae.substring(0,de):""},se=function(ae){return ae.slice(-1)!=="/"&&(ae+="/"),ae},le=function(ae,de){return de=de!==void 0?de:Q.createFolders,ae=se(ae),this.files[ae]||z.call(this,ae,null,{dir:!0,createFolders:de}),this.files[ae]};function he(ae){return Object.prototype.toString.call(ae)==="[object RegExp]"}var ce={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(ae){var de,ge,fe;for(de in this.files)fe=this.files[de],(ge=de.slice(this.root.length,de.length))&&de.slice(0,this.root.length)===this.root&&ae(ge,fe)},filter:function(ae){var de=[];return this.forEach(function(ge,fe){ae(ge,fe)&&de.push(fe)}),de},file:function(ae,de,ge){if(arguments.length!==1)return ae=this.root+ae,z.call(this,ae,de,ge),this;if(he(ae)){var fe=ae;return this.filter(function(we,De){return!De.dir&&fe.test(we)})}var oe=this.files[this.root+ae];return oe&&!oe.dir?oe:null},folder:function(ae){if(!ae)return this;if(he(ae))return this.filter(function(oe,we){return we.dir&&ae.test(oe)});var de=this.root+ae,ge=le.call(this,de),fe=this.clone();return fe.root=ge.name,fe},remove:function(ae){ae=this.root+ae;var de=this.files[ae];if(de||(ae.slice(-1)!=="/"&&(ae+="/"),de=this.files[ae]),de&&!de.dir)delete this.files[ae];else for(var ge=this.filter(function(oe,we){return we.name.slice(0,ae.length)===ae}),fe=0;fe<ge.length;fe++)delete this.files[ge[fe].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(ae){var de,ge={};try{if((ge=G.extend(ae||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:V.utf8encode})).type=ge.type.toLowerCase(),ge.compression=ge.compression.toUpperCase(),ge.type==="binarystring"&&(ge.type="string"),!ge.type)throw new Error("No output type specified.");G.checkSupport(ge.type),ge.platform!=="darwin"&&ge.platform!=="freebsd"&&ge.platform!=="linux"&&ge.platform!=="sunos"||(ge.platform="UNIX"),ge.platform==="win32"&&(ge.platform="DOS");var fe=ge.comment||this.comment||"";de=te.generateWorker(this,ge,fe)}catch(oe){(de=new X("error")).error(oe)}return new Y(de,ge.type||"string",ge.mimeType)},generateAsync:function(ae,de){return this.generateInternalStream(ae).accumulate(de)},generateNodeStream:function(ae,de){return(ae=ae||{}).type||(ae.type="nodebuffer"),this.generateInternalStream(ae).toNodejsStream(de)}};$.exports=ce},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(M,$,j){$.exports=M("stream")},{stream:void 0}],17:[function(M,$,j){var z=M("./DataReader");function V(G){z.call(this,G);for(var X=0;X<this.data.length;X++)G[X]=255&G[X]}M("../utils").inherits(V,z),V.prototype.byteAt=function(G){return this.data[this.zero+G]},V.prototype.lastIndexOfSignature=function(G){for(var X=G.charCodeAt(0),Y=G.charCodeAt(1),Q=G.charCodeAt(2),Z=G.charCodeAt(3),ee=this.length-4;0<=ee;--ee)if(this.data[ee]===X&&this.data[ee+1]===Y&&this.data[ee+2]===Q&&this.data[ee+3]===Z)return ee-this.zero;return-1},V.prototype.readAndCheckSignature=function(G){var X=G.charCodeAt(0),Y=G.charCodeAt(1),Q=G.charCodeAt(2),Z=G.charCodeAt(3),ee=this.readData(4);return X===ee[0]&&Y===ee[1]&&Q===ee[2]&&Z===ee[3]},V.prototype.readData=function(G){if(this.checkOffset(G),G===0)return[];var X=this.data.slice(this.zero+this.index,this.zero+this.index+G);return this.index+=G,X},$.exports=V},{"../utils":32,"./DataReader":18}],18:[function(M,$,j){var z=M("../utils");function V(G){this.data=G,this.length=G.length,this.index=0,this.zero=0}V.prototype={checkOffset:function(G){this.checkIndex(this.index+G)},checkIndex:function(G){if(this.length<this.zero+G||G<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+G+"). Corrupted zip ?")},setIndex:function(G){this.checkIndex(G),this.index=G},skip:function(G){this.setIndex(this.index+G)},byteAt:function(){},readInt:function(G){var X,Y=0;for(this.checkOffset(G),X=this.index+G-1;X>=this.index;X--)Y=(Y<<8)+this.byteAt(X);return this.index+=G,Y},readString:function(G){return z.transformTo("string",this.readData(G))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var G=this.readInt(4);return new Date(Date.UTC(1980+(G>>25&127),(G>>21&15)-1,G>>16&31,G>>11&31,G>>5&63,(31&G)<<1))}},$.exports=V},{"../utils":32}],19:[function(M,$,j){var z=M("./Uint8ArrayReader");function V(G){z.call(this,G)}M("../utils").inherits(V,z),V.prototype.readData=function(G){this.checkOffset(G);var X=this.data.slice(this.zero+this.index,this.zero+this.index+G);return this.index+=G,X},$.exports=V},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(M,$,j){var z=M("./DataReader");function V(G){z.call(this,G)}M("../utils").inherits(V,z),V.prototype.byteAt=function(G){return this.data.charCodeAt(this.zero+G)},V.prototype.lastIndexOfSignature=function(G){return this.data.lastIndexOf(G)-this.zero},V.prototype.readAndCheckSignature=function(G){return G===this.readData(4)},V.prototype.readData=function(G){this.checkOffset(G);var X=this.data.slice(this.zero+this.index,this.zero+this.index+G);return this.index+=G,X},$.exports=V},{"../utils":32,"./DataReader":18}],21:[function(M,$,j){var z=M("./ArrayReader");function V(G){z.call(this,G)}M("../utils").inherits(V,z),V.prototype.readData=function(G){if(this.checkOffset(G),G===0)return new Uint8Array(0);var X=this.data.subarray(this.zero+this.index,this.zero+this.index+G);return this.index+=G,X},$.exports=V},{"../utils":32,"./ArrayReader":17}],22:[function(M,$,j){var z=M("../utils"),V=M("../support"),G=M("./ArrayReader"),X=M("./StringReader"),Y=M("./NodeBufferReader"),Q=M("./Uint8ArrayReader");$.exports=function(Z){var ee=z.getTypeOf(Z);return z.checkSupport(ee),ee!=="string"||V.uint8array?ee==="nodebuffer"?new Y(Z):V.uint8array?new Q(z.transformTo("uint8array",Z)):new G(z.transformTo("array",Z)):new X(Z)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(M,$,j){j.LOCAL_FILE_HEADER="PK",j.CENTRAL_FILE_HEADER="PK",j.CENTRAL_DIRECTORY_END="PK",j.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",j.ZIP64_CENTRAL_DIRECTORY_END="PK",j.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(M,$,j){var z=M("./GenericWorker"),V=M("../utils");function G(X){z.call(this,"ConvertWorker to "+X),this.destType=X}V.inherits(G,z),G.prototype.processChunk=function(X){this.push({data:V.transformTo(this.destType,X.data),meta:X.meta})},$.exports=G},{"../utils":32,"./GenericWorker":28}],25:[function(M,$,j){var z=M("./GenericWorker"),V=M("../crc32");function G(){z.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}M("../utils").inherits(G,z),G.prototype.processChunk=function(X){this.streamInfo.crc32=V(X.data,this.streamInfo.crc32||0),this.push(X)},$.exports=G},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(M,$,j){var z=M("../utils"),V=M("./GenericWorker");function G(X){V.call(this,"DataLengthProbe for "+X),this.propName=X,this.withStreamInfo(X,0)}z.inherits(G,V),G.prototype.processChunk=function(X){if(X){var Y=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=Y+X.data.length}V.prototype.processChunk.call(this,X)},$.exports=G},{"../utils":32,"./GenericWorker":28}],27:[function(M,$,j){var z=M("../utils"),V=M("./GenericWorker");function G(X){V.call(this,"DataWorker");var Y=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,X.then(function(Q){Y.dataIsReady=!0,Y.data=Q,Y.max=Q&&Q.length||0,Y.type=z.getTypeOf(Q),Y.isPaused||Y._tickAndRepeat()},function(Q){Y.error(Q)})}z.inherits(G,V),G.prototype.cleanUp=function(){V.prototype.cleanUp.call(this),this.data=null},G.prototype.resume=function(){return!!V.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,z.delay(this._tickAndRepeat,[],this)),!0)},G.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(z.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},G.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var X=null,Y=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":X=this.data.substring(this.index,Y);break;case"uint8array":X=this.data.subarray(this.index,Y);break;case"array":case"nodebuffer":X=this.data.slice(this.index,Y)}return this.index=Y,this.push({data:X,meta:{percent:this.max?this.index/this.max*100:0}})},$.exports=G},{"../utils":32,"./GenericWorker":28}],28:[function(M,$,j){function z(V){this.name=V||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}z.prototype={push:function(V){this.emit("data",V)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(V){this.emit("error",V)}return!0},error:function(V){return!this.isFinished&&(this.isPaused?this.generatedError=V:(this.isFinished=!0,this.emit("error",V),this.previous&&this.previous.error(V),this.cleanUp()),!0)},on:function(V,G){return this._listeners[V].push(G),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(V,G){if(this._listeners[V])for(var X=0;X<this._listeners[V].length;X++)this._listeners[V][X].call(this,G)},pipe:function(V){return V.registerPrevious(this)},registerPrevious:function(V){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=V.streamInfo,this.mergeStreamInfo(),this.previous=V;var G=this;return V.on("data",function(X){G.processChunk(X)}),V.on("end",function(){G.end()}),V.on("error",function(X){G.error(X)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var V=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),V=!0),this.previous&&this.previous.resume(),!V},flush:function(){},processChunk:function(V){this.push(V)},withStreamInfo:function(V,G){return this.extraStreamInfo[V]=G,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var V in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,V)&&(this.streamInfo[V]=this.extraStreamInfo[V])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var V="Worker "+this.name;return this.previous?this.previous+" -> "+V:V}},$.exports=z},{}],29:[function(M,$,j){var z=M("../utils"),V=M("./ConvertWorker"),G=M("./GenericWorker"),X=M("../base64"),Y=M("../support"),Q=M("../external"),Z=null;if(Y.nodestream)try{Z=M("../nodejs/NodejsStreamOutputAdapter")}catch{}function ee(ne,re){return new Q.Promise(function(ie,se){var le=[],he=ne._internalType,ce=ne._outputType,ae=ne._mimeType;ne.on("data",function(de,ge){le.push(de),re&&re(ge)}).on("error",function(de){le=[],se(de)}).on("end",function(){try{var de=function(ge,fe,oe){switch(ge){case"blob":return z.newBlob(z.transformTo("arraybuffer",fe),oe);case"base64":return X.encode(fe);default:return z.transformTo(ge,fe)}}(ce,function(ge,fe){var oe,we=0,De=null,ve=0;for(oe=0;oe<fe.length;oe++)ve+=fe[oe].length;switch(ge){case"string":return fe.join("");case"array":return Array.prototype.concat.apply([],fe);case"uint8array":for(De=new Uint8Array(ve),oe=0;oe<fe.length;oe++)De.set(fe[oe],we),we+=fe[oe].length;return De;case"nodebuffer":return Buffer.concat(fe);default:throw new Error("concat : unsupported type '"+ge+"'")}}(he,le),ae);ie(de)}catch(ge){se(ge)}le=[]}).resume()})}function te(ne,re,ie){var se=re;switch(re){case"blob":case"arraybuffer":se="uint8array";break;case"base64":se="string"}try{this._internalType=se,this._outputType=re,this._mimeType=ie,z.checkSupport(se),this._worker=ne.pipe(new V(se)),ne.lock()}catch(le){this._worker=new G("error"),this._worker.error(le)}}te.prototype={accumulate:function(ne){return ee(this,ne)},on:function(ne,re){var ie=this;return ne==="data"?this._worker.on(ne,function(se){re.call(ie,se.data,se.meta)}):this._worker.on(ne,function(){z.delay(re,arguments,ie)}),this},resume:function(){return z.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(ne){if(z.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new Z(this,{objectMode:this._outputType!=="nodebuffer"},ne)}},$.exports=te},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(M,$,j){if(j.base64=!0,j.array=!0,j.string=!0,j.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",j.nodebuffer=typeof Buffer<"u",j.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")j.blob=!1;else{var z=new ArrayBuffer(0);try{j.blob=new Blob([z],{type:"application/zip"}).size===0}catch{try{var V=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);V.append(z),j.blob=V.getBlob("application/zip").size===0}catch{j.blob=!1}}}try{j.nodestream=!!M("readable-stream").Readable}catch{j.nodestream=!1}},{"readable-stream":16}],31:[function(M,$,j){for(var z=M("./utils"),V=M("./support"),G=M("./nodejsUtils"),X=M("./stream/GenericWorker"),Y=new Array(256),Q=0;Q<256;Q++)Y[Q]=252<=Q?6:248<=Q?5:240<=Q?4:224<=Q?3:192<=Q?2:1;Y[254]=Y[254]=1;function Z(){X.call(this,"utf-8 decode"),this.leftOver=null}function ee(){X.call(this,"utf-8 encode")}j.utf8encode=function(te){return V.nodebuffer?G.newBufferFrom(te,"utf-8"):function(ne){var re,ie,se,le,he,ce=ne.length,ae=0;for(le=0;le<ce;le++)(64512&(ie=ne.charCodeAt(le)))==55296&&le+1<ce&&(64512&(se=ne.charCodeAt(le+1)))==56320&&(ie=65536+(ie-55296<<10)+(se-56320),le++),ae+=ie<128?1:ie<2048?2:ie<65536?3:4;for(re=V.uint8array?new Uint8Array(ae):new Array(ae),le=he=0;he<ae;le++)(64512&(ie=ne.charCodeAt(le)))==55296&&le+1<ce&&(64512&(se=ne.charCodeAt(le+1)))==56320&&(ie=65536+(ie-55296<<10)+(se-56320),le++),ie<128?re[he++]=ie:(ie<2048?re[he++]=192|ie>>>6:(ie<65536?re[he++]=224|ie>>>12:(re[he++]=240|ie>>>18,re[he++]=128|ie>>>12&63),re[he++]=128|ie>>>6&63),re[he++]=128|63&ie);return re}(te)},j.utf8decode=function(te){return V.nodebuffer?z.transformTo("nodebuffer",te).toString("utf-8"):function(ne){var re,ie,se,le,he=ne.length,ce=new Array(2*he);for(re=ie=0;re<he;)if((se=ne[re++])<128)ce[ie++]=se;else if(4<(le=Y[se]))ce[ie++]=65533,re+=le-1;else{for(se&=le===2?31:le===3?15:7;1<le&&re<he;)se=se<<6|63&ne[re++],le--;1<le?ce[ie++]=65533:se<65536?ce[ie++]=se:(se-=65536,ce[ie++]=55296|se>>10&1023,ce[ie++]=56320|1023&se)}return ce.length!==ie&&(ce.subarray?ce=ce.subarray(0,ie):ce.length=ie),z.applyFromCharCode(ce)}(te=z.transformTo(V.uint8array?"uint8array":"array",te))},z.inherits(Z,X),Z.prototype.processChunk=function(te){var ne=z.transformTo(V.uint8array?"uint8array":"array",te.data);if(this.leftOver&&this.leftOver.length){if(V.uint8array){var re=ne;(ne=new Uint8Array(re.length+this.leftOver.length)).set(this.leftOver,0),ne.set(re,this.leftOver.length)}else ne=this.leftOver.concat(ne);this.leftOver=null}var ie=function(le,he){var ce;for((he=he||le.length)>le.length&&(he=le.length),ce=he-1;0<=ce&&(192&le[ce])==128;)ce--;return ce<0||ce===0?he:ce+Y[le[ce]]>he?ce:he}(ne),se=ne;ie!==ne.length&&(V.uint8array?(se=ne.subarray(0,ie),this.leftOver=ne.subarray(ie,ne.length)):(se=ne.slice(0,ie),this.leftOver=ne.slice(ie,ne.length))),this.push({data:j.utf8decode(se),meta:te.meta})},Z.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:j.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},j.Utf8DecodeWorker=Z,z.inherits(ee,X),ee.prototype.processChunk=function(te){this.push({data:j.utf8encode(te.data),meta:te.meta})},j.Utf8EncodeWorker=ee},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(M,$,j){var z=M("./support"),V=M("./base64"),G=M("./nodejsUtils"),X=M("./external");function Y(re){return re}function Q(re,ie){for(var se=0;se<re.length;++se)ie[se]=255&re.charCodeAt(se);return ie}M("setimmediate"),j.newBlob=function(re,ie){j.checkSupport("blob");try{return new Blob([re],{type:ie})}catch{try{var se=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return se.append(re),se.getBlob(ie)}catch{throw new Error("Bug : can't construct the Blob.")}}};var Z={stringifyByChunk:function(re,ie,se){var le=[],he=0,ce=re.length;if(ce<=se)return String.fromCharCode.apply(null,re);for(;he<ce;)ie==="array"||ie==="nodebuffer"?le.push(String.fromCharCode.apply(null,re.slice(he,Math.min(he+se,ce)))):le.push(String.fromCharCode.apply(null,re.subarray(he,Math.min(he+se,ce)))),he+=se;return le.join("")},stringifyByChar:function(re){for(var ie="",se=0;se<re.length;se++)ie+=String.fromCharCode(re[se]);return ie},applyCanBeUsed:{uint8array:function(){try{return z.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return z.nodebuffer&&String.fromCharCode.apply(null,G.allocBuffer(1)).length===1}catch{return!1}}()}};function ee(re){var ie=65536,se=j.getTypeOf(re),le=!0;if(se==="uint8array"?le=Z.applyCanBeUsed.uint8array:se==="nodebuffer"&&(le=Z.applyCanBeUsed.nodebuffer),le)for(;1<ie;)try{return Z.stringifyByChunk(re,se,ie)}catch{ie=Math.floor(ie/2)}return Z.stringifyByChar(re)}function te(re,ie){for(var se=0;se<re.length;se++)ie[se]=re[se];return ie}j.applyFromCharCode=ee;var ne={};ne.string={string:Y,array:function(re){return Q(re,new Array(re.length))},arraybuffer:function(re){return ne.string.uint8array(re).buffer},uint8array:function(re){return Q(re,new Uint8Array(re.length))},nodebuffer:function(re){return Q(re,G.allocBuffer(re.length))}},ne.array={string:ee,array:Y,arraybuffer:function(re){return new Uint8Array(re).buffer},uint8array:function(re){return new Uint8Array(re)},nodebuffer:function(re){return G.newBufferFrom(re)}},ne.arraybuffer={string:function(re){return ee(new Uint8Array(re))},array:function(re){return te(new Uint8Array(re),new Array(re.byteLength))},arraybuffer:Y,uint8array:function(re){return new Uint8Array(re)},nodebuffer:function(re){return G.newBufferFrom(new Uint8Array(re))}},ne.uint8array={string:ee,array:function(re){return te(re,new Array(re.length))},arraybuffer:function(re){return re.buffer},uint8array:Y,nodebuffer:function(re){return G.newBufferFrom(re)}},ne.nodebuffer={string:ee,array:function(re){return te(re,new Array(re.length))},arraybuffer:function(re){return ne.nodebuffer.uint8array(re).buffer},uint8array:function(re){return te(re,new Uint8Array(re.length))},nodebuffer:Y},j.transformTo=function(re,ie){if(ie=ie||"",!re)return ie;j.checkSupport(re);var se=j.getTypeOf(ie);return ne[se][re](ie)},j.resolve=function(re){for(var ie=re.split("/"),se=[],le=0;le<ie.length;le++){var he=ie[le];he==="."||he===""&&le!==0&&le!==ie.length-1||(he===".."?se.pop():se.push(he))}return se.join("/")},j.getTypeOf=function(re){return typeof re=="string"?"string":Object.prototype.toString.call(re)==="[object Array]"?"array":z.nodebuffer&&G.isBuffer(re)?"nodebuffer":z.uint8array&&re instanceof Uint8Array?"uint8array":z.arraybuffer&&re instanceof ArrayBuffer?"arraybuffer":void 0},j.checkSupport=function(re){if(!z[re.toLowerCase()])throw new Error(re+" is not supported by this platform")},j.MAX_VALUE_16BITS=65535,j.MAX_VALUE_32BITS=-1,j.pretty=function(re){var ie,se,le="";for(se=0;se<(re||"").length;se++)le+="\\x"+((ie=re.charCodeAt(se))<16?"0":"")+ie.toString(16).toUpperCase();return le},j.delay=function(re,ie,se){setImmediate(function(){re.apply(se||null,ie||[])})},j.inherits=function(re,ie){function se(){}se.prototype=ie.prototype,re.prototype=new se},j.extend=function(){var re,ie,se={};for(re=0;re<arguments.length;re++)for(ie in arguments[re])Object.prototype.hasOwnProperty.call(arguments[re],ie)&&se[ie]===void 0&&(se[ie]=arguments[re][ie]);return se},j.prepareContent=function(re,ie,se,le,he){return X.Promise.resolve(ie).then(function(ce){return z.blob&&(ce instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(ce))!==-1)&&typeof FileReader<"u"?new X.Promise(function(ae,de){var ge=new FileReader;ge.onload=function(fe){ae(fe.target.result)},ge.onerror=function(fe){de(fe.target.error)},ge.readAsArrayBuffer(ce)}):ce}).then(function(ce){var ae=j.getTypeOf(ce);return ae?(ae==="arraybuffer"?ce=j.transformTo("uint8array",ce):ae==="string"&&(he?ce=V.decode(ce):se&&le!==!0&&(ce=function(de){return Q(de,z.uint8array?new Uint8Array(de.length):new Array(de.length))}(ce))),ce):X.Promise.reject(new Error("Can't read the data of '"+re+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(M,$,j){var z=M("./reader/readerFor"),V=M("./utils"),G=M("./signature"),X=M("./zipEntry"),Y=M("./support");function Q(Z){this.files=[],this.loadOptions=Z}Q.prototype={checkSignature:function(Z){if(!this.reader.readAndCheckSignature(Z)){this.reader.index-=4;var ee=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+V.pretty(ee)+", expected "+V.pretty(Z)+")")}},isSignature:function(Z,ee){var te=this.reader.index;this.reader.setIndex(Z);var ne=this.reader.readString(4)===ee;return this.reader.setIndex(te),ne},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var Z=this.reader.readData(this.zipCommentLength),ee=Y.uint8array?"uint8array":"array",te=V.transformTo(ee,Z);this.zipComment=this.loadOptions.decodeFileName(te)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var Z,ee,te,ne=this.zip64EndOfCentralSize-44;0<ne;)Z=this.reader.readInt(2),ee=this.reader.readInt(4),te=this.reader.readData(ee),this.zip64ExtensibleData[Z]={id:Z,length:ee,value:te}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var Z,ee;for(Z=0;Z<this.files.length;Z++)ee=this.files[Z],this.reader.setIndex(ee.localHeaderOffset),this.checkSignature(G.LOCAL_FILE_HEADER),ee.readLocalPart(this.reader),ee.handleUTF8(),ee.processAttributes()},readCentralDir:function(){var Z;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(G.CENTRAL_FILE_HEADER);)(Z=new X({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(Z);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var Z=this.reader.lastIndexOfSignature(G.CENTRAL_DIRECTORY_END);if(Z<0)throw this.isSignature(0,G.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(Z);var ee=Z;if(this.checkSignature(G.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===V.MAX_VALUE_16BITS||this.diskWithCentralDirStart===V.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===V.MAX_VALUE_16BITS||this.centralDirRecords===V.MAX_VALUE_16BITS||this.centralDirSize===V.MAX_VALUE_32BITS||this.centralDirOffset===V.MAX_VALUE_32BITS){if(this.zip64=!0,(Z=this.reader.lastIndexOfSignature(G.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(Z),this.checkSignature(G.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,G.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(G.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(G.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var te=this.centralDirOffset+this.centralDirSize;this.zip64&&(te+=20,te+=12+this.zip64EndOfCentralSize);var ne=ee-te;if(0<ne)this.isSignature(ee,G.CENTRAL_FILE_HEADER)||(this.reader.zero=ne);else if(ne<0)throw new Error("Corrupted zip: missing "+Math.abs(ne)+" bytes.")},prepareReader:function(Z){this.reader=z(Z)},load:function(Z){this.prepareReader(Z),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},$.exports=Q},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(M,$,j){var z=M("./reader/readerFor"),V=M("./utils"),G=M("./compressedObject"),X=M("./crc32"),Y=M("./utf8"),Q=M("./compressions"),Z=M("./support");function ee(te,ne){this.options=te,this.loadOptions=ne}ee.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(te){var ne,re;if(te.skip(22),this.fileNameLength=te.readInt(2),re=te.readInt(2),this.fileName=te.readData(this.fileNameLength),te.skip(re),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((ne=function(ie){for(var se in Q)if(Object.prototype.hasOwnProperty.call(Q,se)&&Q[se].magic===ie)return Q[se];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+V.pretty(this.compressionMethod)+" unknown (inner file : "+V.transformTo("string",this.fileName)+")");this.decompressed=new G(this.compressedSize,this.uncompressedSize,this.crc32,ne,te.readData(this.compressedSize))},readCentralPart:function(te){this.versionMadeBy=te.readInt(2),te.skip(2),this.bitFlag=te.readInt(2),this.compressionMethod=te.readString(2),this.date=te.readDate(),this.crc32=te.readInt(4),this.compressedSize=te.readInt(4),this.uncompressedSize=te.readInt(4);var ne=te.readInt(2);if(this.extraFieldsLength=te.readInt(2),this.fileCommentLength=te.readInt(2),this.diskNumberStart=te.readInt(2),this.internalFileAttributes=te.readInt(2),this.externalFileAttributes=te.readInt(4),this.localHeaderOffset=te.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");te.skip(ne),this.readExtraFields(te),this.parseZIP64ExtraField(te),this.fileComment=te.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var te=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),te==0&&(this.dosPermissions=63&this.externalFileAttributes),te==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var te=z(this.extraFields[1].value);this.uncompressedSize===V.MAX_VALUE_32BITS&&(this.uncompressedSize=te.readInt(8)),this.compressedSize===V.MAX_VALUE_32BITS&&(this.compressedSize=te.readInt(8)),this.localHeaderOffset===V.MAX_VALUE_32BITS&&(this.localHeaderOffset=te.readInt(8)),this.diskNumberStart===V.MAX_VALUE_32BITS&&(this.diskNumberStart=te.readInt(4))}},readExtraFields:function(te){var ne,re,ie,se=te.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});te.index+4<se;)ne=te.readInt(2),re=te.readInt(2),ie=te.readData(re),this.extraFields[ne]={id:ne,length:re,value:ie};te.setIndex(se)},handleUTF8:function(){var te=Z.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=Y.utf8decode(this.fileName),this.fileCommentStr=Y.utf8decode(this.fileComment);else{var ne=this.findExtraFieldUnicodePath();if(ne!==null)this.fileNameStr=ne;else{var re=V.transformTo(te,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(re)}var ie=this.findExtraFieldUnicodeComment();if(ie!==null)this.fileCommentStr=ie;else{var se=V.transformTo(te,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(se)}}},findExtraFieldUnicodePath:function(){var te=this.extraFields[28789];if(te){var ne=z(te.value);return ne.readInt(1)!==1||X(this.fileName)!==ne.readInt(4)?null:Y.utf8decode(ne.readData(te.length-5))}return null},findExtraFieldUnicodeComment:function(){var te=this.extraFields[25461];if(te){var ne=z(te.value);return ne.readInt(1)!==1||X(this.fileComment)!==ne.readInt(4)?null:Y.utf8decode(ne.readData(te.length-5))}return null}},$.exports=ee},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(M,$,j){function z(ne,re,ie){this.name=ne,this.dir=ie.dir,this.date=ie.date,this.comment=ie.comment,this.unixPermissions=ie.unixPermissions,this.dosPermissions=ie.dosPermissions,this._data=re,this._dataBinary=ie.binary,this.options={compression:ie.compression,compressionOptions:ie.compressionOptions}}var V=M("./stream/StreamHelper"),G=M("./stream/DataWorker"),X=M("./utf8"),Y=M("./compressedObject"),Q=M("./stream/GenericWorker");z.prototype={internalStream:function(ne){var re=null,ie="string";try{if(!ne)throw new Error("No output type specified.");var se=(ie=ne.toLowerCase())==="string"||ie==="text";ie!=="binarystring"&&ie!=="text"||(ie="string"),re=this._decompressWorker();var le=!this._dataBinary;le&&!se&&(re=re.pipe(new X.Utf8EncodeWorker)),!le&&se&&(re=re.pipe(new X.Utf8DecodeWorker))}catch(he){(re=new Q("error")).error(he)}return new V(re,ie,"")},async:function(ne,re){return this.internalStream(ne).accumulate(re)},nodeStream:function(ne,re){return this.internalStream(ne||"nodebuffer").toNodejsStream(re)},_compressWorker:function(ne,re){if(this._data instanceof Y&&this._data.compression.magic===ne.magic)return this._data.getCompressedWorker();var ie=this._decompressWorker();return this._dataBinary||(ie=ie.pipe(new X.Utf8EncodeWorker)),Y.createWorkerFrom(ie,ne,re)},_decompressWorker:function(){return this._data instanceof Y?this._data.getContentWorker():this._data instanceof Q?this._data:new G(this._data)}};for(var Z=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],ee=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},te=0;te<Z.length;te++)z.prototype[Z[te]]=ee;$.exports=z},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(M,$,j){(function(z){var V,G,X=z.MutationObserver||z.WebKitMutationObserver;if(X){var Y=0,Q=new X(ne),Z=z.document.createTextNode("");Q.observe(Z,{characterData:!0}),V=function(){Z.data=Y=++Y%2}}else if(z.setImmediate||z.MessageChannel===void 0)V="document"in z&&"onreadystatechange"in z.document.createElement("script")?function(){var re=z.document.createElement("script");re.onreadystatechange=function(){ne(),re.onreadystatechange=null,re.parentNode.removeChild(re),re=null},z.document.documentElement.appendChild(re)}:function(){setTimeout(ne,0)};else{var ee=new z.MessageChannel;ee.port1.onmessage=ne,V=function(){ee.port2.postMessage(0)}}var te=[];function ne(){var re,ie;G=!0;for(var se=te.length;se;){for(ie=te,te=[],re=-1;++re<se;)ie[re]();se=te.length}G=!1}$.exports=function(re){te.push(re)!==1||G||V()}}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(M,$,j){var z=M("immediate");function V(){}var G={},X=["REJECTED"],Y=["FULFILLED"],Q=["PENDING"];function Z(se){if(typeof se!="function")throw new TypeError("resolver must be a function");this.state=Q,this.queue=[],this.outcome=void 0,se!==V&&re(this,se)}function ee(se,le,he){this.promise=se,typeof le=="function"&&(this.onFulfilled=le,this.callFulfilled=this.otherCallFulfilled),typeof he=="function"&&(this.onRejected=he,this.callRejected=this.otherCallRejected)}function te(se,le,he){z(function(){var ce;try{ce=le(he)}catch(ae){return G.reject(se,ae)}ce===se?G.reject(se,new TypeError("Cannot resolve promise with itself")):G.resolve(se,ce)})}function ne(se){var le=se&&se.then;if(se&&(typeof se=="object"||typeof se=="function")&&typeof le=="function")return function(){le.apply(se,arguments)}}function re(se,le){var he=!1;function ce(ge){he||(he=!0,G.reject(se,ge))}function ae(ge){he||(he=!0,G.resolve(se,ge))}var de=ie(function(){le(ae,ce)});de.status==="error"&&ce(de.value)}function ie(se,le){var he={};try{he.value=se(le),he.status="success"}catch(ce){he.status="error",he.value=ce}return he}($.exports=Z).prototype.finally=function(se){if(typeof se!="function")return this;var le=this.constructor;return this.then(function(he){return le.resolve(se()).then(function(){return he})},function(he){return le.resolve(se()).then(function(){throw he})})},Z.prototype.catch=function(se){return this.then(null,se)},Z.prototype.then=function(se,le){if(typeof se!="function"&&this.state===Y||typeof le!="function"&&this.state===X)return this;var he=new this.constructor(V);return this.state!==Q?te(he,this.state===Y?se:le,this.outcome):this.queue.push(new ee(he,se,le)),he},ee.prototype.callFulfilled=function(se){G.resolve(this.promise,se)},ee.prototype.otherCallFulfilled=function(se){te(this.promise,this.onFulfilled,se)},ee.prototype.callRejected=function(se){G.reject(this.promise,se)},ee.prototype.otherCallRejected=function(se){te(this.promise,this.onRejected,se)},G.resolve=function(se,le){var he=ie(ne,le);if(he.status==="error")return G.reject(se,he.value);var ce=he.value;if(ce)re(se,ce);else{se.state=Y,se.outcome=le;for(var ae=-1,de=se.queue.length;++ae<de;)se.queue[ae].callFulfilled(le)}return se},G.reject=function(se,le){se.state=X,se.outcome=le;for(var he=-1,ce=se.queue.length;++he<ce;)se.queue[he].callRejected(le);return se},Z.resolve=function(se){return se instanceof this?se:G.resolve(new this(V),se)},Z.reject=function(se){var le=new this(V);return G.reject(le,se)},Z.all=function(se){var le=this;if(Object.prototype.toString.call(se)!=="[object Array]")return this.reject(new TypeError("must be an array"));var he=se.length,ce=!1;if(!he)return this.resolve([]);for(var ae=new Array(he),de=0,ge=-1,fe=new this(V);++ge<he;)oe(se[ge],ge);return fe;function oe(we,De){le.resolve(we).then(function(ve){ae[De]=ve,++de!==he||ce||(ce=!0,G.resolve(fe,ae))},function(ve){ce||(ce=!0,G.reject(fe,ve))})}},Z.race=function(se){var le=this;if(Object.prototype.toString.call(se)!=="[object Array]")return this.reject(new TypeError("must be an array"));var he=se.length,ce=!1;if(!he)return this.resolve([]);for(var ae=-1,de=new this(V);++ae<he;)ge=se[ae],le.resolve(ge).then(function(fe){ce||(ce=!0,G.resolve(de,fe))},function(fe){ce||(ce=!0,G.reject(de,fe))});var ge;return de}},{immediate:36}],38:[function(M,$,j){var z={};(0,M("./lib/utils/common").assign)(z,M("./lib/deflate"),M("./lib/inflate"),M("./lib/zlib/constants")),$.exports=z},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(M,$,j){var z=M("./zlib/deflate"),V=M("./utils/common"),G=M("./utils/strings"),X=M("./zlib/messages"),Y=M("./zlib/zstream"),Q=Object.prototype.toString,Z=0,ee=-1,te=0,ne=8;function re(se){if(!(this instanceof re))return new re(se);this.options=V.assign({level:ee,method:ne,chunkSize:16384,windowBits:15,memLevel:8,strategy:te,to:""},se||{});var le=this.options;le.raw&&0<le.windowBits?le.windowBits=-le.windowBits:le.gzip&&0<le.windowBits&&le.windowBits<16&&(le.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Y,this.strm.avail_out=0;var he=z.deflateInit2(this.strm,le.level,le.method,le.windowBits,le.memLevel,le.strategy);if(he!==Z)throw new Error(X[he]);if(le.header&&z.deflateSetHeader(this.strm,le.header),le.dictionary){var ce;if(ce=typeof le.dictionary=="string"?G.string2buf(le.dictionary):Q.call(le.dictionary)==="[object ArrayBuffer]"?new Uint8Array(le.dictionary):le.dictionary,(he=z.deflateSetDictionary(this.strm,ce))!==Z)throw new Error(X[he]);this._dict_set=!0}}function ie(se,le){var he=new re(le);if(he.push(se,!0),he.err)throw he.msg||X[he.err];return he.result}re.prototype.push=function(se,le){var he,ce,ae=this.strm,de=this.options.chunkSize;if(this.ended)return!1;ce=le===~~le?le:le===!0?4:0,typeof se=="string"?ae.input=G.string2buf(se):Q.call(se)==="[object ArrayBuffer]"?ae.input=new Uint8Array(se):ae.input=se,ae.next_in=0,ae.avail_in=ae.input.length;do{if(ae.avail_out===0&&(ae.output=new V.Buf8(de),ae.next_out=0,ae.avail_out=de),(he=z.deflate(ae,ce))!==1&&he!==Z)return this.onEnd(he),!(this.ended=!0);ae.avail_out!==0&&(ae.avail_in!==0||ce!==4&&ce!==2)||(this.options.to==="string"?this.onData(G.buf2binstring(V.shrinkBuf(ae.output,ae.next_out))):this.onData(V.shrinkBuf(ae.output,ae.next_out)))}while((0<ae.avail_in||ae.avail_out===0)&&he!==1);return ce===4?(he=z.deflateEnd(this.strm),this.onEnd(he),this.ended=!0,he===Z):ce!==2||(this.onEnd(Z),!(ae.avail_out=0))},re.prototype.onData=function(se){this.chunks.push(se)},re.prototype.onEnd=function(se){se===Z&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=V.flattenChunks(this.chunks)),this.chunks=[],this.err=se,this.msg=this.strm.msg},j.Deflate=re,j.deflate=ie,j.deflateRaw=function(se,le){return(le=le||{}).raw=!0,ie(se,le)},j.gzip=function(se,le){return(le=le||{}).gzip=!0,ie(se,le)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(M,$,j){var z=M("./zlib/inflate"),V=M("./utils/common"),G=M("./utils/strings"),X=M("./zlib/constants"),Y=M("./zlib/messages"),Q=M("./zlib/zstream"),Z=M("./zlib/gzheader"),ee=Object.prototype.toString;function te(re){if(!(this instanceof te))return new te(re);this.options=V.assign({chunkSize:16384,windowBits:0,to:""},re||{});var ie=this.options;ie.raw&&0<=ie.windowBits&&ie.windowBits<16&&(ie.windowBits=-ie.windowBits,ie.windowBits===0&&(ie.windowBits=-15)),!(0<=ie.windowBits&&ie.windowBits<16)||re&&re.windowBits||(ie.windowBits+=32),15<ie.windowBits&&ie.windowBits<48&&!(15&ie.windowBits)&&(ie.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;var se=z.inflateInit2(this.strm,ie.windowBits);if(se!==X.Z_OK)throw new Error(Y[se]);this.header=new Z,z.inflateGetHeader(this.strm,this.header)}function ne(re,ie){var se=new te(ie);if(se.push(re,!0),se.err)throw se.msg||Y[se.err];return se.result}te.prototype.push=function(re,ie){var se,le,he,ce,ae,de,ge=this.strm,fe=this.options.chunkSize,oe=this.options.dictionary,we=!1;if(this.ended)return!1;le=ie===~~ie?ie:ie===!0?X.Z_FINISH:X.Z_NO_FLUSH,typeof re=="string"?ge.input=G.binstring2buf(re):ee.call(re)==="[object ArrayBuffer]"?ge.input=new Uint8Array(re):ge.input=re,ge.next_in=0,ge.avail_in=ge.input.length;do{if(ge.avail_out===0&&(ge.output=new V.Buf8(fe),ge.next_out=0,ge.avail_out=fe),(se=z.inflate(ge,X.Z_NO_FLUSH))===X.Z_NEED_DICT&&oe&&(de=typeof oe=="string"?G.string2buf(oe):ee.call(oe)==="[object ArrayBuffer]"?new Uint8Array(oe):oe,se=z.inflateSetDictionary(this.strm,de)),se===X.Z_BUF_ERROR&&we===!0&&(se=X.Z_OK,we=!1),se!==X.Z_STREAM_END&&se!==X.Z_OK)return this.onEnd(se),!(this.ended=!0);ge.next_out&&(ge.avail_out!==0&&se!==X.Z_STREAM_END&&(ge.avail_in!==0||le!==X.Z_FINISH&&le!==X.Z_SYNC_FLUSH)||(this.options.to==="string"?(he=G.utf8border(ge.output,ge.next_out),ce=ge.next_out-he,ae=G.buf2string(ge.output,he),ge.next_out=ce,ge.avail_out=fe-ce,ce&&V.arraySet(ge.output,ge.output,he,ce,0),this.onData(ae)):this.onData(V.shrinkBuf(ge.output,ge.next_out)))),ge.avail_in===0&&ge.avail_out===0&&(we=!0)}while((0<ge.avail_in||ge.avail_out===0)&&se!==X.Z_STREAM_END);return se===X.Z_STREAM_END&&(le=X.Z_FINISH),le===X.Z_FINISH?(se=z.inflateEnd(this.strm),this.onEnd(se),this.ended=!0,se===X.Z_OK):le!==X.Z_SYNC_FLUSH||(this.onEnd(X.Z_OK),!(ge.avail_out=0))},te.prototype.onData=function(re){this.chunks.push(re)},te.prototype.onEnd=function(re){re===X.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=V.flattenChunks(this.chunks)),this.chunks=[],this.err=re,this.msg=this.strm.msg},j.Inflate=te,j.inflate=ne,j.inflateRaw=function(re,ie){return(ie=ie||{}).raw=!0,ne(re,ie)},j.ungzip=ne},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(M,$,j){var z=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";j.assign=function(X){for(var Y=Array.prototype.slice.call(arguments,1);Y.length;){var Q=Y.shift();if(Q){if(typeof Q!="object")throw new TypeError(Q+"must be non-object");for(var Z in Q)Q.hasOwnProperty(Z)&&(X[Z]=Q[Z])}}return X},j.shrinkBuf=function(X,Y){return X.length===Y?X:X.subarray?X.subarray(0,Y):(X.length=Y,X)};var V={arraySet:function(X,Y,Q,Z,ee){if(Y.subarray&&X.subarray)X.set(Y.subarray(Q,Q+Z),ee);else for(var te=0;te<Z;te++)X[ee+te]=Y[Q+te]},flattenChunks:function(X){var Y,Q,Z,ee,te,ne;for(Y=Z=0,Q=X.length;Y<Q;Y++)Z+=X[Y].length;for(ne=new Uint8Array(Z),Y=ee=0,Q=X.length;Y<Q;Y++)te=X[Y],ne.set(te,ee),ee+=te.length;return ne}},G={arraySet:function(X,Y,Q,Z,ee){for(var te=0;te<Z;te++)X[ee+te]=Y[Q+te]},flattenChunks:function(X){return[].concat.apply([],X)}};j.setTyped=function(X){X?(j.Buf8=Uint8Array,j.Buf16=Uint16Array,j.Buf32=Int32Array,j.assign(j,V)):(j.Buf8=Array,j.Buf16=Array,j.Buf32=Array,j.assign(j,G))},j.setTyped(z)},{}],42:[function(M,$,j){var z=M("./common"),V=!0,G=!0;try{String.fromCharCode.apply(null,[0])}catch{V=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{G=!1}for(var X=new z.Buf8(256),Y=0;Y<256;Y++)X[Y]=252<=Y?6:248<=Y?5:240<=Y?4:224<=Y?3:192<=Y?2:1;function Q(Z,ee){if(ee<65537&&(Z.subarray&&G||!Z.subarray&&V))return String.fromCharCode.apply(null,z.shrinkBuf(Z,ee));for(var te="",ne=0;ne<ee;ne++)te+=String.fromCharCode(Z[ne]);return te}X[254]=X[254]=1,j.string2buf=function(Z){var ee,te,ne,re,ie,se=Z.length,le=0;for(re=0;re<se;re++)(64512&(te=Z.charCodeAt(re)))==55296&&re+1<se&&(64512&(ne=Z.charCodeAt(re+1)))==56320&&(te=65536+(te-55296<<10)+(ne-56320),re++),le+=te<128?1:te<2048?2:te<65536?3:4;for(ee=new z.Buf8(le),re=ie=0;ie<le;re++)(64512&(te=Z.charCodeAt(re)))==55296&&re+1<se&&(64512&(ne=Z.charCodeAt(re+1)))==56320&&(te=65536+(te-55296<<10)+(ne-56320),re++),te<128?ee[ie++]=te:(te<2048?ee[ie++]=192|te>>>6:(te<65536?ee[ie++]=224|te>>>12:(ee[ie++]=240|te>>>18,ee[ie++]=128|te>>>12&63),ee[ie++]=128|te>>>6&63),ee[ie++]=128|63&te);return ee},j.buf2binstring=function(Z){return Q(Z,Z.length)},j.binstring2buf=function(Z){for(var ee=new z.Buf8(Z.length),te=0,ne=ee.length;te<ne;te++)ee[te]=Z.charCodeAt(te);return ee},j.buf2string=function(Z,ee){var te,ne,re,ie,se=ee||Z.length,le=new Array(2*se);for(te=ne=0;te<se;)if((re=Z[te++])<128)le[ne++]=re;else if(4<(ie=X[re]))le[ne++]=65533,te+=ie-1;else{for(re&=ie===2?31:ie===3?15:7;1<ie&&te<se;)re=re<<6|63&Z[te++],ie--;1<ie?le[ne++]=65533:re<65536?le[ne++]=re:(re-=65536,le[ne++]=55296|re>>10&1023,le[ne++]=56320|1023&re)}return Q(le,ne)},j.utf8border=function(Z,ee){var te;for((ee=ee||Z.length)>Z.length&&(ee=Z.length),te=ee-1;0<=te&&(192&Z[te])==128;)te--;return te<0||te===0?ee:te+X[Z[te]]>ee?te:ee}},{"./common":41}],43:[function(M,$,j){$.exports=function(z,V,G,X){for(var Y=65535&z|0,Q=z>>>16&65535|0,Z=0;G!==0;){for(G-=Z=2e3<G?2e3:G;Q=Q+(Y=Y+V[X++]|0)|0,--Z;);Y%=65521,Q%=65521}return Y|Q<<16|0}},{}],44:[function(M,$,j){$.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(M,$,j){var z=function(){for(var V,G=[],X=0;X<256;X++){V=X;for(var Y=0;Y<8;Y++)V=1&V?3988292384^V>>>1:V>>>1;G[X]=V}return G}();$.exports=function(V,G,X,Y){var Q=z,Z=Y+X;V^=-1;for(var ee=Y;ee<Z;ee++)V=V>>>8^Q[255&(V^G[ee])];return-1^V}},{}],46:[function(M,$,j){var z,V=M("../utils/common"),G=M("./trees"),X=M("./adler32"),Y=M("./crc32"),Q=M("./messages"),Z=0,ee=4,te=0,ne=-2,re=-1,ie=4,se=2,le=8,he=9,ce=286,ae=30,de=19,ge=2*ce+1,fe=15,oe=3,we=258,De=we+oe+1,ve=42,Ce=113,ue=1,Pe=2,ze=3,Le=4;function Me(_e,We){return _e.msg=Q[We],We}function Ne(_e){return(_e<<1)-(4<_e?9:0)}function Ye(_e){for(var We=_e.length;0<=--We;)_e[We]=0}function Ie(_e){var We=_e.state,Xe=We.pending;Xe>_e.avail_out&&(Xe=_e.avail_out),Xe!==0&&(V.arraySet(_e.output,We.pending_buf,We.pending_out,Xe,_e.next_out),_e.next_out+=Xe,We.pending_out+=Xe,_e.total_out+=Xe,_e.avail_out-=Xe,We.pending-=Xe,We.pending===0&&(We.pending_out=0))}function Oe(_e,We){G._tr_flush_block(_e,0<=_e.block_start?_e.block_start:-1,_e.strstart-_e.block_start,We),_e.block_start=_e.strstart,Ie(_e.strm)}function Se(_e,We){_e.pending_buf[_e.pending++]=We}function pe(_e,We){_e.pending_buf[_e.pending++]=We>>>8&255,_e.pending_buf[_e.pending++]=255&We}function me(_e,We){var Xe,Te,Re=_e.max_chain_length,He=_e.strstart,Ze=_e.prev_length,ot=_e.nice_match,$e=_e.strstart>_e.w_size-De?_e.strstart-(_e.w_size-De):0,je=_e.window,Ke=_e.w_mask,Qe=_e.prev,dt=_e.strstart+we,pt=je[He+Ze-1],wt=je[He+Ze];_e.prev_length>=_e.good_match&&(Re>>=2),ot>_e.lookahead&&(ot=_e.lookahead);do if(je[(Xe=We)+Ze]===wt&&je[Xe+Ze-1]===pt&&je[Xe]===je[He]&&je[++Xe]===je[He+1]){He+=2,Xe++;do;while(je[++He]===je[++Xe]&&je[++He]===je[++Xe]&&je[++He]===je[++Xe]&&je[++He]===je[++Xe]&&je[++He]===je[++Xe]&&je[++He]===je[++Xe]&&je[++He]===je[++Xe]&&je[++He]===je[++Xe]&&He<dt);if(Te=we-(dt-He),He=dt-we,Ze<Te){if(_e.match_start=We,ot<=(Ze=Te))break;pt=je[He+Ze-1],wt=je[He+Ze]}}while((We=Qe[We&Ke])>$e&&--Re!=0);return Ze<=_e.lookahead?Ze:_e.lookahead}function be(_e){var We,Xe,Te,Re,He,Ze,ot,$e,je,Ke,Qe=_e.w_size;do{if(Re=_e.window_size-_e.lookahead-_e.strstart,_e.strstart>=Qe+(Qe-De)){for(V.arraySet(_e.window,_e.window,Qe,Qe,0),_e.match_start-=Qe,_e.strstart-=Qe,_e.block_start-=Qe,We=Xe=_e.hash_size;Te=_e.head[--We],_e.head[We]=Qe<=Te?Te-Qe:0,--Xe;);for(We=Xe=Qe;Te=_e.prev[--We],_e.prev[We]=Qe<=Te?Te-Qe:0,--Xe;);Re+=Qe}if(_e.strm.avail_in===0)break;if(Ze=_e.strm,ot=_e.window,$e=_e.strstart+_e.lookahead,je=Re,Ke=void 0,Ke=Ze.avail_in,je<Ke&&(Ke=je),Xe=Ke===0?0:(Ze.avail_in-=Ke,V.arraySet(ot,Ze.input,Ze.next_in,Ke,$e),Ze.state.wrap===1?Ze.adler=X(Ze.adler,ot,Ke,$e):Ze.state.wrap===2&&(Ze.adler=Y(Ze.adler,ot,Ke,$e)),Ze.next_in+=Ke,Ze.total_in+=Ke,Ke),_e.lookahead+=Xe,_e.lookahead+_e.insert>=oe)for(He=_e.strstart-_e.insert,_e.ins_h=_e.window[He],_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[He+1])&_e.hash_mask;_e.insert&&(_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[He+oe-1])&_e.hash_mask,_e.prev[He&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=He,He++,_e.insert--,!(_e.lookahead+_e.insert<oe)););}while(_e.lookahead<De&&_e.strm.avail_in!==0)}function Ee(_e,We){for(var Xe,Te;;){if(_e.lookahead<De){if(be(_e),_e.lookahead<De&&We===Z)return ue;if(_e.lookahead===0)break}if(Xe=0,_e.lookahead>=oe&&(_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[_e.strstart+oe-1])&_e.hash_mask,Xe=_e.prev[_e.strstart&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=_e.strstart),Xe!==0&&_e.strstart-Xe<=_e.w_size-De&&(_e.match_length=me(_e,Xe)),_e.match_length>=oe)if(Te=G._tr_tally(_e,_e.strstart-_e.match_start,_e.match_length-oe),_e.lookahead-=_e.match_length,_e.match_length<=_e.max_lazy_match&&_e.lookahead>=oe){for(_e.match_length--;_e.strstart++,_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[_e.strstart+oe-1])&_e.hash_mask,Xe=_e.prev[_e.strstart&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=_e.strstart,--_e.match_length!=0;);_e.strstart++}else _e.strstart+=_e.match_length,_e.match_length=0,_e.ins_h=_e.window[_e.strstart],_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[_e.strstart+1])&_e.hash_mask;else Te=G._tr_tally(_e,0,_e.window[_e.strstart]),_e.lookahead--,_e.strstart++;if(Te&&(Oe(_e,!1),_e.strm.avail_out===0))return ue}return _e.insert=_e.strstart<oe-1?_e.strstart:oe-1,We===ee?(Oe(_e,!0),_e.strm.avail_out===0?ze:Le):_e.last_lit&&(Oe(_e,!1),_e.strm.avail_out===0)?ue:Pe}function ke(_e,We){for(var Xe,Te,Re;;){if(_e.lookahead<De){if(be(_e),_e.lookahead<De&&We===Z)return ue;if(_e.lookahead===0)break}if(Xe=0,_e.lookahead>=oe&&(_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[_e.strstart+oe-1])&_e.hash_mask,Xe=_e.prev[_e.strstart&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=_e.strstart),_e.prev_length=_e.match_length,_e.prev_match=_e.match_start,_e.match_length=oe-1,Xe!==0&&_e.prev_length<_e.max_lazy_match&&_e.strstart-Xe<=_e.w_size-De&&(_e.match_length=me(_e,Xe),_e.match_length<=5&&(_e.strategy===1||_e.match_length===oe&&4096<_e.strstart-_e.match_start)&&(_e.match_length=oe-1)),_e.prev_length>=oe&&_e.match_length<=_e.prev_length){for(Re=_e.strstart+_e.lookahead-oe,Te=G._tr_tally(_e,_e.strstart-1-_e.prev_match,_e.prev_length-oe),_e.lookahead-=_e.prev_length-1,_e.prev_length-=2;++_e.strstart<=Re&&(_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[_e.strstart+oe-1])&_e.hash_mask,Xe=_e.prev[_e.strstart&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=_e.strstart),--_e.prev_length!=0;);if(_e.match_available=0,_e.match_length=oe-1,_e.strstart++,Te&&(Oe(_e,!1),_e.strm.avail_out===0))return ue}else if(_e.match_available){if((Te=G._tr_tally(_e,0,_e.window[_e.strstart-1]))&&Oe(_e,!1),_e.strstart++,_e.lookahead--,_e.strm.avail_out===0)return ue}else _e.match_available=1,_e.strstart++,_e.lookahead--}return _e.match_available&&(Te=G._tr_tally(_e,0,_e.window[_e.strstart-1]),_e.match_available=0),_e.insert=_e.strstart<oe-1?_e.strstart:oe-1,We===ee?(Oe(_e,!0),_e.strm.avail_out===0?ze:Le):_e.last_lit&&(Oe(_e,!1),_e.strm.avail_out===0)?ue:Pe}function Fe(_e,We,Xe,Te,Re){this.good_length=_e,this.max_lazy=We,this.nice_length=Xe,this.max_chain=Te,this.func=Re}function Be(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=le,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new V.Buf16(2*ge),this.dyn_dtree=new V.Buf16(2*(2*ae+1)),this.bl_tree=new V.Buf16(2*(2*de+1)),Ye(this.dyn_ltree),Ye(this.dyn_dtree),Ye(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new V.Buf16(fe+1),this.heap=new V.Buf16(2*ce+1),Ye(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new V.Buf16(2*ce+1),Ye(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ue(_e){var We;return _e&&_e.state?(_e.total_in=_e.total_out=0,_e.data_type=se,(We=_e.state).pending=0,We.pending_out=0,We.wrap<0&&(We.wrap=-We.wrap),We.status=We.wrap?ve:Ce,_e.adler=We.wrap===2?0:1,We.last_flush=Z,G._tr_init(We),te):Me(_e,ne)}function nt(_e){var We=Ue(_e);return We===te&&function(Xe){Xe.window_size=2*Xe.w_size,Ye(Xe.head),Xe.max_lazy_match=z[Xe.level].max_lazy,Xe.good_match=z[Xe.level].good_length,Xe.nice_match=z[Xe.level].nice_length,Xe.max_chain_length=z[Xe.level].max_chain,Xe.strstart=0,Xe.block_start=0,Xe.lookahead=0,Xe.insert=0,Xe.match_length=Xe.prev_length=oe-1,Xe.match_available=0,Xe.ins_h=0}(_e.state),We}function rt(_e,We,Xe,Te,Re,He){if(!_e)return ne;var Ze=1;if(We===re&&(We=6),Te<0?(Ze=0,Te=-Te):15<Te&&(Ze=2,Te-=16),Re<1||he<Re||Xe!==le||Te<8||15<Te||We<0||9<We||He<0||ie<He)return Me(_e,ne);Te===8&&(Te=9);var ot=new Be;return(_e.state=ot).strm=_e,ot.wrap=Ze,ot.gzhead=null,ot.w_bits=Te,ot.w_size=1<<ot.w_bits,ot.w_mask=ot.w_size-1,ot.hash_bits=Re+7,ot.hash_size=1<<ot.hash_bits,ot.hash_mask=ot.hash_size-1,ot.hash_shift=~~((ot.hash_bits+oe-1)/oe),ot.window=new V.Buf8(2*ot.w_size),ot.head=new V.Buf16(ot.hash_size),ot.prev=new V.Buf16(ot.w_size),ot.lit_bufsize=1<<Re+6,ot.pending_buf_size=4*ot.lit_bufsize,ot.pending_buf=new V.Buf8(ot.pending_buf_size),ot.d_buf=1*ot.lit_bufsize,ot.l_buf=3*ot.lit_bufsize,ot.level=We,ot.strategy=He,ot.method=Xe,nt(_e)}z=[new Fe(0,0,0,0,function(_e,We){var Xe=65535;for(Xe>_e.pending_buf_size-5&&(Xe=_e.pending_buf_size-5);;){if(_e.lookahead<=1){if(be(_e),_e.lookahead===0&&We===Z)return ue;if(_e.lookahead===0)break}_e.strstart+=_e.lookahead,_e.lookahead=0;var Te=_e.block_start+Xe;if((_e.strstart===0||_e.strstart>=Te)&&(_e.lookahead=_e.strstart-Te,_e.strstart=Te,Oe(_e,!1),_e.strm.avail_out===0)||_e.strstart-_e.block_start>=_e.w_size-De&&(Oe(_e,!1),_e.strm.avail_out===0))return ue}return _e.insert=0,We===ee?(Oe(_e,!0),_e.strm.avail_out===0?ze:Le):(_e.strstart>_e.block_start&&(Oe(_e,!1),_e.strm.avail_out),ue)}),new Fe(4,4,8,4,Ee),new Fe(4,5,16,8,Ee),new Fe(4,6,32,32,Ee),new Fe(4,4,16,16,ke),new Fe(8,16,32,32,ke),new Fe(8,16,128,128,ke),new Fe(8,32,128,256,ke),new Fe(32,128,258,1024,ke),new Fe(32,258,258,4096,ke)],j.deflateInit=function(_e,We){return rt(_e,We,le,15,8,0)},j.deflateInit2=rt,j.deflateReset=nt,j.deflateResetKeep=Ue,j.deflateSetHeader=function(_e,We){return _e&&_e.state?_e.state.wrap!==2?ne:(_e.state.gzhead=We,te):ne},j.deflate=function(_e,We){var Xe,Te,Re,He;if(!_e||!_e.state||5<We||We<0)return _e?Me(_e,ne):ne;if(Te=_e.state,!_e.output||!_e.input&&_e.avail_in!==0||Te.status===666&&We!==ee)return Me(_e,_e.avail_out===0?-5:ne);if(Te.strm=_e,Xe=Te.last_flush,Te.last_flush=We,Te.status===ve)if(Te.wrap===2)_e.adler=0,Se(Te,31),Se(Te,139),Se(Te,8),Te.gzhead?(Se(Te,(Te.gzhead.text?1:0)+(Te.gzhead.hcrc?2:0)+(Te.gzhead.extra?4:0)+(Te.gzhead.name?8:0)+(Te.gzhead.comment?16:0)),Se(Te,255&Te.gzhead.time),Se(Te,Te.gzhead.time>>8&255),Se(Te,Te.gzhead.time>>16&255),Se(Te,Te.gzhead.time>>24&255),Se(Te,Te.level===9?2:2<=Te.strategy||Te.level<2?4:0),Se(Te,255&Te.gzhead.os),Te.gzhead.extra&&Te.gzhead.extra.length&&(Se(Te,255&Te.gzhead.extra.length),Se(Te,Te.gzhead.extra.length>>8&255)),Te.gzhead.hcrc&&(_e.adler=Y(_e.adler,Te.pending_buf,Te.pending,0)),Te.gzindex=0,Te.status=69):(Se(Te,0),Se(Te,0),Se(Te,0),Se(Te,0),Se(Te,0),Se(Te,Te.level===9?2:2<=Te.strategy||Te.level<2?4:0),Se(Te,3),Te.status=Ce);else{var Ze=le+(Te.w_bits-8<<4)<<8;Ze|=(2<=Te.strategy||Te.level<2?0:Te.level<6?1:Te.level===6?2:3)<<6,Te.strstart!==0&&(Ze|=32),Ze+=31-Ze%31,Te.status=Ce,pe(Te,Ze),Te.strstart!==0&&(pe(Te,_e.adler>>>16),pe(Te,65535&_e.adler)),_e.adler=1}if(Te.status===69)if(Te.gzhead.extra){for(Re=Te.pending;Te.gzindex<(65535&Te.gzhead.extra.length)&&(Te.pending!==Te.pending_buf_size||(Te.gzhead.hcrc&&Te.pending>Re&&(_e.adler=Y(_e.adler,Te.pending_buf,Te.pending-Re,Re)),Ie(_e),Re=Te.pending,Te.pending!==Te.pending_buf_size));)Se(Te,255&Te.gzhead.extra[Te.gzindex]),Te.gzindex++;Te.gzhead.hcrc&&Te.pending>Re&&(_e.adler=Y(_e.adler,Te.pending_buf,Te.pending-Re,Re)),Te.gzindex===Te.gzhead.extra.length&&(Te.gzindex=0,Te.status=73)}else Te.status=73;if(Te.status===73)if(Te.gzhead.name){Re=Te.pending;do{if(Te.pending===Te.pending_buf_size&&(Te.gzhead.hcrc&&Te.pending>Re&&(_e.adler=Y(_e.adler,Te.pending_buf,Te.pending-Re,Re)),Ie(_e),Re=Te.pending,Te.pending===Te.pending_buf_size)){He=1;break}He=Te.gzindex<Te.gzhead.name.length?255&Te.gzhead.name.charCodeAt(Te.gzindex++):0,Se(Te,He)}while(He!==0);Te.gzhead.hcrc&&Te.pending>Re&&(_e.adler=Y(_e.adler,Te.pending_buf,Te.pending-Re,Re)),He===0&&(Te.gzindex=0,Te.status=91)}else Te.status=91;if(Te.status===91)if(Te.gzhead.comment){Re=Te.pending;do{if(Te.pending===Te.pending_buf_size&&(Te.gzhead.hcrc&&Te.pending>Re&&(_e.adler=Y(_e.adler,Te.pending_buf,Te.pending-Re,Re)),Ie(_e),Re=Te.pending,Te.pending===Te.pending_buf_size)){He=1;break}He=Te.gzindex<Te.gzhead.comment.length?255&Te.gzhead.comment.charCodeAt(Te.gzindex++):0,Se(Te,He)}while(He!==0);Te.gzhead.hcrc&&Te.pending>Re&&(_e.adler=Y(_e.adler,Te.pending_buf,Te.pending-Re,Re)),He===0&&(Te.status=103)}else Te.status=103;if(Te.status===103&&(Te.gzhead.hcrc?(Te.pending+2>Te.pending_buf_size&&Ie(_e),Te.pending+2<=Te.pending_buf_size&&(Se(Te,255&_e.adler),Se(Te,_e.adler>>8&255),_e.adler=0,Te.status=Ce)):Te.status=Ce),Te.pending!==0){if(Ie(_e),_e.avail_out===0)return Te.last_flush=-1,te}else if(_e.avail_in===0&&Ne(We)<=Ne(Xe)&&We!==ee)return Me(_e,-5);if(Te.status===666&&_e.avail_in!==0)return Me(_e,-5);if(_e.avail_in!==0||Te.lookahead!==0||We!==Z&&Te.status!==666){var ot=Te.strategy===2?function($e,je){for(var Ke;;){if($e.lookahead===0&&(be($e),$e.lookahead===0)){if(je===Z)return ue;break}if($e.match_length=0,Ke=G._tr_tally($e,0,$e.window[$e.strstart]),$e.lookahead--,$e.strstart++,Ke&&(Oe($e,!1),$e.strm.avail_out===0))return ue}return $e.insert=0,je===ee?(Oe($e,!0),$e.strm.avail_out===0?ze:Le):$e.last_lit&&(Oe($e,!1),$e.strm.avail_out===0)?ue:Pe}(Te,We):Te.strategy===3?function($e,je){for(var Ke,Qe,dt,pt,wt=$e.window;;){if($e.lookahead<=we){if(be($e),$e.lookahead<=we&&je===Z)return ue;if($e.lookahead===0)break}if($e.match_length=0,$e.lookahead>=oe&&0<$e.strstart&&(Qe=wt[dt=$e.strstart-1])===wt[++dt]&&Qe===wt[++dt]&&Qe===wt[++dt]){pt=$e.strstart+we;do;while(Qe===wt[++dt]&&Qe===wt[++dt]&&Qe===wt[++dt]&&Qe===wt[++dt]&&Qe===wt[++dt]&&Qe===wt[++dt]&&Qe===wt[++dt]&&Qe===wt[++dt]&&dt<pt);$e.match_length=we-(pt-dt),$e.match_length>$e.lookahead&&($e.match_length=$e.lookahead)}if($e.match_length>=oe?(Ke=G._tr_tally($e,1,$e.match_length-oe),$e.lookahead-=$e.match_length,$e.strstart+=$e.match_length,$e.match_length=0):(Ke=G._tr_tally($e,0,$e.window[$e.strstart]),$e.lookahead--,$e.strstart++),Ke&&(Oe($e,!1),$e.strm.avail_out===0))return ue}return $e.insert=0,je===ee?(Oe($e,!0),$e.strm.avail_out===0?ze:Le):$e.last_lit&&(Oe($e,!1),$e.strm.avail_out===0)?ue:Pe}(Te,We):z[Te.level].func(Te,We);if(ot!==ze&&ot!==Le||(Te.status=666),ot===ue||ot===ze)return _e.avail_out===0&&(Te.last_flush=-1),te;if(ot===Pe&&(We===1?G._tr_align(Te):We!==5&&(G._tr_stored_block(Te,0,0,!1),We===3&&(Ye(Te.head),Te.lookahead===0&&(Te.strstart=0,Te.block_start=0,Te.insert=0))),Ie(_e),_e.avail_out===0))return Te.last_flush=-1,te}return We!==ee?te:Te.wrap<=0?1:(Te.wrap===2?(Se(Te,255&_e.adler),Se(Te,_e.adler>>8&255),Se(Te,_e.adler>>16&255),Se(Te,_e.adler>>24&255),Se(Te,255&_e.total_in),Se(Te,_e.total_in>>8&255),Se(Te,_e.total_in>>16&255),Se(Te,_e.total_in>>24&255)):(pe(Te,_e.adler>>>16),pe(Te,65535&_e.adler)),Ie(_e),0<Te.wrap&&(Te.wrap=-Te.wrap),Te.pending!==0?te:1)},j.deflateEnd=function(_e){var We;return _e&&_e.state?(We=_e.state.status)!==ve&&We!==69&&We!==73&&We!==91&&We!==103&&We!==Ce&&We!==666?Me(_e,ne):(_e.state=null,We===Ce?Me(_e,-3):te):ne},j.deflateSetDictionary=function(_e,We){var Xe,Te,Re,He,Ze,ot,$e,je,Ke=We.length;if(!_e||!_e.state||(He=(Xe=_e.state).wrap)===2||He===1&&Xe.status!==ve||Xe.lookahead)return ne;for(He===1&&(_e.adler=X(_e.adler,We,Ke,0)),Xe.wrap=0,Ke>=Xe.w_size&&(He===0&&(Ye(Xe.head),Xe.strstart=0,Xe.block_start=0,Xe.insert=0),je=new V.Buf8(Xe.w_size),V.arraySet(je,We,Ke-Xe.w_size,Xe.w_size,0),We=je,Ke=Xe.w_size),Ze=_e.avail_in,ot=_e.next_in,$e=_e.input,_e.avail_in=Ke,_e.next_in=0,_e.input=We,be(Xe);Xe.lookahead>=oe;){for(Te=Xe.strstart,Re=Xe.lookahead-(oe-1);Xe.ins_h=(Xe.ins_h<<Xe.hash_shift^Xe.window[Te+oe-1])&Xe.hash_mask,Xe.prev[Te&Xe.w_mask]=Xe.head[Xe.ins_h],Xe.head[Xe.ins_h]=Te,Te++,--Re;);Xe.strstart=Te,Xe.lookahead=oe-1,be(Xe)}return Xe.strstart+=Xe.lookahead,Xe.block_start=Xe.strstart,Xe.insert=Xe.lookahead,Xe.lookahead=0,Xe.match_length=Xe.prev_length=oe-1,Xe.match_available=0,_e.next_in=ot,_e.input=$e,_e.avail_in=Ze,Xe.wrap=He,te},j.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(M,$,j){$.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(M,$,j){$.exports=function(z,V){var G,X,Y,Q,Z,ee,te,ne,re,ie,se,le,he,ce,ae,de,ge,fe,oe,we,De,ve,Ce,ue,Pe;G=z.state,X=z.next_in,ue=z.input,Y=X+(z.avail_in-5),Q=z.next_out,Pe=z.output,Z=Q-(V-z.avail_out),ee=Q+(z.avail_out-257),te=G.dmax,ne=G.wsize,re=G.whave,ie=G.wnext,se=G.window,le=G.hold,he=G.bits,ce=G.lencode,ae=G.distcode,de=(1<<G.lenbits)-1,ge=(1<<G.distbits)-1;e:do{he<15&&(le+=ue[X++]<<he,he+=8,le+=ue[X++]<<he,he+=8),fe=ce[le&de];t:for(;;){if(le>>>=oe=fe>>>24,he-=oe,(oe=fe>>>16&255)===0)Pe[Q++]=65535&fe;else{if(!(16&oe)){if(!(64&oe)){fe=ce[(65535&fe)+(le&(1<<oe)-1)];continue t}if(32&oe){G.mode=12;break e}z.msg="invalid literal/length code",G.mode=30;break e}we=65535&fe,(oe&=15)&&(he<oe&&(le+=ue[X++]<<he,he+=8),we+=le&(1<<oe)-1,le>>>=oe,he-=oe),he<15&&(le+=ue[X++]<<he,he+=8,le+=ue[X++]<<he,he+=8),fe=ae[le&ge];n:for(;;){if(le>>>=oe=fe>>>24,he-=oe,!(16&(oe=fe>>>16&255))){if(!(64&oe)){fe=ae[(65535&fe)+(le&(1<<oe)-1)];continue n}z.msg="invalid distance code",G.mode=30;break e}if(De=65535&fe,he<(oe&=15)&&(le+=ue[X++]<<he,(he+=8)<oe&&(le+=ue[X++]<<he,he+=8)),te<(De+=le&(1<<oe)-1)){z.msg="invalid distance too far back",G.mode=30;break e}if(le>>>=oe,he-=oe,(oe=Q-Z)<De){if(re<(oe=De-oe)&&G.sane){z.msg="invalid distance too far back",G.mode=30;break e}if(Ce=se,(ve=0)===ie){if(ve+=ne-oe,oe<we){for(we-=oe;Pe[Q++]=se[ve++],--oe;);ve=Q-De,Ce=Pe}}else if(ie<oe){if(ve+=ne+ie-oe,(oe-=ie)<we){for(we-=oe;Pe[Q++]=se[ve++],--oe;);if(ve=0,ie<we){for(we-=oe=ie;Pe[Q++]=se[ve++],--oe;);ve=Q-De,Ce=Pe}}}else if(ve+=ie-oe,oe<we){for(we-=oe;Pe[Q++]=se[ve++],--oe;);ve=Q-De,Ce=Pe}for(;2<we;)Pe[Q++]=Ce[ve++],Pe[Q++]=Ce[ve++],Pe[Q++]=Ce[ve++],we-=3;we&&(Pe[Q++]=Ce[ve++],1<we&&(Pe[Q++]=Ce[ve++]))}else{for(ve=Q-De;Pe[Q++]=Pe[ve++],Pe[Q++]=Pe[ve++],Pe[Q++]=Pe[ve++],2<(we-=3););we&&(Pe[Q++]=Pe[ve++],1<we&&(Pe[Q++]=Pe[ve++]))}break}}break}}while(X<Y&&Q<ee);X-=we=he>>3,le&=(1<<(he-=we<<3))-1,z.next_in=X,z.next_out=Q,z.avail_in=X<Y?Y-X+5:5-(X-Y),z.avail_out=Q<ee?ee-Q+257:257-(Q-ee),G.hold=le,G.bits=he}},{}],49:[function(M,$,j){var z=M("../utils/common"),V=M("./adler32"),G=M("./crc32"),X=M("./inffast"),Y=M("./inftrees"),Q=1,Z=2,ee=0,te=-2,ne=1,re=852,ie=592;function se(ve){return(ve>>>24&255)+(ve>>>8&65280)+((65280&ve)<<8)+((255&ve)<<24)}function le(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new z.Buf16(320),this.work=new z.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function he(ve){var Ce;return ve&&ve.state?(Ce=ve.state,ve.total_in=ve.total_out=Ce.total=0,ve.msg="",Ce.wrap&&(ve.adler=1&Ce.wrap),Ce.mode=ne,Ce.last=0,Ce.havedict=0,Ce.dmax=32768,Ce.head=null,Ce.hold=0,Ce.bits=0,Ce.lencode=Ce.lendyn=new z.Buf32(re),Ce.distcode=Ce.distdyn=new z.Buf32(ie),Ce.sane=1,Ce.back=-1,ee):te}function ce(ve){var Ce;return ve&&ve.state?((Ce=ve.state).wsize=0,Ce.whave=0,Ce.wnext=0,he(ve)):te}function ae(ve,Ce){var ue,Pe;return ve&&ve.state?(Pe=ve.state,Ce<0?(ue=0,Ce=-Ce):(ue=1+(Ce>>4),Ce<48&&(Ce&=15)),Ce&&(Ce<8||15<Ce)?te:(Pe.window!==null&&Pe.wbits!==Ce&&(Pe.window=null),Pe.wrap=ue,Pe.wbits=Ce,ce(ve))):te}function de(ve,Ce){var ue,Pe;return ve?(Pe=new le,(ve.state=Pe).window=null,(ue=ae(ve,Ce))!==ee&&(ve.state=null),ue):te}var ge,fe,oe=!0;function we(ve){if(oe){var Ce;for(ge=new z.Buf32(512),fe=new z.Buf32(32),Ce=0;Ce<144;)ve.lens[Ce++]=8;for(;Ce<256;)ve.lens[Ce++]=9;for(;Ce<280;)ve.lens[Ce++]=7;for(;Ce<288;)ve.lens[Ce++]=8;for(Y(Q,ve.lens,0,288,ge,0,ve.work,{bits:9}),Ce=0;Ce<32;)ve.lens[Ce++]=5;Y(Z,ve.lens,0,32,fe,0,ve.work,{bits:5}),oe=!1}ve.lencode=ge,ve.lenbits=9,ve.distcode=fe,ve.distbits=5}function De(ve,Ce,ue,Pe){var ze,Le=ve.state;return Le.window===null&&(Le.wsize=1<<Le.wbits,Le.wnext=0,Le.whave=0,Le.window=new z.Buf8(Le.wsize)),Pe>=Le.wsize?(z.arraySet(Le.window,Ce,ue-Le.wsize,Le.wsize,0),Le.wnext=0,Le.whave=Le.wsize):(Pe<(ze=Le.wsize-Le.wnext)&&(ze=Pe),z.arraySet(Le.window,Ce,ue-Pe,ze,Le.wnext),(Pe-=ze)?(z.arraySet(Le.window,Ce,ue-Pe,Pe,0),Le.wnext=Pe,Le.whave=Le.wsize):(Le.wnext+=ze,Le.wnext===Le.wsize&&(Le.wnext=0),Le.whave<Le.wsize&&(Le.whave+=ze))),0}j.inflateReset=ce,j.inflateReset2=ae,j.inflateResetKeep=he,j.inflateInit=function(ve){return de(ve,15)},j.inflateInit2=de,j.inflate=function(ve,Ce){var ue,Pe,ze,Le,Me,Ne,Ye,Ie,Oe,Se,pe,me,be,Ee,ke,Fe,Be,Ue,nt,rt,_e,We,Xe,Te,Re=0,He=new z.Buf8(4),Ze=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ve||!ve.state||!ve.output||!ve.input&&ve.avail_in!==0)return te;(ue=ve.state).mode===12&&(ue.mode=13),Me=ve.next_out,ze=ve.output,Ye=ve.avail_out,Le=ve.next_in,Pe=ve.input,Ne=ve.avail_in,Ie=ue.hold,Oe=ue.bits,Se=Ne,pe=Ye,We=ee;e:for(;;)switch(ue.mode){case ne:if(ue.wrap===0){ue.mode=13;break}for(;Oe<16;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}if(2&ue.wrap&&Ie===35615){He[ue.check=0]=255&Ie,He[1]=Ie>>>8&255,ue.check=G(ue.check,He,2,0),Oe=Ie=0,ue.mode=2;break}if(ue.flags=0,ue.head&&(ue.head.done=!1),!(1&ue.wrap)||(((255&Ie)<<8)+(Ie>>8))%31){ve.msg="incorrect header check",ue.mode=30;break}if((15&Ie)!=8){ve.msg="unknown compression method",ue.mode=30;break}if(Oe-=4,_e=8+(15&(Ie>>>=4)),ue.wbits===0)ue.wbits=_e;else if(_e>ue.wbits){ve.msg="invalid window size",ue.mode=30;break}ue.dmax=1<<_e,ve.adler=ue.check=1,ue.mode=512&Ie?10:12,Oe=Ie=0;break;case 2:for(;Oe<16;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}if(ue.flags=Ie,(255&ue.flags)!=8){ve.msg="unknown compression method",ue.mode=30;break}if(57344&ue.flags){ve.msg="unknown header flags set",ue.mode=30;break}ue.head&&(ue.head.text=Ie>>8&1),512&ue.flags&&(He[0]=255&Ie,He[1]=Ie>>>8&255,ue.check=G(ue.check,He,2,0)),Oe=Ie=0,ue.mode=3;case 3:for(;Oe<32;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}ue.head&&(ue.head.time=Ie),512&ue.flags&&(He[0]=255&Ie,He[1]=Ie>>>8&255,He[2]=Ie>>>16&255,He[3]=Ie>>>24&255,ue.check=G(ue.check,He,4,0)),Oe=Ie=0,ue.mode=4;case 4:for(;Oe<16;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}ue.head&&(ue.head.xflags=255&Ie,ue.head.os=Ie>>8),512&ue.flags&&(He[0]=255&Ie,He[1]=Ie>>>8&255,ue.check=G(ue.check,He,2,0)),Oe=Ie=0,ue.mode=5;case 5:if(1024&ue.flags){for(;Oe<16;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}ue.length=Ie,ue.head&&(ue.head.extra_len=Ie),512&ue.flags&&(He[0]=255&Ie,He[1]=Ie>>>8&255,ue.check=G(ue.check,He,2,0)),Oe=Ie=0}else ue.head&&(ue.head.extra=null);ue.mode=6;case 6:if(1024&ue.flags&&(Ne<(me=ue.length)&&(me=Ne),me&&(ue.head&&(_e=ue.head.extra_len-ue.length,ue.head.extra||(ue.head.extra=new Array(ue.head.extra_len)),z.arraySet(ue.head.extra,Pe,Le,me,_e)),512&ue.flags&&(ue.check=G(ue.check,Pe,me,Le)),Ne-=me,Le+=me,ue.length-=me),ue.length))break e;ue.length=0,ue.mode=7;case 7:if(2048&ue.flags){if(Ne===0)break e;for(me=0;_e=Pe[Le+me++],ue.head&&_e&&ue.length<65536&&(ue.head.name+=String.fromCharCode(_e)),_e&&me<Ne;);if(512&ue.flags&&(ue.check=G(ue.check,Pe,me,Le)),Ne-=me,Le+=me,_e)break e}else ue.head&&(ue.head.name=null);ue.length=0,ue.mode=8;case 8:if(4096&ue.flags){if(Ne===0)break e;for(me=0;_e=Pe[Le+me++],ue.head&&_e&&ue.length<65536&&(ue.head.comment+=String.fromCharCode(_e)),_e&&me<Ne;);if(512&ue.flags&&(ue.check=G(ue.check,Pe,me,Le)),Ne-=me,Le+=me,_e)break e}else ue.head&&(ue.head.comment=null);ue.mode=9;case 9:if(512&ue.flags){for(;Oe<16;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}if(Ie!==(65535&ue.check)){ve.msg="header crc mismatch",ue.mode=30;break}Oe=Ie=0}ue.head&&(ue.head.hcrc=ue.flags>>9&1,ue.head.done=!0),ve.adler=ue.check=0,ue.mode=12;break;case 10:for(;Oe<32;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}ve.adler=ue.check=se(Ie),Oe=Ie=0,ue.mode=11;case 11:if(ue.havedict===0)return ve.next_out=Me,ve.avail_out=Ye,ve.next_in=Le,ve.avail_in=Ne,ue.hold=Ie,ue.bits=Oe,2;ve.adler=ue.check=1,ue.mode=12;case 12:if(Ce===5||Ce===6)break e;case 13:if(ue.last){Ie>>>=7&Oe,Oe-=7&Oe,ue.mode=27;break}for(;Oe<3;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}switch(ue.last=1&Ie,Oe-=1,3&(Ie>>>=1)){case 0:ue.mode=14;break;case 1:if(we(ue),ue.mode=20,Ce!==6)break;Ie>>>=2,Oe-=2;break e;case 2:ue.mode=17;break;case 3:ve.msg="invalid block type",ue.mode=30}Ie>>>=2,Oe-=2;break;case 14:for(Ie>>>=7&Oe,Oe-=7&Oe;Oe<32;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}if((65535&Ie)!=(Ie>>>16^65535)){ve.msg="invalid stored block lengths",ue.mode=30;break}if(ue.length=65535&Ie,Oe=Ie=0,ue.mode=15,Ce===6)break e;case 15:ue.mode=16;case 16:if(me=ue.length){if(Ne<me&&(me=Ne),Ye<me&&(me=Ye),me===0)break e;z.arraySet(ze,Pe,Le,me,Me),Ne-=me,Le+=me,Ye-=me,Me+=me,ue.length-=me;break}ue.mode=12;break;case 17:for(;Oe<14;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}if(ue.nlen=257+(31&Ie),Ie>>>=5,Oe-=5,ue.ndist=1+(31&Ie),Ie>>>=5,Oe-=5,ue.ncode=4+(15&Ie),Ie>>>=4,Oe-=4,286<ue.nlen||30<ue.ndist){ve.msg="too many length or distance symbols",ue.mode=30;break}ue.have=0,ue.mode=18;case 18:for(;ue.have<ue.ncode;){for(;Oe<3;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}ue.lens[Ze[ue.have++]]=7&Ie,Ie>>>=3,Oe-=3}for(;ue.have<19;)ue.lens[Ze[ue.have++]]=0;if(ue.lencode=ue.lendyn,ue.lenbits=7,Xe={bits:ue.lenbits},We=Y(0,ue.lens,0,19,ue.lencode,0,ue.work,Xe),ue.lenbits=Xe.bits,We){ve.msg="invalid code lengths set",ue.mode=30;break}ue.have=0,ue.mode=19;case 19:for(;ue.have<ue.nlen+ue.ndist;){for(;Fe=(Re=ue.lencode[Ie&(1<<ue.lenbits)-1])>>>16&255,Be=65535&Re,!((ke=Re>>>24)<=Oe);){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}if(Be<16)Ie>>>=ke,Oe-=ke,ue.lens[ue.have++]=Be;else{if(Be===16){for(Te=ke+2;Oe<Te;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}if(Ie>>>=ke,Oe-=ke,ue.have===0){ve.msg="invalid bit length repeat",ue.mode=30;break}_e=ue.lens[ue.have-1],me=3+(3&Ie),Ie>>>=2,Oe-=2}else if(Be===17){for(Te=ke+3;Oe<Te;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}Oe-=ke,_e=0,me=3+(7&(Ie>>>=ke)),Ie>>>=3,Oe-=3}else{for(Te=ke+7;Oe<Te;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}Oe-=ke,_e=0,me=11+(127&(Ie>>>=ke)),Ie>>>=7,Oe-=7}if(ue.have+me>ue.nlen+ue.ndist){ve.msg="invalid bit length repeat",ue.mode=30;break}for(;me--;)ue.lens[ue.have++]=_e}}if(ue.mode===30)break;if(ue.lens[256]===0){ve.msg="invalid code -- missing end-of-block",ue.mode=30;break}if(ue.lenbits=9,Xe={bits:ue.lenbits},We=Y(Q,ue.lens,0,ue.nlen,ue.lencode,0,ue.work,Xe),ue.lenbits=Xe.bits,We){ve.msg="invalid literal/lengths set",ue.mode=30;break}if(ue.distbits=6,ue.distcode=ue.distdyn,Xe={bits:ue.distbits},We=Y(Z,ue.lens,ue.nlen,ue.ndist,ue.distcode,0,ue.work,Xe),ue.distbits=Xe.bits,We){ve.msg="invalid distances set",ue.mode=30;break}if(ue.mode=20,Ce===6)break e;case 20:ue.mode=21;case 21:if(6<=Ne&&258<=Ye){ve.next_out=Me,ve.avail_out=Ye,ve.next_in=Le,ve.avail_in=Ne,ue.hold=Ie,ue.bits=Oe,X(ve,pe),Me=ve.next_out,ze=ve.output,Ye=ve.avail_out,Le=ve.next_in,Pe=ve.input,Ne=ve.avail_in,Ie=ue.hold,Oe=ue.bits,ue.mode===12&&(ue.back=-1);break}for(ue.back=0;Fe=(Re=ue.lencode[Ie&(1<<ue.lenbits)-1])>>>16&255,Be=65535&Re,!((ke=Re>>>24)<=Oe);){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}if(Fe&&!(240&Fe)){for(Ue=ke,nt=Fe,rt=Be;Fe=(Re=ue.lencode[rt+((Ie&(1<<Ue+nt)-1)>>Ue)])>>>16&255,Be=65535&Re,!(Ue+(ke=Re>>>24)<=Oe);){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}Ie>>>=Ue,Oe-=Ue,ue.back+=Ue}if(Ie>>>=ke,Oe-=ke,ue.back+=ke,ue.length=Be,Fe===0){ue.mode=26;break}if(32&Fe){ue.back=-1,ue.mode=12;break}if(64&Fe){ve.msg="invalid literal/length code",ue.mode=30;break}ue.extra=15&Fe,ue.mode=22;case 22:if(ue.extra){for(Te=ue.extra;Oe<Te;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}ue.length+=Ie&(1<<ue.extra)-1,Ie>>>=ue.extra,Oe-=ue.extra,ue.back+=ue.extra}ue.was=ue.length,ue.mode=23;case 23:for(;Fe=(Re=ue.distcode[Ie&(1<<ue.distbits)-1])>>>16&255,Be=65535&Re,!((ke=Re>>>24)<=Oe);){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}if(!(240&Fe)){for(Ue=ke,nt=Fe,rt=Be;Fe=(Re=ue.distcode[rt+((Ie&(1<<Ue+nt)-1)>>Ue)])>>>16&255,Be=65535&Re,!(Ue+(ke=Re>>>24)<=Oe);){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}Ie>>>=Ue,Oe-=Ue,ue.back+=Ue}if(Ie>>>=ke,Oe-=ke,ue.back+=ke,64&Fe){ve.msg="invalid distance code",ue.mode=30;break}ue.offset=Be,ue.extra=15&Fe,ue.mode=24;case 24:if(ue.extra){for(Te=ue.extra;Oe<Te;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}ue.offset+=Ie&(1<<ue.extra)-1,Ie>>>=ue.extra,Oe-=ue.extra,ue.back+=ue.extra}if(ue.offset>ue.dmax){ve.msg="invalid distance too far back",ue.mode=30;break}ue.mode=25;case 25:if(Ye===0)break e;if(me=pe-Ye,ue.offset>me){if((me=ue.offset-me)>ue.whave&&ue.sane){ve.msg="invalid distance too far back",ue.mode=30;break}be=me>ue.wnext?(me-=ue.wnext,ue.wsize-me):ue.wnext-me,me>ue.length&&(me=ue.length),Ee=ue.window}else Ee=ze,be=Me-ue.offset,me=ue.length;for(Ye<me&&(me=Ye),Ye-=me,ue.length-=me;ze[Me++]=Ee[be++],--me;);ue.length===0&&(ue.mode=21);break;case 26:if(Ye===0)break e;ze[Me++]=ue.length,Ye--,ue.mode=21;break;case 27:if(ue.wrap){for(;Oe<32;){if(Ne===0)break e;Ne--,Ie|=Pe[Le++]<<Oe,Oe+=8}if(pe-=Ye,ve.total_out+=pe,ue.total+=pe,pe&&(ve.adler=ue.check=ue.flags?G(ue.check,ze,pe,Me-pe):V(ue.check,ze,pe,Me-pe)),pe=Ye,(ue.flags?Ie:se(Ie))!==ue.check){ve.msg="incorrect data check",ue.mode=30;break}Oe=Ie=0}ue.mode=28;case 28:if(ue.wrap&&ue.flags){for(;Oe<32;){if(Ne===0)break e;Ne--,Ie+=Pe[Le++]<<Oe,Oe+=8}if(Ie!==(4294967295&ue.total)){ve.msg="incorrect length check",ue.mode=30;break}Oe=Ie=0}ue.mode=29;case 29:We=1;break e;case 30:We=-3;break e;case 31:return-4;case 32:default:return te}return ve.next_out=Me,ve.avail_out=Ye,ve.next_in=Le,ve.avail_in=Ne,ue.hold=Ie,ue.bits=Oe,(ue.wsize||pe!==ve.avail_out&&ue.mode<30&&(ue.mode<27||Ce!==4))&&De(ve,ve.output,ve.next_out,pe-ve.avail_out)?(ue.mode=31,-4):(Se-=ve.avail_in,pe-=ve.avail_out,ve.total_in+=Se,ve.total_out+=pe,ue.total+=pe,ue.wrap&&pe&&(ve.adler=ue.check=ue.flags?G(ue.check,ze,pe,ve.next_out-pe):V(ue.check,ze,pe,ve.next_out-pe)),ve.data_type=ue.bits+(ue.last?64:0)+(ue.mode===12?128:0)+(ue.mode===20||ue.mode===15?256:0),(Se==0&&pe===0||Ce===4)&&We===ee&&(We=-5),We)},j.inflateEnd=function(ve){if(!ve||!ve.state)return te;var Ce=ve.state;return Ce.window&&(Ce.window=null),ve.state=null,ee},j.inflateGetHeader=function(ve,Ce){var ue;return ve&&ve.state&&2&(ue=ve.state).wrap?((ue.head=Ce).done=!1,ee):te},j.inflateSetDictionary=function(ve,Ce){var ue,Pe=Ce.length;return ve&&ve.state?(ue=ve.state).wrap!==0&&ue.mode!==11?te:ue.mode===11&&V(1,Ce,Pe,0)!==ue.check?-3:De(ve,Ce,Pe,Pe)?(ue.mode=31,-4):(ue.havedict=1,ee):te},j.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(M,$,j){var z=M("../utils/common"),V=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],G=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],X=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Y=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];$.exports=function(Q,Z,ee,te,ne,re,ie,se){var le,he,ce,ae,de,ge,fe,oe,we,De=se.bits,ve=0,Ce=0,ue=0,Pe=0,ze=0,Le=0,Me=0,Ne=0,Ye=0,Ie=0,Oe=null,Se=0,pe=new z.Buf16(16),me=new z.Buf16(16),be=null,Ee=0;for(ve=0;ve<=15;ve++)pe[ve]=0;for(Ce=0;Ce<te;Ce++)pe[Z[ee+Ce]]++;for(ze=De,Pe=15;1<=Pe&&pe[Pe]===0;Pe--);if(Pe<ze&&(ze=Pe),Pe===0)return ne[re++]=20971520,ne[re++]=20971520,se.bits=1,0;for(ue=1;ue<Pe&&pe[ue]===0;ue++);for(ze<ue&&(ze=ue),ve=Ne=1;ve<=15;ve++)if(Ne<<=1,(Ne-=pe[ve])<0)return-1;if(0<Ne&&(Q===0||Pe!==1))return-1;for(me[1]=0,ve=1;ve<15;ve++)me[ve+1]=me[ve]+pe[ve];for(Ce=0;Ce<te;Ce++)Z[ee+Ce]!==0&&(ie[me[Z[ee+Ce]]++]=Ce);if(ge=Q===0?(Oe=be=ie,19):Q===1?(Oe=V,Se-=257,be=G,Ee-=257,256):(Oe=X,be=Y,-1),ve=ue,de=re,Me=Ce=Ie=0,ce=-1,ae=(Ye=1<<(Le=ze))-1,Q===1&&852<Ye||Q===2&&592<Ye)return 1;for(;;){for(fe=ve-Me,we=ie[Ce]<ge?(oe=0,ie[Ce]):ie[Ce]>ge?(oe=be[Ee+ie[Ce]],Oe[Se+ie[Ce]]):(oe=96,0),le=1<<ve-Me,ue=he=1<<Le;ne[de+(Ie>>Me)+(he-=le)]=fe<<24|oe<<16|we|0,he!==0;);for(le=1<<ve-1;Ie&le;)le>>=1;if(le!==0?(Ie&=le-1,Ie+=le):Ie=0,Ce++,--pe[ve]==0){if(ve===Pe)break;ve=Z[ee+ie[Ce]]}if(ze<ve&&(Ie&ae)!==ce){for(Me===0&&(Me=ze),de+=ue,Ne=1<<(Le=ve-Me);Le+Me<Pe&&!((Ne-=pe[Le+Me])<=0);)Le++,Ne<<=1;if(Ye+=1<<Le,Q===1&&852<Ye||Q===2&&592<Ye)return 1;ne[ce=Ie&ae]=ze<<24|Le<<16|de-re|0}}return Ie!==0&&(ne[de+Ie]=ve-Me<<24|64<<16|0),se.bits=ze,0}},{"../utils/common":41}],51:[function(M,$,j){$.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(M,$,j){var z=M("../utils/common"),V=0,G=1;function X(Re){for(var He=Re.length;0<=--He;)Re[He]=0}var Y=0,Q=29,Z=256,ee=Z+1+Q,te=30,ne=19,re=2*ee+1,ie=15,se=16,le=7,he=256,ce=16,ae=17,de=18,ge=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],fe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],oe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],we=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],De=new Array(2*(ee+2));X(De);var ve=new Array(2*te);X(ve);var Ce=new Array(512);X(Ce);var ue=new Array(256);X(ue);var Pe=new Array(Q);X(Pe);var ze,Le,Me,Ne=new Array(te);function Ye(Re,He,Ze,ot,$e){this.static_tree=Re,this.extra_bits=He,this.extra_base=Ze,this.elems=ot,this.max_length=$e,this.has_stree=Re&&Re.length}function Ie(Re,He){this.dyn_tree=Re,this.max_code=0,this.stat_desc=He}function Oe(Re){return Re<256?Ce[Re]:Ce[256+(Re>>>7)]}function Se(Re,He){Re.pending_buf[Re.pending++]=255&He,Re.pending_buf[Re.pending++]=He>>>8&255}function pe(Re,He,Ze){Re.bi_valid>se-Ze?(Re.bi_buf|=He<<Re.bi_valid&65535,Se(Re,Re.bi_buf),Re.bi_buf=He>>se-Re.bi_valid,Re.bi_valid+=Ze-se):(Re.bi_buf|=He<<Re.bi_valid&65535,Re.bi_valid+=Ze)}function me(Re,He,Ze){pe(Re,Ze[2*He],Ze[2*He+1])}function be(Re,He){for(var Ze=0;Ze|=1&Re,Re>>>=1,Ze<<=1,0<--He;);return Ze>>>1}function Ee(Re,He,Ze){var ot,$e,je=new Array(ie+1),Ke=0;for(ot=1;ot<=ie;ot++)je[ot]=Ke=Ke+Ze[ot-1]<<1;for($e=0;$e<=He;$e++){var Qe=Re[2*$e+1];Qe!==0&&(Re[2*$e]=be(je[Qe]++,Qe))}}function ke(Re){var He;for(He=0;He<ee;He++)Re.dyn_ltree[2*He]=0;for(He=0;He<te;He++)Re.dyn_dtree[2*He]=0;for(He=0;He<ne;He++)Re.bl_tree[2*He]=0;Re.dyn_ltree[2*he]=1,Re.opt_len=Re.static_len=0,Re.last_lit=Re.matches=0}function Fe(Re){8<Re.bi_valid?Se(Re,Re.bi_buf):0<Re.bi_valid&&(Re.pending_buf[Re.pending++]=Re.bi_buf),Re.bi_buf=0,Re.bi_valid=0}function Be(Re,He,Ze,ot){var $e=2*He,je=2*Ze;return Re[$e]<Re[je]||Re[$e]===Re[je]&&ot[He]<=ot[Ze]}function Ue(Re,He,Ze){for(var ot=Re.heap[Ze],$e=Ze<<1;$e<=Re.heap_len&&($e<Re.heap_len&&Be(He,Re.heap[$e+1],Re.heap[$e],Re.depth)&&$e++,!Be(He,ot,Re.heap[$e],Re.depth));)Re.heap[Ze]=Re.heap[$e],Ze=$e,$e<<=1;Re.heap[Ze]=ot}function nt(Re,He,Ze){var ot,$e,je,Ke,Qe=0;if(Re.last_lit!==0)for(;ot=Re.pending_buf[Re.d_buf+2*Qe]<<8|Re.pending_buf[Re.d_buf+2*Qe+1],$e=Re.pending_buf[Re.l_buf+Qe],Qe++,ot===0?me(Re,$e,He):(me(Re,(je=ue[$e])+Z+1,He),(Ke=ge[je])!==0&&pe(Re,$e-=Pe[je],Ke),me(Re,je=Oe(--ot),Ze),(Ke=fe[je])!==0&&pe(Re,ot-=Ne[je],Ke)),Qe<Re.last_lit;);me(Re,he,He)}function rt(Re,He){var Ze,ot,$e,je=He.dyn_tree,Ke=He.stat_desc.static_tree,Qe=He.stat_desc.has_stree,dt=He.stat_desc.elems,pt=-1;for(Re.heap_len=0,Re.heap_max=re,Ze=0;Ze<dt;Ze++)je[2*Ze]!==0?(Re.heap[++Re.heap_len]=pt=Ze,Re.depth[Ze]=0):je[2*Ze+1]=0;for(;Re.heap_len<2;)je[2*($e=Re.heap[++Re.heap_len]=pt<2?++pt:0)]=1,Re.depth[$e]=0,Re.opt_len--,Qe&&(Re.static_len-=Ke[2*$e+1]);for(He.max_code=pt,Ze=Re.heap_len>>1;1<=Ze;Ze--)Ue(Re,je,Ze);for($e=dt;Ze=Re.heap[1],Re.heap[1]=Re.heap[Re.heap_len--],Ue(Re,je,1),ot=Re.heap[1],Re.heap[--Re.heap_max]=Ze,Re.heap[--Re.heap_max]=ot,je[2*$e]=je[2*Ze]+je[2*ot],Re.depth[$e]=(Re.depth[Ze]>=Re.depth[ot]?Re.depth[Ze]:Re.depth[ot])+1,je[2*Ze+1]=je[2*ot+1]=$e,Re.heap[1]=$e++,Ue(Re,je,1),2<=Re.heap_len;);Re.heap[--Re.heap_max]=Re.heap[1],function(wt,St){var Rt,xt,It,ht,ft,lt,et=St.dyn_tree,tt=St.max_code,mt=St.stat_desc.static_tree,gt=St.stat_desc.has_stree,Ut=St.stat_desc.extra_bits,jt=St.stat_desc.extra_base,at=St.stat_desc.max_length,yt=0;for(ht=0;ht<=ie;ht++)wt.bl_count[ht]=0;for(et[2*wt.heap[wt.heap_max]+1]=0,Rt=wt.heap_max+1;Rt<re;Rt++)at<(ht=et[2*et[2*(xt=wt.heap[Rt])+1]+1]+1)&&(ht=at,yt++),et[2*xt+1]=ht,tt<xt||(wt.bl_count[ht]++,ft=0,jt<=xt&&(ft=Ut[xt-jt]),lt=et[2*xt],wt.opt_len+=lt*(ht+ft),gt&&(wt.static_len+=lt*(mt[2*xt+1]+ft)));if(yt!==0){do{for(ht=at-1;wt.bl_count[ht]===0;)ht--;wt.bl_count[ht]--,wt.bl_count[ht+1]+=2,wt.bl_count[at]--,yt-=2}while(0<yt);for(ht=at;ht!==0;ht--)for(xt=wt.bl_count[ht];xt!==0;)tt<(It=wt.heap[--Rt])||(et[2*It+1]!==ht&&(wt.opt_len+=(ht-et[2*It+1])*et[2*It],et[2*It+1]=ht),xt--)}}(Re,He),Ee(je,pt,Re.bl_count)}function _e(Re,He,Ze){var ot,$e,je=-1,Ke=He[1],Qe=0,dt=7,pt=4;for(Ke===0&&(dt=138,pt=3),He[2*(Ze+1)+1]=65535,ot=0;ot<=Ze;ot++)$e=Ke,Ke=He[2*(ot+1)+1],++Qe<dt&&$e===Ke||(Qe<pt?Re.bl_tree[2*$e]+=Qe:$e!==0?($e!==je&&Re.bl_tree[2*$e]++,Re.bl_tree[2*ce]++):Qe<=10?Re.bl_tree[2*ae]++:Re.bl_tree[2*de]++,je=$e,pt=(Qe=0)===Ke?(dt=138,3):$e===Ke?(dt=6,3):(dt=7,4))}function We(Re,He,Ze){var ot,$e,je=-1,Ke=He[1],Qe=0,dt=7,pt=4;for(Ke===0&&(dt=138,pt=3),ot=0;ot<=Ze;ot++)if($e=Ke,Ke=He[2*(ot+1)+1],!(++Qe<dt&&$e===Ke)){if(Qe<pt)for(;me(Re,$e,Re.bl_tree),--Qe!=0;);else $e!==0?($e!==je&&(me(Re,$e,Re.bl_tree),Qe--),me(Re,ce,Re.bl_tree),pe(Re,Qe-3,2)):Qe<=10?(me(Re,ae,Re.bl_tree),pe(Re,Qe-3,3)):(me(Re,de,Re.bl_tree),pe(Re,Qe-11,7));je=$e,pt=(Qe=0)===Ke?(dt=138,3):$e===Ke?(dt=6,3):(dt=7,4)}}X(Ne);var Xe=!1;function Te(Re,He,Ze,ot){pe(Re,(Y<<1)+(ot?1:0),3),function($e,je,Ke,Qe){Fe($e),Qe&&(Se($e,Ke),Se($e,~Ke)),z.arraySet($e.pending_buf,$e.window,je,Ke,$e.pending),$e.pending+=Ke}(Re,He,Ze,!0)}j._tr_init=function(Re){Xe||(function(){var He,Ze,ot,$e,je,Ke=new Array(ie+1);for($e=ot=0;$e<Q-1;$e++)for(Pe[$e]=ot,He=0;He<1<<ge[$e];He++)ue[ot++]=$e;for(ue[ot-1]=$e,$e=je=0;$e<16;$e++)for(Ne[$e]=je,He=0;He<1<<fe[$e];He++)Ce[je++]=$e;for(je>>=7;$e<te;$e++)for(Ne[$e]=je<<7,He=0;He<1<<fe[$e]-7;He++)Ce[256+je++]=$e;for(Ze=0;Ze<=ie;Ze++)Ke[Ze]=0;for(He=0;He<=143;)De[2*He+1]=8,He++,Ke[8]++;for(;He<=255;)De[2*He+1]=9,He++,Ke[9]++;for(;He<=279;)De[2*He+1]=7,He++,Ke[7]++;for(;He<=287;)De[2*He+1]=8,He++,Ke[8]++;for(Ee(De,ee+1,Ke),He=0;He<te;He++)ve[2*He+1]=5,ve[2*He]=be(He,5);ze=new Ye(De,ge,Z+1,ee,ie),Le=new Ye(ve,fe,0,te,ie),Me=new Ye(new Array(0),oe,0,ne,le)}(),Xe=!0),Re.l_desc=new Ie(Re.dyn_ltree,ze),Re.d_desc=new Ie(Re.dyn_dtree,Le),Re.bl_desc=new Ie(Re.bl_tree,Me),Re.bi_buf=0,Re.bi_valid=0,ke(Re)},j._tr_stored_block=Te,j._tr_flush_block=function(Re,He,Ze,ot){var $e,je,Ke=0;0<Re.level?(Re.strm.data_type===2&&(Re.strm.data_type=function(Qe){var dt,pt=4093624447;for(dt=0;dt<=31;dt++,pt>>>=1)if(1&pt&&Qe.dyn_ltree[2*dt]!==0)return V;if(Qe.dyn_ltree[18]!==0||Qe.dyn_ltree[20]!==0||Qe.dyn_ltree[26]!==0)return G;for(dt=32;dt<Z;dt++)if(Qe.dyn_ltree[2*dt]!==0)return G;return V}(Re)),rt(Re,Re.l_desc),rt(Re,Re.d_desc),Ke=function(Qe){var dt;for(_e(Qe,Qe.dyn_ltree,Qe.l_desc.max_code),_e(Qe,Qe.dyn_dtree,Qe.d_desc.max_code),rt(Qe,Qe.bl_desc),dt=ne-1;3<=dt&&Qe.bl_tree[2*we[dt]+1]===0;dt--);return Qe.opt_len+=3*(dt+1)+5+5+4,dt}(Re),$e=Re.opt_len+3+7>>>3,(je=Re.static_len+3+7>>>3)<=$e&&($e=je)):$e=je=Ze+5,Ze+4<=$e&&He!==-1?Te(Re,He,Ze,ot):Re.strategy===4||je===$e?(pe(Re,2+(ot?1:0),3),nt(Re,De,ve)):(pe(Re,4+(ot?1:0),3),function(Qe,dt,pt,wt){var St;for(pe(Qe,dt-257,5),pe(Qe,pt-1,5),pe(Qe,wt-4,4),St=0;St<wt;St++)pe(Qe,Qe.bl_tree[2*we[St]+1],3);We(Qe,Qe.dyn_ltree,dt-1),We(Qe,Qe.dyn_dtree,pt-1)}(Re,Re.l_desc.max_code+1,Re.d_desc.max_code+1,Ke+1),nt(Re,Re.dyn_ltree,Re.dyn_dtree)),ke(Re),ot&&Fe(Re)},j._tr_tally=function(Re,He,Ze){return Re.pending_buf[Re.d_buf+2*Re.last_lit]=He>>>8&255,Re.pending_buf[Re.d_buf+2*Re.last_lit+1]=255&He,Re.pending_buf[Re.l_buf+Re.last_lit]=255&Ze,Re.last_lit++,He===0?Re.dyn_ltree[2*Ze]++:(Re.matches++,He--,Re.dyn_ltree[2*(ue[Ze]+Z+1)]++,Re.dyn_dtree[2*Oe(He)]++),Re.last_lit===Re.lit_bufsize-1},j._tr_align=function(Re){pe(Re,2,3),me(Re,he,De),function(He){He.bi_valid===16?(Se(He,He.bi_buf),He.bi_buf=0,He.bi_valid=0):8<=He.bi_valid&&(He.pending_buf[He.pending++]=255&He.bi_buf,He.bi_buf>>=8,He.bi_valid-=8)}(Re)}},{"../utils/common":41}],53:[function(M,$,j){$.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(M,$,j){(function(z){(function(V,G){if(!V.setImmediate){var X,Y,Q,Z,ee=1,te={},ne=!1,re=V.document,ie=Object.getPrototypeOf&&Object.getPrototypeOf(V);ie=ie&&ie.setTimeout?ie:V,X={}.toString.call(V.process)==="[object process]"?function(ce){process.nextTick(function(){le(ce)})}:function(){if(V.postMessage&&!V.importScripts){var ce=!0,ae=V.onmessage;return V.onmessage=function(){ce=!1},V.postMessage("","*"),V.onmessage=ae,ce}}()?(Z="setImmediate$"+Math.random()+"$",V.addEventListener?V.addEventListener("message",he,!1):V.attachEvent("onmessage",he),function(ce){V.postMessage(Z+ce,"*")}):V.MessageChannel?((Q=new MessageChannel).port1.onmessage=function(ce){le(ce.data)},function(ce){Q.port2.postMessage(ce)}):re&&"onreadystatechange"in re.createElement("script")?(Y=re.documentElement,function(ce){var ae=re.createElement("script");ae.onreadystatechange=function(){le(ce),ae.onreadystatechange=null,Y.removeChild(ae),ae=null},Y.appendChild(ae)}):function(ce){setTimeout(le,0,ce)},ie.setImmediate=function(ce){typeof ce!="function"&&(ce=new Function(""+ce));for(var ae=new Array(arguments.length-1),de=0;de<ae.length;de++)ae[de]=arguments[de+1];var ge={callback:ce,args:ae};return te[ee]=ge,X(ee),ee++},ie.clearImmediate=se}function se(ce){delete te[ce]}function le(ce){if(ne)setTimeout(le,0,ce);else{var ae=te[ce];if(ae){ne=!0;try{(function(de){var ge=de.callback,fe=de.args;switch(fe.length){case 0:ge();break;case 1:ge(fe[0]);break;case 2:ge(fe[0],fe[1]);break;case 3:ge(fe[0],fe[1],fe[2]);break;default:ge.apply(G,fe)}})(ae)}finally{se(ce),ne=!1}}}}function he(ce){ce.source===V&&typeof ce.data=="string"&&ce.data.indexOf(Z)===0&&le(+ce.data.slice(Z.length))}})(typeof self>"u"?z===void 0?this:z:self)}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(jszip_min);var jszip_minExports=jszip_min.exports;const JSZip=getDefaultExportFromCjs(jszip_minExports);function create_if_block$f(q){let _,M,$,j,z;M=new Tooltip({props:{text:"backing up "+(q[0]?"your studio":"the commons")+" by downloading a zip file",$$slots:{default:[create_default_slot$2]},$$scope:{ctx:q}}});let V=q[1]>0&&create_if_block_1$c(q);return{c(){_=element("div"),create_component(M.$$.fragment),$=space(),V&&V.c(),attr(_,"class",j=(q[0]?"":"phase1")+" flex flex-col-reverse")},m(G,X){insert(G,_,X),mount_component(M,_,null),append(_,$),V&&V.m(_,null),z=!0},p(G,X){const Y={};X&1&&(Y.text="backing up "+(G[0]?"your studio":"the commons")+" by downloading a zip file"),X&262145&&(Y.$$scope={dirty:X,ctx:G}),M.$set(Y),G[1]>0?V?V.p(G,X):(V=create_if_block_1$c(G),V.c(),V.m(_,null)):V&&(V.d(1),V=null),(!z||X&1&&j!==(j=(G[0]?"":"phase1")+" flex flex-col-reverse"))&&attr(_,"class",j)},i(G){z||(transition_in(M.$$.fragment,G),z=!0)},o(G){transition_out(M.$$.fragment,G),z=!1},d(G){G&&detach(_),destroy_component(M),V&&V.d()}}}function create_default_slot$2(q){let _,M=q[0]?"backup this studio":"Create Archive",$,j,z;return{c(){_=element("button"),$=text(M),attr(_,"class","w-full")},m(V,G){insert(V,_,G),append(_,$),j||(z=listen(_,"click",q[3]),j=!0)},p(V,G){G&1&&M!==(M=V[0]?"backup this studio":"Create Archive")&&set_data($,M)},d(V){V&&detach(_),j=!1,z()}}}function create_if_block_1$c(q){let _,M,$,j,z=q[1]>1?"times":"time",V;return{c(){_=element("p"),M=text("This button was used "),$=text(q[1]),j=space(),V=text(z),attr(_,"class","text-left")},m(G,X){insert(G,_,X),append(_,M),append(_,$),append(_,j),append(_,V)},p(G,X){X&2&&set_data($,G[1]),X&2&&z!==(z=G[1]>1?"times":"time")&&set_data(V,z)},d(G){G&&detach(_)}}}function create_fragment$k(q){let _,M,$=!q[2]&&create_if_block$f(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,[z]){j[2]?$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros()):$?($.p(j,z),z&4&&transition_in($,1)):($=create_if_block$f(j),$.c(),transition_in($,1),$.m(_.parentNode,_))},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function instance$j(q,_,M){let $,j,z;component_subscribe(q,replicaDetails,le=>M(8,$=le)),component_subscribe(q,cacheDetails,le=>M(9,j=le)),component_subscribe(q,authorKeypair,le=>M(10,z=le));let V=[],G,X,Y=!0,{shareAddress:Q}=_,{isStudio:Z=!1}=_;shareKeypair.subscribe(le=>{M(5,X=le.shareAddress)});const ee=async()=>{console.log("fetching counter");let le=await j.queryDocs({filter:{pathStartsWith:"/counter"}});le.length>0?M(1,G=le[0].text):M(1,G="0")},te=async()=>{await ee();let le=G,de=(parseInt(le||"0")+1).toString();await $.replica.set(z,{path:"/counter/number",text:de}),M(1,G=de)},ne=async()=>{V=await j.queryDocs({filter:{pathStartsWith:"/documents"}}),V.map(le=>le.path)},re=async le=>{for(let he of V){let ce=le.folder(he.path.replace("/","_"));if(ce.file("document.txt",JSON.stringify(he)),he.attachmentSize){let ae=await $.replica.getAttachment(he),de=ae?await ae.bytes():void 0,ge=he.path.split("/").pop().replace("!","");ce.file(ge,de)}}},ie=async le=>{let he=await le.generateAsync({type:"blob"}),ce=document.createElement("a"),ae=new Date().toISOString().slice(0,10);ce.href=URL.createObjectURL(he),ce.download="archive_"+ae+".zip",ce.style.display="none",document.body.appendChild(ce),ce.click()},se=async()=>{try{let le=new JSZip;await ne(),await re(le),await ie(le),await te()}catch(le){console.error("Error during archival:",le)}};return q.$$set=le=>{"shareAddress"in le&&M(4,Q=le.shareAddress),"isStudio"in le&&M(0,Z=le.isStudio)},q.$$.update=()=>{q.$$.dirty&48&&Q===X&&M(2,Y=!1)},[Z,G,Y,se,Q,X]}class DownloadTool extends SvelteComponent{constructor(_){super(),init(this,_,instance$j,create_fragment$k,safe_not_equal,{shareAddress:4,isStudio:0})}}function createObserver(q,_){return new IntersectionObserver(q,{threshold:_})}function observeElement(q,_){_&&q&&q.observe(_)}function disconnectObserver(q){q&&q.disconnect()}function extractPageNumber(q){if(!q){console.error("Undefined document passed to extractPageNumber");return}if(q.text&&typeof q.text=="string"&&q.text.trim()!==""){const _=q.path.match(/\/documents\/page(\d+)/);return _?parseInt(_[1],10):1}}const GridSelector_svelte_svelte_type_style_lang="";function get_each_context$6(q,_,M){const $=q.slice();return $[14]=_[M],$[16]=M,$}function get_each_context_1$1(q,_,M){const $=q.slice();return $[14]=_[M],$[18]=M,$}function create_if_block$e(q){let _=mapNumberToLetter(q[18])+"",M,$,j=q[16]+1+"",z;return{c(){M=text(_),$=text(", "),z=text(j)},m(V,G){insert(V,M,G),insert(V,$,G),insert(V,z,G)},p(V,G){G&1&&_!==(_=mapNumberToLetter(V[18])+"")&&set_data(M,_),G&1&&j!==(j=V[16]+1+"")&&set_data(z,j)},d(V){V&&detach(M),V&&detach($),V&&detach(z)}}}function create_each_block_1$1(q,_){let M,$,j,z,V=!(_[1][_[16]]&&_[1][_[16]][_[18]])&&create_if_block$e(_);function G(){return _[8](_[16],_[18])}return{key:q,first:null,c(){M=element("div"),V&&V.c(),$=space(),set_style(M,"display","flex"),set_style(M,"justify-content","center"),set_style(M,"align-items","center"),set_style(M,"height","100%"),attr(M,"class","svelte-1c3sju5"),toggle_class(M,"active",_[4][_[16]][_[18]]),toggle_class(M,"occupied",_[1][_[16]]&&_[1][_[16]][_[18]]),this.first=M},m(X,Y){insert(X,M,Y),V&&V.m(M,null),append(M,$),j||(z=listen(M,"click",function(){is_function(_[1][_[16]]&&_[1][_[16]][_[18]]?void 0:G)&&(_[1][_[16]]&&_[1][_[16]][_[18]]?void 0:G).apply(this,arguments)}),j=!0)},p(X,Y){_=X,_[1][_[16]]&&_[1][_[16]][_[18]]?V&&(V.d(1),V=null):V?V.p(_,Y):(V=create_if_block$e(_),V.c(),V.m(M,$)),Y&17&&toggle_class(M,"active",_[4][_[16]][_[18]]),Y&3&&toggle_class(M,"occupied",_[1][_[16]]&&_[1][_[16]][_[18]])},d(X){X&&detach(M),V&&V.d(),j=!1,z()}}}function create_each_block$6(q,_){let M,$=[],j=new Map,z,V={length:_[0][1]};const G=X=>X[18];for(let X=0;X<V.length;X+=1){let Y=get_each_context_1$1(_,V,X),Q=G(Y);j.set(Q,$[X]=create_each_block_1$1(Q,Y))}return{key:q,first:null,c(){M=empty();for(let X=0;X<$.length;X+=1)$[X].c();z=empty(),this.first=M},m(X,Y){insert(X,M,Y);for(let Q=0;Q<$.length;Q+=1)$[Q]&&$[Q].m(X,Y);insert(X,z,Y)},p(X,Y){_=X,Y&51&&(V={length:_[0][1]},$=update_keyed_each($,Y,G,1,_,V,j,z.parentNode,destroy_block,create_each_block_1$1,z,get_each_context_1$1))},d(X){X&&detach(M);for(let Y=0;Y<$.length;Y+=1)$[Y].d(X);X&&detach(z)}}}function create_fragment$j(q){let _,M,$=[],j=new Map,z={length:q[0][0]};const V=G=>G[16];for(let G=0;G<z.length;G+=1){let X=get_each_context$6(q,z,G),Y=V(X);j.set(Y,$[G]=create_each_block$6(Y,X))}return{c(){_=element("div"),M=element("div");for(let G=0;G<$.length;G+=1)$[G].c();attr(M,"class","container svelte-1c3sju5"),set_style(M,"grid-template-rows",q[3]),set_style(M,"grid-template-columns",q[2]),set_style(_,"position","fixed"),set_style(_,"z-index","52"),attr(_,"class","mt-16 pt-4")},m(G,X){insert(G,_,X),append(_,M);for(let Y=0;Y<$.length;Y+=1)$[Y]&&$[Y].m(M,null)},p(G,[X]){X&51&&(z={length:G[0][0]},$=update_keyed_each($,X,V,1,G,z,j,M,destroy_block,create_each_block$6,null,get_each_context$6)),X&8&&set_style(M,"grid-template-rows",G[3]),X&4&&set_style(M,"grid-template-columns",G[2])},i:noop,o:noop,d(G){G&&detach(_);for(let X=0;X<$.length;X+=1)$[X].d()}}}function mapNumberToLetter(q){return String.fromCharCode(65+q)}function instance$i(q,_,M){let $;component_subscribe(q,commonsGridStore,ie=>M(7,$=ie));const j=createEventDispatcher();let{windowWidth:z}=_,V,G,X,Y,Q=[],Z={};function ee(ie,se){Q=[ie,se],ne([ie,se]),j("selected",Q)}function te([ie,se],[le,he]){return(ie-Q[0])*(ie-le)<=0&&(se-Q[1])*(se-he)<=0}function ne(ie){M(4,Y=Y.map((se,le)=>se.map((he,ce)=>te([le,ce],ie))))}const re=(ie,se)=>ee(ie,se);return q.$$set=ie=>{"windowWidth"in ie&&M(6,z=ie.windowWidth)},q.$$.update=()=>{q.$$.dirty&65&&(z<=768?M(0,V=[18,3]):M(0,V=[6,9]),M(2,G=`repeat(${V[1]}, 1fr)`),M(3,X=`repeat(${V[0]}, 1fr)`),M(4,Y=Array(V[0]).fill(0).map(ie=>Array(V[1]).fill(!1)))),q.$$.dirty&130&&(M(1,Z=$),console.log("Current Occupied Grid:",Z))},[V,Z,G,X,Y,ee,z,$,re]}class GridSelector extends SvelteComponent{constructor(_){super(),init(this,_,instance$i,create_fragment$j,safe_not_equal,{windowWidth:6})}}async function getAttachment(q,_){let M,$;const j=await _.getAttachment(q);let z=q.path.split(".").pop();if(j!==void 0&&typeof j.bytes=="function"){const X=await j.bytes();let Y=new Uint8Array(X.length);for(var V=0;V<X.length;V++)Y[V]=X[V];switch(z){case"md":var G=new TextDecoder("utf-8");M=G.decode(new Uint8Array(X));break;case"mp3":case"ogg":case"webm":$="audio/"+z,M=URL.createObjectURL(new Blob([Y],{type:$}));break;case"txt":var G=new TextDecoder("utf-8");M=G.decode(Uint8Array.from(Y));break;case"png":case"jpeg":case"jpg":case"gif":$="image/"+z,M=URL.createObjectURL(new Blob([Y],{type:$}));break;case"pdf":M=URL.createObjectURL(new Blob([Y],{type:"application/pdf"}));break;default:M=URL.createObjectURL(new Blob([Y],{type:"application/octet-stream"}))}return M}}function getFileExt(q){let _=q.path.split(".").pop(),M;switch(_){case"md":M="markdown";break;case"mp3":case"ogg":case"webm":M="audio";break;case"txt":M="text";break;case"png":case"jpeg":case"jpg":case"gif":M="image";break;case"pdf":M="pdf";break;default:M="other";break}return M}function extractDateFromPath(q){const _=/(\d{13})/,M=q.match(_);if(!M)throw new Error("No timestamp found in the path");const $=parseInt(M[1],10),j=new Date($),z=j.toLocaleString("en-US",{month:"short"}),V=j.getUTCDate(),G=j.getUTCFullYear();return j.toTimeString().split(" ")[0],`${(j.getTimezoneOffset()>0?"-"+Math.abs(j.getTimezoneOffset()/60):"+"+Math.abs(j.getTimezoneOffset()/60)).padStart(5,"0")}`,`${z} ${V} ${G}`}const ArtefactPreview_svelte_svelte_type_style_lang="";function create_if_block$d(q){let _,M,$,j={ctx:q,current:null,token:null,hasCatch:!1,pending:create_pending_block,then:create_then_block,catch:create_catch_block,value:7,blocks:[,,,]};return handle_promise(M=q[1],j),{c(){_=empty(),j.block.c()},m(z,V){insert(z,_,V),j.block.m(z,j.anchor=V),j.mount=()=>_.parentNode,j.anchor=_,$=!0},p(z,V){q=z,j.ctx=q,V&2&&M!==(M=q[1])&&handle_promise(M,j)||update_await_block_branch(j,q,V)},i(z){$||(transition_in(j.block),$=!0)},o(z){for(let V=0;V<3;V+=1){const G=j.blocks[V];transition_out(G)}$=!1},d(z){z&&detach(_),j.block.d(z),j.token=null,j=null}}}function create_catch_block(q){return{c:noop,m:noop,p:noop,i:noop,o:noop,d:noop}}function create_then_block(q){let _,M,$=!q[3]&&create_if_block_1$b(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,z){j[3]?$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros()):$?($.p(j,z),z&8&&transition_in($,1)):($=create_if_block_1$b(j),$.c(),transition_in($,1),$.m(_.parentNode,_))},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function create_if_block_1$b(q){let _,M,$,j,z;const V=[create_if_block_2$8,create_if_block_3$3,create_if_block_4$3,create_if_block_5$2,create_if_block_6$2,create_else_block$5],G=[];function X(Y,Q){return Y[4]=="image"?0:Y[4]=="text"?1:Y[4]=="audio"?2:Y[4]=="markdown"?3:Y[4]=="pdf"?4:5}return $=X(q),j=G[$]=V[$](q),{c(){_=element("div"),M=element("div"),j.c(),attr(M,"class","flex flex-col items-center h-auto"),attr(_,"class","flex flex-row flex-wrap justify-center w-full")},m(Y,Q){insert(Y,_,Q),append(_,M),G[$].m(M,null),z=!0},p(Y,Q){let Z=$;$=X(Y),$===Z?G[$].p(Y,Q):(group_outros(),transition_out(G[Z],1,1,()=>{G[Z]=null}),check_outros(),j=G[$],j?j.p(Y,Q):(j=G[$]=V[$](Y),j.c()),transition_in(j,1),j.m(M,null))},i(Y){z||(transition_in(j),z=!0)},o(Y){transition_out(j),z=!1},d(Y){Y&&detach(_),G[$].d()}}}function create_else_block$5(q){let _,M,$;return{c(){_=text(q[4]),M=space(),$=element("p"),$.innerHTML="Attachment type not supported. You can use the <i>report bugs</i> link in the footer to request a new filetype feature."},m(j,z){insert(j,_,z),insert(j,M,z),insert(j,$,z)},p(j,z){z&16&&set_data(_,j[4])},i:noop,o:noop,d(j){j&&detach(_),j&&detach(M),j&&detach($)}}}function create_if_block_6$2(q){let _,M,$;return M=new PdfViewer({props:{data:q[7],url:q[7],showButtons:["navigation","pageInfo"],showBorder:!1}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","pdfViewer svelte-drgbia")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.data=j[7]),z&2&&(V.url=j[7]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_5$2(q){let _,M,$;return M=new SvelteMarkdown({props:{source:q[7]}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","markdown text-3xl self-end svelte-drgbia")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.source=j[7]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_4$3(q){let _,M,$;return{c(){_=element("div"),M=element("audio"),attr(M,"class","w-full svelte-drgbia"),src_url_equal(M.src,$=q[7])||attr(M,"src",$),M.controls=!0,attr(_,"class","audioWrapper svelte-drgbia")},m(j,z){insert(j,_,z),append(_,M)},p(j,z){z&2&&!src_url_equal(M.src,$=j[7])&&attr(M,"src",$)},i:noop,o:noop,d(j){j&&detach(_)}}}function create_if_block_3$3(q){let _,M=q[7]+"";return{c(){_=element("p"),attr(_,"class","my-6 textbox svelte-drgbia")},m($,j){insert($,_,j),_.innerHTML=M},p($,j){j&2&&M!==(M=$[7]+"")&&(_.innerHTML=M)},i:noop,o:noop,d($){$&&detach(_)}}}function create_if_block_2$8(q){let _,M,$;return{c(){_=element("img"),src_url_equal(_.src,M=q[7])||attr(_,"src",M),attr(_,"alt",$=q[0].text),attr(_,"class","mx-auto svelte-drgbia")},m(j,z){insert(j,_,z)},p(j,z){z&2&&!src_url_equal(_.src,M=j[7])&&attr(_,"src",M),z&1&&$!==($=j[0].text)&&attr(_,"alt",$)},i:noop,o:noop,d(j){j&&detach(_)}}}function create_pending_block(q){let _;return{c(){_=text("Loading attachment...")},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}function create_fragment$i(q){let _,M,$=q[2]&&create_if_block$d(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,[z]){j[2]?$?($.p(j,z),z&4&&transition_in($,1)):($=create_if_block$d(j),$.c(),transition_in($,1),$.m(_.parentNode,_)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros())},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function instance$h(q,_,M){let{doc:$}=_,{studioReplica:j}=_,z,V=!1,G=!0,X;async function Y(Q){let Z=await getAttachment(Q,j);return console.log("filetype preview",X),Z}return X=getFileExt($),q.$$set=Q=>{"doc"in Q&&M(0,$=Q.doc),"studioReplica"in Q&&M(5,j=Q.studioReplica)},q.$$.update=()=>{q.$$.dirty&3&&$&&(M(4,X=getFileExt($)),M(1,z=Y($)),M(2,V=!0),M(3,G=!1),console.log(z))},[$,z,V,G,X,j]}class ArtefactPreview extends SvelteComponent{constructor(_){super(),init(this,_,instance$h,create_fragment$i,safe_not_equal,{doc:0,studioReplica:5})}}const PlaceFromStudio_svelte_svelte_type_style_lang="";function get_each_context$5(q,_,M){const $=q.slice();return $[22]=_[M],$}function create_if_block_2$7(q){let _,M,$;function j(V){q[10](V)}let z={};return q[0]!==void 0&&(z.windowWidth=q[0]),_=new GridSelector({props:z}),binding_callbacks.push(()=>bind(_,"windowWidth",j)),_.$on("selected",q[5]),{c(){create_component(_.$$.fragment)},m(V,G){mount_component(_,V,G),$=!0},p(V,G){const X={};!M&&G&1&&(M=!0,X.windowWidth=V[0],add_flush_callback(()=>M=!1)),_.$set(X)},i(V){$||(transition_in(_.$$.fragment,V),$=!0)},o(V){transition_out(_.$$.fragment,V),$=!1},d(V){destroy_component(_,V)}}}function create_if_block$c(q){let _,M,$,j,z,V,G;const X=[create_if_block_1$a,create_else_block$4],Y=[];function Q(Z,ee){return Z[4].length===0?0:1}return z=Q(q),V=Y[z]=X[z](q),{c(){_=element("div"),M=element("div"),$=element("h4"),$.textContent="Place Artefact from the Studio",j=space(),V.c(),attr($,"class","ml-8 mt-8 text-left"),attr(M,"class","container svelte-11n7j5h"),set_style(_,"position","fixed"),set_style(_,"z-index","52"),attr(_,"class","mt-16 pt-4")},m(Z,ee){insert(Z,_,ee),append(_,M),append(M,$),append(M,j),Y[z].m(M,null),G=!0},p(Z,ee){let te=z;z=Q(Z),z===te?Y[z].p(Z,ee):(group_outros(),transition_out(Y[te],1,1,()=>{Y[te]=null}),check_outros(),V=Y[z],V?V.p(Z,ee):(V=Y[z]=X[z](Z),V.c()),transition_in(V,1),V.m(M,null))},i(Z){G||(transition_in(V),G=!0)},o(Z){transition_out(V),G=!1},d(Z){Z&&detach(_),Y[z].d()}}}function create_else_block$4(q){let _,M=[],$=new Map,j,z=q[4];const V=G=>`${G[22].textHash}-${G[22].timestamp}`;for(let G=0;G<z.length;G+=1){let X=get_each_context$5(q,z,G),Y=V(X);$.set(Y,M[G]=create_each_block$5(Y,X))}return{c(){_=element("div");for(let G=0;G<M.length;G+=1)M[G].c();attr(_,"class","flex flex-row flex-wrap mx-2 justify-center ")},m(G,X){insert(G,_,X);for(let Y=0;Y<M.length;Y+=1)M[Y]&&M[Y].m(_,null);j=!0},p(G,X){X&408&&(z=G[4],group_outros(),M=update_keyed_each(M,X,V,1,G,z,$,_,outro_and_destroy_block,create_each_block$5,null,get_each_context$5),check_outros())},i(G){if(!j){for(let X=0;X<z.length;X+=1)transition_in(M[X]);j=!0}},o(G){for(let X=0;X<M.length;X+=1)transition_out(M[X]);j=!1},d(G){G&&detach(_);for(let X=0;X<M.length;X+=1)M[X].d()}}}function create_if_block_1$a(q){let _,M,$,j;return $=new StudioPortal({props:{noArtefacts:!0}}),$.$on("shareUpdated",q[6]),{c(){_=element("h5"),_.textContent="no artefacts found in the studio",M=space(),create_component($.$$.fragment),attr(_,"class","ml-8 mt-8 text-left")},m(z,V){insert(z,_,V),insert(z,M,V),mount_component($,z,V),j=!0},p:noop,i(z){j||(transition_in($.$$.fragment,z),j=!0)},o(z){transition_out($.$$.fragment,z),j=!1},d(z){z&&detach(_),z&&detach(M),destroy_component($,z)}}}function create_each_block$5(q,_){let M,$,j,z,V,G,X=(_[8](_[22].text)?`${_[8](_[22].text)} - Shared on ${extractDateFromPath(_[22].path)}`:_[22].path)+"",Y,Q,Z,ee,te;z=new ArtefactPreview({props:{doc:_[22],studioReplica:_[3]}});function ne(){return _[9](_[22])}return{key:q,first:null,c(){M=element("div"),$=element("button"),j=element("div"),create_component(z.$$.fragment),V=space(),G=element("div"),Y=text(X),Q=space(),attr(j,"class","flex w-full"),attr(G,"class","h-1/6 text-center flex items-center justify-center"),attr($,"class","flex flex-col h-full justify-between"),attr(M,"class","m-1 flex flex-col w-64 h-64"),this.first=M},m(re,ie){insert(re,M,ie),append(M,$),append($,j),mount_component(z,j,null),append($,V),append($,G),append(G,Y),append(M,Q),Z=!0,ee||(te=listen($,"click",ne),ee=!0)},p(re,ie){_=re;const se={};ie&16&&(se.doc=_[22]),ie&8&&(se.studioReplica=_[3]),z.$set(se),(!Z||ie&16)&&X!==(X=(_[8](_[22].text)?`${_[8](_[22].text)} - Shared on ${extractDateFromPath(_[22].path)}`:_[22].path)+"")&&set_data(Y,X)},i(re){Z||(transition_in(z.$$.fragment,re),Z=!0)},o(re){transition_out(z.$$.fragment,re),Z=!1},d(re){re&&detach(M),destroy_component(z),ee=!1,te()}}}function create_fragment$h(q){let _,M,$,j;const z=[create_if_block$c,create_if_block_2$7],V=[];function G(X,Y){return X[2]?0:X[1]?1:-1}return~(_=G(q))&&(M=V[_]=z[_](q)),{c(){M&&M.c(),$=empty()},m(X,Y){~_&&V[_].m(X,Y),insert(X,$,Y),j=!0},p(X,[Y]){let Q=_;_=G(X),_===Q?~_&&V[_].p(X,Y):(M&&(group_outros(),transition_out(V[Q],1,1,()=>{V[Q]=null}),check_outros()),~_?(M=V[_],M?M.p(X,Y):(M=V[_]=z[_](X),M.c()),transition_in(M,1),M.m($.parentNode,$)):M=null)},i(X){j||(transition_in(M),j=!0)},o(X){transition_out(M),j=!1},d(X){~_&&V[_].d(X),X&&detach($)}}}function instance$g(q,_,M){let $,j;component_subscribe(q,authorKeypair,oe=>M(15,$=oe)),component_subscribe(q,replicaDetails,oe=>M(16,j=oe));const z=createEventDispatcher();let{windowWidth:V}=_,G=[],X=!1,Y=!0,Q,Z,ee;studioShares.subscribe(oe=>{ee=oe});function te(oe){G=oe.detail,M(1,X=!1),de()}function ne(){M(2,Y=!1),z("hideWindow")}let re=[];onMount(async()=>{const oe=async ve=>{try{const Ce=settings.shareSecrets[ve];M(3,Q=new Replica({driver:new ReplicaDriverWeb(ve)}));let ue=await Q.queryDocs({historyMode:"latest",filter:{author:$.address,pathStartsWith:"/documents"}});return ue=ue.filter(Pe=>!Pe.text.trim()||/^\/documents\/page\d+\/newPage$/.test(Pe.path)?!1:Pe.path.includes("/page")?Pe.path.split("/").length<=7:Pe.path.split("/").length<=6),ue}catch(Ce){console.error("Error fetching artefacts:",Ce)}};let we=ee.map(ve=>oe(ve)),De=await Promise.all(we);M(4,re=De.flat())});let ie;function se(oe){ie=oe,M(2,Y=!1),M(1,X=!0)}function le(oe){return splitTitleAndNotes(oe).title}async function he(oe){const we=await Q.getAttachment(oe);return we&&typeof we.bytes=="function"?await we.bytes():null}const ce=async oe=>(await Q.queryDocs({filter:{pathStartsWith:oe}})).filter(ve=>ve.text.trim()===""?!1:ve.path.includes("/page")?ve.path.split("/").length>=8:ve.path.split("/").length>=7),ae=async(oe,we,De)=>{for(let ve of oe){let Ce=new Date,ue=ve.path.split("/").pop();if(ue.includes(".")){const Ne=await he(ve);Ne&&(ve.attachment=Ne)}let Le={path:we.split("!")[0]+`${Ce.getTime()}/!`+ue,deleteAfter:De,text:ve.text};const Me=await j.replica.set($,Le);isErr(Me)&&console.error(Me)}};async function de(){if(!ie){console.error("No artefact selected");return}const oe=await he(ie);let we=ie.path.split(".").pop(),De=new Date,ve=$.address.slice(1,5),Ce=`/documents/${G[0]}/${G[1]}/${De.getTime()}/!shared-from-the-studio-by-${ve}`,ue=oe?`${Ce}.${we}`:Ce+".md";Z=(Date.now()+25488e5)*1e3;let Pe={path:ue,text:ie.text,deleteAfter:Z};oe&&(Pe.attachment=oe);let ze=await j.replica.set($,Pe);console.log("Result: ",ze);let Le=ie.path.substring(0,ie.path.lastIndexOf("/")),Me=await ce(Le),Ne=await ae(Me,Ce,Z);z("artefactPlaced"),console.log("transferedReplies: ",Ne),isErr(ze)&&console.error(ze)}const ge=oe=>se(oe);function fe(oe){V=oe,M(0,V)}return q.$$set=oe=>{"windowWidth"in oe&&M(0,V=oe.windowWidth)},[V,X,Y,Q,re,te,ne,se,le,ge,fe]}class PlaceFromStudio extends SvelteComponent{constructor(_){super(),init(this,_,instance$g,create_fragment$h,safe_not_equal,{windowWidth:0})}}const CreatePage_svelte_svelte_type_style_lang="";function create_fragment$g(q){let _,M,$,j,z,V;return{c(){_=element("div"),M=element("h5"),M.textContent="Running out of space?",$=space(),j=element("button"),j.textContent="create a new page",attr(j,"class","phase1 mt-8"),attr(_,"class","container mb-32 svelte-zwks6e")},m(G,X){insert(G,_,X),append(_,M),append(_,$),append(_,j),z||(V=listen(j,"click",q[0]),z=!0)},p:noop,i:noop,o:noop,d(G){G&&detach(_),z=!1,V()}}}function instance$f(q,_,M){let $,j,z;component_subscribe(q,authorKeypair,Z=>M(2,$=Z)),component_subscribe(q,replicaDetails,Z=>M(3,j=Z)),component_subscribe(q,cacheDetails,Z=>M(4,z=Z));let V=0,G=$.address.slice(1,5);const X=createEventDispatcher();onMount(async()=>{V=await Y()});async function Y(){const Z=z.queryDocs({filter:{pathStartsWith:"/documents"}});function ee(ne){const re=ne.match(/\/documents\/page(\d+)/);return re?parseInt(re[1],10):0}function te(ne){const ie=ne.filter(le=>le.text&&le.text.trim()!=="").map(le=>ee(le.path)),se=Math.max(...ie);return se===0?2:se+1}return te(Z)}async function Q(){let Z={path:`/documents/page${V}/newPage`,text:"A new page was created by "+G},ee=await j.replica.set($,Z);console.log("new page result: ",ee),X("createPage")}return[Q]}class CreatePage extends SvelteComponent{constructor(_){super(),init(this,_,instance$f,create_fragment$g,safe_not_equal,{})}}const GridView_svelte_svelte_type_style_lang="";function get_each_context_4(q,_,M){const $=q.slice();return $[80]=_[M],$}function get_each_context_5(q,_,M){const $=q.slice();return $[72]=_[M],$[74]=M,$}function get_each_context_6(q,_,M){const $=q.slice();return $[72]=_[M],$[76]=M,$}function get_each_context_8(q,_,M){const $=q.slice();return $[77]=_[M],$}function get_each_context_7(q,_,M){const $=q.slice();return $[85]=_[M],$}function get_each_context$4(q,_,M){const $=q.slice();return $[69]=_[M],$[71]=M,$}function get_each_context_1(q,_,M){const $=q.slice();return $[72]=_[M],$[74]=M,$}function get_each_context_2(q,_,M){const $=q.slice();return $[72]=_[M],$[76]=M,$}function get_each_context_3(q,_,M){const $=q.slice();return $[77]=_[M],$}function create_else_block_3(q){let _,M,$,j,z,V,G=q[4]?`${q[15]}, ${q[14]} `:"",X,Y,Q,Z,ee,te,ne,re,ie,se=settings.servers.length===1?"Server:":`${settings.servers.length} Servers:`,le,he,ce,ae,de,ge,fe,oe,we,De,ve,Ce,ue,Pe=q[2].length+"",ze,Le,Me,Ne,Ye,Ie;ae=new ServerList({props:{truncate:!0}});let Oe=q[5]&&create_if_block_22(q),Se=q[25].length===0&&create_if_block_21(),pe=!q[5]&&create_if_block_20(q),me=(q[5]&&q[1]===0||!q[5]||!q[13])&&create_if_block_16(q);return{c(){_=element("div"),M=element("h6"),$=text(q[6]),j=text(" status"),z=space(),V=element("p"),X=text(G),Y=space(),Q=element("div"),Z=text(`Workspace Address:
    `),ee=element("p"),te=text(q[3]),ne=space(),re=element("div"),ie=text("Current "),le=text(se),he=element("br"),ce=space(),create_component(ae.$$.fragment),de=space(),ge=element("div"),Oe&&Oe.c(),fe=space(),oe=element("p"),we=element("b"),De=text("Number of artefacts in the "),ve=text(q[6]),Ce=text(":"),ue=space(),ze=text(Pe),Le=space(),Me=element("div"),Se&&Se.c(),Ne=space(),pe&&pe.c(),Ye=space(),me&&me.c(),attr(M,"class","text-left"),attr(V,"class","text-left text-xl font-bold mb-2"),attr(ee,"class","truncate ..."),attr(Q,"class","text-left font-bold mb-2"),attr(re,"class","text-left font-bold mb-2"),attr(oe,"class","text-left"),attr(ge,"class","flex flex-col justify-left"),attr(Me,"class","flex flex-col w-full")},m(be,Ee){insert(be,_,Ee),append(_,M),append(M,$),append(M,j),append(_,z),append(_,V),append(V,X),append(_,Y),append(_,Q),append(Q,Z),append(Q,ee),append(ee,te),append(_,ne),append(_,re),append(re,ie),append(re,le),append(re,he),append(re,ce),mount_component(ae,re,null),append(_,de),append(_,ge),Oe&&Oe.m(ge,null),append(ge,fe),append(ge,oe),append(oe,we),append(we,De),append(we,ve),append(we,Ce),append(oe,ue),append(oe,ze),insert(be,Le,Ee),insert(be,Me,Ee),Se&&Se.m(Me,null),append(Me,Ne),pe&&pe.m(Me,null),append(Me,Ye),me&&me.m(Me,null),Ie=!0},p(be,Ee){(!Ie||Ee[0]&64)&&set_data($,be[6]),(!Ie||Ee[0]&49168)&&G!==(G=be[4]?`${be[15]}, ${be[14]} `:"")&&set_data(X,G),(!Ie||Ee[0]&8)&&set_data(te,be[3]),be[5]?Oe?Oe.p(be,Ee):(Oe=create_if_block_22(be),Oe.c(),Oe.m(ge,fe)):Oe&&(Oe.d(1),Oe=null),(!Ie||Ee[0]&64)&&set_data(ve,be[6]),(!Ie||Ee[0]&4)&&Pe!==(Pe=be[2].length+"")&&set_data(ze,Pe),be[5]?pe&&(group_outros(),transition_out(pe,1,1,()=>{pe=null}),check_outros()):pe?(pe.p(be,Ee),Ee[0]&32&&transition_in(pe,1)):(pe=create_if_block_20(be),pe.c(),transition_in(pe,1),pe.m(Me,Ye)),be[5]&&be[1]===0||!be[5]||!be[13]?me?me.p(be,Ee):(me=create_if_block_16(be),me.c(),me.m(Me,null)):me&&(me.d(1),me=null)},i(be){Ie||(transition_in(ae.$$.fragment,be),transition_in(pe),Ie=!0)},o(be){transition_out(ae.$$.fragment,be),transition_out(pe),Ie=!1},d(be){be&&detach(_),destroy_component(ae),Oe&&Oe.d(),be&&detach(Le),be&&detach(Me),Se&&Se.d(),pe&&pe.d(),me&&me.d()}}}function create_if_block_15(q){let _,M,$;return M=new DocDetails({props:{doc:q[4],attachment:q[0],isCommons:q[5]}}),{c(){_=element("div"),create_component(M.$$.fragment)},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z[0]&16&&(V.doc=j[4]),z[0]&1&&(V.attachment=j[0]),z[0]&32&&(V.isCommons=j[5]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_22(q){let _,M,$,j=PHASE_NAME[q[1]]+"",z,V,G,X,Y,Q;return{c(){_=element("p"),M=element("b"),M.textContent="Phase of decay:",$=space(),z=text(j),V=space(),G=element("p"),X=element("b"),X.textContent="Number of artefacts in this phase:",Y=space(),Q=text(q[22]),attr(_,"class","text-left"),attr(G,"class","text-left")},m(Z,ee){insert(Z,_,ee),append(_,M),append(_,$),append(_,z),insert(Z,V,ee),insert(Z,G,ee),append(G,X),append(G,Y),append(G,Q)},p(Z,ee){ee[0]&2&&j!==(j=PHASE_NAME[Z[1]]+"")&&set_data(z,j),ee[0]&4194304&&set_data(Q,Z[22])},d(Z){Z&&detach(_),Z&&detach(V),Z&&detach(G)}}}function create_if_block_21(q){let _;return{c(){_=element("p"),_.innerHTML="<b>you will need an identity in order to interact with this app</b>",attr(_,"class","mx-2 text-2xl text-left")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_20(q){let _,M,$,j,z,V,G,X;return M=new DownloadTool({props:{shareAddress:q[3],isStudio:!0}}),{c(){_=element("div"),create_component(M.$$.fragment),$=space(),j=element("div"),z=element("button"),z.textContent="take me back to Commons",attr(_,"class","w-auto py-4"),attr(j,"class","w-auto flex flex-col")},m(Y,Q){insert(Y,_,Q),mount_component(M,_,null),insert(Y,$,Q),insert(Y,j,Q),append(j,z),V=!0,G||(X=listen(z,"click",q[27]),G=!0)},p(Y,Q){const Z={};Q[0]&8&&(Z.shareAddress=Y[3]),M.$set(Z)},i(Y){V||(transition_in(M.$$.fragment,Y),V=!0)},o(Y){transition_out(M.$$.fragment,Y),V=!1},d(Y){Y&&detach(_),destroy_component(M),Y&&detach($),Y&&detach(j),G=!1,X()}}}function create_if_block_16(q){let _;function M(z,V){return z[5]?create_if_block_17:create_else_block_5}let $=M(q),j=$(q);return{c(){_=element("div"),j.c(),attr(_,"class","w-full flex flex-col py-4")},m(z,V){insert(z,_,V),j.m(_,null)},p(z,V){$===($=M(z))&&j?j.p(z,V):(j.d(1),j=$(z),j&&(j.c(),j.m(_,null)))},d(z){z&&detach(_),j.d()}}}function create_else_block_5(q){let _,M,$;function j(G,X){return G[13]?create_if_block_19:create_else_block_6}let z=j(q),V=z(q);return{c(){_=element("button"),V.c()},m(G,X){insert(G,_,X),V.m(_,null),M||($=listen(_,"click",q[31]),M=!0)},p(G,X){z!==(z=j(G))&&(V.d(1),V=z(G),V&&(V.c(),V.m(_,null)))},d(G){G&&detach(_),V.d(),M=!1,$()}}}function create_if_block_17(q){let _,M,$;function j(G,X){return G[13]?create_if_block_18:create_else_block_4}let z=j(q),V=z(q);return{c(){_=element("button"),V.c()},m(G,X){insert(G,_,X),V.m(_,null),M||($=listen(_,"click",q[30]),M=!0)},p(G,X){z!==(z=j(G))&&(V.d(1),V=z(G),V&&(V.c(),V.m(_,null)))},d(G){G&&detach(_),V.d(),M=!1,$()}}}function create_else_block_6(q){let _;return{c(){_=text("Back to viewing")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_19(q){let _;return{c(){_=text("Place an artefact")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_else_block_4(q){let _;return{c(){_=text("Back to viewing")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_18(q){let _;return{c(){_=text("Place artefact from the studio")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_14(q){let _,M;return _=new PlaceFromStudio({props:{windowWidth:q[7]}}),_.$on("hideWindow",q[37]),_.$on("artefactPlaced",q[29]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p($,j){const z={};j[0]&128&&(z.windowWidth=$[7]),_.$set(z)},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_13(q){let _,M,$;return M=new Upload({props:{filetype:q[17],xy:q[19]}}),M.$on("success",q[35]),M.$on("close",q[35]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","relative"),set_style(_,"z-index","51")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z[0]&131072&&(V.filetype=j[17]),z[0]&524288&&(V.xy=j[19]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_12(q){let _,M,$;return M=new GridUpload({props:{windowWidth:q[7],pages:q[8]}}),M.$on("success",q[51]),M.$on("upload",q[52]),M.$on("selected",q[34]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","relative pt-12"),set_style(_,"z-index","51")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z[0]&128&&(V.windowWidth=j[7]),z[0]&256&&(V.pages=j[8]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_11(q){let _,M,$;return M=new View({props:{selectedDocument:q[4]}}),M.$on("close",q[50]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","artefact-overlay customBorder mt-[12vh] h-[80vh] w-4/5 fixed max-w-overlay svelte-1mtid1f")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z[0]&16&&(V.selectedDocument=j[4]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block_7$1(q){let _=[],M=new Map,$,j,z,V,G,X=q[8];const Y=Q=>Q[80].pageNumber;for(let Q=0;Q<X.length;Q+=1){let Z=get_each_context_4(q,X,Q),ee=Y(Z);M.set(ee,_[Q]=create_each_block_4(ee,Z))}return j=new CreatePage({}),j.$on("createPage",q[29]),V=new StudioPortal({}),V.$on("shareUpdated",q[36]),{c(){for(let Q=0;Q<_.length;Q+=1)_[Q].c();$=space(),create_component(j.$$.fragment),z=space(),create_component(V.$$.fragment)},m(Q,Z){for(let ee=0;ee<_.length;ee+=1)_[ee]&&_[ee].m(Q,Z);insert(Q,$,Z),mount_component(j,Q,Z),insert(Q,z,Z),mount_component(V,Q,Z),G=!0},p(Q,Z){Z[0]&288369920&&(X=Q[8],group_outros(),_=update_keyed_each(_,Z,Y,1,Q,X,M,$.parentNode,outro_and_destroy_block,create_each_block_4,$,get_each_context_4),check_outros())},i(Q){if(!G){for(let Z=0;Z<X.length;Z+=1)transition_in(_[Z]);transition_in(j.$$.fragment,Q),transition_in(V.$$.fragment,Q),G=!0}},o(Q){for(let Z=0;Z<_.length;Z+=1)transition_out(_[Z]);transition_out(j.$$.fragment,Q),transition_out(V.$$.fragment,Q),G=!1},d(Q){for(let Z=0;Z<_.length;Z+=1)_[Z].d(Q);Q&&detach($),destroy_component(j,Q),Q&&detach(z),destroy_component(V,Q)}}}function create_if_block_2$6(q){let _,M=[],$=new Map,j,z,V,G=!q[11]&&create_if_block_6$1(q),X=LUNAR_PHASE;const Y=Q=>Q[71];for(let Q=0;Q<X.length;Q+=1){let Z=get_each_context$4(q,X,Q),ee=Y(Z);$.set(ee,M[Q]=create_each_block$4(ee,Z))}return z=new StudioPortal({}),z.$on("shareUpdated",q[36]),{c(){G&&G.c(),_=space();for(let Q=0;Q<M.length;Q+=1)M[Q].c();j=space(),create_component(z.$$.fragment)},m(Q,Z){G&&G.m(Q,Z),insert(Q,_,Z);for(let ee=0;ee<M.length;ee+=1)M[ee]&&M[ee].m(Q,Z);insert(Q,j,Z),mount_component(z,Q,Z),V=!0},p(Q,Z){Q[11]?G&&(group_outros(),transition_out(G,1,1,()=>{G=null}),check_outros()):G?(G.p(Q,Z),Z[0]&2048&&transition_in(G,1)):(G=create_if_block_6$1(Q),G.c(),transition_in(G,1),G.m(_.parentNode,_)),Z[0]&355477508&&(X=LUNAR_PHASE,group_outros(),M=update_keyed_each(M,Z,Y,1,Q,X,$,j.parentNode,outro_and_destroy_block,create_each_block$4,j,get_each_context$4),check_outros())},i(Q){if(!V){transition_in(G);for(let Z=0;Z<X.length;Z+=1)transition_in(M[Z]);transition_in(z.$$.fragment,Q),V=!0}},o(Q){transition_out(G);for(let Z=0;Z<M.length;Z+=1)transition_out(M[Z]);transition_out(z.$$.fragment,Q),V=!1},d(Q){G&&G.d(Q),Q&&detach(_);for(let Z=0;Z<M.length;Z+=1)M[Z].d(Q);Q&&detach(j),destroy_component(z,Q)}}}function create_if_block$b(q){let _,M,$,j,z,V=q[9]==="No artefacts were found"&&create_if_block_1$9(q);return{c(){_=element("div"),M=element("h3"),$=text(q[9]),j=space(),V&&V.c(),attr(M,"class","p-6"),attr(_,"class","flex flex-col items-center justify-center align-middle h-[60vh]")},m(G,X){insert(G,_,X),append(_,M),append(M,$),append(_,j),V&&V.m(_,null),z=!0},p(G,X){(!z||X[0]&512)&&set_data($,G[9]),G[9]==="No artefacts were found"?V?(V.p(G,X),X[0]&512&&transition_in(V,1)):(V=create_if_block_1$9(G),V.c(),transition_in(V,1),V.m(_,null)):V&&(group_outros(),transition_out(V,1,1,()=>{V=null}),check_outros())},i(G){z||(transition_in(V),z=!0)},o(G){transition_out(V),z=!1},d(G){G&&detach(_),V&&V.d()}}}function create_else_block_2(q){let _,M=q[80].documents.find(z),$,j;function z(...G){return q[48](q[80],q[74],q[76],...G)}let V=M&&create_if_block_10(q);return{c(){_=element("div"),V&&V.c(),attr(_,"class",$="borderstudio relative "+(q[74]===0?"top-row-offset":"")+" "+(q[76]===0&&q[13]?"first-col-offset":"")+" svelte-1mtid1f"),attr(_,"data-letter",q[74]===0?mapNumberToLetter$2(q[76]):""),attr(_,"data-number",q[76]===0?q[74]+1:"")},m(G,X){insert(G,_,X),V&&V.m(_,null),j=!0},p(G,X){q=G,X[0]&256&&(M=q[80].documents.find(z)),M?V?(V.p(q,X),X[0]&256&&transition_in(V,1)):(V=create_if_block_10(q),V.c(),transition_in(V,1),V.m(_,null)):V&&(group_outros(),transition_out(V,1,1,()=>{V=null}),check_outros()),(!j||X[0]&8192&&$!==($="borderstudio relative "+(q[74]===0?"top-row-offset":"")+" "+(q[76]===0&&q[13]?"first-col-offset":"")+" svelte-1mtid1f"))&&attr(_,"class",$)},i(G){j||(transition_in(V),j=!0)},o(G){transition_out(V),j=!1},d(G){G&&detach(_),V&&V.d()}}}function create_if_block_8(q){let _,M,$,j,z=q[10][q[76]][q[74]]&&q[10][q[76]][q[74]].length>0&&create_if_block_9(q);return{c(){_=element("h3"),_.textContent="Please visit this page on a larger screen.",M=space(),z&&z.c(),$=empty()},m(V,G){insert(V,_,G),insert(V,M,G),z&&z.m(V,G),insert(V,$,G),j=!0},p(V,G){V[10][V[76]][V[74]]&&V[10][V[76]][V[74]].length>0?z?(z.p(V,G),G[0]&1024&&transition_in(z,1)):(z=create_if_block_9(V),z.c(),transition_in(z,1),z.m($.parentNode,$)):z&&(group_outros(),transition_out(z,1,1,()=>{z=null}),check_outros())},i(V){j||(transition_in(z),j=!0)},o(V){transition_out(z),j=!1},d(V){V&&detach(_),V&&detach(M),z&&z.d(V),V&&detach($)}}}function create_if_block_10(q){let _=[],M=new Map,$,j;function z(...X){return q[56](q[80],q[74],q[76],...X)}let V=q[80].documents.filter(z);const G=X=>X[77].textHash+X[77].timestamp;for(let X=0;X<V.length;X+=1){let Y=get_each_context_8(q,V,X),Q=G(Y);M.set(Q,_[X]=create_each_block_8(Q,Y))}return{c(){for(let X=0;X<_.length;X+=1)_[X].c();$=empty()},m(X,Y){for(let Q=0;Q<_.length;Q+=1)_[Q]&&_[Q].m(X,Y);insert(X,$,Y),j=!0},p(X,Y){q=X,Y[0]&285212928&&(V=q[80].documents.filter(z),group_outros(),_=update_keyed_each(_,Y,G,1,q,V,M,$.parentNode,outro_and_destroy_block,create_each_block_8,$,get_each_context_8),check_outros())},i(X){if(!j){for(let Y=0;Y<V.length;Y+=1)transition_in(_[Y]);j=!0}},o(X){for(let Y=0;Y<_.length;Y+=1)transition_out(_[Y]);j=!1},d(X){for(let Y=0;Y<_.length;Y+=1)_[Y].d(X);X&&detach($)}}}function create_each_block_8(q,_){let M,$,j,z,V,G,X;$=new OrbitingReplies({props:{doc:_[77]}});function Y(){return _[57](_[77])}return V=new Icon({props:{replies,phase:"0",doc:_[77]}}),V.$on("click",Y),{key:q,first:null,c(){M=element("div"),create_component($.$$.fragment),j=space(),z=element("div"),create_component(V.$$.fragment),attr(z,"class","orbit-icon svelte-1mtid1f"),attr(M,"id",G=_[77].textHash+_[77].timestamp),attr(M,"class","orbit-icon-container svelte-1mtid1f"),this.first=M},m(Q,Z){insert(Q,M,Z),mount_component($,M,null),append(M,j),append(M,z),mount_component(V,z,null),X=!0},p(Q,Z){_=Q;const ee={};Z[0]&256&&(ee.doc=_[77]),$.$set(ee);const te={};Z[0]&256&&(te.doc=_[77]),V.$set(te),(!X||Z[0]&256&&G!==(G=_[77].textHash+_[77].timestamp))&&attr(M,"id",G)},i(Q){X||(transition_in($.$$.fragment,Q),transition_in(V.$$.fragment,Q),X=!0)},o(Q){transition_out($.$$.fragment,Q),transition_out(V.$$.fragment,Q),X=!1},d(Q){Q&&detach(M),destroy_component($),destroy_component(V)}}}function create_if_block_9(q){let _,M=q[74]+"",$,j,z=q[76]+"",V,G,X,Y=q[10][q[76]][q[74]],Q=[];for(let ee=0;ee<Y.length;ee+=1)Q[ee]=create_each_block_7(get_each_context_7(q,Y,ee));const Z=ee=>transition_out(Q[ee],1,1,()=>{Q[ee]=null});return{c(){_=element("div"),$=text(M),j=text(","),V=text(z),G=space();for(let ee=0;ee<Q.length;ee+=1)Q[ee].c();attr(_,"id",`Studio_cell_${q[74]}_${q[76]}`),attr(_,"class","grid-cell svelte-1mtid1f")},m(ee,te){insert(ee,_,te),append(_,$),append(_,j),append(_,V),append(_,G);for(let ne=0;ne<Q.length;ne+=1)Q[ne]&&Q[ne].m(_,null);X=!0},p(ee,te){if(te[0]&285213696){Y=ee[10][ee[76]][ee[74]];let ne;for(ne=0;ne<Y.length;ne+=1){const re=get_each_context_7(ee,Y,ne);Q[ne]?(Q[ne].p(re,te),transition_in(Q[ne],1)):(Q[ne]=create_each_block_7(re),Q[ne].c(),transition_in(Q[ne],1),Q[ne].m(_,null))}for(group_outros(),ne=Y.length;ne<Q.length;ne+=1)Z(ne);check_outros()}},i(ee){if(!X){for(let te=0;te<Y.length;te+=1)transition_in(Q[te]);X=!0}},o(ee){Q=Q.filter(Boolean);for(let te=0;te<Q.length;te+=1)transition_out(Q[te]);X=!1},d(ee){ee&&detach(_),destroy_each(Q,ee)}}}function create_each_block_7(q){let _,M,$,j,z,V,G;M=new OrbitingReplies({props:{doc:q[85].doc}});function X(){return q[55](q[85])}return z=new Icon({props:{replies,phase:1,doc:q[85].doc}}),z.$on("click",X),{c(){_=element("div"),create_component(M.$$.fragment),$=space(),j=element("div"),create_component(z.$$.fragment),attr(j,"class","orbit-icon svelte-1mtid1f"),attr(_,"id",V=q[74]+q[76]+q[85].doc.textHash+q[85].doc.timestamp),attr(_,"class","orbit-icon-container svelte-1mtid1f")},m(Y,Q){insert(Y,_,Q),mount_component(M,_,null),append(_,$),append(_,j),mount_component(z,j,null),G=!0},p(Y,Q){q=Y;const Z={};Q[0]&1024&&(Z.doc=q[85].doc),M.$set(Z);const ee={};Q[0]&1024&&(ee.doc=q[85].doc),z.$set(ee),(!G||Q[0]&1024&&V!==(V=q[74]+q[76]+q[85].doc.textHash+q[85].doc.timestamp))&&attr(_,"id",V)},i(Y){G||(transition_in(M.$$.fragment,Y),transition_in(z.$$.fragment,Y),G=!0)},o(Y){transition_out(M.$$.fragment,Y),transition_out(z.$$.fragment,Y),G=!1},d(Y){Y&&detach(_),destroy_component(M),destroy_component(z)}}}function create_each_block_6(q,_){let M,$,j,z,V;const G=[create_if_block_8,create_else_block_2],X=[];function Y(Q,Z){return Q[11]?0:1}return $=Y(_),j=X[$]=G[$](_),{key:q,first:null,c(){M=empty(),j.c(),z=empty(),this.first=M},m(Q,Z){insert(Q,M,Z),X[$].m(Q,Z),insert(Q,z,Z),V=!0},p(Q,Z){_=Q;let ee=$;$=Y(_),$===ee?X[$].p(_,Z):(group_outros(),transition_out(X[ee],1,1,()=>{X[ee]=null}),check_outros(),j=X[$],j?j.p(_,Z):(j=X[$]=G[$](_),j.c()),transition_in(j,1),j.m(z.parentNode,z))},i(Q){V||(transition_in(j),V=!0)},o(Q){transition_out(j),V=!1},d(Q){Q&&detach(M),X[$].d(Q),Q&&detach(z)}}}function create_each_block_5(q,_){let M,$=[],j=new Map,z,V,G={length:_[24][1]};const X=Y=>Y[76];for(let Y=0;Y<G.length;Y+=1){let Q=get_each_context_6(_,G,Y),Z=X(Q);j.set(Z,$[Y]=create_each_block_6(Z,Q))}return{key:q,first:null,c(){M=empty();for(let Y=0;Y<$.length;Y+=1)$[Y].c();z=empty(),this.first=M},m(Y,Q){insert(Y,M,Q);for(let Z=0;Z<$.length;Z+=1)$[Z]&&$[Z].m(Y,Q);insert(Y,z,Q),V=!0},p(Y,Q){_=Y,Q[0]&285224192&&(G={length:_[24][1]},group_outros(),$=update_keyed_each($,Q,X,1,_,G,j,z.parentNode,outro_and_destroy_block,create_each_block_6,z,get_each_context_6),check_outros())},i(Y){if(!V){for(let Q=0;Q<G.length;Q+=1)transition_in($[Q]);V=!0}},o(Y){for(let Q=0;Q<$.length;Q+=1)transition_out($[Q]);V=!1},d(Y){Y&&detach(M);for(let Q=0;Q<$.length;Q+=1)$[Q].d(Y);Y&&detach(z)}}}function create_each_block_4(q,_){let M,$=[],j=new Map,z,V,G,X=_[80].pageNumber+"",Y,Q,Z,ee,te={length:_[24][0]};const ne=re=>re[74];for(let re=0;re<te.length;re+=1){let ie=get_each_context_5(_,te,re),se=ne(ie);j.set(se,$[re]=create_each_block_5(se,ie))}return{key:q,first:null,c(){M=element("div");for(let re=0;re<$.length;re+=1)$[re].c();z=space(),V=element("p"),G=text("page "),Y=text(X),attr(V,"class","text-left"),attr(M,"id",Q=`Studio-page${_[80].pageNumber}`),attr(M,"class","my-grid-container studio-grid w-screen mb-32 svelte-1mtid1f"),attr(M,"style",Z=`background-color: white; ${_[11]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${_[20]}; grid-template-rows: ${_[21]};`}`),this.first=M},m(re,ie){insert(re,M,ie);for(let se=0;se<$.length;se+=1)$[se]&&$[se].m(M,null);append(M,z),append(M,V),append(V,G),append(V,Y),ee=!0},p(re,ie){_=re,ie[0]&285224192&&(te={length:_[24][0]},group_outros(),$=update_keyed_each($,ie,ne,1,_,te,j,M,outro_and_destroy_block,create_each_block_5,z,get_each_context_5),check_outros()),(!ee||ie[0]&256)&&X!==(X=_[80].pageNumber+"")&&set_data(Y,X),(!ee||ie[0]&256&&Q!==(Q=`Studio-page${_[80].pageNumber}`))&&attr(M,"id",Q),(!ee||ie[0]&3147776&&Z!==(Z=`background-color: white; ${_[11]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${_[20]}; grid-template-rows: ${_[21]};`}`))&&attr(M,"style",Z)},i(re){if(!ee){for(let ie=0;ie<te.length;ie+=1)transition_in($[ie]);ee=!0}},o(re){for(let ie=0;ie<$.length;ie+=1)transition_out($[ie]);ee=!1},d(re){re&&detach(M);for(let ie=0;ie<$.length;ie+=1)$[ie].d()}}}function create_if_block_6$1(q){let _,M;return _=new StudioPortal({props:{topOfCommons:!0}}),_.$on("shareUpdated",q[36]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p:noop,i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_else_block$3(q){let _,M=q[2].find(z),$,j;function z(...G){return q[47](q[74],q[76],...G)}let V=M&&create_if_block_4$2(q);return{c(){_=element("div"),V&&V.c(),attr(_,"id",q[76]+"+"+q[74]+"+"+q[71]),attr(_,"class",$="grid-cell "+(q[74]===0&&q[71]===0?"top-row-offset":"")+" "+(q[76]===0&&q[13]?"first-col-offset":"")+" svelte-1mtid1f"),attr(_,"data-letter",q[74]===0?mapNumberToLetter$2(q[76]):""),attr(_,"data-number",q[76]===0?q[74]+1:"")},m(G,X){insert(G,_,X),V&&V.m(_,null),j=!0},p(G,X){q=G,X[0]&4&&(M=q[2].find(z)),M?V?(V.p(q,X),X[0]&4&&transition_in(V,1)):(V=create_if_block_4$2(q),V.c(),transition_in(V,1),V.m(_,null)):V&&(group_outros(),transition_out(V,1,1,()=>{V=null}),check_outros()),(!j||X[0]&8192&&$!==($="grid-cell "+(q[74]===0&&q[71]===0?"top-row-offset":"")+" "+(q[76]===0&&q[13]?"first-col-offset":"")+" svelte-1mtid1f"))&&attr(_,"class",$)},i(G){j||(transition_in(V),j=!0)},o(G){transition_out(V),j=!1},d(G){G&&detach(_),V&&V.d()}}}function create_if_block_3$2(q){let _;return{c(){_=element("h3"),_.textContent="Please visit this page on a larger screen."},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}function create_if_block_4$2(q){let _=[],M=new Map,$,j;function z(...X){return q[53](q[74],q[76],...X)}let V=q[2].filter(z);const G=X=>X[77].textHash+X[77].timestamp;for(let X=0;X<V.length;X+=1){let Y=get_each_context_3(q,V,X),Q=G(Y);M.set(Q,_[X]=create_each_block_3(Q,Y))}return{c(){for(let X=0;X<_.length;X+=1)_[X].c();$=empty()},m(X,Y){for(let Q=0;Q<_.length;Q+=1)_[Q]&&_[Q].m(X,Y);insert(X,$,Y),j=!0},p(X,Y){q=X,Y[0]&352321540&&(V=q[2].filter(z),group_outros(),_=update_keyed_each(_,Y,G,1,q,V,M,$.parentNode,outro_and_destroy_block,create_each_block_3,$,get_each_context_3),check_outros())},i(X){if(!j){for(let Y=0;Y<V.length;Y+=1)transition_in(_[Y]);j=!0}},o(X){for(let Y=0;Y<_.length;Y+=1)transition_out(_[Y]);j=!1},d(X){for(let Y=0;Y<_.length;Y+=1)_[Y].d(X);X&&detach($)}}}function create_else_block_1(q){let _,M,$,j,z;_=new OrbitingReplies({props:{doc:q[77]}});function V(){return q[54](q[77])}return j=new Icon({props:{replies,phase:q[71],doc:q[77]}}),j.$on("click",V),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-1mtid1f")},m(G,X){mount_component(_,G,X),insert(G,M,X),insert(G,$,X),mount_component(j,$,null),z=!0},p(G,X){q=G;const Y={};X[0]&4&&(Y.doc=q[77]),_.$set(Y);const Q={};X[0]&4&&(Q.doc=q[77]),j.$set(Q)},i(G){z||(transition_in(_.$$.fragment,G),transition_in(j.$$.fragment,G),z=!0)},o(G){transition_out(_.$$.fragment,G),transition_out(j.$$.fragment,G),z=!1},d(G){destroy_component(_,G),G&&detach(M),G&&detach($),destroy_component(j)}}}function create_if_block_5$1(q){let _,M,$,j,z;return _=new OrbitingReplies({props:{doc:q[77],disabled:!0}}),j=new Icon({props:{replies,phase:q[71],doc:q[77],disabled:!0}}),{c(){create_component(_.$$.fragment),M=space(),$=element("div"),create_component(j.$$.fragment),attr($,"class","orbit-icon svelte-1mtid1f")},m(V,G){mount_component(_,V,G),insert(V,M,G),insert(V,$,G),mount_component(j,$,null),z=!0},p(V,G){const X={};G[0]&4&&(X.doc=V[77]),_.$set(X);const Y={};G[0]&4&&(Y.doc=V[77]),j.$set(Y)},i(V){z||(transition_in(_.$$.fragment,V),transition_in(j.$$.fragment,V),z=!0)},o(V){transition_out(_.$$.fragment,V),transition_out(j.$$.fragment,V),z=!1},d(V){destroy_component(_,V),V&&detach(M),V&&detach($),destroy_component(j)}}}function create_each_block_3(q,_){let M,$,j,z,V;const G=[create_if_block_5$1,create_else_block_1],X=[];function Y(Q,Z){return Q[26]<Q[77].deleteAfter-Q[69]&&Q[26]>Q[77].deleteAfter-(Q[69]+63936e7)?1:0}return $=Y(_),j=X[$]=G[$](_),{key:q,first:null,c(){M=element("div"),j.c(),attr(M,"id",z=_[77].textHash+_[77].timestamp),attr(M,"class","orbit-icon-container svelte-1mtid1f"),this.first=M},m(Q,Z){insert(Q,M,Z),X[$].m(M,null),V=!0},p(Q,Z){_=Q;let ee=$;$=Y(_),$===ee?X[$].p(_,Z):(group_outros(),transition_out(X[ee],1,1,()=>{X[ee]=null}),check_outros(),j=X[$],j?j.p(_,Z):(j=X[$]=G[$](_),j.c()),transition_in(j,1),j.m(M,null)),(!V||Z[0]&4&&z!==(z=_[77].textHash+_[77].timestamp))&&attr(M,"id",z)},i(Q){V||(transition_in(j),V=!0)},o(Q){transition_out(j),V=!1},d(Q){Q&&detach(M),X[$].d()}}}function create_each_block_2(q,_){let M,$,j,z,V;const G=[create_if_block_3$2,create_else_block$3],X=[];function Y(Q,Z){return Q[11]?0:1}return $=Y(_),j=X[$]=G[$](_),{key:q,first:null,c(){M=empty(),j.c(),z=empty(),this.first=M},m(Q,Z){insert(Q,M,Z),X[$].m(Q,Z),insert(Q,z,Z),V=!0},p(Q,Z){_=Q;let ee=$;$=Y(_),$===ee?X[$].p(_,Z):(group_outros(),transition_out(X[ee],1,1,()=>{X[ee]=null}),check_outros(),j=X[$],j?j.p(_,Z):(j=X[$]=G[$](_),j.c()),transition_in(j,1),j.m(z.parentNode,z))},i(Q){V||(transition_in(j),V=!0)},o(Q){transition_out(j),V=!1},d(Q){Q&&detach(M),X[$].d(Q),Q&&detach(z)}}}function create_each_block_1(q,_){let M,$=[],j=new Map,z,V,G={length:_[24][1]};const X=Y=>Y[76];for(let Y=0;Y<G.length;Y+=1){let Q=get_each_context_2(_,G,Y),Z=X(Q);j.set(Z,$[Y]=create_each_block_2(Z,Q))}return{key:q,first:null,c(){M=empty();for(let Y=0;Y<$.length;Y+=1)$[Y].c();z=empty(),this.first=M},m(Y,Q){insert(Y,M,Q);for(let Z=0;Z<$.length;Z+=1)$[Z]&&$[Z].m(Y,Q);insert(Y,z,Q),V=!0},p(Y,Q){_=Y,Q[0]&352331780&&(G={length:_[24][1]},group_outros(),$=update_keyed_each($,Q,X,1,_,G,j,z.parentNode,outro_and_destroy_block,create_each_block_2,z,get_each_context_2),check_outros())},i(Y){if(!V){for(let Q=0;Q<G.length;Q+=1)transition_in($[Q]);V=!0}},o(Y){for(let Q=0;Q<$.length;Q+=1)transition_out($[Q]);V=!1},d(Y){Y&&detach(M);for(let Q=0;Q<$.length;Q+=1)$[Q].d(Y);Y&&detach(z)}}}function create_each_block$4(q,_){let M,$=[],j=new Map,z,V,G={length:_[24][0]};const X=Y=>Y[74];for(let Y=0;Y<G.length;Y+=1){let Q=get_each_context_1(_,G,Y),Z=X(Q);j.set(Z,$[Y]=create_each_block_1(Z,Q))}return{key:q,first:null,c(){M=element("div");for(let Y=0;Y<$.length;Y+=1)$[Y].c();attr(M,"id",`section${_[71]}`),attr(M,"class","my-grid-container w-screen h-full commons-border "+(_[71]===0?"top-border":"")+" "+(_[71]===3?"bottom-border":"")+" svelte-1mtid1f"),attr(M,"style",z=`background-color: ${COLOR_CYCLE[_[71]]}; ${_[11]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${_[20]}; grid-template-rows: ${_[21]};`}`),this.first=M},m(Y,Q){insert(Y,M,Q);for(let Z=0;Z<$.length;Z+=1)$[Z]&&$[Z].m(M,null);V=!0},p(Y,Q){_=Y,Q[0]&352331780&&(G={length:_[24][0]},group_outros(),$=update_keyed_each($,Q,X,1,_,G,j,M,outro_and_destroy_block,create_each_block_1,null,get_each_context_1),check_outros()),(!V||Q[0]&3147776&&z!==(z=`background-color: ${COLOR_CYCLE[_[71]]}; ${_[11]?"grid-template-columns: repeat(3, 1fr); grid-template-rows: auto;":`grid-template-columns: ${_[20]}; grid-template-rows: ${_[21]};`}`))&&attr(M,"style",z)},i(Y){if(!V){for(let Q=0;Q<G.length;Q+=1)transition_in($[Q]);V=!0}},o(Y){for(let Q=0;Q<$.length;Q+=1)transition_out($[Q]);V=!1},d(Y){Y&&detach(M);for(let Q=0;Q<$.length;Q+=1)$[Q].d()}}}function create_if_block_1$9(q){let _,M;return _=new StudioPortal({props:{topOfCommons:!0}}),_.$on("shareUpdated",q[36]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},p:noop,i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_fragment$f(q){let _,M,$,j,z,V,G,X,Y=(q[25].length>0?q[25]:"none")+"",Q,Z,ee,te,ne,re,ie,se,le,he,ce,ae,de,ge,fe,oe,we,De,ve;const Ce=[create_if_block_15,create_else_block_3],ue=[];function Pe(Se,pe){return Se[4]?0:1}te=Pe(q),ne=ue[te]=Ce[te](q);let ze=q[23]&&create_if_block_14(q);const Le=[create_if_block_11,create_if_block_12,create_if_block_13],Me=[];function Ne(Se,pe){return Se[4]?0:!Se[13]&&!Se[23]?1:Se[16]?2:-1}~(ce=Ne(q))&&(ae=Me[ce]=Le[ce](q));const Ye=[create_if_block$b,create_if_block_2$6,create_if_block_7$1],Ie=[];function Oe(Se,pe){return Se[2].length===0?0:Se[5]?1:Se[18]?2:-1}return~(fe=Oe(q))&&(oe=Ie[fe]=Ye[fe](q)),{c(){_=element("div"),M=space(),$=element("div"),j=element("div"),z=element("button"),z.textContent="🔮 app customization",V=space(),G=element("p"),X=element("b"),X.textContent=`current alias:
  `,Q=text(Y),Z=space(),ee=element("div"),ne.c(),ie=space(),se=element("div"),le=element("div"),ze&&ze.c(),he=space(),ae&&ae.c(),de=space(),ge=element("div"),oe&&oe.c(),attr(_,"class","w-screen flex flex-row justify-start h-auto"),attr(z,"class","ml-6 mt-4 mb-2 h-auto mr-1"),attr(G,"class","ml-6 text-2xl text-left"),attr(ee,"class","ml-6 mx-1 sm:mt-4 flex flex-row justify-between sm:flex-col p-8 h-auto sm:h-[80vh] z-50 customBorder svelte-1mtid1f"),attr(ee,"style",re=(q[5]?`background-color: ${q[12]};`:"background-color: white;")+" transition: background-color 1s ease; "+(q[5]?"color: #71302B;":"color: black;")+";"),attr(j,"class","sm:w-1/5 flex flex-col side-bar fixed "),attr(ge,"class","flex flex-col w-auto mt-6"),attr(le,"class","my-grid-container-wrapper w-auto pl-4 ml-4 svelte-1mtid1f"),attr(se,"class","w-4/5 mt-16 sm:mt-4 sm:ml-[20vw]"),attr($,"class","the-scroll flex flex-row sm:flex-col min-h-screen overflow-y-auto svelte-1mtid1f")},m(Se,pe){insert(Se,_,pe),insert(Se,M,pe),insert(Se,$,pe),append($,j),append(j,z),append(j,V),append(j,G),append(G,X),append(G,Q),append(j,Z),append(j,ee),ue[te].m(ee,null),append($,ie),append($,se),append(se,le),ze&&ze.m(le,null),append(le,he),~ce&&Me[ce].m(le,null),append(le,de),append(le,ge),~fe&&Ie[fe].m(ge,null),we=!0,De||(ve=[listen(_,"click",q[49]),listen(_,"keydown",q[33]),listen(z,"click",q[32])],De=!0)},p(Se,pe){let me=te;te=Pe(Se),te===me?ue[te].p(Se,pe):(group_outros(),transition_out(ue[me],1,1,()=>{ue[me]=null}),check_outros(),ne=ue[te],ne?ne.p(Se,pe):(ne=ue[te]=Ce[te](Se),ne.c()),transition_in(ne,1),ne.m(ee,null)),(!we||pe[0]&4128&&re!==(re=(Se[5]?`background-color: ${Se[12]};`:"background-color: white;")+" transition: background-color 1s ease; "+(Se[5]?"color: #71302B;":"color: black;")+";"))&&attr(ee,"style",re),Se[23]?ze?(ze.p(Se,pe),pe[0]&8388608&&transition_in(ze,1)):(ze=create_if_block_14(Se),ze.c(),transition_in(ze,1),ze.m(le,he)):ze&&(group_outros(),transition_out(ze,1,1,()=>{ze=null}),check_outros());let be=ce;ce=Ne(Se),ce===be?~ce&&Me[ce].p(Se,pe):(ae&&(group_outros(),transition_out(Me[be],1,1,()=>{Me[be]=null}),check_outros()),~ce?(ae=Me[ce],ae?ae.p(Se,pe):(ae=Me[ce]=Le[ce](Se),ae.c()),transition_in(ae,1),ae.m(le,de)):ae=null);let Ee=fe;fe=Oe(Se),fe===Ee?~fe&&Ie[fe].p(Se,pe):(oe&&(group_outros(),transition_out(Ie[Ee],1,1,()=>{Ie[Ee]=null}),check_outros()),~fe?(oe=Ie[fe],oe?oe.p(Se,pe):(oe=Ie[fe]=Ye[fe](Se),oe.c()),transition_in(oe,1),oe.m(ge,null)):oe=null)},i(Se){we||(transition_in(ne),transition_in(ze),transition_in(ae),transition_in(oe),we=!0)},o(Se){transition_out(ne),transition_out(ze),transition_out(ae),transition_out(oe),we=!1},d(Se){Se&&detach(_),Se&&detach(M),Se&&detach($),ue[te].d(),ze&&ze.d(),~ce&&Me[ce].d(),~fe&&Ie[fe].d(),De=!1,run_all(ve)}}}const MAX_RETRIES=8;let replies=!1;function instance$e(q,_,M){let $,j,z,V,G;component_subscribe(q,cacheDetails,ht=>M(60,$=ht)),component_subscribe(q,studioGridStore,ht=>M(61,j=ht)),component_subscribe(q,commonsGridStore,ht=>M(62,z=ht)),component_subscribe(q,time,ht=>M(63,V=ht)),component_subscribe(q,authorKeypair,ht=>M(64,G=ht));let{showDetails:X=!0}=_,{IDcreated:Y=!1}=_,{attachment:Q=!0}=_,{isReply:Z=!1}=_,ee=0,te=[6,9],ne=[],re,ie="Looking for artefacts...",se=G.address.slice(0,5),le=0,he=Array(te[0]).fill().map(()=>Array(te[1]).fill(!1)),ce=[],ae=V.getTime()*1e3,de=!1,ge,fe=COLOR_CYCLE[0];const oe=createEventDispatcher();let we=get_store_value(shareKeypair).shareAddress;shareKeypair.subscribe(ht=>{M(3,we=ht.shareAddress)});function De(){const ht="+commons.buxxyxhoa3uxpanzrb6ki7btpzvkm5cf7brjptev3bmim3rk77hbq",ft=settings.shareSecrets[ht];shareKeypair.set({shareAddress:ht,secret:ft}),He(),M(4,ue=null),M(13,Ce=!0)}function ve(){disconnectObserver(ge);let ht;window.innerWidth<=768?ht=.45:ht=.5,ge=createObserver(lt=>{lt.forEach(et=>{et.isIntersecting&&(M(1,le=parseInt(et.target.getAttribute("id").replace("section",""))),M(12,fe=COLOR_CYCLE[le%COLOR_CYCLE.length]))})},ht)}afterUpdate(()=>{we.includes("commons")&&LUNAR_PHASE.forEach((ht,ft)=>{const lt=document.querySelector(`#section${ft}`);observeElement(ge,lt)})}),onDestroy(()=>{disconnectObserver(ge)});let Ce=!0,ue=null,Pe,ze,Le=!1,Me=null,Ne=!1,Ye,Ie,Oe=[0,0],Se,pe,me=0,be=0,Ee=0,ke=0,Fe=0;cacheDetails.subscribe(ht=>{});function Be(ht){M(4,ue=ht),console.log("selecteddoc",ht)}const Ue=async()=>{if(M(9,ie="Looking for artefacts..."),M(2,ce=$.queryDocs({filter:{pathStartsWith:"/documents"}})),Ye){M(2,ce=ce.filter(ft=>ft.path.split("/").length<=6&&ft.text.trim()!=="")),M(10,he=calculateLunarPhase(ce)),set_store_value(commonsGridStore,z={},z),isCommonsCellOccupied(ce);const ht=countArtefactsInEachPhase(he);M(43,me=ht.artefactsInPhase0),M(44,be=ht.artefactsInPhase1),M(45,Ee=ht.artefactsInPhase2),M(46,ke=ht.artefactsInPhase3)}else{M(9,ie="Looking for artefacts...");let ht={};M(2,ce=ce.filter(ft=>{const et=extractPageNumber(ft)===1?6:7,tt=ft.path.endsWith("/newPage")&&ft.text.trim()!=="";return ft.path.split("/").length<=et&&ft.path.split("/").length>=5&&ft.text.trim()!==""||tt})),ce.forEach(ft=>{const lt=extractPageNumber(ft);ht[lt]||(ht[lt]=[]),ht[lt].push(ft)}),set_store_value(studioGridStore,j={},j);for(let ft in ht){let lt=parseInt(ft);setIsCellOccupied(ht[ft],lt)}M(42,re=Object.values(ht)),setTimeout(()=>{M(18,Ne=!0)},500)}};$.onCacheUpdated(()=>{setTimeout(()=>{Ue()},500)}),onMount(()=>{Ue()});let nt=!1;function rt(){M(23,nt=!nt),M(13,Ce=!Ce)}function _e(){M(13,Ce=!Ce),M(4,ue=null)}function We(){oe("toggle")}function Xe(ht){ht.key==="Escape"&&M(4,ue=null)}function Te(ht){M(16,Le=!0),M(13,Ce=!0),M(4,ue=null),M(17,Me=ht.detail.type),M(19,Oe=ht.detail.location)}function Re(){M(16,Le=!1),M(13,Ce=!0),M(4,ue=null),M(17,Me=null),M(19,Oe=[0,0]),setTimeout(()=>{Ue()},500)}function He(){M(41,ee=0),M(9,ie=""),M(2,ce=[]),M(3,we=get_store_value(shareKeypair).shareAddress),setTimeout(()=>{Ue()},800),M(23,nt=!1),M(13,Ce=!0)}let Ze;onMount(()=>{M(7,Ze=window.innerWidth),window.addEventListener("resize",()=>{M(7,Ze=window.innerWidth)})});function ot(){M(4,ue=null),M(13,Ce=!0),M(23,nt=!1),He()}const $e=(ht,ft,lt)=>parseInt(lt.path.split("/")[2])==ht&&parseInt(lt.path.split("/")[3])==ft,je=(ht,ft,lt,et)=>parseInt(et.path.split("/")[ht.pageNumber===1?2:3])==ft&&parseInt(et.path.split("/")[ht.pageNumber===1?3:4])==lt,Ke=()=>M(4,ue=null),Qe=()=>M(4,ue=null),dt=()=>M(13,Ce=!Ce),pt=()=>M(13,Ce=!Ce),wt=(ht,ft,lt)=>parseInt(lt.path.split("/")[2])==ht&&parseInt(lt.path.split("/")[3])==ft,St=ht=>Be(ht),Rt=ht=>Be(ht.doc),xt=(ht,ft,lt,et)=>parseInt(et.path.split("/")[ht.pageNumber===1?2:3])==ft&&parseInt(et.path.split("/")[ht.pageNumber===1?3:4])==lt,It=ht=>Be(ht);return q.$$set=ht=>{"showDetails"in ht&&M(38,X=ht.showDetails),"IDcreated"in ht&&M(39,Y=ht.IDcreated),"attachment"in ht&&M(0,Q=ht.attachment),"isReply"in ht&&M(40,Z=ht.isReply)},q.$$.update=()=>{if(q.$$.dirty[0]&16&&ue){let ht=pathToXY(ue.path);M(14,Pe=ht[1]),M(15,ze=ht[0])}if(q.$$.dirty[0]&2|q.$$.dirty[1]&61440)switch(le){case 0:M(22,Fe=me);break;case 1:M(22,Fe=be);break;case 2:M(22,Fe=Ee);break;case 3:M(22,Fe=ke);break}q.$$.dirty[0]&4|q.$$.dirty[1]&1024&&(ce.length===0?ee<MAX_RETRIES?(M(41,ee++,ee),setTimeout(()=>{Ue()},2e3),M(9,ie="Looking for artefacts...")):M(9,ie="No artefacts were found"):M(41,ee=0)),q.$$.dirty[0]&104|q.$$.dirty[1]&2048&&(M(6,Ie=we.split("+")[1].split(".")[0]),M(5,Ye=Ie.includes("commons")),!Ye&&re!==void 0&&M(8,ne=re.map((ht,ft)=>({pageNumber:ft+1,documents:ht})))),q.$$.dirty[0]&2,q.$$.dirty[0]&128&&(Ze<=768?(M(11,de=!0),M(20,Se="repeat(3, minmax(min-content, 1fr))"),M(21,pe="repeat(18, minmax(min-content, 1fr))")):(M(11,de=!1),M(20,Se="repeat("+te[1]+", minmax(min-content, 1fr))"),M(21,pe="repeat("+te[0]+", minmax(min-content, 1fr))")),ve())},M(7,Ze=window.innerWidth),[Q,le,ce,we,ue,Ye,Ie,Ze,ne,ie,he,de,fe,Ce,Pe,ze,Le,Me,Ne,Oe,Se,pe,Fe,nt,te,se,ae,De,Be,Ue,rt,_e,We,Xe,Te,Re,He,ot,X,Y,Z,ee,re,me,be,Ee,ke,$e,je,Ke,Qe,dt,pt,wt,St,Rt,xt,It]}class GridView extends SvelteComponent{constructor(_){super(),init(this,_,instance$e,create_fragment$f,safe_not_equal,{showDetails:38,IDcreated:39,attachment:0,isReply:40},null,[-1,-1,-1])}}function create_if_block$a(q){let _,M,$,j,z,V,G,X,Y=q[1]<=1?"document":"documents",Q,Z,ee,te,ne,re,ie,se=q[2]<=1?"document":"documents",le,he,ce,ae,de,ge,fe,oe=q[3]<=1?"document":"documents",we,De;return{c(){_=element("div"),M=element("h5"),$=text(q[4]),j=space(),z=element("p"),V=element("strong"),G=text(q[1]),X=space(),Q=text(Y),Z=text(" shared"),ee=space(),te=element("p"),ne=element("strong"),re=text(q[2]),ie=space(),le=text(se),he=text(" received"),ce=space(),ae=element("p"),de=element("strong"),ge=text(q[3]),fe=space(),we=text(oe),De=text(" in queue"),attr(_,"class","flex flex-col items-start")},m(ve,Ce){insert(ve,_,Ce),append(_,M),append(M,$),append(_,j),append(_,z),append(z,V),append(V,G),append(z,X),append(z,Q),append(z,Z),append(_,ee),append(_,te),append(te,ne),append(ne,re),append(te,ie),append(te,le),append(te,he),append(_,ce),append(_,ae),append(ae,de),append(de,ge),append(ae,fe),append(ae,we),append(ae,De)},p(ve,Ce){Ce&16&&set_data($,ve[4]),Ce&2&&set_data(G,ve[1]),Ce&2&&Y!==(Y=ve[1]<=1?"document":"documents")&&set_data(Q,Y),Ce&4&&set_data(re,ve[2]),Ce&4&&se!==(se=ve[2]<=1?"document":"documents")&&set_data(le,se),Ce&8&&set_data(ge,ve[3]),Ce&8&&oe!==(oe=ve[3]<=1?"document":"documents")&&set_data(we,oe)},d(ve){ve&&detach(_)}}}function create_fragment$e(q){let _,M={$statusStore:q[0]}&&create_if_block$a(q);return{c(){M&&M.c(),_=empty()},m($,j){M&&M.m($,j),insert($,_,j)},p($,[j]){$[0],M?M.p($,j):(M=create_if_block$a($),M.c(),M.m(_.parentNode,_))},i:noop,o:noop,d($){M&&M.d($),$&&detach(_)}}}function instance$d(q,_,M){let $;component_subscribe(q,statusStore,Q=>M(0,$=Q));let{shareID:j}=_,z,V,G,X,Y;return q.$$set=Q=>{"shareID"in Q&&M(5,j=Q.shareID)},q.$$.update=()=>{if(q.$$.dirty&97&&$&&$[j]){let Q=$[j];Q&&(M(6,z=Q.docs),M(4,Y=z.status),M(1,V=z.sentCount),M(2,G=z.receivedCount),M(3,X=z.requestedCount))}},[$,V,G,X,Y,j,z]}class StatusPanel extends SvelteComponent{constructor(_){super(),init(this,_,instance$d,create_fragment$e,safe_not_equal,{shareID:5})}}function create_if_block_1$8(q){let _;return{c(){_=element("p"),_.textContent="Share and/or secret successfully added!",attr(_,"class","text-left")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block$9(q){let _,M,$;return{c(){_=element("p"),M=element("strong"),$=text(q[3])},m(j,z){insert(j,_,z),append(_,M),append(M,$)},p(j,z){z&8&&set_data($,j[3])},d(j){j&&detach(_)}}}function create_fragment$d(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee,te,ne,re,ie,se,le,he,ce=q[4]&&create_if_block_1$8(),ae=q[2]&&create_if_block$9(q);return{c(){_=element("div"),M=element("div"),$=element("h6"),$.textContent="add existing share",j=space(),z=element("div"),V=element("label"),G=text(`Address:
      `),X=element("input"),Y=space(),Q=element("label"),Z=text(`Secret:
    `),ee=element("input"),te=space(),ne=element("div"),re=element("button"),re.textContent="add a share",ie=space(),ce&&ce.c(),se=space(),ae&&ae.c(),attr($,"class","text-left pt-2"),attr(X,"id","shareAddress"),attr(X,"type","text"),attr(X,"spellcheck","false"),attr(X,"placeholder","Add a new workspace address"),attr(ee,"type","text"),attr(ee,"spellcheck","false"),attr(ee,"placeholder","Add the secret for this share"),attr(re,"class","w-60 phase1 mt-2 mb-1"),attr(Q,"for","shareAddress"),set_style(Q,"text-align","left"),attr(V,"for","shareAddress"),set_style(V,"text-align","left"),attr(z,"class","flex flex-col lg:flex-row"),attr(M,"class","flex flex-col justify-start py-2")},m(de,ge){insert(de,_,ge),append(_,M),append(M,$),append(M,j),append(M,z),append(z,V),append(V,G),append(V,X),set_input_value(X,q[0]),append(V,Y),append(V,Q),append(Q,Z),append(Q,ee),set_input_value(ee,q[1]),append(Q,te),append(Q,ne),append(ne,re),append(_,ie),ce&&ce.m(_,null),append(_,se),ae&&ae.m(_,null),le||(he=[listen(X,"input",q[6]),listen(ee,"input",q[7]),listen(re,"click",q[8])],le=!0)},p(de,[ge]){ge&1&&X.value!==de[0]&&set_input_value(X,de[0]),ge&2&&ee.value!==de[1]&&set_input_value(ee,de[1]),de[4]?ce||(ce=create_if_block_1$8(),ce.c(),ce.m(_,se)):ce&&(ce.d(1),ce=null),de[2]?ae?ae.p(de,ge):(ae=create_if_block$9(de),ae.c(),ae.m(_,null)):ae&&(ae.d(1),ae=null)},i:noop,o:noop,d(de){de&&detach(_),ce&&ce.d(),ae&&ae.d(),le=!1,run_all(he)}}}function instance$c(q,_,M){let $;component_subscribe(q,shareKeypair,ne=>M(10,$=ne));let j,z,V=!1,G,X=!1;function Y(ne){if(isErr(checkShareIsValid(ne))){M(2,V=!0),M(3,G="Not a valid share address");return}else M(2,V=!1),settings.addShare(ne),console.log("You are currently signed in as",settings.author||"no-one!"),console.log("You have",settings.shares.length,"shares"),console.log("Your shares are",settings.shares);Q(),V||M(4,X=!0)}async function Q(){let ne={address:j,secret:z};const re=await Crypto.checkKeypairIsValid(ne);if(console.log("share",j,typeof j),console.log("secret",z,typeof z),console.log(re),isErr(re)){M(2,V=!0),M(3,G="Not the right secret for this share.");return}else M(2,V=!1),settings.addSecret(j,z),console.log("You are currently signed in as",settings.author||"no-one!"),console.log("You have",settings.shares.length,"shares"),console.log("Your shares are",settings.shares),console.log("You know the secret to these shares:",settings.shareSecrets),V||M(4,X=!0)}onMount(()=>{$!==void 0&&(settings.addShare($.shareAddress),settings.addSecret($.shareAddress,$.secret))});function Z(){j=this.value,M(0,j)}function ee(){z=this.value,M(1,z)}return[j,z,V,G,X,Y,Z,ee,()=>Y(j)]}class AddShare extends SvelteComponent{constructor(_){super(),init(this,_,instance$c,create_fragment$d,safe_not_equal,{})}}const ShareSwitcher_svelte_svelte_type_style_lang="",RemoveShare_svelte_svelte_type_style_lang="";function get_each_context$3(q,_,M){const $=q.slice();return $[13]=_[M],$}function create_each_block$3(q,_){let M,$=_[13]+"",j,z;return{key:q,first:null,c(){M=element("option"),j=text($),M.__value=z=_[13],M.value=M.__value,this.first=M},m(V,G){insert(V,M,G),append(M,j)},p(V,G){_=V,G&32&&$!==($=_[13]+"")&&set_data(j,$),G&32&&z!==(z=_[13])&&(M.__value=z,M.value=M.__value)},d(V){V&&detach(M)}}}function create_if_block_1$7(q){let _;return{c(){_=element("p"),attr(_,"class","text-left")},m(M,$){insert(M,_,$),_.innerHTML=q[1]},p(M,$){$&2&&(_.innerHTML=M[1])},d(M){M&&detach(_)}}}function create_if_block$8(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee,te,ne=settings.shareSecrets[q[0]]+"",re,ie,se,le,he,ce,ae,de,ge,fe,oe=q[0].split(".")[1]+"",we,De,ve,Ce,ue,Pe,ze,Le,Me,Ne;return{c(){_=element("div"),M=element("div"),$=element("div"),j=element("h5"),j.textContent="removing the following share from your workspace:",z=space(),V=element("p"),G=element("b"),G.textContent=`Address:
    `,X=text(q[0]),Y=element("br"),Q=space(),Z=element("p"),ee=element("b"),ee.textContent="Secret:",te=space(),re=text(ne),ie=element("br"),se=space(),le=element("h6"),le.textContent="type the name of this share to remove it from your browser's memory",he=space(),ce=element("div"),ae=element("p"),de=text(`+
      `),ge=element("input"),fe=text(`
      .`),we=text(oe),De=space(),ve=element("p"),Ce=space(),ue=element("div"),Pe=element("button"),Pe.textContent="remove this share",ze=space(),Le=element("button"),Le.textContent="cancel",attr(j,"class","text-left"),attr(V,"class","pt-2 text-left truncate ..."),attr(Z,"class","pb-2 text-left truncate ..."),attr(le,"class","text-left"),attr(ge,"type","text"),attr(ge,"placeholder",q[4]),attr(ge,"class","svelte-1qgxk0l"),attr(ae,"class","truncate ..."),attr(ve,"class","text-left"),attr(Pe,"class","py-2 m-4"),attr(Le,"class","py-2 m-4"),attr(ue,"class","flex flex-row justify-between"),attr(ce,"class","flex flex-col py-2"),attr($,"class","flex flex-col justify-start"),attr(M,"class","modal-content w-2/3 lg:w-2/5 svelte-1qgxk0l"),attr(_,"class","modal svelte-1qgxk0l")},m(Ye,Ie){insert(Ye,_,Ie),append(_,M),append(M,$),append($,j),append($,z),append($,V),append(V,G),append(V,X),append(V,Y),append($,Q),append($,Z),append(Z,ee),append(Z,te),append(Z,re),append(Z,ie),append($,se),append($,le),append($,he),append($,ce),append(ce,ae),append(ae,de),append(ae,ge),set_input_value(ge,q[2]),append(ae,fe),append(ae,we),append(ce,De),append(ce,ve),ve.innerHTML=q[1],append(ce,Ce),append(ce,ue),append(ue,Pe),append(ue,ze),append(ue,Le),Me||(Ne=[listen(ge,"input",q[12]),listen(Pe,"click",q[8]),listen(Le,"click",q[9]),listen(_,"click",q[10])],Me=!0)},p(Ye,Ie){Ie&1&&set_data(X,Ye[0]),Ie&1&&ne!==(ne=settings.shareSecrets[Ye[0]]+"")&&set_data(re,ne),Ie&16&&attr(ge,"placeholder",Ye[4]),Ie&4&&ge.value!==Ye[2]&&set_input_value(ge,Ye[2]),Ie&1&&oe!==(oe=Ye[0].split(".")[1]+"")&&set_data(we,oe),Ie&2&&(ve.innerHTML=Ye[1])},d(Ye){Ye&&detach(_),Me=!1,run_all(Ne)}}}function create_fragment$c(q){let _,M,$,j,z,V,G,X=[],Y=new Map,Q,Z,ee,te,ne,re,ie,se=q[5];const le=ae=>ae[13];for(let ae=0;ae<se.length;ae+=1){let de=get_each_context$3(q,se,ae),ge=le(de);Y.set(ge,X[ae]=create_each_block$3(ge,de))}let he=q[1]&&create_if_block_1$7(q),ce=q[3]&&create_if_block$8(q);return{c(){_=element("div"),M=element("h6"),M.textContent="remove shares",$=space(),j=element("label"),j.textContent="this action is irreversible",z=space(),V=element("div"),G=element("select");for(let ae=0;ae<X.length;ae+=1)X[ae].c();Q=space(),Z=element("button"),Z.textContent="remove share",ee=space(),he&&he.c(),te=space(),ce&&ce.c(),ne=empty(),attr(M,"class","text-left"),attr(j,"class","text-left"),attr(j,"for","share-switcher"),attr(G,"id","share-selecter"),attr(G,"class","form-control my-2 w-3/5"),q[0]===void 0&&add_render_callback(()=>q[11].call(G)),attr(Z,"class","phase1 w-2/5 my-2 ml-4"),attr(V,"class","flex flex-col lg:flex-row"),attr(_,"class","flex flex-col justify-start py-2")},m(ae,de){insert(ae,_,de),append(_,M),append(_,$),append(_,j),append(_,z),append(_,V),append(V,G);for(let ge=0;ge<X.length;ge+=1)X[ge]&&X[ge].m(G,null);select_option(G,q[0],!0),append(V,Q),append(V,Z),append(_,ee),he&&he.m(_,null),insert(ae,te,de),ce&&ce.m(ae,de),insert(ae,ne,de),re||(ie=[listen(G,"change",q[11]),listen(Z,"click",q[7])],re=!0)},p(ae,[de]){de&32&&(se=ae[5],X=update_keyed_each(X,de,le,1,ae,se,Y,G,destroy_block,create_each_block$3,null,get_each_context$3)),de&33&&select_option(G,ae[0]),ae[1]?he?he.p(ae,de):(he=create_if_block_1$7(ae),he.c(),he.m(_,null)):he&&(he.d(1),he=null),ae[3]?ce?ce.p(ae,de):(ce=create_if_block$8(ae),ce.c(),ce.m(ne.parentNode,ne)):ce&&(ce.d(1),ce=null)},i:noop,o:noop,d(ae){ae&&detach(_);for(let de=0;de<X.length;de+=1)X[de].d();he&&he.d(),ae&&detach(te),ce&&ce.d(ae),ae&&detach(ne),re=!1,run_all(ie)}}}function instance$b(q,_,M){let $;const j=derived([shares,shareKeypair],([ie,se])=>ie.filter(le=>le!==se.shareAddress));component_subscribe(q,j,ie=>M(5,$=ie));let z=get_store_value(shareKeypair).shareAddress,V="",G="",X=!1,Y;shareKeypair.subscribe(ie=>{M(0,z=ie.shareAddress)});function Q(){M(1,V=""),M(3,X=!0)}function Z(){G===Y?(removeShare(z),M(2,G=""),M(3,X=!1),M(1,V=`You successfully removed +${Y}.`)):M(1,V="The share could not be removed. <br>Please type the name of the share you want to remove.<br>This is the section between the '+' and '.'")}function ee(){M(2,G=""),M(3,X=!1)}function te(ie){ie.target.classList.contains("modal")&&ee()}function ne(){z=select_value(this),M(0,z)}function re(){G=this.value,M(2,G)}return q.$$.update=()=>{q.$$.dirty&1&&M(4,Y=z.split("+")[1].split(".")[0])},[z,V,G,X,Y,$,j,Q,Z,ee,te,ne,re]}class RemoveShare extends SvelteComponent{constructor(_){super(),init(this,_,instance$b,create_fragment$c,safe_not_equal,{})}}function create_if_block_1$6(q){let _,M,$,j,z,V=q[3]&&create_if_block_2$5(q);return{c(){_=element("div"),M=element("p"),M.textContent="Successfully generated new workspace keypair!",$=space(),V&&V.c(),j=space(),z=element("p"),z.textContent="This new keypair has been added to your workspace.",attr(_,"class","text-left")},m(G,X){insert(G,_,X),append(_,M),append(_,$),V&&V.m(_,null),append(_,j),append(_,z)},p(G,X){G[3]?V?V.p(G,X):(V=create_if_block_2$5(G),V.c(),V.m(_,j)):V&&(V.d(1),V=null)},d(G){G&&detach(_),V&&V.d()}}}function create_if_block$7(q){let _,M,$,j=q[1].message+"",z,V,G,X,Y;return{c(){_=element("div"),M=element("p"),$=text("Error: "),z=text(j),V=space(),G=element("p"),G.textContent="Please ensure the share name meets the following requirements:",X=space(),Y=element("ul"),Y.innerHTML=`<li>MUST be 1 to 15 characters long, inclusive.</li> 
      <li>MUST only contain digits 0-9 and lowercase ASCII letters a-z.</li> 
      <li>MUST NOT start with a digit.</li>`,attr(_,"class","error-info text-left")},m(Q,Z){insert(Q,_,Z),append(_,M),append(M,$),append(M,z),append(_,V),append(_,G),append(_,X),append(_,Y)},p(Q,Z){Z&2&&j!==(j=Q[1].message+"")&&set_data(z,j)},d(Q){Q&&detach(_)}}}function create_if_block_2$5(q){let _,M=q[3].shareAddress+"",$,j,z,V=q[3].secret+"",G;return{c(){_=element("p"),$=text(M),j=space(),z=element("p"),G=text(V)},m(X,Y){insert(X,_,Y),append(_,$),insert(X,j,Y),insert(X,z,Y),append(z,G)},p(X,Y){Y&8&&M!==(M=X[3].shareAddress+"")&&set_data($,M),Y&8&&V!==(V=X[3].secret+"")&&set_data(G,V)},d(X){X&&detach(_),X&&detach(j),X&&detach(z)}}}function create_fragment$b(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee,te;function ne(se,le){if(se[1])return create_if_block$7;if(se[2])return create_if_block_1$6}let re=ne(q),ie=re&&re(q);return{c(){_=element("div"),M=element("div"),$=element("h6"),$.textContent="generate new workspace",j=space(),z=element("div"),V=element("input"),G=space(),X=element("div"),Y=element("button"),Y.textContent="Generate New Workspace Keypair",Q=space(),ie&&ie.c(),Z=empty(),attr($,"class","text-left"),attr(V,"class","mr-2"),attr(V,"id","dbName"),attr(V,"type","text"),attr(V,"placeholder","Enter share name"),attr(Y,"class","phase1"),attr(X,"class","mx-2"),attr(z,"class","flex flex-col md:flex-row space-between w-auto"),attr(M,"class","flex flex-col justify-start py-2")},m(se,le){insert(se,_,le),append(_,M),append(M,$),append(M,j),append(M,z),append(z,V),set_input_value(V,q[0]),append(z,G),append(z,X),append(X,Y),insert(se,Q,le),ie&&ie.m(se,le),insert(se,Z,le),ee||(te=[listen(V,"input",q[5]),listen(Y,"click",q[4])],ee=!0)},p(se,[le]){le&1&&V.value!==se[0]&&set_input_value(V,se[0]),re===(re=ne(se))&&ie?ie.p(se,le):(ie&&ie.d(1),ie=re&&re(se),ie&&(ie.c(),ie.m(Z.parentNode,Z)))},i:noop,o:noop,d(se){se&&detach(_),se&&detach(Q),ie&&ie.d(se),se&&detach(Z),ee=!1,run_all(te)}}}function instance$a(q,_,M){let $="",j,z=!1,V;const G=async()=>{try{if(!X($))throw new Error("Share name contains invalid characters");if(M(3,V=await Crypto.generateShareKeypair($)),console.log(V),settings){const Q=settings.addShare(V.shareAddress),Z=settings.addSecret(V.shareAddress,V.secret);if(typeof Q!="string"&&typeof Z!="string")M(2,z=!0),M(1,j=null),updateShares(settings.shares);else throw new Error("Error adding new workspace keypair")}}catch(Q){console.error(Q),M(1,j=Q),M(2,z=!1)}},X=Q=>Q.length<1||Q.length>15||/\d/.test(Q[0])?!1:/^[a-z0-9]+$/.test(Q);function Y(){$=this.value,M(0,$)}return[$,j,z,V,G,Y]}class GenerateShare extends SvelteComponent{constructor(_){super(),init(this,_,instance$a,create_fragment$b,safe_not_equal,{})}}const ShareSettings_svelte_svelte_type_style_lang="";function create_if_block_2$4(q){let _;return{c(){_=element("p"),_.innerHTML="<strong>Server was added successfully!</strong>"},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_1$5(q){let _;return{c(){_=element("p"),_.innerHTML="<strong>Sync is complete!</strong>"},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block$6(q){let _,M,$;return{c(){_=element("p"),M=element("strong"),$=text(q[2])},m(j,z){insert(j,_,z),append(_,M),append(M,$)},p(j,z){z&4&&set_data($,j[2])},d(j){j&&detach(_)}}}function create_fragment$a(q){let _,M,$,j,z,V,G,X,Y,Q=q[3]&&create_if_block_2$4(),Z=q[4]&&create_if_block_1$5(),ee=q[1]&&create_if_block$6(q);return{c(){_=element("div"),M=element("input"),$=space(),j=element("button"),j.textContent="Add server",z=space(),Q&&Q.c(),V=space(),Z&&Z.c(),G=space(),ee&&ee.c(),attr(M,"type","text"),attr(M,"spellcheck","false"),attr(M,"placeholder","Add a new server URL"),attr(j,"class","mx-4 phase1"),attr(_,"class","w-full flex flex-col lg:flex-row my-2")},m(te,ne){insert(te,_,ne),append(_,M),set_input_value(M,q[0]),append(_,$),append(_,j),append(_,z),Q&&Q.m(_,null),append(_,V),Z&&Z.m(_,null),append(_,G),ee&&ee.m(_,null),X||(Y=[listen(M,"input",q[6]),listen(j,"click",q[7])],X=!0)},p(te,[ne]){ne&1&&M.value!==te[0]&&set_input_value(M,te[0]),te[3]?Q||(Q=create_if_block_2$4(),Q.c(),Q.m(_,V)):Q&&(Q.d(1),Q=null),te[4]?Z||(Z=create_if_block_1$5(),Z.c(),Z.m(_,G)):Z&&(Z.d(1),Z=null),te[1]?ee?ee.p(te,ne):(ee=create_if_block$6(te),ee.c(),ee.m(_,null)):ee&&(ee.d(1),ee=null)},i:noop,o:noop,d(te){te&&detach(_),Q&&Q.d(),Z&&Z.d(),ee&&ee.d(),X=!1,run_all(Y)}}}function instance$9(q,_,M){let $,j=!1,z,V=!1,G=!1,X;replicaDetails.subscribe(ee=>{X=ee.replica});async function Y(ee){let te=settings.addServer(ee);if(isErr(te)){M(1,j=!0),M(2,z="Not a valid server URL");return}else{M(1,j=!1),M(3,V=!0),console.log("You have",settings.servers.length,"servers"),console.log("Your servers are",settings.servers);const ne=new Peer;ne.addReplica(X),await ne.sync(ee).isDone(),M(4,G=!0),console.log("Sync is done")}}function Q(){$=this.value,M(0,$)}return[$,j,z,V,G,Y,Q,()=>Y($)]}class AddServer extends SvelteComponent{constructor(_){super(),init(this,_,instance$9,create_fragment$a,safe_not_equal,{})}}function get_each_context$2(q,_,M){const $=q.slice();return $[7]=_[M],$}function create_each_block$2(q,_){let M,$=_[7]+"",j,z;return{key:q,first:null,c(){M=element("option"),j=text($),M.__value=z=_[7],M.value=M.__value,this.first=M},m(V,G){insert(V,M,G),append(M,j)},p(V,G){_=V,G&4&&$!==($=_[7]+"")&&set_data(j,$),G&4&&z!==(z=_[7])&&(M.__value=z,M.value=M.__value)},d(V){V&&detach(M)}}}function create_if_block$5(q){let _;return{c(){_=element("p"),_.innerHTML="<strong>Server was removed successfully!</strong>"},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_fragment$9(q){let _,M,$,j=[],z=new Map,V,G,X,Y,Q,Z=q[2];const ee=ne=>ne[7];for(let ne=0;ne<Z.length;ne+=1){let re=get_each_context$2(q,Z,ne),ie=ee(re);z.set(ie,j[ne]=create_each_block$2(ie,re))}let te=q[1]&&create_if_block$5();return{c(){_=element("div"),M=element("select"),$=element("option"),$.textContent="Select a server to remove";for(let ne=0;ne<j.length;ne+=1)j[ne].c();V=space(),G=element("button"),G.textContent="Remove server",X=space(),te&&te.c(),$.__value="",$.value=$.__value,q[0]===void 0&&add_render_callback(()=>q[4].call(M)),attr(G,"class","mx-4 phase1"),attr(_,"class","flex flex-col lg:flex-row my-2")},m(ne,re){insert(ne,_,re),append(_,M),append(M,$);for(let ie=0;ie<j.length;ie+=1)j[ie]&&j[ie].m(M,null);select_option(M,q[0],!0),append(_,V),append(_,G),append(_,X),te&&te.m(_,null),Y||(Q=[listen(M,"change",q[4]),listen(G,"click",q[3])],Y=!0)},p(ne,[re]){re&4&&(Z=ne[2],j=update_keyed_each(j,re,ee,1,ne,Z,z,M,destroy_block,create_each_block$2,null,get_each_context$2)),re&5&&select_option(M,ne[0]),ne[1]?te||(te=create_if_block$5(),te.c(),te.m(_,null)):te&&(te.d(1),te=null)},i:noop,o:noop,d(ne){ne&&detach(_);for(let re=0;re<j.length;re+=1)j[re].d();te&&te.d(),Y=!1,run_all(Q)}}}function instance$8(q,_,M){let $;component_subscribe(q,servers,X=>M(2,$=X));let j,z=!1;function V(){let X=settings.removeServer(j);isErr(X)||(M(1,z=!0),setTimeout(()=>{M(1,z=!1)},3e3),console.log("You have",settings.servers.length,"servers"),console.log("Your servers are",settings.servers)),M(0,j="")}function G(){j=select_value(this),M(0,j)}return[j,z,$,V,G]}class RemoveServer extends SvelteComponent{constructor(_){super(),init(this,_,instance$8,create_fragment$9,safe_not_equal,{})}}function create_fragment$8(q){let _,M,$,j,z,V=q[0].length<=1?"Server:":`${q[0].length} Servers:`,G,X,Y,Q,Z,ee,te,ne,re;return Q=new ServerList({}),ee=new AddServer({}),ne=new RemoveServer({}),{c(){_=element("div"),M=element("h3"),M.textContent="Server settings",$=space(),j=element("h4"),z=text("Current "),G=text(V),X=space(),Y=element("div"),create_component(Q.$$.fragment),Z=space(),create_component(ee.$$.fragment),te=space(),create_component(ne.$$.fragment),attr(Y,"class","my-4"),attr(_,"class","flex flex-col items-start pb-24")},m(ie,se){insert(ie,_,se),append(_,M),append(_,$),append(_,j),append(j,z),append(j,G),append(_,X),append(_,Y),mount_component(Q,Y,null),append(_,Z),mount_component(ee,_,null),append(_,te),mount_component(ne,_,null),re=!0},p(ie,[se]){(!re||se&1)&&V!==(V=ie[0].length<=1?"Server:":`${ie[0].length} Servers:`)&&set_data(G,V)},i(ie){re||(transition_in(Q.$$.fragment,ie),transition_in(ee.$$.fragment,ie),transition_in(ne.$$.fragment,ie),re=!0)},o(ie){transition_out(Q.$$.fragment,ie),transition_out(ee.$$.fragment,ie),transition_out(ne.$$.fragment,ie),re=!1},d(ie){ie&&detach(_),destroy_component(Q),destroy_component(ee),destroy_component(ne)}}}function instance$7(q,_,M){let $;return component_subscribe(q,servers,j=>M(0,$=j)),q.$$.update=()=>{q.$$.dirty&1&&console.log("settings.servers",$)},[$]}class Server extends SvelteComponent{constructor(_){super(),init(this,_,instance$7,create_fragment$8,safe_not_equal,{})}}var canPromise$1=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},qrcode={},utils$1={};let toSJISFunction;const CODEWORDS_COUNT=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];utils$1.getSymbolSize=function q(_){if(!_)throw new Error('"version" cannot be null or undefined');if(_<1||_>40)throw new Error('"version" should be in range from 1 to 40');return _*4+17};utils$1.getSymbolTotalCodewords=function q(_){return CODEWORDS_COUNT[_]};utils$1.getBCHDigit=function(q){let _=0;for(;q!==0;)_++,q>>>=1;return _};utils$1.setToSJISFunction=function q(_){if(typeof _!="function")throw new Error('"toSJISFunc" is not a valid function.');toSJISFunction=_};utils$1.isKanjiModeEnabled=function(){return typeof toSJISFunction<"u"};utils$1.toSJIS=function q(_){return toSJISFunction(_)};var errorCorrectionLevel={};(function(q){q.L={bit:1},q.M={bit:0},q.Q={bit:3},q.H={bit:2};function _(M){if(typeof M!="string")throw new Error("Param is not a string");switch(M.toLowerCase()){case"l":case"low":return q.L;case"m":case"medium":return q.M;case"q":case"quartile":return q.Q;case"h":case"high":return q.H;default:throw new Error("Unknown EC Level: "+M)}}q.isValid=function($){return $&&typeof $.bit<"u"&&$.bit>=0&&$.bit<4},q.from=function($,j){if(q.isValid($))return $;try{return _($)}catch{return j}}})(errorCorrectionLevel);function BitBuffer$1(){this.buffer=[],this.length=0}BitBuffer$1.prototype={get:function(q){const _=Math.floor(q/8);return(this.buffer[_]>>>7-q%8&1)===1},put:function(q,_){for(let M=0;M<_;M++)this.putBit((q>>>_-M-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(q){const _=Math.floor(this.length/8);this.buffer.length<=_&&this.buffer.push(0),q&&(this.buffer[_]|=128>>>this.length%8),this.length++}};var bitBuffer=BitBuffer$1;function BitMatrix$1(q){if(!q||q<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=q,this.data=new Uint8Array(q*q),this.reservedBit=new Uint8Array(q*q)}BitMatrix$1.prototype.set=function(q,_,M,$){const j=q*this.size+_;this.data[j]=M,$&&(this.reservedBit[j]=!0)};BitMatrix$1.prototype.get=function(q,_){return this.data[q*this.size+_]};BitMatrix$1.prototype.xor=function(q,_,M){this.data[q*this.size+_]^=M};BitMatrix$1.prototype.isReserved=function(q,_){return this.reservedBit[q*this.size+_]};var bitMatrix=BitMatrix$1,alignmentPattern={};(function(q){const _=utils$1.getSymbolSize;q.getRowColCoords=function($){if($===1)return[];const j=Math.floor($/7)+2,z=_($),V=z===145?26:Math.ceil((z-13)/(2*j-2))*2,G=[z-7];for(let X=1;X<j-1;X++)G[X]=G[X-1]-V;return G.push(6),G.reverse()},q.getPositions=function($){const j=[],z=q.getRowColCoords($),V=z.length;for(let G=0;G<V;G++)for(let X=0;X<V;X++)G===0&&X===0||G===0&&X===V-1||G===V-1&&X===0||j.push([z[G],z[X]]);return j}})(alignmentPattern);var finderPattern={};const getSymbolSize=utils$1.getSymbolSize,FINDER_PATTERN_SIZE=7;finderPattern.getPositions=function q(_){const M=getSymbolSize(_);return[[0,0],[M-FINDER_PATTERN_SIZE,0],[0,M-FINDER_PATTERN_SIZE]]};var maskPattern={};(function(q){q.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const _={N1:3,N2:3,N3:40,N4:10};q.isValid=function(j){return j!=null&&j!==""&&!isNaN(j)&&j>=0&&j<=7},q.from=function(j){return q.isValid(j)?parseInt(j,10):void 0},q.getPenaltyN1=function(j){const z=j.size;let V=0,G=0,X=0,Y=null,Q=null;for(let Z=0;Z<z;Z++){G=X=0,Y=Q=null;for(let ee=0;ee<z;ee++){let te=j.get(Z,ee);te===Y?G++:(G>=5&&(V+=_.N1+(G-5)),Y=te,G=1),te=j.get(ee,Z),te===Q?X++:(X>=5&&(V+=_.N1+(X-5)),Q=te,X=1)}G>=5&&(V+=_.N1+(G-5)),X>=5&&(V+=_.N1+(X-5))}return V},q.getPenaltyN2=function(j){const z=j.size;let V=0;for(let G=0;G<z-1;G++)for(let X=0;X<z-1;X++){const Y=j.get(G,X)+j.get(G,X+1)+j.get(G+1,X)+j.get(G+1,X+1);(Y===4||Y===0)&&V++}return V*_.N2},q.getPenaltyN3=function(j){const z=j.size;let V=0,G=0,X=0;for(let Y=0;Y<z;Y++){G=X=0;for(let Q=0;Q<z;Q++)G=G<<1&2047|j.get(Y,Q),Q>=10&&(G===1488||G===93)&&V++,X=X<<1&2047|j.get(Q,Y),Q>=10&&(X===1488||X===93)&&V++}return V*_.N3},q.getPenaltyN4=function(j){let z=0;const V=j.data.length;for(let X=0;X<V;X++)z+=j.data[X];return Math.abs(Math.ceil(z*100/V/5)-10)*_.N4};function M($,j,z){switch($){case q.Patterns.PATTERN000:return(j+z)%2===0;case q.Patterns.PATTERN001:return j%2===0;case q.Patterns.PATTERN010:return z%3===0;case q.Patterns.PATTERN011:return(j+z)%3===0;case q.Patterns.PATTERN100:return(Math.floor(j/2)+Math.floor(z/3))%2===0;case q.Patterns.PATTERN101:return j*z%2+j*z%3===0;case q.Patterns.PATTERN110:return(j*z%2+j*z%3)%2===0;case q.Patterns.PATTERN111:return(j*z%3+(j+z)%2)%2===0;default:throw new Error("bad maskPattern:"+$)}}q.applyMask=function(j,z){const V=z.size;for(let G=0;G<V;G++)for(let X=0;X<V;X++)z.isReserved(X,G)||z.xor(X,G,M(j,X,G))},q.getBestMask=function(j,z){const V=Object.keys(q.Patterns).length;let G=0,X=1/0;for(let Y=0;Y<V;Y++){z(Y),q.applyMask(Y,j);const Q=q.getPenaltyN1(j)+q.getPenaltyN2(j)+q.getPenaltyN3(j)+q.getPenaltyN4(j);q.applyMask(Y,j),Q<X&&(X=Q,G=Y)}return G}})(maskPattern);var errorCorrectionCode={};const ECLevel$1=errorCorrectionLevel,EC_BLOCKS_TABLE=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],EC_CODEWORDS_TABLE=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];errorCorrectionCode.getBlocksCount=function q(_,M){switch(M){case ECLevel$1.L:return EC_BLOCKS_TABLE[(_-1)*4+0];case ECLevel$1.M:return EC_BLOCKS_TABLE[(_-1)*4+1];case ECLevel$1.Q:return EC_BLOCKS_TABLE[(_-1)*4+2];case ECLevel$1.H:return EC_BLOCKS_TABLE[(_-1)*4+3];default:return}};errorCorrectionCode.getTotalCodewordsCount=function q(_,M){switch(M){case ECLevel$1.L:return EC_CODEWORDS_TABLE[(_-1)*4+0];case ECLevel$1.M:return EC_CODEWORDS_TABLE[(_-1)*4+1];case ECLevel$1.Q:return EC_CODEWORDS_TABLE[(_-1)*4+2];case ECLevel$1.H:return EC_CODEWORDS_TABLE[(_-1)*4+3];default:return}};var polynomial={},galoisField={};const EXP_TABLE=new Uint8Array(512),LOG_TABLE=new Uint8Array(256);(function q(){let _=1;for(let M=0;M<255;M++)EXP_TABLE[M]=_,LOG_TABLE[_]=M,_<<=1,_&256&&(_^=285);for(let M=255;M<512;M++)EXP_TABLE[M]=EXP_TABLE[M-255]})();galoisField.log=function q(_){if(_<1)throw new Error("log("+_+")");return LOG_TABLE[_]};galoisField.exp=function q(_){return EXP_TABLE[_]};galoisField.mul=function q(_,M){return _===0||M===0?0:EXP_TABLE[LOG_TABLE[_]+LOG_TABLE[M]]};(function(q){const _=galoisField;q.mul=function($,j){const z=new Uint8Array($.length+j.length-1);for(let V=0;V<$.length;V++)for(let G=0;G<j.length;G++)z[V+G]^=_.mul($[V],j[G]);return z},q.mod=function($,j){let z=new Uint8Array($);for(;z.length-j.length>=0;){const V=z[0];for(let X=0;X<j.length;X++)z[X]^=_.mul(j[X],V);let G=0;for(;G<z.length&&z[G]===0;)G++;z=z.slice(G)}return z},q.generateECPolynomial=function($){let j=new Uint8Array([1]);for(let z=0;z<$;z++)j=q.mul(j,new Uint8Array([1,_.exp(z)]));return j}})(polynomial);const Polynomial=polynomial;function ReedSolomonEncoder$1(q){this.genPoly=void 0,this.degree=q,this.degree&&this.initialize(this.degree)}ReedSolomonEncoder$1.prototype.initialize=function q(_){this.degree=_,this.genPoly=Polynomial.generateECPolynomial(this.degree)};ReedSolomonEncoder$1.prototype.encode=function q(_){if(!this.genPoly)throw new Error("Encoder not initialized");const M=new Uint8Array(_.length+this.degree);M.set(_);const $=Polynomial.mod(M,this.genPoly),j=this.degree-$.length;if(j>0){const z=new Uint8Array(this.degree);return z.set($,j),z}return $};var reedSolomonEncoder=ReedSolomonEncoder$1,version={},mode={},versionCheck={};versionCheck.isValid=function q(_){return!isNaN(_)&&_>=1&&_<=40};var regex={};const numeric="[0-9]+",alphanumeric="[A-Z $%*+\\-./:]+";let kanji="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";kanji=kanji.replace(/u/g,"\\u");const byte="(?:(?![A-Z0-9 $%*+\\-./:]|"+kanji+`)(?:.|[\r
]))+`;regex.KANJI=new RegExp(kanji,"g");regex.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");regex.BYTE=new RegExp(byte,"g");regex.NUMERIC=new RegExp(numeric,"g");regex.ALPHANUMERIC=new RegExp(alphanumeric,"g");const TEST_KANJI=new RegExp("^"+kanji+"$"),TEST_NUMERIC=new RegExp("^"+numeric+"$"),TEST_ALPHANUMERIC=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");regex.testKanji=function q(_){return TEST_KANJI.test(_)};regex.testNumeric=function q(_){return TEST_NUMERIC.test(_)};regex.testAlphanumeric=function q(_){return TEST_ALPHANUMERIC.test(_)};(function(q){const _=versionCheck,M=regex;q.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},q.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},q.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},q.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},q.MIXED={bit:-1},q.getCharCountIndicator=function(z,V){if(!z.ccBits)throw new Error("Invalid mode: "+z);if(!_.isValid(V))throw new Error("Invalid version: "+V);return V>=1&&V<10?z.ccBits[0]:V<27?z.ccBits[1]:z.ccBits[2]},q.getBestModeForData=function(z){return M.testNumeric(z)?q.NUMERIC:M.testAlphanumeric(z)?q.ALPHANUMERIC:M.testKanji(z)?q.KANJI:q.BYTE},q.toString=function(z){if(z&&z.id)return z.id;throw new Error("Invalid mode")},q.isValid=function(z){return z&&z.bit&&z.ccBits};function $(j){if(typeof j!="string")throw new Error("Param is not a string");switch(j.toLowerCase()){case"numeric":return q.NUMERIC;case"alphanumeric":return q.ALPHANUMERIC;case"kanji":return q.KANJI;case"byte":return q.BYTE;default:throw new Error("Unknown mode: "+j)}}q.from=function(z,V){if(q.isValid(z))return z;try{return $(z)}catch{return V}}})(mode);(function(q){const _=utils$1,M=errorCorrectionCode,$=errorCorrectionLevel,j=mode,z=versionCheck,V=7973,G=_.getBCHDigit(V);function X(ee,te,ne){for(let re=1;re<=40;re++)if(te<=q.getCapacity(re,ne,ee))return re}function Y(ee,te){return j.getCharCountIndicator(ee,te)+4}function Q(ee,te){let ne=0;return ee.forEach(function(re){const ie=Y(re.mode,te);ne+=ie+re.getBitsLength()}),ne}function Z(ee,te){for(let ne=1;ne<=40;ne++)if(Q(ee,ne)<=q.getCapacity(ne,te,j.MIXED))return ne}q.from=function(te,ne){return z.isValid(te)?parseInt(te,10):ne},q.getCapacity=function(te,ne,re){if(!z.isValid(te))throw new Error("Invalid QR Code version");typeof re>"u"&&(re=j.BYTE);const ie=_.getSymbolTotalCodewords(te),se=M.getTotalCodewordsCount(te,ne),le=(ie-se)*8;if(re===j.MIXED)return le;const he=le-Y(re,te);switch(re){case j.NUMERIC:return Math.floor(he/10*3);case j.ALPHANUMERIC:return Math.floor(he/11*2);case j.KANJI:return Math.floor(he/13);case j.BYTE:default:return Math.floor(he/8)}},q.getBestVersionForData=function(te,ne){let re;const ie=$.from(ne,$.M);if(Array.isArray(te)){if(te.length>1)return Z(te,ie);if(te.length===0)return 1;re=te[0]}else re=te;return X(re.mode,re.getLength(),ie)},q.getEncodedBits=function(te){if(!z.isValid(te)||te<7)throw new Error("Invalid QR Code version");let ne=te<<12;for(;_.getBCHDigit(ne)-G>=0;)ne^=V<<_.getBCHDigit(ne)-G;return te<<12|ne}})(version);var formatInfo={};const Utils$3=utils$1,G15=1335,G15_MASK=21522,G15_BCH=Utils$3.getBCHDigit(G15);formatInfo.getEncodedBits=function q(_,M){const $=_.bit<<3|M;let j=$<<10;for(;Utils$3.getBCHDigit(j)-G15_BCH>=0;)j^=G15<<Utils$3.getBCHDigit(j)-G15_BCH;return($<<10|j)^G15_MASK};var segments={};const Mode$4=mode;function NumericData(q){this.mode=Mode$4.NUMERIC,this.data=q.toString()}NumericData.getBitsLength=function q(_){return 10*Math.floor(_/3)+(_%3?_%3*3+1:0)};NumericData.prototype.getLength=function q(){return this.data.length};NumericData.prototype.getBitsLength=function q(){return NumericData.getBitsLength(this.data.length)};NumericData.prototype.write=function q(_){let M,$,j;for(M=0;M+3<=this.data.length;M+=3)$=this.data.substr(M,3),j=parseInt($,10),_.put(j,10);const z=this.data.length-M;z>0&&($=this.data.substr(M),j=parseInt($,10),_.put(j,z*3+1))};var numericData=NumericData;const Mode$3=mode,ALPHA_NUM_CHARS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function AlphanumericData(q){this.mode=Mode$3.ALPHANUMERIC,this.data=q}AlphanumericData.getBitsLength=function q(_){return 11*Math.floor(_/2)+6*(_%2)};AlphanumericData.prototype.getLength=function q(){return this.data.length};AlphanumericData.prototype.getBitsLength=function q(){return AlphanumericData.getBitsLength(this.data.length)};AlphanumericData.prototype.write=function q(_){let M;for(M=0;M+2<=this.data.length;M+=2){let $=ALPHA_NUM_CHARS.indexOf(this.data[M])*45;$+=ALPHA_NUM_CHARS.indexOf(this.data[M+1]),_.put($,11)}this.data.length%2&&_.put(ALPHA_NUM_CHARS.indexOf(this.data[M]),6)};var alphanumericData=AlphanumericData,encodeUtf8$1=function q(_){for(var M=[],$=_.length,j=0;j<$;j++){var z=_.charCodeAt(j);if(z>=55296&&z<=56319&&$>j+1){var V=_.charCodeAt(j+1);V>=56320&&V<=57343&&(z=(z-55296)*1024+V-56320+65536,j+=1)}if(z<128){M.push(z);continue}if(z<2048){M.push(z>>6|192),M.push(z&63|128);continue}if(z<55296||z>=57344&&z<65536){M.push(z>>12|224),M.push(z>>6&63|128),M.push(z&63|128);continue}if(z>=65536&&z<=1114111){M.push(z>>18|240),M.push(z>>12&63|128),M.push(z>>6&63|128),M.push(z&63|128);continue}M.push(239,191,189)}return new Uint8Array(M).buffer};const encodeUtf8=encodeUtf8$1,Mode$2=mode;function ByteData(q){this.mode=Mode$2.BYTE,typeof q=="string"&&(q=encodeUtf8(q)),this.data=new Uint8Array(q)}ByteData.getBitsLength=function q(_){return _*8};ByteData.prototype.getLength=function q(){return this.data.length};ByteData.prototype.getBitsLength=function q(){return ByteData.getBitsLength(this.data.length)};ByteData.prototype.write=function(q){for(let _=0,M=this.data.length;_<M;_++)q.put(this.data[_],8)};var byteData=ByteData;const Mode$1=mode,Utils$2=utils$1;function KanjiData(q){this.mode=Mode$1.KANJI,this.data=q}KanjiData.getBitsLength=function q(_){return _*13};KanjiData.prototype.getLength=function q(){return this.data.length};KanjiData.prototype.getBitsLength=function q(){return KanjiData.getBitsLength(this.data.length)};KanjiData.prototype.write=function(q){let _;for(_=0;_<this.data.length;_++){let M=Utils$2.toSJIS(this.data[_]);if(M>=33088&&M<=40956)M-=33088;else if(M>=57408&&M<=60351)M-=49472;else throw new Error("Invalid SJIS character: "+this.data[_]+`
Make sure your charset is UTF-8`);M=(M>>>8&255)*192+(M&255),q.put(M,13)}};var kanjiData=KanjiData,dijkstra={exports:{}};(function(q){var _={single_source_shortest_paths:function(M,$,j){var z={},V={};V[$]=0;var G=_.PriorityQueue.make();G.push($,0);for(var X,Y,Q,Z,ee,te,ne,re,ie;!G.empty();){X=G.pop(),Y=X.value,Z=X.cost,ee=M[Y]||{};for(Q in ee)ee.hasOwnProperty(Q)&&(te=ee[Q],ne=Z+te,re=V[Q],ie=typeof V[Q]>"u",(ie||re>ne)&&(V[Q]=ne,G.push(Q,ne),z[Q]=Y))}if(typeof j<"u"&&typeof V[j]>"u"){var se=["Could not find a path from ",$," to ",j,"."].join("");throw new Error(se)}return z},extract_shortest_path_from_predecessor_list:function(M,$){for(var j=[],z=$;z;)j.push(z),M[z],z=M[z];return j.reverse(),j},find_path:function(M,$,j){var z=_.single_source_shortest_paths(M,$,j);return _.extract_shortest_path_from_predecessor_list(z,j)},PriorityQueue:{make:function(M){var $=_.PriorityQueue,j={},z;M=M||{};for(z in $)$.hasOwnProperty(z)&&(j[z]=$[z]);return j.queue=[],j.sorter=M.sorter||$.default_sorter,j},default_sorter:function(M,$){return M.cost-$.cost},push:function(M,$){var j={value:M,cost:$};this.queue.push(j),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};q.exports=_})(dijkstra);var dijkstraExports=dijkstra.exports;(function(q){const _=mode,M=numericData,$=alphanumericData,j=byteData,z=kanjiData,V=regex,G=utils$1,X=dijkstraExports;function Y(se){return unescape(encodeURIComponent(se)).length}function Q(se,le,he){const ce=[];let ae;for(;(ae=se.exec(he))!==null;)ce.push({data:ae[0],index:ae.index,mode:le,length:ae[0].length});return ce}function Z(se){const le=Q(V.NUMERIC,_.NUMERIC,se),he=Q(V.ALPHANUMERIC,_.ALPHANUMERIC,se);let ce,ae;return G.isKanjiModeEnabled()?(ce=Q(V.BYTE,_.BYTE,se),ae=Q(V.KANJI,_.KANJI,se)):(ce=Q(V.BYTE_KANJI,_.BYTE,se),ae=[]),le.concat(he,ce,ae).sort(function(ge,fe){return ge.index-fe.index}).map(function(ge){return{data:ge.data,mode:ge.mode,length:ge.length}})}function ee(se,le){switch(le){case _.NUMERIC:return M.getBitsLength(se);case _.ALPHANUMERIC:return $.getBitsLength(se);case _.KANJI:return z.getBitsLength(se);case _.BYTE:return j.getBitsLength(se)}}function te(se){return se.reduce(function(le,he){const ce=le.length-1>=0?le[le.length-1]:null;return ce&&ce.mode===he.mode?(le[le.length-1].data+=he.data,le):(le.push(he),le)},[])}function ne(se){const le=[];for(let he=0;he<se.length;he++){const ce=se[he];switch(ce.mode){case _.NUMERIC:le.push([ce,{data:ce.data,mode:_.ALPHANUMERIC,length:ce.length},{data:ce.data,mode:_.BYTE,length:ce.length}]);break;case _.ALPHANUMERIC:le.push([ce,{data:ce.data,mode:_.BYTE,length:ce.length}]);break;case _.KANJI:le.push([ce,{data:ce.data,mode:_.BYTE,length:Y(ce.data)}]);break;case _.BYTE:le.push([{data:ce.data,mode:_.BYTE,length:Y(ce.data)}])}}return le}function re(se,le){const he={},ce={start:{}};let ae=["start"];for(let de=0;de<se.length;de++){const ge=se[de],fe=[];for(let oe=0;oe<ge.length;oe++){const we=ge[oe],De=""+de+oe;fe.push(De),he[De]={node:we,lastCount:0},ce[De]={};for(let ve=0;ve<ae.length;ve++){const Ce=ae[ve];he[Ce]&&he[Ce].node.mode===we.mode?(ce[Ce][De]=ee(he[Ce].lastCount+we.length,we.mode)-ee(he[Ce].lastCount,we.mode),he[Ce].lastCount+=we.length):(he[Ce]&&(he[Ce].lastCount=we.length),ce[Ce][De]=ee(we.length,we.mode)+4+_.getCharCountIndicator(we.mode,le))}}ae=fe}for(let de=0;de<ae.length;de++)ce[ae[de]].end=0;return{map:ce,table:he}}function ie(se,le){let he;const ce=_.getBestModeForData(se);if(he=_.from(le,ce),he!==_.BYTE&&he.bit<ce.bit)throw new Error('"'+se+'" cannot be encoded with mode '+_.toString(he)+`.
 Suggested mode is: `+_.toString(ce));switch(he===_.KANJI&&!G.isKanjiModeEnabled()&&(he=_.BYTE),he){case _.NUMERIC:return new M(se);case _.ALPHANUMERIC:return new $(se);case _.KANJI:return new z(se);case _.BYTE:return new j(se)}}q.fromArray=function(le){return le.reduce(function(he,ce){return typeof ce=="string"?he.push(ie(ce,null)):ce.data&&he.push(ie(ce.data,ce.mode)),he},[])},q.fromString=function(le,he){const ce=Z(le,G.isKanjiModeEnabled()),ae=ne(ce),de=re(ae,he),ge=X.find_path(de.map,"start","end"),fe=[];for(let oe=1;oe<ge.length-1;oe++)fe.push(de.table[ge[oe]].node);return q.fromArray(te(fe))},q.rawSplit=function(le){return q.fromArray(Z(le,G.isKanjiModeEnabled()))}})(segments);const Utils$1=utils$1,ECLevel=errorCorrectionLevel,BitBuffer=bitBuffer,BitMatrix=bitMatrix,AlignmentPattern=alignmentPattern,FinderPattern=finderPattern,MaskPattern=maskPattern,ECCode=errorCorrectionCode,ReedSolomonEncoder=reedSolomonEncoder,Version=version,FormatInfo=formatInfo,Mode=mode,Segments=segments;function setupFinderPattern(q,_){const M=q.size,$=FinderPattern.getPositions(_);for(let j=0;j<$.length;j++){const z=$[j][0],V=$[j][1];for(let G=-1;G<=7;G++)if(!(z+G<=-1||M<=z+G))for(let X=-1;X<=7;X++)V+X<=-1||M<=V+X||(G>=0&&G<=6&&(X===0||X===6)||X>=0&&X<=6&&(G===0||G===6)||G>=2&&G<=4&&X>=2&&X<=4?q.set(z+G,V+X,!0,!0):q.set(z+G,V+X,!1,!0))}}function setupTimingPattern(q){const _=q.size;for(let M=8;M<_-8;M++){const $=M%2===0;q.set(M,6,$,!0),q.set(6,M,$,!0)}}function setupAlignmentPattern(q,_){const M=AlignmentPattern.getPositions(_);for(let $=0;$<M.length;$++){const j=M[$][0],z=M[$][1];for(let V=-2;V<=2;V++)for(let G=-2;G<=2;G++)V===-2||V===2||G===-2||G===2||V===0&&G===0?q.set(j+V,z+G,!0,!0):q.set(j+V,z+G,!1,!0)}}function setupVersionInfo(q,_){const M=q.size,$=Version.getEncodedBits(_);let j,z,V;for(let G=0;G<18;G++)j=Math.floor(G/3),z=G%3+M-8-3,V=($>>G&1)===1,q.set(j,z,V,!0),q.set(z,j,V,!0)}function setupFormatInfo(q,_,M){const $=q.size,j=FormatInfo.getEncodedBits(_,M);let z,V;for(z=0;z<15;z++)V=(j>>z&1)===1,z<6?q.set(z,8,V,!0):z<8?q.set(z+1,8,V,!0):q.set($-15+z,8,V,!0),z<8?q.set(8,$-z-1,V,!0):z<9?q.set(8,15-z-1+1,V,!0):q.set(8,15-z-1,V,!0);q.set($-8,8,1,!0)}function setupData(q,_){const M=q.size;let $=-1,j=M-1,z=7,V=0;for(let G=M-1;G>0;G-=2)for(G===6&&G--;;){for(let X=0;X<2;X++)if(!q.isReserved(j,G-X)){let Y=!1;V<_.length&&(Y=(_[V]>>>z&1)===1),q.set(j,G-X,Y),z--,z===-1&&(V++,z=7)}if(j+=$,j<0||M<=j){j-=$,$=-$;break}}}function createData(q,_,M){const $=new BitBuffer;M.forEach(function(X){$.put(X.mode.bit,4),$.put(X.getLength(),Mode.getCharCountIndicator(X.mode,q)),X.write($)});const j=Utils$1.getSymbolTotalCodewords(q),z=ECCode.getTotalCodewordsCount(q,_),V=(j-z)*8;for($.getLengthInBits()+4<=V&&$.put(0,4);$.getLengthInBits()%8!==0;)$.putBit(0);const G=(V-$.getLengthInBits())/8;for(let X=0;X<G;X++)$.put(X%2?17:236,8);return createCodewords($,q,_)}function createCodewords(q,_,M){const $=Utils$1.getSymbolTotalCodewords(_),j=ECCode.getTotalCodewordsCount(_,M),z=$-j,V=ECCode.getBlocksCount(_,M),G=$%V,X=V-G,Y=Math.floor($/V),Q=Math.floor(z/V),Z=Q+1,ee=Y-Q,te=new ReedSolomonEncoder(ee);let ne=0;const re=new Array(V),ie=new Array(V);let se=0;const le=new Uint8Array(q.buffer);for(let ge=0;ge<V;ge++){const fe=ge<X?Q:Z;re[ge]=le.slice(ne,ne+fe),ie[ge]=te.encode(re[ge]),ne+=fe,se=Math.max(se,fe)}const he=new Uint8Array($);let ce=0,ae,de;for(ae=0;ae<se;ae++)for(de=0;de<V;de++)ae<re[de].length&&(he[ce++]=re[de][ae]);for(ae=0;ae<ee;ae++)for(de=0;de<V;de++)he[ce++]=ie[de][ae];return he}function createSymbol(q,_,M,$){let j;if(Array.isArray(q))j=Segments.fromArray(q);else if(typeof q=="string"){let Y=_;if(!Y){const Q=Segments.rawSplit(q);Y=Version.getBestVersionForData(Q,M)}j=Segments.fromString(q,Y||40)}else throw new Error("Invalid data");const z=Version.getBestVersionForData(j,M);if(!z)throw new Error("The amount of data is too big to be stored in a QR Code");if(!_)_=z;else if(_<z)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+z+`.
`);const V=createData(_,M,j),G=Utils$1.getSymbolSize(_),X=new BitMatrix(G);return setupFinderPattern(X,_),setupTimingPattern(X),setupAlignmentPattern(X,_),setupFormatInfo(X,M,0),_>=7&&setupVersionInfo(X,_),setupData(X,V),isNaN($)&&($=MaskPattern.getBestMask(X,setupFormatInfo.bind(null,X,M))),MaskPattern.applyMask($,X),setupFormatInfo(X,M,$),{modules:X,version:_,errorCorrectionLevel:M,maskPattern:$,segments:j}}qrcode.create=function q(_,M){if(typeof _>"u"||_==="")throw new Error("No input text");let $=ECLevel.M,j,z;return typeof M<"u"&&($=ECLevel.from(M.errorCorrectionLevel,ECLevel.M),j=Version.from(M.version),z=MaskPattern.from(M.maskPattern),M.toSJISFunc&&Utils$1.setToSJISFunction(M.toSJISFunc)),createSymbol(_,j,$,z)};var canvas={},utils={};(function(q){function _(M){if(typeof M=="number"&&(M=M.toString()),typeof M!="string")throw new Error("Color should be defined as hex string");let $=M.slice().replace("#","").split("");if($.length<3||$.length===5||$.length>8)throw new Error("Invalid hex color: "+M);($.length===3||$.length===4)&&($=Array.prototype.concat.apply([],$.map(function(z){return[z,z]}))),$.length===6&&$.push("F","F");const j=parseInt($.join(""),16);return{r:j>>24&255,g:j>>16&255,b:j>>8&255,a:j&255,hex:"#"+$.slice(0,6).join("")}}q.getOptions=function($){$||($={}),$.color||($.color={});const j=typeof $.margin>"u"||$.margin===null||$.margin<0?4:$.margin,z=$.width&&$.width>=21?$.width:void 0,V=$.scale||4;return{width:z,scale:z?4:V,margin:j,color:{dark:_($.color.dark||"#000000ff"),light:_($.color.light||"#ffffffff")},type:$.type,rendererOpts:$.rendererOpts||{}}},q.getScale=function($,j){return j.width&&j.width>=$+j.margin*2?j.width/($+j.margin*2):j.scale},q.getImageWidth=function($,j){const z=q.getScale($,j);return Math.floor(($+j.margin*2)*z)},q.qrToImageData=function($,j,z){const V=j.modules.size,G=j.modules.data,X=q.getScale(V,z),Y=Math.floor((V+z.margin*2)*X),Q=z.margin*X,Z=[z.color.light,z.color.dark];for(let ee=0;ee<Y;ee++)for(let te=0;te<Y;te++){let ne=(ee*Y+te)*4,re=z.color.light;if(ee>=Q&&te>=Q&&ee<Y-Q&&te<Y-Q){const ie=Math.floor((ee-Q)/X),se=Math.floor((te-Q)/X);re=Z[G[ie*V+se]?1:0]}$[ne++]=re.r,$[ne++]=re.g,$[ne++]=re.b,$[ne]=re.a}}})(utils);(function(q){const _=utils;function M(j,z,V){j.clearRect(0,0,z.width,z.height),z.style||(z.style={}),z.height=V,z.width=V,z.style.height=V+"px",z.style.width=V+"px"}function $(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}q.render=function(z,V,G){let X=G,Y=V;typeof X>"u"&&(!V||!V.getContext)&&(X=V,V=void 0),V||(Y=$()),X=_.getOptions(X);const Q=_.getImageWidth(z.modules.size,X),Z=Y.getContext("2d"),ee=Z.createImageData(Q,Q);return _.qrToImageData(ee.data,z,X),M(Z,Y,Q),Z.putImageData(ee,0,0),Y},q.renderToDataURL=function(z,V,G){let X=G;typeof X>"u"&&(!V||!V.getContext)&&(X=V,V=void 0),X||(X={});const Y=q.render(z,V,X),Q=X.type||"image/png",Z=X.rendererOpts||{};return Y.toDataURL(Q,Z.quality)}})(canvas);var svgTag={};const Utils=utils;function getColorAttrib(q,_){const M=q.a/255,$=_+'="'+q.hex+'"';return M<1?$+" "+_+'-opacity="'+M.toFixed(2).slice(1)+'"':$}function svgCmd(q,_,M){let $=q+_;return typeof M<"u"&&($+=" "+M),$}function qrToPath(q,_,M){let $="",j=0,z=!1,V=0;for(let G=0;G<q.length;G++){const X=Math.floor(G%_),Y=Math.floor(G/_);!X&&!z&&(z=!0),q[G]?(V++,G>0&&X>0&&q[G-1]||($+=z?svgCmd("M",X+M,.5+Y+M):svgCmd("m",j,0),j=0,z=!1),X+1<_&&q[G+1]||($+=svgCmd("h",V),V=0)):j++}return $}svgTag.render=function q(_,M,$){const j=Utils.getOptions(M),z=_.modules.size,V=_.modules.data,G=z+j.margin*2,X=j.color.light.a?"<path "+getColorAttrib(j.color.light,"fill")+' d="M0 0h'+G+"v"+G+'H0z"/>':"",Y="<path "+getColorAttrib(j.color.dark,"stroke")+' d="'+qrToPath(V,z,j.margin)+'"/>',Q='viewBox="0 0 '+G+" "+G+'"',ee='<svg xmlns="http://www.w3.org/2000/svg" '+(j.width?'width="'+j.width+'" height="'+j.width+'" ':"")+Q+' shape-rendering="crispEdges">'+X+Y+`</svg>
`;return typeof $=="function"&&$(null,ee),ee};const canPromise=canPromise$1,QRCode=qrcode,CanvasRenderer=canvas,SvgRenderer=svgTag;function renderCanvas(q,_,M,$,j){const z=[].slice.call(arguments,1),V=z.length,G=typeof z[V-1]=="function";if(!G&&!canPromise())throw new Error("Callback required as last argument");if(G){if(V<2)throw new Error("Too few arguments provided");V===2?(j=M,M=_,_=$=void 0):V===3&&(_.getContext&&typeof j>"u"?(j=$,$=void 0):(j=$,$=M,M=_,_=void 0))}else{if(V<1)throw new Error("Too few arguments provided");return V===1?(M=_,_=$=void 0):V===2&&!_.getContext&&($=M,M=_,_=void 0),new Promise(function(X,Y){try{const Q=QRCode.create(M,$);X(q(Q,_,$))}catch(Q){Y(Q)}})}try{const X=QRCode.create(M,$);j(null,q(X,_,$))}catch(X){j(X)}}QRCode.create;renderCanvas.bind(null,CanvasRenderer.render);renderCanvas.bind(null,CanvasRenderer.renderToDataURL);renderCanvas.bind(null,function(q,_,M){return SvgRenderer.render(q,M)});function create_if_block$4(q){let _,M,$,j,z,V,G,X,Y;function Q(te,ne){return te[2]?create_else_block$2:create_if_block_1$4}let Z=Q(q),ee=Z(q);return{c(){_=element("p"),M=element("strong"),M.textContent="Your invitation URL is:",$=space(),j=element("span"),z=text(q[1]),G=space(),ee.c(),X=empty(),attr(j,"class","break-all text-xs"),attr(_,"class","py-2 w-60")},m(te,ne){insert(te,_,ne),append(_,M),append(_,$),append(_,j),append(j,z),insert(te,G,ne),ee.m(te,ne),insert(te,X,ne),Y=!0},p(te,ne){(!Y||ne&2)&&set_data(z,te[1]),Z===(Z=Q(te))&&ee?ee.p(te,ne):(ee.d(1),ee=Z(te),ee&&(ee.c(),ee.m(X.parentNode,X)))},i(te){Y||(te&&add_render_callback(()=>{Y&&(V||(V=create_bidirectional_transition(_,slide,{},!0)),V.run(1))}),Y=!0)},o(te){te&&(V||(V=create_bidirectional_transition(_,slide,{},!1)),V.run(0)),Y=!1},d(te){te&&detach(_),te&&V&&V.end(),te&&detach(G),ee.d(te),te&&detach(X)}}}function create_else_block$2(q){let _,M,$;return{c(){_=element("button"),_.textContent="URL copied to clipboard!"},m(j,z){insert(j,_,z),M||($=listen(_,"click",q[4]),M=!0)},p:noop,d(j){j&&detach(_),M=!1,$()}}}function create_if_block_1$4(q){let _,M,$;return{c(){_=element("button"),_.textContent="Copy URL to clipboard"},m(j,z){insert(j,_,z),M||($=listen(_,"click",q[4]),M=!0)},p:noop,d(j){j&&detach(_),M=!1,$()}}}function create_fragment$7(q){let _,M,$,j,z,V=q[0]&&create_if_block$4(q);return{c(){_=element("div"),M=element("button"),M.textContent="generate invitation url",$=space(),V&&V.c(),attr(M,"class","phase1 w-60"),attr(_,"class","flex flex-col")},m(G,X){insert(G,_,X),append(_,M),append(_,$),V&&V.m(_,null),j||(z=listen(M,"click",q[3]),j=!0)},p(G,[X]){G[0]?V?(V.p(G,X),X&1&&transition_in(V,1)):(V=create_if_block$4(G),V.c(),transition_in(V,1),V.m(_,null)):V&&(group_outros(),transition_out(V,1,1,()=>{V=null}),check_outros())},i(G){transition_in(V)},o(G){transition_out(V)},d(G){G&&detach(_),V&&V.d(),j=!1,z()}}}function instance$6(q,_,M){onMount(()=>{window.addEventListener("resize",()=>{})});let $=!1,j="",z=!1,{shareAddress:V}=_;async function G(){M(0,$=!$),M(2,z=!1);const Y=await createInvitationURL(V,settings.servers,settings.shareSecrets[V]);typeof Y=="string"?M(1,j=Y):console.error("Failed to create invitation URL:",Y)}async function X(){try{await navigator.clipboard.writeText(j),M(2,z=!0)}catch(Y){console.error("Failed to copy text: ",Y)}}return q.$$set=Y=>{"shareAddress"in Y&&M(5,V=Y.shareAddress)},[$,j,z,G,X,V]}class CreateInvitation extends SvelteComponent{constructor(_){super(),init(this,_,instance$6,create_fragment$7,safe_not_equal,{shareAddress:5})}}const ShareViewer_svelte_svelte_type_style_lang="";function get_each_context$1(q,_,M){const $=q.slice();return $[13]=_[M],$}function create_else_block$1(q){let _;return{c(){_=text("show list")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block_7(q){let _;return{c(){_=text("hide list")},m(M,$){insert(M,_,$)},d(M){M&&detach(_)}}}function create_if_block$3(q){let _,M,$,j=q[0].length>0&&create_if_block_1$3(q);return{c(){_=element("div"),j&&j.c()},m(z,V){insert(z,_,V),j&&j.m(_,null),$=!0},p(z,V){z[0].length>0?j?(j.p(z,V),V&1&&transition_in(j,1)):(j=create_if_block_1$3(z),j.c(),transition_in(j,1),j.m(_,null)):j&&(group_outros(),transition_out(j,1,1,()=>{j=null}),check_outros())},i(z){$||(transition_in(j),z&&add_render_callback(()=>{$&&(M||(M=create_bidirectional_transition(_,slide,{},!0)),M.run(1))}),$=!0)},o(z){transition_out(j),z&&(M||(M=create_bidirectional_transition(_,slide,{},!1)),M.run(0)),$=!1},d(z){z&&detach(_),j&&j.d(),z&&M&&M.end()}}}function create_if_block_1$3(q){let _=[],M=new Map,$,j,z=q[0];const V=G=>G[13];for(let G=0;G<z.length;G+=1){let X=get_each_context$1(q,z,G),Y=V(X);M.set(Y,_[G]=create_each_block$1(Y,X))}return{c(){for(let G=0;G<_.length;G+=1)_[G].c();$=empty()},m(G,X){for(let Y=0;Y<_.length;Y+=1)_[Y]&&_[Y].m(G,X);insert(G,$,X),j=!0},p(G,X){X&251&&(z=G[0],group_outros(),_=update_keyed_each(_,X,V,1,G,z,M,$.parentNode,outro_and_destroy_block,create_each_block$1,$,get_each_context$1),check_outros())},i(G){if(!j){for(let X=0;X<z.length;X+=1)transition_in(_[X]);j=!0}},o(G){for(let X=0;X<_.length;X+=1)transition_out(_[X]);j=!1},d(G){for(let X=0;X<_.length;X+=1)_[X].d(G);G&&detach($)}}}function create_if_block_6(q){let _,M,$,j=q[3][q[13]]+"",z;return{c(){_=element("p"),M=element("b"),M.textContent="Secret:",$=space(),z=text(j)},m(V,G){insert(V,_,G),append(_,M),append(_,$),append(_,z)},p(V,G){G&9&&j!==(j=V[3][V[13]]+"")&&set_data(z,j)},d(V){V&&detach(_)}}}function create_if_block_2$3(q){let _=q[13],M,$,j=create_key_block(q);return{c(){j.c(),M=empty()},m(z,V){j.m(z,V),insert(z,M,V),$=!0},p(z,V){V&1&&safe_not_equal(_,_=z[13])?(group_outros(),transition_out(j,1,1,noop),check_outros(),j=create_key_block(z),j.c(),transition_in(j,1),j.m(M.parentNode,M)):j.p(z,V)},i(z){$||(transition_in(j),$=!0)},o(z){transition_out(j),$=!1},d(z){z&&detach(M),j.d(z)}}}function create_if_block_3$1(q){let _,M,$=q[4][q[13]].docs&&create_if_block_4$1(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,z){j[4][j[13]].docs?$?($.p(j,z),z&17&&transition_in($,1)):($=create_if_block_4$1(j),$.c(),transition_in($,1),$.m(_.parentNode,_)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros())},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function create_if_block_4$1(q){let _=Object.keys(q[4][q[13]].docs).length>0,M,$,j=_&&create_if_block_5(q);return{c(){j&&j.c(),M=empty()},m(z,V){j&&j.m(z,V),insert(z,M,V),$=!0},p(z,V){V&17&&(_=Object.keys(z[4][z[13]].docs).length>0),_?j?(j.p(z,V),V&17&&transition_in(j,1)):(j=create_if_block_5(z),j.c(),transition_in(j,1),j.m(M.parentNode,M)):j&&(group_outros(),transition_out(j,1,1,()=>{j=null}),check_outros())},i(z){$||(transition_in(j),$=!0)},o(z){transition_out(j),$=!1},d(z){j&&j.d(z),z&&detach(M)}}}function create_if_block_5(q){let _,M,$;return M=new StatusPanel({props:{shareID:q[13]}}),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","ml-16")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&1&&(V.shareID=j[13]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_key_block(q){let _,M,$=q[4][q[13]]&&create_if_block_3$1(q);return{c(){$&&$.c(),_=empty()},m(j,z){$&&$.m(j,z),insert(j,_,z),M=!0},p(j,z){j[4][j[13]]?$?($.p(j,z),z&17&&transition_in($,1)):($=create_if_block_3$1(j),$.c(),transition_in($,1),$.m(_.parentNode,_)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros())},i(j){M||(transition_in($),M=!0)},o(j){transition_out($),M=!1},d(j){$&&$.d(j),j&&detach(_)}}}function create_each_block$1(q,_){let M,$,j,z,V,G,X=_[13]+"",Y,Q,Z,ee,te,ne,re=_[13].includes("commons")?"Commons":"Studio",ie,se,le=_[13]===_[5]||_[13]===_[6]?" (default)":"",he,ce,ae,de,ge,fe,oe,we,De,ve,Ce,ue,Pe,ze,Le,Me,Ne,Ye,Ie,Oe,Se,pe,me,be,Ee,ke=_[3][_[13]]&&create_if_block_6(_),Fe=_[4]&&create_if_block_2$3(_);fe=new CreateInvitation({props:{shareAddress:_[13]}});function Be(){return _[10](_[13])}function Ue(){return _[11](_[13])}return Ie=new DownloadTool({props:{shareAddress:_[13]}}),{key:q,first:null,c(){M=element("div"),$=element("div"),j=element("div"),z=element("p"),V=element("b"),V.textContent="Address:",G=space(),Y=text(X),Q=space(),ke&&ke.c(),Z=space(),ee=element("p"),te=element("b"),te.textContent="Type:",ne=space(),ie=text(re),se=space(),he=text(le),ce=space(),Fe&&Fe.c(),ae=space(),de=element("div"),ge=element("div"),create_component(fe.$$.fragment),oe=space(),we=element("div"),De=element("button"),ve=text(`copy address
                    `),Ce=element("span"),Ce.textContent="address copied",ue=space(),Pe=element("div"),ze=element("button"),Le=text(`copy secret
                    `),Me=element("span"),Me.textContent="secret copied",Ne=space(),Ye=element("div"),create_component(Ie.$$.fragment),Oe=space(),Se=element("hr"),pe=space(),attr(j,"class","flex flex-col items-start py-2"),attr($,"class","flex flex-row justify-between"),attr(ge,"class","mt-4 mx-2"),attr(Ce,"class","tooltiptext svelte-1xvhruw"),toggle_class(Ce,"visible",_[1][_[13]]==="address"),attr(De,"class","phase1 tooltip svelte-1xvhruw"),attr(we,"class","mt-4 mx-2"),attr(Me,"class","tooltiptext svelte-1xvhruw"),toggle_class(Me,"visible",_[1][_[13]]==="secret"),attr(ze,"class","phase1 tooltip svelte-1xvhruw"),attr(Pe,"class","mt-4 mx-2"),attr(Ye,"class","mt-4 ml-16"),attr(de,"class","flex flex-row items-end"),attr(Se,"class","divider w-full mt-4 mb-2 svelte-1xvhruw"),attr(M,"class","flex flex-col items-start py-2"),this.first=M},m(nt,rt){insert(nt,M,rt),append(M,$),append($,j),append(j,z),append(z,V),append(z,G),append(z,Y),append(j,Q),ke&&ke.m(j,null),append(j,Z),append(j,ee),append(ee,te),append(ee,ne),append(ee,ie),append(ee,se),append(ee,he),append($,ce),Fe&&Fe.m($,null),append(M,ae),append(M,de),append(de,ge),mount_component(fe,ge,null),append(de,oe),append(de,we),append(we,De),append(De,ve),append(De,Ce),append(de,ue),append(de,Pe),append(Pe,ze),append(ze,Le),append(ze,Me),append(de,Ne),append(de,Ye),mount_component(Ie,Ye,null),append(M,Oe),append(M,Se),append(M,pe),me=!0,be||(Ee=[listen(De,"click",Be),listen(ze,"click",Ue)],be=!0)},p(nt,rt){_=nt,(!me||rt&1)&&X!==(X=_[13]+"")&&set_data(Y,X),_[3][_[13]]?ke?ke.p(_,rt):(ke=create_if_block_6(_),ke.c(),ke.m(j,Z)):ke&&(ke.d(1),ke=null),(!me||rt&1)&&re!==(re=_[13].includes("commons")?"Commons":"Studio")&&set_data(ie,re),(!me||rt&1)&&le!==(le=_[13]===_[5]||_[13]===_[6]?" (default)":"")&&set_data(he,le),_[4]?Fe?(Fe.p(_,rt),rt&16&&transition_in(Fe,1)):(Fe=create_if_block_2$3(_),Fe.c(),transition_in(Fe,1),Fe.m($,null)):Fe&&(group_outros(),transition_out(Fe,1,1,()=>{Fe=null}),check_outros());const _e={};rt&1&&(_e.shareAddress=_[13]),fe.$set(_e),(!me||rt&3)&&toggle_class(Ce,"visible",_[1][_[13]]==="address"),(!me||rt&3)&&toggle_class(Me,"visible",_[1][_[13]]==="secret");const We={};rt&1&&(We.shareAddress=_[13]),Ie.$set(We)},i(nt){me||(transition_in(Fe),transition_in(fe.$$.fragment,nt),transition_in(Ie.$$.fragment,nt),me=!0)},o(nt){transition_out(Fe),transition_out(fe.$$.fragment,nt),transition_out(Ie.$$.fragment,nt),me=!1},d(nt){nt&&detach(M),ke&&ke.d(),Fe&&Fe.d(),destroy_component(fe),destroy_component(Ie),be=!1,run_all(Ee)}}}function create_fragment$6(q){let _,M,$,j,z,V,G,X,Y,Q,Z;$=new StudioPortal({props:{commons:!0,topOfCommons:!0}}),$.$on("shareUpdated",q[8]);function ee(ie,se){return ie[2]?create_if_block_7:create_else_block$1}let te=ee(q),ne=te(q),re=q[2]&&create_if_block$3(q);return{c(){_=element("div"),M=element("div"),create_component($.$$.fragment),j=space(),z=element("button"),ne.c(),G=space(),X=element("div"),re&&re.c(),attr(_,"class","flex flex-row items-start"),attr(z,"class",V=q[2]?"phase1":"phase2"),attr(X,"class","flex flex-col items-start")},m(ie,se){insert(ie,_,se),append(_,M),mount_component($,M,null),insert(ie,j,se),insert(ie,z,se),ne.m(z,null),insert(ie,G,se),insert(ie,X,se),re&&re.m(X,null),Y=!0,Q||(Z=listen(z,"click",q[9]),Q=!0)},p(ie,[se]){te!==(te=ee(ie))&&(ne.d(1),ne=te(ie),ne&&(ne.c(),ne.m(z,null))),(!Y||se&4&&V!==(V=ie[2]?"phase1":"phase2"))&&attr(z,"class",V),ie[2]?re?(re.p(ie,se),se&4&&transition_in(re,1)):(re=create_if_block$3(ie),re.c(),transition_in(re,1),re.m(X,null)):re&&(group_outros(),transition_out(re,1,1,()=>{re=null}),check_outros())},i(ie){Y||(transition_in($.$$.fragment,ie),transition_in(re),Y=!0)},o(ie){transition_out($.$$.fragment,ie),transition_out(re),Y=!1},d(ie){ie&&detach(_),destroy_component($),ie&&detach(j),ie&&detach(z),ne.d(),ie&&detach(G),ie&&detach(X),re&&re.d(),Q=!1,Z()}}}function instance$5(q,_,M){let $,j;component_subscribe(q,secrets,ie=>M(3,$=ie)),component_subscribe(q,statusStore,ie=>M(4,j=ie));let z=[],V={},G={},X=!0;const Y="+studio.byayb6kplfkg5rduj7prh5zt2q2pfzwhuh55r7ghhoqnmh3c7e5qa",Q="+commons.buxxyxhoa3uxpanzrb6ki7btpzvkm5cf7brjptev3bmim3rk77hbq";function Z(ie,se){G[ie]&&clearTimeout(G[ie]),M(1,V[ie]=se,V),G[ie]=setTimeout(()=>{M(1,V[ie]=null,V)},2e3)}shares.subscribe(ie=>{M(0,z=[...ie]),ie.forEach(se=>M(1,V[se]=!1,V))});function ee(ie){bubble.call(this,q,ie)}return[z,V,X,$,j,Y,Q,Z,ee,()=>M(2,X=!X),ie=>{navigator.clipboard.writeText(ie),Z(ie,"address")},ie=>{navigator.clipboard.writeText(settings.shareSecrets[ie]),Z(ie,"secret")}]}class ShareViewer extends SvelteComponent{constructor(_){super(),init(this,_,instance$5,create_fragment$6,safe_not_equal,{})}}function create_if_block_2$2(q){let _,M,$,j=JSON.stringify(q[1],null,2)+"",z;return{c(){_=element("p"),_.textContent="Parsed Invitation:",M=space(),$=element("pre"),z=text(j)},m(V,G){insert(V,_,G),insert(V,M,G),insert(V,$,G),append($,z)},p(V,G){G&2&&j!==(j=JSON.stringify(V[1],null,2)+"")&&set_data(z,j)},d(V){V&&detach(_),V&&detach(M),V&&detach($)}}}function create_if_block_1$2(q){let _;return{c(){_=element("p"),_.textContent="Successfully redeemed invitation!"},m(M,$){insert(M,_,$)},p:noop,d(M){M&&detach(_)}}}function create_if_block$2(q){let _,M,$=q[2].message+"",j;return{c(){_=element("p"),M=text("Error: "),j=text($)},m(z,V){insert(z,_,V),append(_,M),append(_,j)},p(z,V){V&4&&$!==($=z[2].message+"")&&set_data(j,$)},d(z){z&&detach(_)}}}function create_fragment$5(q){let _,M,$,j,z,V,G,X,Y,Q;function Z(ne,re){if(ne[2])return create_if_block$2;if(ne[3])return create_if_block_1$2;if(ne[1])return create_if_block_2$2}let ee=Z(q),te=ee&&ee(q);return{c(){_=element("div"),M=element("div"),M.textContent="🕸️",$=space(),j=element("input"),z=space(),V=element("div"),G=element("button"),G.textContent="Redeem Invitation URL",X=space(),te&&te.c(),attr(M,"class","text-4xl"),attr(j,"class","mr-2"),attr(j,"type","text"),attr(j,"placeholder","Enter invitation URL"),attr(G,"class","phase1"),attr(V,"class","mx-2"),attr(_,"class","flex flex-col md:flex-row space-between mt-6 mb-4")},m(ne,re){insert(ne,_,re),append(_,M),append(_,$),append(_,j),set_input_value(j,q[0]),append(_,z),append(_,V),append(V,G),append(_,X),te&&te.m(_,null),Y||(Q=[listen(j,"input",q[5]),listen(G,"click",q[4])],Y=!0)},p(ne,[re]){re&1&&j.value!==ne[0]&&set_input_value(j,ne[0]),ee===(ee=Z(ne))&&te?te.p(ne,re):(te&&te.d(1),te=ee&&ee(ne),te&&(te.c(),te.m(_,null)))},i:noop,o:noop,d(ne){ne&&detach(_),te&&te.d(),Y=!1,run_all(Q)}}}function instance$4(q,_,M){let $="",j,z,V=!1;const G=async()=>{try{const Q=await settings.redeemInvitationURL($);Q===!0?(M(3,V=!0),M(2,z=null)):(M(2,z=Q),M(3,V=!1))}catch(Q){M(2,z=Q),M(3,V=!1)}},X=async()=>{await G()};function Y(){$=this.value,M(0,$)}return[$,j,z,V,X,Y]}class RedeemInvitation extends SvelteComponent{constructor(_){super(),init(this,_,instance$4,create_fragment$5,safe_not_equal,{})}}function create_default_slot$1(q){let _;return{c(){_=element("sup"),_.textContent="?",attr(_,"class","font-features sups")},m(M,$){insert(M,_,$)},p:noop,d(M){M&&detach(_)}}}function create_fragment$4(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee,te,ne,re,ie,se,le,he;return V=new Tooltip({props:{text:"A workspace is a collection of artefacts that you can share with others",$$slots:{default:[create_default_slot$1]},$$scope:{ctx:q}}}),X=new ShareViewer({}),X.$on("shareUpdated",q[0]),ee=new GenerateShare({}),ne=new AddShare({}),ie=new RemoveShare({}),le=new RedeemInvitation({}),{c(){_=element("div"),M=element("h3"),M.textContent="workspace settings",$=space(),j=element("h4"),z=text(`list of known workspaces
        `),create_component(V.$$.fragment),G=space(),create_component(X.$$.fragment),Y=space(),Q=element("h4"),Q.textContent="add/remove workspaces",Z=space(),create_component(ee.$$.fragment),te=space(),create_component(ne.$$.fragment),re=space(),create_component(ie.$$.fragment),se=space(),create_component(le.$$.fragment),attr(Q,"class","pb-4"),attr(_,"class","flex flex-col items-start pb-24")},m(ce,ae){insert(ce,_,ae),append(_,M),append(_,$),append(_,j),append(j,z),mount_component(V,j,null),append(_,G),mount_component(X,_,null),append(_,Y),append(_,Q),append(_,Z),mount_component(ee,_,null),append(_,te),mount_component(ne,_,null),append(_,re),mount_component(ie,_,null),append(_,se),mount_component(le,_,null),he=!0},p(ce,[ae]){const de={};ae&2&&(de.$$scope={dirty:ae,ctx:ce}),V.$set(de)},i(ce){he||(transition_in(V.$$.fragment,ce),transition_in(X.$$.fragment,ce),transition_in(ee.$$.fragment,ce),transition_in(ne.$$.fragment,ce),transition_in(ie.$$.fragment,ce),transition_in(le.$$.fragment,ce),he=!0)},o(ce){transition_out(V.$$.fragment,ce),transition_out(X.$$.fragment,ce),transition_out(ee.$$.fragment,ce),transition_out(ne.$$.fragment,ce),transition_out(ie.$$.fragment,ce),transition_out(le.$$.fragment,ce),he=!1},d(ce){ce&&detach(_),destroy_component(V),destroy_component(X),destroy_component(ee),destroy_component(ne),destroy_component(ie),destroy_component(le)}}}function instance$3(q){function _(M){bubble.call(this,q,M)}return[_]}class Workspace extends SvelteComponent{constructor(_){super(),init(this,_,instance$3,create_fragment$4,safe_not_equal,{})}}const UserSettings_svelte_svelte_type_style_lang="";function create_if_block_2$1(q){let _,M;return _=new Workspace({}),_.$on("shareUpdated",q[7]),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_if_block_1$1(q){let _,M,$;return M=new Server({}),{c(){_=element("div"),create_component(M.$$.fragment)},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block$1(q){let _,M;return _=new Identity({}),{c(){create_component(_.$$.fragment)},m($,j){mount_component(_,$,j),M=!0},i($){M||(transition_in(_.$$.fragment,$),M=!0)},o($){transition_out(_.$$.fragment,$),M=!1},d($){destroy_component(_,$)}}}function create_fragment$3(q){let _,M,$,j,z,V,G=q[1].address.slice(0,5)+"",X,Y,Q,Z,ee,te,ne,re,ie,se,le,he,ce,ae,de,ge=q[0]==="workspace"&&create_if_block_2$1(q),fe=q[0]==="server"&&create_if_block_1$1(),oe=q[0]==="identity"&&create_if_block$1();return{c(){_=element("div"),M=element("div"),$=element("button"),$.textContent="🔮 exit app customization",j=space(),z=element("p"),V=element("b"),V.textContent="current alias: ",X=text(G),Y=space(),Q=element("div"),Z=element("button"),Z.textContent="workspace settings",ee=space(),te=element("button"),te.textContent="server settings",ne=space(),re=element("button"),re.textContent="manage alias",ie=space(),se=element("div"),ge&&ge.c(),le=space(),fe&&fe.c(),he=space(),oe&&oe.c(),attr($,"class","ml-6 mt-4 mb-2 h-auto mr-1 border-black"),attr(z,"class","ml-6 text-2xl text-left"),attr(Z,"class","my-1"),toggle_class(Z,"phase2",q[0]==="workspace"),attr(te,"class","my-1"),toggle_class(te,"phase2",q[0]==="server"),attr(re,"class","my-1"),toggle_class(re,"phase2",q[0]==="identity"),attr(Q,"class","paper-yellow customBorder ml-6 mx-1 sm:mt-4 flex flex-row sm:flex-col p-8 h-auto sm:h-[80vh] z-50 customBorder svelte-ys1fjx"),attr(M,"class","sm:w-1/5 flex flex-col fixed"),attr(se,"class","w-full sm:w-[80vw] mt-16 sm:mt-10 sm:ml-[25vw]"),attr(_,"class","the-scroll flex flex-col sm:flex-row min-h-screen overflow-y-auto")},m(we,De){insert(we,_,De),append(_,M),append(M,$),append(M,j),append(M,z),append(z,V),append(z,X),append(M,Y),append(M,Q),append(Q,Z),append(Q,ee),append(Q,te),append(Q,ne),append(Q,re),append(_,ie),append(_,se),ge&&ge.m(se,null),append(se,le),fe&&fe.m(se,null),append(se,he),oe&&oe.m(se,null),ce=!0,ae||(de=[listen($,"click",q[2]),listen(Z,"click",q[4]),listen(te,"click",q[5]),listen(re,"click",q[6])],ae=!0)},p(we,[De]){(!ce||De&2)&&G!==(G=we[1].address.slice(0,5)+"")&&set_data(X,G),(!ce||De&1)&&toggle_class(Z,"phase2",we[0]==="workspace"),(!ce||De&1)&&toggle_class(te,"phase2",we[0]==="server"),(!ce||De&1)&&toggle_class(re,"phase2",we[0]==="identity"),we[0]==="workspace"?ge?De&1&&transition_in(ge,1):(ge=create_if_block_2$1(we),ge.c(),transition_in(ge,1),ge.m(se,le)):ge&&(group_outros(),transition_out(ge,1,1,()=>{ge=null}),check_outros()),we[0]==="server"?fe?De&1&&transition_in(fe,1):(fe=create_if_block_1$1(),fe.c(),transition_in(fe,1),fe.m(se,he)):fe&&(group_outros(),transition_out(fe,1,1,()=>{fe=null}),check_outros()),we[0]==="identity"?oe?De&1&&transition_in(oe,1):(oe=create_if_block$1(),oe.c(),transition_in(oe,1),oe.m(se,null)):oe&&(group_outros(),transition_out(oe,1,1,()=>{oe=null}),check_outros())},i(we){ce||(transition_in(ge),transition_in(fe),transition_in(oe),ce=!0)},o(we){transition_out(ge),transition_out(fe),transition_out(oe),ce=!1},d(we){we&&detach(_),ge&&ge.d(),fe&&fe.d(),oe&&oe.d(),ae=!1,run_all(de)}}}function instance$2(q,_,M){let $;component_subscribe(q,authorKeypair,ee=>M(1,$=ee));const j=createEventDispatcher();let{initialView:z="workspace"}=_,V=z;function G(){j("toggle")}const X=()=>M(0,V="workspace"),Y=()=>M(0,V="server"),Q=()=>M(0,V="identity");function Z(ee){bubble.call(this,q,ee)}return q.$$set=ee=>{"initialView"in ee&&M(3,z=ee.initialView)},[V,$,G,z,X,Y,Q,Z]}class UserSettings extends SvelteComponent{constructor(_){super(),init(this,_,instance$2,create_fragment$3,safe_not_equal,{initialView:3})}}const MouseBanner_svelte_svelte_type_style_lang="";function get_each_context(q,_,M){const $=q.slice();return $[1]=_[M],$[3]=M,$}function create_each_block(q){let _,M,$,j;return{c(){_=element("div"),M=element("div"),$=space(),j=element("div"),attr(M,"class","ml-12 bgimg svelte-1veluwv"),attr(M,"style",`background-image: url(${src});`),attr(_,"class","cell svelte-1veluwv"),attr(j,"class","cell svelte-1veluwv")},m(z,V){insert(z,_,V),append(_,M),insert(z,$,V),insert(z,j,V)},p:noop,d(z){z&&detach(_),z&&detach($),z&&detach(j)}}}function create_fragment$2(q){let _,M=q[0],$=[];for(let j=0;j<M.length;j+=1)$[j]=create_each_block(get_each_context(q,M,j));return{c(){_=element("div");for(let j=0;j<$.length;j+=1)$[j].c();attr(_,"class","banner svelte-1veluwv")},m(j,z){insert(j,_,z);for(let V=0;V<$.length;V+=1)$[V]&&$[V].m(_,null)},p(j,[z]){if(z&0){M=j[0];let V;for(V=0;V<M.length;V+=1){const G=get_each_context(j,M,V);$[V]?$[V].p(G,z):($[V]=create_each_block(),$[V].c(),$[V].m(_,null))}for(;V<$.length;V+=1)$[V].d(1);$.length=M.length}},i:noop,o:noop,d(j){j&&detach(_),destroy_each($,j)}}}const src="images/upload-img.png",repetitions=7;function instance$1(q){return[Array(repetitions).fill().map(()=>({}))]}class MouseBanner extends SvelteComponent{constructor(_){super(),init(this,_,instance$1,create_fragment$2,safe_not_equal,{})}}const Footer_svelte_svelte_type_style_lang="";function create_fragment$1(q){let _;return{c(){_=element("footer"),_.innerHTML=`<div class="footer mx-6 flex flex-row justify-between svelte-ag7h2a"><div class="flex flex-row justify-between w-1/3 ml-8"><div><a href="https://docs.google.com/document/d/1wIBZQP5sueNfqXHAQgkw7sO-m2qB5wnfbRHEv_zxE_4/edit?usp=sharing" target="_blank" rel="noreferrer" class="svelte-ag7h2a">read manual</a></div> 
      <div><a href="https://github.com/hyphacoop/restructuring-futures/issues/new?assignees=TRIPLEDOUBLEV&amp;labels=bug&amp;projects=&amp;template=bug_report.md&amp;title=" target="_blank" rel="noreferrer" class="svelte-ag7h2a">report bugs</a></div> 
      <div><a href="https://github.com/hyphacoop/restructuring-futures/" target="_blank" rel="noreferrer" class="svelte-ag7h2a">about</a></div></div> 
    <div class="mr-8">built with 
        <a target="_blank" rel="noreferrer" href="https://earthstar-project.org/" class="svelte-ag7h2a">Earthstar</a>
       with the support of the 
       <a target="_blank" rel="noreferrer" href="https://canadacouncil.ca" class="svelte-ag7h2a">Canada Council for the Arts</a></div></div>`,attr(_,"class","w-full")},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}class Footer extends SvelteComponent{constructor(_){super(),init(this,_,null,create_fragment$1,safe_not_equal,{})}}const App_svelte_svelte_type_style_lang="";function create_if_block_2(q){let _,M,$,j,z,V,G,X,Y,Q;const Z=[create_if_block_4,create_else_block],ee=[];function te(re,ie){return re[5]?0:1}V=te(q),G=ee[V]=Z[V](q);let ne=q[2]===!0&&create_if_block_3();return{c(){_=element("div"),M=element("h1"),M.textContent="Eccentric Networks",$=space(),j=element("h4"),j.textContent="Collaboration space for the unconnected",z=space(),G.c(),X=space(),ne&&ne.c(),Y=empty(),attr(M,"class","svelte-w61yp2"),attr(_,"class","my-12")},m(re,ie){insert(re,_,ie),append(_,M),append(_,$),append(_,j),append(_,z),ee[V].m(_,null),insert(re,X,ie),ne&&ne.m(re,ie),insert(re,Y,ie),Q=!0},p(re,ie){let se=V;V=te(re),V===se?ee[V].p(re,ie):(group_outros(),transition_out(ee[se],1,1,()=>{ee[se]=null}),check_outros(),G=ee[V],G?G.p(re,ie):(G=ee[V]=Z[V](re),G.c()),transition_in(G,1),G.m(_,null)),re[2]===!0?ne?ie&4&&transition_in(ne,1):(ne=create_if_block_3(),ne.c(),transition_in(ne,1),ne.m(Y.parentNode,Y)):ne&&(group_outros(),transition_out(ne,1,1,()=>{ne=null}),check_outros())},i(re){Q||(transition_in(G),transition_in(ne),Q=!0)},o(re){transition_out(G),transition_out(ne),Q=!1},d(re){re&&detach(_),ee[V].d(),re&&detach(X),ne&&ne.d(re),re&&detach(Y)}}}function create_else_block(q){let _,M,$,j,z,V,G,X,Y,Q,Z,ee,te;return j=new Tooltip({props:{text:"You will need an identity in order to interact with the artefacts",$$slots:{default:[create_default_slot]},$$scope:{ctx:q}}}),X=new ValidateId({}),X.$on("validated",q[6]),X.$on("error",q[9]),X.$on("generateNewIdentity",q[14]),X.$on("alias",q[6]),Q=new MouseBanner({}),{c(){_=element("div"),M=element("button"),M.textContent="Generate new Identity",$=space(),create_component(j.$$.fragment),z=space(),V=element("div"),G=element("div"),create_component(X.$$.fragment),Y=space(),create_component(Q.$$.fragment),attr(M,"class","phase1 mx-16 mt-12 text-2xl"),attr(_,"class","flex flex-col lg:flex-row items-center mx-16 justify-evenly my-12"),attr(G,"class","flex flex-row items-center mx-6 my-12"),attr(V,"class","w-1/2 flex flex-col lg:flex-row items-center mx-2 justify-center my-12")},m(ne,re){insert(ne,_,re),append(_,M),append(_,$),mount_component(j,_,null),insert(ne,z,re),insert(ne,V,re),append(V,G),mount_component(X,G,null),insert(ne,Y,re),mount_component(Q,ne,re),Z=!0,ee||(te=listen(M,"click",q[7]),ee=!0)},p(ne,re){const ie={};re&33554432&&(ie.$$scope={dirty:re,ctx:ne}),j.$set(ie)},i(ne){Z||(transition_in(j.$$.fragment,ne),transition_in(X.$$.fragment,ne),transition_in(Q.$$.fragment,ne),Z=!0)},o(ne){transition_out(j.$$.fragment,ne),transition_out(X.$$.fragment,ne),transition_out(Q.$$.fragment,ne),Z=!1},d(ne){ne&&detach(_),destroy_component(j),ne&&detach(z),ne&&detach(V),destroy_component(X),ne&&detach(Y),destroy_component(Q,ne),ee=!1,te()}}}function create_if_block_4(q){let _;return{c(){_=element("h5"),_.textContent="This app has not been optimized for smaller screens. Please use this app on desktop.",attr(_,"class","mt-6 w-1/2 mx-auto")},m(M,$){insert(M,_,$)},p:noop,i:noop,o:noop,d(M){M&&detach(_)}}}function create_default_slot(q){let _,M,$;return{c(){_=element("button"),_.textContent="Explore the commons",attr(_,"class","phase1 mx-16 mt-12 text-2xl")},m(j,z){insert(j,_,z),M||($=listen(_,"click",q[8]),M=!0)},p:noop,d(j){j&&detach(_),M=!1,$()}}}function create_if_block_3(q){let _,M,$;return{c(){_=element("blockquote"),_.textContent="There was an error with your identity file"},m(j,z){insert(j,_,z),$=!0},i(j){$||(add_render_callback(()=>{$&&(M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!0)),M.run(1))}),$=!0)},o(j){M||(M=create_bidirectional_transition(_,fly,{y:200,duration:2e3},!1)),M.run(0),$=!1},d(j){j&&detach(_),j&&M&&M.end()}}}function create_if_block_1(q){let _,M,$;return M=new UserSettings({props:{initialView:q[4]}}),M.$on("toggle",q[11]),M.$on("shareUpdated",q[11]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","w-full")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&16&&(V.initialView=j[4]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_if_block(q){let _,M,$;return M=new GridView({props:{showDetails:q[1]}}),M.$on("toggle",q[11]),M.$on("view",q[10]),M.$on("details",q[15]),{c(){_=element("div"),create_component(M.$$.fragment),attr(_,"class","w-full")},m(j,z){insert(j,_,z),mount_component(M,_,null),$=!0},p(j,z){const V={};z&2&&(V.showDetails=j[1]),M.$set(V)},i(j){$||(transition_in(M.$$.fragment,j),$=!0)},o(j){transition_out(M.$$.fragment,j),$=!1},d(j){j&&detach(_),destroy_component(M)}}}function create_fragment(q){let _,M,$,j,z,V,G,X=!q[0]&&!q[1]&&create_if_block_2(q);const Y=[create_if_block,create_if_block_1],Q=[];function Z(ee,te){return ee[0]&&!ee[3]?0:ee[0]&&ee[3]?1:-1}return~($=Z(q))&&(j=Q[$]=Y[$](q)),V=new Footer({}),{c(){_=element("main"),X&&X.c(),M=space(),j&&j.c(),z=space(),create_component(V.$$.fragment),attr(_,"class","svelte-w61yp2")},m(ee,te){insert(ee,_,te),X&&X.m(_,null),append(_,M),~$&&Q[$].m(_,null),insert(ee,z,te),mount_component(V,ee,te),G=!0},p(ee,[te]){!ee[0]&&!ee[1]?X?(X.p(ee,te),te&3&&transition_in(X,1)):(X=create_if_block_2(ee),X.c(),transition_in(X,1),X.m(_,M)):X&&(group_outros(),transition_out(X,1,1,()=>{X=null}),check_outros());let ne=$;$=Z(ee),$===ne?~$&&Q[$].p(ee,te):(j&&(group_outros(),transition_out(Q[ne],1,1,()=>{Q[ne]=null}),check_outros()),~$?(j=Q[$],j?j.p(ee,te):(j=Q[$]=Y[$](ee),j.c()),transition_in(j,1),j.m(_,null)):j=null)},i(ee){G||(transition_in(X),transition_in(j),transition_in(V.$$.fragment,ee),G=!0)},o(ee){transition_out(X),transition_out(j),transition_out(V.$$.fragment,ee),G=!1},d(ee){ee&&detach(_),X&&X.d(),~$&&Q[$].d(),ee&&detach(z),destroy_component(V,ee)}}}function instance(q,_,M){let $,j;component_subscribe(q,replicaDetails,oe=>M(13,$=oe)),component_subscribe(q,shareKeypair,oe=>M(18,j=oe));const z="+studio.byayb6kplfkg5rduj7prh5zt2q2pfzwhuh55r7ghhoqnmh3c7e5qa",V="bnjtpwulr3wjnp6s52247faqxob73syf3mofv3ck5edezjsgxy2yq";let G=!1,X=!1,Y=!1,Q=!1,Z="workspace",ee;onMount(async()=>{settings.author?(authorKeypair.set(settings.author),M(0,G=!0)):M(0,G=!1);const oe=settings.addShare(z);Array.isArray(oe)?settings.addSecret(z,V):oe instanceof ValidationError&&console.error("Failed to add share due to validation error:",oe.message);const we=settings.addShare(j.shareAddress);Array.isArray(we)?settings.addSecret(j.shareAddress,j.shareSecret):we instanceof ValidationError&&console.error("Failed to add share due to validation error:",we.message),te()});function te(){const oe=new Peer;oe.addReplica($.replica);const we=oe.sync("https://earthstar-server.fly.dev/sync",!0);settings.addServer("https://earthstar-server.fly.dev/sync"),we.onStatusChange(De=>{ee=De,statusStore.set(ee)}),we.isDone().then(()=>{console.log("Sync complete")}).catch(De=>{console.error("Sync failed",De)})}function ne(oe){M(0,G=!0),M(1,X=!0)}function re(){M(0,G=!0),M(1,X=!1),M(3,Q=!0),M(4,Z="identity")}function ie(){M(0,G=!0),M(1,X=!1),M(3,Q=!1)}function se(oe){M(2,Y=!0)}const le=new URLSearchParams(window.location.search);le.has("studio"),le.has("oracle");function he(){}function ce(){M(3,Q=!Q)}let ae,de=!1;const ge=()=>M(0,G=!G),fe=()=>M(3,Q=!0);return q.$$.update=()=>{q.$$.dirty&8192&&$&&te(),q.$$.dirty&4096&&(ae<=768?M(5,de=!0):M(5,de=!1))},M(12,ae=window.innerWidth),[G,X,Y,Q,Z,de,ne,re,ie,se,he,ce,ae,$,ge,fe]}class App extends SvelteComponent{constructor(_){super(),init(this,_,instance,create_fragment,safe_not_equal,{})}}new App({target:document.getElementById("app")});
